import{u as F,aL as V,d as j,at as L,w as D,ba as K,c as t,G as l,bx as z,H as s,al as H}from"./index.851b5188.js";import{M as $}from"./index.e69e8738.js";import{u as G,s as x,d as P}from"./index.module.9640d101.js";import{q as J,c as Q,v as W,u as Y,a as X}from"./index.56bd039e.js";import{N as Z}from"./Spin.447cad15.js";import{N as ee}from"./Form.9f7fa8c1.js";import{N as o}from"./FormItem.f5b3f80b.js";import{N as ae}from"./InputNumber.cc83334e.js";import{N as te}from"./RadioGroup.c3ead4f3.js";import{N as T}from"./Radio.fc32ca3b.js";import{N as u}from"./Input.79ba0d48.js";import{a as re}from"./Select.3e0f2c28.js";import{N as oe}from"./Space.f9ece73f.js";import{N as le}from"./Button.4e249408.js";import"./index.8acb741a.js";import"./keysOf.ab13e590.js";import"./Card.19bc42e2.js";import"./resolve-slot.9e6a0162.js";import"./index.7a579f81.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./utils.f449ed5c.js";import"./is-browser.45c3bd93.js";import"./index.3ef69258.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./lodash.68b7405b.js";import"./use-compitable.ae5454ac.js";import"./use-form-item.bb4d7ada.js";import"./format-length.d7d829b3.js";import"./get.aa32335f.js";import"./use-locale.f8ac8f2c.js";import"./use-merged-state.e40d3a9f.js";import"./Add.3164a73d.js";import"./get-slot.80096ab3.js";import"./Suffix.21a8a87f.js";import"./Selection.28a32045.js";import"./Popover.30015336.js";import"./_baseMap.9542141b.js";import"./next-frame-once.e5ee25e8.js";function se(n){const{t:c}=F(),a=V({saving:!1,testing:!1,loading:!1});let e;const m=()=>{const i=n();return{...i,other:i.other?JSON.parse(i.other):null}};return{status:a,queryById:async i=>{if(a.loading)return{};a.loading=!0;const p=await J(i);return a.loading=!1,e=p.name,p},testConnect:async()=>{if(!a.testing){a.testing=!0;try{const i=await Q(m());window.$message.success(i?i.msg:`${c("datasource.test_connect")} ${c("datasource.success")}`),a.testing=!1}catch{a.testing=!1}}},createOrUpdate:async i=>{const p=n();if(a.saving||!p.name)return!1;a.saving=!0;try{return e!==p.name&&await W({name:p.name}),i?await Y(m(),i):await X(m()),a.saving=!1,!0}catch{return a.saving=!1,!1}}}}function C(n){return typeof n=="function"||Object.prototype.toString.call(n)==="[object Object]"&&!H(n)}const ue={show:{type:Boolean,default:!1},id:{type:Number},selectType:{type:String,default:"MYSQL"}},Ze=j({name:"DetailModal",props:ue,emits:["cancel","update","open"],setup(n,c){var g;const{t:a}=F(),{state:e,changeType:m,changePort:b,resetFieldsValue:v,setFieldsValue:f,getFieldsValue:i}=G(n.id),{status:p,queryById:_,testConnect:w,createOrUpdate:d}=se(i),I=()=>{v(),c.emit("cancel")},U=async()=>{await e.detailFormRef.validate(),await d(n.id)&&(I(),c.emit("update"))},N=async()=>{await e.detailFormRef.validate(),w()},S=m,k=b,y=(g=L())==null?void 0:g.appContext.config.globalProperties.trim,q=()=>{c.emit("open")};return D(()=>n.show,async()=>{e.detailForm.type=n.selectType,e.detailForm.label=n.selectType==="HIVE"?"HIVE/IMPALA":n.selectType,n.show&&e.detailForm.type&&await m(e.detailForm.type,P[e.detailForm.type]),n.show&&n.id&&f(await _(n.id))}),D(()=>n.selectType,async()=>{e.detailForm.type=n.selectType,e.detailForm.label=n.selectType==="HIVE"?"HIVE/IMPALA":n.selectType,e.detailForm.type&&await m(e.detailForm.type,P[e.detailForm.type])}),{t:a,...K(e),...K(p),onChangeType:S,onChangePort:k,onSubmit:U,onTest:N,onCancel:I,trim:y,handleSourceModalOpen:q}},render(){const{show:n,id:c,t:a,detailForm:e,rules:m,requiredDataBase:b,showHost:v,showPort:f,showAwsRegion:i,showCompatibleMode:p,showConnectType:_,showPrincipal:w,showMode:d,showDataBaseName:I,showJDBCConnectParameters:U,showPublicKey:N,modeOptions:S,redShitModeOptions:k,loading:y,saving:q,testing:g,onChangePort:M,onCancel:R,onTest:O,onSubmit:E,handleSourceModalOpen:B}=this;return t($,{class:"dialog-create-data-source",show:n,title:`${a(c?"datasource.edit":"datasource.create")}${a("datasource.datasource")}`,onConfirm:E,confirmLoading:q||y,onCancel:R,confirmClassName:"btn-submit",cancelClassName:"btn-cancel"},{default:()=>{let h,A;return t(Z,{show:y},{default:()=>[t(ee,{rules:m,ref:"detailFormRef","require-mark-placement":"left","label-align":"left"},{default:()=>[t(o,{label:a("datasource.datasource"),path:"type","show-require-mark":!0},{default:()=>[t("div",{class:[x.typeBox,!!c&&x.disabledBox]},[l(t("div",{"onUpdate:value":r=>e.type=r},[e.label]),[[z,e.type,"value"]]),t("div",{class:[x["text-color"],"btn-data-source-type-drop-down"],onClick:B},[a("datasource.select")])])]}),t(o,{label:a("datasource.datasource_name"),path:"name","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-data-source-name",value:e.name,"onUpdate:value":r=>e.name=r,maxlength:60,placeholder:a("datasource.datasource_name_tips")},null)]}),t(o,{label:a("datasource.description"),path:"note"},{default:()=>[t(u,{class:"input-data-source-description",value:e.note,"onUpdate:value":r=>e.note=r,type:"textarea",placeholder:a("datasource.description_tips")},null)]}),l(t(o,{label:a("datasource.ip"),path:"host","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-ip",value:e.host,"onUpdate:value":r=>e.host=r,type:"text",maxlength:255,placeholder:a("datasource.ip_tips")},null)]}),[[s,v]]),l(t(o,{label:a("datasource.port"),path:"port","show-require-mark":!(d&&e.mode==="IAM-accessKey")},{default:()=>[t(ae,{class:"input-port",value:e.port,"onUpdate:value":r=>e.port=r,"show-button":!1,placeholder:a("datasource.port_tips"),"on-blur":M,style:{width:"100%"}},null)]}),[[s,f]]),l(t(o,{label:"Principal",path:"principal","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.principal,"onUpdate:value":r=>e.principal=r,type:"text",placeholder:a("datasource.principal_tips")},null)]}),[[s,w]]),l(t(o,{label:"krb5.conf",path:"javaSecurityKrb5Conf"},{default:()=>[t(u,{allowInput:this.trim,value:e.javaSecurityKrb5Conf,"onUpdate:value":r=>e.javaSecurityKrb5Conf=r,type:"text",placeholder:a("datasource.krb5_conf_tips")},null)]}),[[s,w]]),l(t(o,{label:a("datasource.validation"),path:"mode","show-require-mark":!0},{default:()=>[t(re,{value:e.mode,"onUpdate:value":r=>e.mode=r,options:e.type==="REDSHIFT"?k:S},null)]}),[[s,d]]),l(t(o,{label:a("datasource.database_username"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",placeholder:a("datasource.database_username")},null)]}),[[s,d&&e.mode==="SqlPassword"]]),l(t(o,{label:a("datasource.database_password"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.database_password")},null)]}),[[s,d&&e.mode==="SqlPassword"]]),l(t(o,{label:a("datasource.Azure_AD_username"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",placeholder:a("datasource.Azure_AD_username")},null)]}),[[s,d&&e.mode==="ActiveDirectoryPassword"]]),l(t(o,{label:a("datasource.Azure_AD_password"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.Azure_AD_password")},null)]}),[[s,d&&e.mode==="ActiveDirectoryPassword"]]),l(t(o,{label:a("datasource.MSIClientId"),path:"MSIClientId"},{default:()=>[t(u,{allowInput:this.trim,value:e.MSIClientId,"onUpdate:value":r=>e.MSIClientId=r,type:"password",placeholder:a("datasource.MSIClientId")},null)]}),[[s,d&&e.mode==="ActiveDirectoryMSI"]]),l(t(o,{label:a("datasource.clientId"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",placeholder:a("datasource.clientId")},null)]}),[[s,d&&e.mode==="ActiveDirectoryServicePrincipal"]]),l(t(o,{label:a("datasource.clientSecret"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.clientSecret")},null)]}),[[s,d&&e.mode==="ActiveDirectoryServicePrincipal"]]),l(t(o,{label:a("datasource.clientId"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",placeholder:a("datasource.clientId")},null)]}),[[s,d&&e.mode==="accessToken"]]),l(t(o,{label:a("datasource.clientSecret"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.clientSecret")},null)]}),[[s,d&&e.mode==="accessToken"]]),l(t(o,{label:a("datasource.OAuth_token_endpoint"),path:"endpoint","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.endpoint,"onUpdate:value":r=>e.endpoint=r,type:"text",placeholder:a("datasource.OAuth_token_endpoint")},null)]}),[[s,d&&e.mode==="accessToken"]]),l(t(o,{label:a("datasource.AccessKeyID"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",maxlength:60,placeholder:a("datasource.AccessKeyID_tips")},null)]}),[[s,d&&e.mode==="IAM-accessKey"]]),l(t(o,{label:a("datasource.SecretAccessKey"),path:"password","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.SecretAccessKey_tips")},null)]}),[[s,d&&e.mode==="IAM-accessKey"]]),l(t(o,{label:a("datasource.dbUser"),path:"dbUser","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-dbUser",value:e.dbUser,"onUpdate:value":r=>e.dbUser=r,type:"text",placeholder:a("datasource.dbUser_tips")},null)]}),[[s,d&&e.mode==="IAM-accessKey"]]),l(t(o,{label:"keytab.username",path:"loginUserKeytabUsername"},{default:()=>[t(u,{allowInput:this.trim,value:e.loginUserKeytabUsername,"onUpdate:value":r=>e.loginUserKeytabUsername=r,type:"text",placeholder:a("datasource.keytab_username_tips")},null)]}),[[s,w]]),l(t(o,{label:"keytab.path",path:"loginUserKeytabPath"},{default:()=>[t(u,{allowInput:this.trim,value:e.loginUserKeytabPath,"onUpdate:value":r=>e.loginUserKeytabPath=r,type:"text",placeholder:a("datasource.keytab_path_tips")},null)]}),[[s,w]]),l(t(o,{label:a("datasource.user_name"),path:"userName","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-username",value:e.userName,"onUpdate:value":r=>e.userName=r,type:"text",maxlength:60,placeholder:a("datasource.user_name_tips")},null)]}),[[s,!d||e.mode==="password"]]),l(t(o,{label:a("datasource.user_password"),path:"password"},{default:()=>[t(u,{allowInput:this.trim,class:"input-password",value:e.password,"onUpdate:value":r=>e.password=r,type:"password",placeholder:a("datasource.user_password_tips")},null)]}),[[s,!d||e.mode==="password"]]),l(t(o,{label:a("datasource.aws_region"),path:"awsRegion","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,value:e.awsRegion,"onUpdate:value":r=>e.awsRegion=r,type:"text",maxlength:60,placeholder:a("datasource.aws_region_tips")},null)]}),[[s,i]]),l(t(o,{label:a("datasource.database_name"),path:"database","show-require-mark":b},{default:()=>[t(u,{allowInput:this.trim,class:"input-data-base",value:e.database,"onUpdate:value":r=>e.database=r,type:"text",maxlength:60,placeholder:a("datasource.database_name_tips")},null)]}),[[s,I]]),e.type==="SNOWFLAKE"&&t(o,{label:a("datasource.datawarehouse"),path:"datawarehouse","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-datawarehouse",value:e.datawarehouse,"onUpdate:value":r=>e.datawarehouse=r,maxlength:60,placeholder:a("datasource.datawarehouse_tips")},null)]}),l(t(o,{label:a("datasource.oracle_connect_type"),path:"connectType","show-require-mark":!0},{default:()=>[t(te,{value:e.connectType,"onUpdate:value":r=>e.connectType=r},{default:()=>[t(oe,null,{default:()=>[t(T,{value:"ORACLE_SERVICE_NAME"},C(h=a("datasource.oracle_service_name"))?h:{default:()=>[h]}),t(T,{value:"ORACLE_SID"},C(A=a("datasource.oracle_sid"))?A:{default:()=>[A]})]})]})]}),[[s,_]]),l(t(o,{label:a("datasource.compatible_mode"),path:"compatibleMode","show-require-mark":!0},{default:()=>[t(u,{allowInput:this.trim,class:"input-data-base",value:e.compatibleMode,"onUpdate:value":r=>e.compatibleMode=r,type:"text",maxlength:60,placeholder:a("datasource.compatible_mode_tips")},null)]}),[[s,p]]),l(t(o,{label:a("datasource.jdbc_connect_parameters"),path:"other"},{default:()=>[t(u,{allowInput:this.trim,class:"input-jdbc-params",value:e.other,"onUpdate:value":r=>e.other=r,type:"textarea",autosize:{minRows:2},placeholder:`${a("datasource.format_tips")} {"key1":"value1","key2":"value2"...} ${a("datasource.connection_parameter")}`},null)]}),[[s,U]]),l(t(o,{label:"PublicKey",path:"publicKey"},{default:()=>[t(u,{value:e.publicKey,"onUpdate:value":r=>e.publicKey=r,type:"textarea",autosize:{minRows:4}},null)]}),[[s,N]])]})]})},"btn-middle":()=>{let h;return t(le,{class:"btn-test-connection",type:"primary",size:"small",onClick:O,loading:g||y},C(h=a("datasource.test_connect"))?h:{default:()=>[h]})}})}});export{Ze as default};
