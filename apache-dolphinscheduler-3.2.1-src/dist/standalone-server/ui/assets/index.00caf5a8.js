import{u as D,bt as S,aL as R,a as n,t as m,d as j,e as P,w as x,$ as E,ba as _,c as l}from"./index.851b5188.js";import{_ as N}from"./lodash.68b7405b.js";import{B as U}from"./index.8acb741a.js";import{d as z,e as v,f as O}from"./index.4701b8ec.js";import{a as b}from"./index.834fe2cc.js";import W from"./table-action.24aaa629.js";import{b as K,r as g,d as V}from"./common.ee372ad3.js";import{D as q,C as i,c as A}from"./column-width-config.4c11a147.js";import{N as B}from"./Ellipsis.b13f7726.js";import{N as L}from"./Icon.afc45566.js";import{N as $}from"./Spin.447cad15.js";import{N as C}from"./Tooltip.52cb9ce9.js";import{C as I}from"./index.6c124806.js";import M from"./process-instance-condition.67716e3c.js";import{N as T}from"./Space.f9ece73f.js";import{N as F,a as G}from"./DataTable.0e9ec324.js";import{N as H}from"./Button.4e249408.js";import{N as X}from"./Popconfirm.013915ef.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./FormOutlined.42f04dba.js";import"./SyncOutlined.95d4ed16.js";import"./CloseCircleOutlined.9e282d8c.js";import"./PlayCircleOutlined.28a7c420.js";import"./PauseCircleOutlined.28d888d0.js";import"./InfoCircleFilled.b53f03a6.js";import"./DeleteOutlined.07e1d3fe.js";import"./ControlOutlined.a4737fde.js";import"./Popover.30015336.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./_baseMap.9542141b.js";import"./get.aa32335f.js";import"./utils.f449ed5c.js";import"./format-length.d7d829b3.js";import"./resolve-slot.9e6a0162.js";import"./use-merged-state.e40d3a9f.js";import"./use-compitable.ae5454ac.js";import"./next-frame-once.e5ee25e8.js";import"./is-browser.45c3bd93.js";import"./use-form-item.bb4d7ada.js";import"./use-locale.f8ac8f2c.js";import"./keysOf.ab13e590.js";import"./get-slot.80096ab3.js";import"./index.7a579f81.js";import"./SettingOutlined.e20148d7.js";import"./CheckCircleOutlined.67794958.js";import"./EditOutlined.e0b6da4a.js";import"./index.d671386a.js";import"./Card.19bc42e2.js";import"./index.23da2c90.js";import"./SearchOutlined.3b9a5586.js";import"./Select.3e0f2c28.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./Selection.28a32045.js";import"./Suffix.21a8a87f.js";import"./index.3ef69258.js";import"./Input.79ba0d48.js";import"./DatePicker.b69ef36a.js";import"./typeof.b54b2da3.js";import"./use-keyboard.f4d2f0c0.js";import"./Forward.bddcd6d4.js";import"./ArrowDown.45f9e719.js";import"./Checkbox.98b84c16.js";import"./RadioGroup.c3ead4f3.js";import"./Radio.fc32ca3b.js";import"./Dropdown.4af83811.js";import"./ChevronRight.d6536995.js";function Y(){const{t:o}=D(),r=S(),e=R({columns:[],tableWidth:q,checkedRowKeys:[],tableData:[],page:n(1),pageSize:n(10),totalPage:n(1),searchVal:n(),executorName:n(),host:n(),stateType:n(),startDate:n(),endDate:n(),projectCode:n(Number(r.currentRoute.value.params.projectCode)),processDefineCode:r.currentRoute.value.query.processDefineCode?n(Number(r.currentRoute.value.query.processDefineCode)):n(),loadingRef:n(!1)}),u=a=>{a.columns=[{type:"selection",className:"btn-selected",...i.selection},{title:"#",key:"id",...i.index,render:(t,s)=>s+1},{title:o("project.workflow.workflow_instance_name"),key:"name",...i.linkName,className:"workflow-name",resizable:!0,width:300,minWidth:300,maxWidth:600,render:t=>m(U,{onClick:()=>{const s=r.resolve({name:"workflow-instance-detail",params:{id:t.id},query:{code:t.processDefinitionCode}});window.open(s.href,"_blank")}},{default:()=>m(B,{style:"max-width: 580px;line-height: 1.5"},()=>t.name)})},{title:o("project.workflow.status"),key:"state",...i.state,className:"workflow-status",render:t=>J(t.state,o)},{title:o("project.workflow.run_type"),key:"commandType",width:160,className:"workflow-run-type",render:t=>(N.filter(K(o),s=>s.code===t.commandType)[0]||{}).desc},{title:o("project.workflow.scheduling_time"),key:"scheduleTime",...i.time,render:t=>g(t.scheduleTime)},{title:o("project.workflow.start_time"),key:"startTime",...i.time,render:t=>g(t.startTime)},{title:o("project.workflow.end_time"),key:"endTime",...i.time,render:t=>g(t.endTime)},{title:o("project.workflow.duration"),key:"duration",...i.duration,render:t=>t.duration||"-"},{title:o("project.workflow.run_times"),key:"runTimes",...i.times,className:"workflow-run-times"},{title:o("project.workflow.fault_tolerant_sign"),key:"recovery",width:100},{title:o("project.workflow.dry_run_flag"),key:"dryRun",...i.dryRun,render:t=>t.dryRun===1?"YES":"NO"},{title:o("project.workflow.executor"),key:"executorName",...i.name},{title:o("project.workflow.host"),key:"host",...i.name},{title:o("project.workflow.operation"),key:"operation",...i.operation(7),render:(t,s)=>m(W,{row:t,onReRun:()=>c({index:s,processInstanceId:t.id,executeType:"REPEAT_RUNNING",buttonType:"run"}),onReStore:()=>c({index:s,processInstanceId:t.id,executeType:"START_FAILURE_TASK_PROCESS",buttonType:"store"}),onStop:()=>{t.state==="STOP"?c({index:s,processInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):h({processInstanceId:t.id,executeType:"STOP"})},onSuspend:()=>{t.state==="PAUSE"?c({index:s,processInstanceId:t.id,executeType:"RECOVER_SUSPENDED_PROCESS",buttonType:"suspend"}):h({processInstanceId:t.id,executeType:"PAUSE"})},onDeleteInstance:()=>d(t.id)})}],a.tableWidth&&(a.tableWidth=A(a.columns))},p=()=>{if(e.loadingRef)return;e.loadingRef=!0;const a={pageNo:e.page,pageSize:e.pageSize,searchVal:e.searchVal,executorName:e.executorName,host:e.host,stateType:e.stateType,startDate:e.startDate,endDate:e.endDate,processDefineCode:e.processDefineCode};z({...a},e.projectCode).then(t=>{e.totalPage=t.totalPage,e.tableData=t.totalList.map(s=>({...s})),e.loadingRef=!1})},d=a=>{v(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===1&&e.page>1&&(e.page-=1),p()})},y=()=>{const a={processInstanceIds:N.join(e.checkedRowKeys,",")};O(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],p()})},h=a=>{b(a,e.projectCode).then(()=>{window.$message.success(o("project.workflow.success")),p()})},k=(a,t)=>{let w,f;w||(f=10,w=setInterval(()=>{f>0&&f<=10?(f--,e.tableData[t].count=f):(a(),clearInterval(w),w=void 0)},1e3))},c=a=>{const{index:t}=a;e.tableData[t].buttonType=a.buttonType,b(a,e.projectCode).then(()=>{e.tableData[t].disabled=!0,window.$message.success(o("project.workflow.success")),k(()=>{p()},t)})};return{variables:e,createColumns:u,getTableData:p,batchDeleteInstance:y}}function J(o,r){if(!o)return"";const e=V(r)[o],u=m(L,{color:e.color,class:e.classNames,style:{display:"flex"},size:20},()=>m(e.icon));return m(C,null,{trigger:()=>e.isSpin?m($,{size:20},{icon:()=>u}):u,default:()=>e.desc})}const wt=j({name:"WorkflowInstanceList",setup(){let o;const{variables:r,createColumns:e,getTableData:u,batchDeleteInstance:p}=Y(),d=()=>{u()},y=c=>{r.processDefineCode=c.processDefineCode,r.searchVal=c.searchVal,r.executorName=c.executorName,r.host=c.host,r.stateType=c.stateType,r.startDate=c.startDate,r.endDate=c.endDate,r.page=1,d()},h=()=>{r.page=1,d()},k=()=>{p()};return P(()=>{e(r),d(),o=setInterval(()=>{d()},9e3)}),x(D().locale,()=>{e(r)}),E(()=>{clearInterval(o)}),{requestData:d,handleSearch:y,handleChangePageSize:h,handleBatchDelete:k,..._(r)}},render(){const{t:o}=D(),{loadingRef:r}=this;return l(T,{vertical:!0},{default:()=>[l(I,null,{default:()=>[l(M,{onHandleSearch:this.handleSearch},null)]}),l(I,{title:o("project.workflow.workflow_instance")},{default:()=>[l(T,{vertical:!0},{default:()=>[l(F,{loading:r,rowKey:e=>e.id,columns:this.columns,data:this.tableData,striped:!0,size:"small",scrollX:this.tableWidth,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":e=>this.checkedRowKeys=e,"row-class-name":"items-workflow-instances"},null),l(T,{justify:"center"},{default:()=>[l(G,{page:this.page,"onUpdate:page":e=>this.page=e,"page-size":this.pageSize,"onUpdate:page-size":e=>this.pageSize=e,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize},null)]})]}),l(C,null,{default:()=>o("project.workflow.delete"),trigger:()=>l(H,{tag:"div",type:"primary",disabled:this.checkedRowKeys.length<=0,style:"position: absolute; bottom: 10px; left: 10px;",class:"btn-delete-all"},{default:()=>[l(X,{onPositiveClick:this.handleBatchDelete},{default:()=>o("project.workflow.delete_confirm"),trigger:()=>o("project.workflow.delete")})]})})]})]})}});export{wt as default};
