import{u as g,bq as D,aL as I,a as q,e as R,d as S,at as U,w as A,ba as C,c as r,al as E}from"./index.851b5188.js";import{l as M}from"./lodash.68b7405b.js";import{q as $}from"./index.57e264b5.js";import{q as P}from"./index.a98592b7.js";import{v as z,u as Z,h as V}from"./index.58f13220.js";import{M as x}from"./index.e69e8738.js";import{N as j}from"./Form.9f7fa8c1.js";import{N as l}from"./FormItem.f5b3f80b.js";import{N as f}from"./Input.79ba0d48.js";import{a as w}from"./Select.3e0f2c28.js";import{N as L}from"./RadioGroup.c3ead4f3.js";import{N as O}from"./Space.f9ece73f.js";import{N}from"./Radio.fc32ca3b.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./index.8acb741a.js";import"./Button.4e249408.js";import"./is-browser.45c3bd93.js";import"./use-form-item.bb4d7ada.js";import"./resolve-slot.9e6a0162.js";import"./keysOf.ab13e590.js";import"./Card.19bc42e2.js";import"./index.7a579f81.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./utils.f449ed5c.js";import"./index.3ef69258.js";import"./format-length.d7d829b3.js";import"./get.aa32335f.js";import"./use-locale.f8ac8f2c.js";import"./use-merged-state.e40d3a9f.js";import"./Suffix.21a8a87f.js";import"./use-compitable.ae5454ac.js";import"./Selection.28a32045.js";import"./Popover.30015336.js";import"./_baseMap.9542141b.js";import"./next-frame-once.e5ee25e8.js";import"./get-slot.80096ab3.js";function T(){const{t:s}=g(),a=D().getUserInfo.userType==="ADMIN_USER",u={userName:"",userPassword:"",tenantId:null,email:"",queue:"",phone:"",state:1};let n;const e=I({formRef:q(),formData:{...u},saving:!1,loading:!1,queues:[],tenants:[]}),d={userName:{trigger:["input","blur"],required:!0,validator(o,t){if(!t.trim())return new Error(s("security.user.username_tips"))}},userPassword:{trigger:["input","blur"],required:!0,validator(o,t){if(!t||!/^(?![0-9]+$)(?![a-z]+$)(?![A-Z]+$)(?![`~!@#$%^&*()_\-+=<>?:"{}|,./;'\\[\]·~！@#￥%……&*（）——\-+={}|《》？：“”【】、；‘’，。、]+$)[`~!@#$%^&*()_\-+=<>?:"{}|,./;'\\[\]·~！@#￥%……&*（）——\-+={}|《》？：“”【】、；‘’，。、0-9A-Za-z]{6,22}$/.test(t))return new Error(s("security.user.user_password_tips"))}},tenantId:{trigger:["input","blur"],required:!0,validator(o,t){if(a&&!t)return new Error(s("security.user.tenant_id_tips"))}},email:{trigger:["input","blur"],required:!0,validator(o,t){if(!t)return new Error(s("security.user.email_empty_tips"));if(!/^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,}$/.test(t))return new Error(s("security.user.emial_correct_tips"))}},phone:{trigger:["input","blur"],required:!1,validator(o,t){const b=new RegExp("^[1][3,4,5,6,7,8,9][0-9]{9}$");if(t&&!b.test(t))return new Error(s("security.user.phone_correct_tips"))}}},h=async()=>{const o=await P();e.queues=o.map(t=>({label:t.queueName,value:t.queueName})),e.queues.length&&(u.queue=e.queues[0].value,e.formData.queue=e.queues[0].value)},p=async()=>{const o=await $();e.tenants=o.map(t=>({label:t.tenantCode,value:t.id})),e.tenants.length&&(u.tenantId=e.tenants[0].value,e.formData.tenantId=e.tenants[0].value)},v=()=>{e.formData={...u}},y=async o=>{try{return await e.formRef.validate(),e.saving?!1:(e.saving=!0,n!==e.formData.userName&&await z({userName:e.formData.userName}),o?await Z({id:o,...e.formData}):await V(e.formData),e.saving=!1,!0)}catch{return e.saving=!1,!1}},c=o=>{e.formData={...M.exports.pick(o,["userName","tenantId","email","queue","phone","state"]),userPassword:""},n=e.formData.userName};return R(async()=>{a&&(h(),p())}),{state:e,formRules:d,IS_ADMIN:a,onReset:v,onSave:y,onSetValues:c}}function _(s){return typeof s=="function"||Object.prototype.toString.call(s)==="[object Object]"&&!E(s)}const F={show:{type:Boolean,default:!1},currentRecord:{type:Object,default:{}}},$e=S({name:"user-modal",props:F,emits:["cancel","update"],setup(s,i){var c;const{t:m}=g(),{state:a,IS_ADMIN:u,formRules:n,onReset:e,onSave:d,onSetValues:h}=T(),p=()=>{e(),i.emit("cancel")},v=async()=>{var t;!await d((t=s.currentRecord)==null?void 0:t.id)||(p(),i.emit("update"))},y=(c=U())==null?void 0:c.appContext.config.globalProperties.trim;return A(()=>s.show,()=>{var o;s.show&&((o=s.currentRecord)==null?void 0:o.id)&&h(s.currentRecord)}),{t:m,...C(a),IS_ADMIN:u,formRules:n,onCancel:p,onConfirm:v,trim:y}},render(s){let i,m;const{t:a}=this,{currentRecord:u}=s;return r(x,{show:this.show,title:`${a(u!=null&&u.id?"security.user.edit_user":"security.user.create_user")}`,onCancel:this.onCancel,confirmLoading:this.loading,onConfirm:this.onConfirm,confirmClassName:"btn-submit",cancelClassName:"btn-cancel"},{default:()=>[r(j,{ref:"formRef",model:this.formData,rules:this.formRules,labelPlacement:"left",labelAlign:"left",labelWidth:120},{default:()=>{var n;return[r(l,{label:a("security.user.username"),path:"userName"},{default:()=>[r(f,{allowInput:this.trim,class:"input-username",value:this.formData.userName,"onUpdate:value":e=>this.formData.userName=e,minlength:3,maxlength:39,placeholder:a("security.user.username_tips")},null)]}),!((n=this.currentRecord)!=null&&n.id)&&r(l,{label:a("security.user.user_password"),path:"userPassword"},{default:()=>[r(f,{allowInput:this.trim,class:"input-password",type:"password",value:this.formData.userPassword,"onUpdate:value":e=>this.formData.userPassword=e,placeholder:a("security.user.user_password_tips")},null)]}),this.IS_ADMIN&&r(l,{label:a("security.user.tenant_code"),path:"tenantId"},{default:()=>[r(w,{class:"select-tenant",options:this.tenants,value:this.formData.tenantId,"onUpdate:value":e=>this.formData.tenantId=e},null)]}),this.IS_ADMIN&&r(l,{label:a("security.user.queue"),path:"queue"},{default:()=>[r(w,{class:"select-queue",options:this.queues,value:this.formData.queue,"onUpdate:value":e=>this.formData.queue=e,placeholder:a("security.user.queue_tips")},null)]}),r(l,{label:a("security.user.email"),path:"email"},{default:()=>[r(f,{allowInput:this.trim,class:"input-email",value:this.formData.email,"onUpdate:value":e=>this.formData.email=e,placeholder:a("security.user.email_empty_tips")},null)]}),r(l,{label:a("security.user.phone"),path:"phone"},{default:()=>[r(f,{allowInput:this.trim,class:"input-phone",value:this.formData.phone,"onUpdate:value":e=>this.formData.phone=e,placeholder:a("security.user.phone_empty_tips")},null)]}),r(l,{label:a("security.user.state"),path:"state"},{default:()=>[r(L,{value:this.formData.state,"onUpdate:value":e=>this.formData.state=e},{default:()=>[r(O,null,{default:()=>[r(N,{value:1,class:"radio-state-enable"},_(i=this.t("security.user.enable"))?i:{default:()=>[i]}),r(N,{value:0,class:"radio-state-disable"},_(m=this.t("security.user.disable"))?m:{default:()=>[m]})]})]})]})]}})]})}});export{$e as UserModal,$e as default};
