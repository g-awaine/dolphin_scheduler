import{l as ib}from"./lodash.68b7405b.js";import{h as ab,g as Ye,d as Fe,_ as Cm,c as fr,a as xt,b as lr,i as wi,f as Xt,e as Y,j as ob}from"./typeof.b54b2da3.js";import{bg as su}from"./index.851b5188.js";const kf=e=>typeof e=="number",Qx=e=>Number.isNaN(Number(e)),Zx=e=>e!==null&&typeof e=="object",Ro=e=>{if(e===null)return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array){const t=[];return e.forEach(r=>{t.push(r)}),t.map(r=>Ro(r))}if(typeof e=="object"&&e!=={}){const t=Object.assign({},e);return Object.keys(t).forEach(r=>{t[r]=Ro(t[r])}),t}return e};function sb(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Co;if(typeof sb=="function")try{Co=ib.exports}catch{}Co||(Co=window._);var Nr=Co,at=Nr,Su=gt,ub="\0",$n="\0",Df="";function gt(e){this._isDirected=at.has(e,"directed")?e.directed:!0,this._isMultigraph=at.has(e,"multigraph")?e.multigraph:!1,this._isCompound=at.has(e,"compound")?e.compound:!1,this._label=void 0,this._defaultNodeLabelFn=at.constant(void 0),this._defaultEdgeLabelFn=at.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children[$n]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}gt.prototype._nodeCount=0;gt.prototype._edgeCount=0;gt.prototype.isDirected=function(){return this._isDirected};gt.prototype.isMultigraph=function(){return this._isMultigraph};gt.prototype.isCompound=function(){return this._isCompound};gt.prototype.setGraph=function(e){return this._label=e,this};gt.prototype.graph=function(){return this._label};gt.prototype.setDefaultNodeLabel=function(e){return at.isFunction(e)||(e=at.constant(e)),this._defaultNodeLabelFn=e,this};gt.prototype.nodeCount=function(){return this._nodeCount};gt.prototype.nodes=function(){return at.keys(this._nodes)};gt.prototype.sources=function(){return at.filter(this.nodes(),at.bind(function(e){return at.isEmpty(this._in[e])},this))};gt.prototype.sinks=function(){return at.filter(this.nodes(),at.bind(function(e){return at.isEmpty(this._out[e])},this))};gt.prototype.setNodes=function(e,t){var r=arguments;return at.each(e,at.bind(function(n){r.length>1?this.setNode(n,t):this.setNode(n)},this)),this};gt.prototype.setNode=function(e,t){return at.has(this._nodes,e)?(arguments.length>1&&(this._nodes[e]=t),this):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]=$n,this._children[e]={},this._children[$n][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount,this)};gt.prototype.node=function(e){return this._nodes[e]};gt.prototype.hasNode=function(e){return at.has(this._nodes,e)};gt.prototype.removeNode=function(e){var t=this;if(at.has(this._nodes,e)){var r=function(n){t.removeEdge(t._edgeObjs[n])};delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],at.each(this.children(e),at.bind(function(n){this.setParent(n)},this)),delete this._children[e]),at.each(at.keys(this._in[e]),r),delete this._in[e],delete this._preds[e],at.each(at.keys(this._out[e]),r),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this};gt.prototype.setParent=function(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(at.isUndefined(t))t=$n;else{t+="";for(var r=t;!at.isUndefined(r);r=this.parent(r))if(r===e)throw new Error("Setting "+t+" as parent of "+e+" would create create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this};gt.prototype._removeFromParentsChildList=function(e){delete this._children[this._parent[e]][e]};gt.prototype.parent=function(e){if(this._isCompound){var t=this._parent[e];if(t!==$n)return t}};gt.prototype.children=function(e){if(at.isUndefined(e)&&(e=$n),this._isCompound){var t=this._children[e];if(t)return at.keys(t)}else{if(e===$n)return this.nodes();if(this.hasNode(e))return[]}};gt.prototype.predecessors=function(e){var t=this._preds[e];if(t)return at.keys(t)};gt.prototype.successors=function(e){var t=this._sucs[e];if(t)return at.keys(t)};gt.prototype.neighbors=function(e){var t=this.predecessors(e);if(t)return at.union(t,this.successors(e))};gt.prototype.isLeaf=function(e){var t;return this.isDirected()?t=this.successors(e):t=this.neighbors(e),t.length===0};gt.prototype.filterNodes=function(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph()),at.each(this._nodes,at.bind(function(a,o){e(o)&&t.setNode(o,a)},this)),at.each(this._edgeObjs,at.bind(function(a){t.hasNode(a.v)&&t.hasNode(a.w)&&t.setEdge(a,this.edge(a))},this));var r=this,n={};function i(a){var o=r.parent(a);return o===void 0||t.hasNode(o)?(n[a]=o,o):o in n?n[o]:i(o)}return this._isCompound&&at.each(t.nodes(),function(a){t.setParent(a,i(a))}),t};gt.prototype.setDefaultEdgeLabel=function(e){return at.isFunction(e)||(e=at.constant(e)),this._defaultEdgeLabelFn=e,this};gt.prototype.edgeCount=function(){return this._edgeCount};gt.prototype.edges=function(){return at.values(this._edgeObjs)};gt.prototype.setPath=function(e,t){var r=this,n=arguments;return at.reduce(e,function(i,a){return n.length>1?r.setEdge(i,a,t):r.setEdge(i,a),a}),this};gt.prototype.setEdge=function(){var e,t,r,n,i=!1,a=arguments[0];typeof a=="object"&&a!==null&&"v"in a?(e=a.v,t=a.w,r=a.name,arguments.length===2&&(n=arguments[1],i=!0)):(e=a,t=arguments[1],r=arguments[3],arguments.length>2&&(n=arguments[2],i=!0)),e=""+e,t=""+t,at.isUndefined(r)||(r=""+r);var o=ba(this._isDirected,e,t,r);if(at.has(this._edgeLabels,o))return i&&(this._edgeLabels[o]=n),this;if(!at.isUndefined(r)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[o]=i?n:this._defaultEdgeLabelFn(e,t,r);var s=cb(this._isDirected,e,t,r);return e=s.v,t=s.w,Object.freeze(s),this._edgeObjs[o]=s,Ff(this._preds[t],e),Ff(this._sucs[e],t),this._in[t][o]=s,this._out[e][o]=s,this._edgeCount++,this};gt.prototype.edge=function(e,t,r){var n=arguments.length===1?wu(this._isDirected,arguments[0]):ba(this._isDirected,e,t,r);return this._edgeLabels[n]};gt.prototype.hasEdge=function(e,t,r){var n=arguments.length===1?wu(this._isDirected,arguments[0]):ba(this._isDirected,e,t,r);return at.has(this._edgeLabels,n)};gt.prototype.removeEdge=function(e,t,r){var n=arguments.length===1?wu(this._isDirected,arguments[0]):ba(this._isDirected,e,t,r),i=this._edgeObjs[n];return i&&(e=i.v,t=i.w,delete this._edgeLabels[n],delete this._edgeObjs[n],Gf(this._preds[t],e),Gf(this._sucs[e],t),delete this._in[t][n],delete this._out[e][n],this._edgeCount--),this};gt.prototype.inEdges=function(e,t){var r=this._in[e];if(r){var n=at.values(r);return t?at.filter(n,function(i){return i.v===t}):n}};gt.prototype.outEdges=function(e,t){var r=this._out[e];if(r){var n=at.values(r);return t?at.filter(n,function(i){return i.w===t}):n}};gt.prototype.nodeEdges=function(e,t){var r=this.inEdges(e,t);if(r)return r.concat(this.outEdges(e,t))};function Ff(e,t){e[t]?e[t]++:e[t]=1}function Gf(e,t){--e[t]||delete e[t]}function ba(e,t,r,n){var i=""+t,a=""+r;if(!e&&i>a){var o=i;i=a,a=o}return i+Df+a+Df+(at.isUndefined(n)?ub:n)}function cb(e,t,r,n){var i=""+t,a=""+r;if(!e&&i>a){var o=i;i=a,a=o}var s={v:i,w:a};return n&&(s.name=n),s}function wu(e,t){return ba(e,t.v,t.w,t.name)}var fb="2.1.4",lb={Graph:Su,version:fb},Hr=Nr,db=Su,hb={write:vb,read:yb};function vb(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:pb(e),edges:mb(e)};return Hr.isUndefined(e.graph())||(t.value=Hr.clone(e.graph())),t}function pb(e){return Hr.map(e.nodes(),function(t){var r=e.node(t),n=e.parent(t),i={v:t};return Hr.isUndefined(r)||(i.value=r),Hr.isUndefined(n)||(i.parent=n),i})}function mb(e){return Hr.map(e.edges(),function(t){var r=e.edge(t),n={v:t.v,w:t.w};return Hr.isUndefined(t.name)||(n.name=t.name),Hr.isUndefined(r)||(n.value=r),n})}function yb(e){var t=new db(e.options).setGraph(e.value);return Hr.each(e.nodes,function(r){t.setNode(r.v,r.value),r.parent&&t.setParent(r.v,r.parent)}),Hr.each(e.edges,function(r){t.setEdge({v:r.v,w:r.w,name:r.name},r.value)}),t}var ro=Nr,_b=Eb;function Eb(e){var t={},r=[],n;function i(a){ro.has(t,a)||(t[a]=!0,n.push(a),ro.each(e.successors(a),i),ro.each(e.predecessors(a),i))}return ro.each(e.nodes(),function(a){n=[],i(a),n.length&&r.push(n)}),r}var xm=Nr,Nm=Or;function Or(){this._arr=[],this._keyIndices={}}Or.prototype.size=function(){return this._arr.length};Or.prototype.keys=function(){return this._arr.map(function(e){return e.key})};Or.prototype.has=function(e){return xm.has(this._keyIndices,e)};Or.prototype.priority=function(e){var t=this._keyIndices[e];if(t!==void 0)return this._arr[t].priority};Or.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key};Or.prototype.add=function(e,t){var r=this._keyIndices;if(e=String(e),!xm.has(r,e)){var n=this._arr,i=n.length;return r[e]=i,n.push({key:e,priority:t}),this._decrease(i),!0}return!1};Or.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key};Or.prototype.decrease=function(e,t){var r=this._keyIndices[e];if(t>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[r].priority+" New: "+t);this._arr[r].priority=t,this._decrease(r)};Or.prototype._heapify=function(e){var t=this._arr,r=2*e,n=r+1,i=e;r<t.length&&(i=t[r].priority<t[i].priority?r:i,n<t.length&&(i=t[n].priority<t[i].priority?n:i),i!==e&&(this._swap(e,i),this._heapify(i)))};Or.prototype._decrease=function(e){for(var t=this._arr,r=t[e].priority,n;e!==0&&(n=e>>1,!(t[n].priority<r));)this._swap(e,n),e=n};Or.prototype._swap=function(e,t){var r=this._arr,n=this._keyIndices,i=r[e],a=r[t];r[e]=a,r[t]=i,n[a.key]=e,n[i.key]=t};var bb=Nr,gb=Nm,Om=Ab,Tb=bb.constant(1);function Ab(e,t,r,n){return Sb(e,String(t),r||Tb,n||function(i){return e.outEdges(i)})}function Sb(e,t,r,n){var i={},a=new gb,o,s,u=function(c){var f=c.v!==o?c.v:c.w,d=i[f],p=r(c),g=s.distance+p;if(p<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+c+" Weight: "+p);g<d.distance&&(d.distance=g,d.predecessor=o,a.decrease(f,g))};for(e.nodes().forEach(function(c){var f=c===t?0:Number.POSITIVE_INFINITY;i[c]={distance:f},a.add(c,f)});a.size()>0&&(o=a.removeMin(),s=i[o],s.distance!==Number.POSITIVE_INFINITY);)n(o).forEach(u);return i}var wb=Om,Rb=Nr,Cb=xb;function xb(e,t,r){return Rb.transform(e.nodes(),function(n,i){n[i]=wb(e,i,t,r)},{})}var Bf=Nr,Im=Nb;function Nb(e){var t=0,r=[],n={},i=[];function a(o){var s=n[o]={onStack:!0,lowlink:t,index:t++};if(r.push(o),e.successors(o).forEach(function(f){Bf.has(n,f)?n[f].onStack&&(s.lowlink=Math.min(s.lowlink,n[f].index)):(a(f),s.lowlink=Math.min(s.lowlink,n[f].lowlink))}),s.lowlink===s.index){var u=[],c;do c=r.pop(),n[c].onStack=!1,u.push(c);while(o!==c);i.push(u)}}return e.nodes().forEach(function(o){Bf.has(n,o)||a(o)}),i}var Ob=Nr,Ib=Im,Pb=Lb;function Lb(e){return Ob.filter(Ib(e),function(t){return t.length>1||t.length===1&&e.hasEdge(t[0],t[0])})}var Mb=Nr,kb=Fb,Db=Mb.constant(1);function Fb(e,t,r){return Gb(e,t||Db,r||function(n){return e.outEdges(n)})}function Gb(e,t,r){var n={},i=e.nodes();return i.forEach(function(a){n[a]={},n[a][a]={distance:0},i.forEach(function(o){a!==o&&(n[a][o]={distance:Number.POSITIVE_INFINITY})}),r(a).forEach(function(o){var s=o.v===a?o.w:o.v,u=t(o);n[a][s]={distance:u,predecessor:a}})}),i.forEach(function(a){var o=n[a];i.forEach(function(s){var u=n[s];i.forEach(function(c){var f=u[a],d=o[c],p=u[c],g=f.distance+d.distance;g<p.distance&&(p.distance=g,p.predecessor=d.predecessor)})})}),n}var Hi=Nr,Pm=Lm;Lm.CycleException=uu;function Lm(e){var t={},r={},n=[];function i(a){if(Hi.has(r,a))throw new uu;Hi.has(t,a)||(r[a]=!0,t[a]=!0,Hi.each(e.predecessors(a),i),delete r[a],n.push(a))}if(Hi.each(e.sinks(),i),Hi.size(t)!==e.nodeCount())throw new uu;return n}function uu(){}var Uf=Pm,Bb=Ub;function Ub(e){try{Uf(e)}catch(t){if(t instanceof Uf.CycleException)return!1;throw t}return!0}var xo=Nr,Mm=$b;function $b(e,t,r){xo.isArray(t)||(t=[t]);var n=(e.isDirected()?e.successors:e.neighbors).bind(e),i=[],a={};return xo.each(t,function(o){if(!e.hasNode(o))throw new Error("Graph does not have node: "+o);km(e,o,r==="post",a,n,i)}),i}function km(e,t,r,n,i,a){xo.has(n,t)||(n[t]=!0,r||a.push(t),xo.each(i(t),function(o){km(e,o,r,n,i,a)}),r&&a.push(t))}var Vb=Mm,jb=zb;function zb(e,t){return Vb(e,t,"post")}var Hb=Mm,Xb=Wb;function Wb(e,t){return Hb(e,t,"pre")}var $f=Nr,Yb=Su,qb=Nm,Kb=Qb;function Qb(e,t){var r=new Yb,n={},i=new qb,a;function o(u){var c=u.v===a?u.w:u.v,f=i.priority(c);if(f!==void 0){var d=t(u);d<f&&(n[c]=a,i.decrease(c,d))}}if(e.nodeCount()===0)return r;$f.each(e.nodes(),function(u){i.add(u,Number.POSITIVE_INFINITY),r.setNode(u)}),i.decrease(e.nodes()[0],0);for(var s=!1;i.size()>0;){if(a=i.removeMin(),$f.has(n,a))r.setEdge(a,n[a]);else{if(s)throw new Error("Input graph is not connected: "+e);s=!0}e.nodeEdges(a).forEach(o)}return r}var Zb={components:_b,dijkstra:Om,dijkstraAll:Cb,findCycles:Pb,floydWarshall:kb,isAcyclic:Bb,postorder:jb,preorder:Xb,prim:Kb,tarjan:Im,topsort:Pm},Vf=lb,Jb={Graph:Vf.Graph,json:hb,alg:Zb,version:Vf.version};let cu=Jb;!cu&&typeof window<"u"&&(cu=window.graphlib);Array.prototype.flat||(Array.prototype.flat=function(e){let t=e||1;if(!isFinite(t))return;const r=this.length;let n=[];if(this.length===0)return this;for(;t--;){const i=[];let a=!1;if(n.length===0){a=!0;for(let o=0;o<r;o++)this[o]instanceof Array?n.push(...this[o]):n.push(this[o])}else{for(let o=0;o<n.length;o++)n[o]instanceof Array?(a=!0,i.push(...n[o])):i.push(n[o]);n=i}if(!a&&t===1/0)break}return n});const Tn=cu,jf=e=>{e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev},eg=(e,t)=>{if(e!=="_next"&&e!=="_prev")return t};class tg{constructor(){const t={};t._next=t._prev=t,this.isentinel=t}dequeue(){const t=this.isentinel,r=t._prev;if(r!==t)return jf(r),r}enqueue(){const t=this.isentinel,r=t._prev;if(r!==t)return jf(r),r}toString(){const t=[],r=this.isentinel;let n=r._prev;for(;n!==r;)t.push(JSON.stringify(n,eg)),n=n._prev;return`[${t.join(", ")}]`}}const rg=Tn.Graph,ng=()=>1,ig=(e,t)=>{var r;if(e.nodeCount()<=1)return[];const n=og(e,t||ng);return(r=ag(n.graph,n.buckets,n.zeroIdx).map(a=>e.outEdges(a.v,a.w)))===null||r===void 0?void 0:r.flat()},ag=(e,t,r)=>{let n=[];const i=t[t.length-1],a=t[0];let o;for(;e.nodeCount();){for(;o=a.dequeue();)Gs(e,t,r,o);for(;o=i.dequeue();)Gs(e,t,r,o);if(e.nodeCount()){for(let s=t.length-2;s>0;--s)if(o=t[s].dequeue(),o){n=n.concat(Gs(e,t,r,o,!0));break}}}return n},Gs=(e,t,r,n,i)=>{var a,o;const s=i?[]:void 0;return(a=e.inEdges(n.v))===null||a===void 0||a.forEach(u=>{const c=e.edge(u),f=e.node(u.v);i&&s.push({v:u.v,w:u.w}),f.out===void 0&&(f.out=0),f.out-=c,fu(t,r,f)}),(o=e.outEdges(n.v))===null||o===void 0||o.forEach(u=>{const c=e.edge(u),f=u.w,d=e.node(f);d.in===void 0&&(d.in=0),d.in-=c,fu(t,r,d)}),e.removeNode(n.v),s},og=(e,t)=>{const r=new rg;let n=0,i=0;e.nodes().forEach(u=>{r.setNode(u,{v:u,in:0,out:0})}),e.edges().forEach(u=>{const c=r.edge(u.v,u.w)||0,f=t==null?void 0:t(u),d=c+f;r.setEdge(u.v,u.w,d),i=Math.max(i,r.node(u.v).out+=f),n=Math.max(n,r.node(u.w).in+=f)});const a=[],o=i+n+3;for(let u=0;u<o;u++)a.push(new tg);const s=n+1;return r.nodes().forEach(u=>{fu(a,s,r.node(u))}),{buckets:a,zeroIdx:s,graph:r}},fu=(e,t,r)=>{r.out?r.in?e[r.out-r.in+t].enqueue(r):e[e.length-1].enqueue(r):e[0].enqueue(r)},sg=e=>{const t=n=>i=>n.edge(i).weight,r=e.graph().acyclicer==="greedy"?ig(e,t(e)):ug(e);r==null||r.forEach(n=>{const i=e.edge(n);e.removeEdge(n),i.forwardName=n.name,i.reversed=!0,e.setEdge(n.w,n.v,i,`rev-${Math.random()}`)})},ug=e=>{const t=[],r={},n={},i=a=>{var o;n.hasOwnProperty(a)||(n[a]=!0,r[a]=!0,(o=e.outEdges(a))===null||o===void 0||o.forEach(s=>{r.hasOwnProperty(s.w)?t.push(s):i(s.w)}),delete r[a])};return e.nodes().forEach(i),t},cg=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.reversed){e.removeEdge(t);const n=r.forwardName;delete r.reversed,delete r.forwardName,e.setEdge(t.w,t.v,r,n)}})},zf={run:sg,undo:cg},Dm=Tn.Graph,Fm=(e,t,r,n)=>{let i;do i=`${n}${Math.random()}`;while(e.hasNode(i));return r.dummy=t,e.setNode(i,r),i},Gm=e=>{const t=new Dm().setGraph(e.graph());return e.nodes().forEach(r=>{t.setNode(r,e.node(r))}),e.edges().forEach(r=>{const n=t.edge(r.v,r.w)||{weight:0,minlen:1},i=e.edge(r);t.setEdge(r.v,r.w,{weight:n.weight+i.weight,minlen:Math.max(n.minlen,i.minlen)})}),t},fg=e=>{const t=new Dm({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(r=>{var n;!((n=e.children(r))===null||n===void 0)&&n.length||t.setNode(r,e.node(r))}),e.edges().forEach(r=>t.setEdge(r,e.edge(r))),t},Mo=(e,t)=>{const r={};return e==null||e.forEach((n,i)=>{r[n]=t[i]}),r},lg=e=>{const t=e.nodes().map(r=>{var n;const i={};return(n=e.outEdges(r))===null||n===void 0||n.forEach(a=>{i[a.w]=(i[a.w]||0)+e.edge(a).weight}),i});return Mo(e.nodes(),t)},dg=e=>{const t=e.nodes().map(r=>{var n;const i={};return(n=e.inEdges(r))===null||n===void 0||n.forEach(a=>{i[a.v]=(i[a.v]||0)+e.edge(a).weight}),i});return Mo(e.nodes(),t)},hg=(e,t)=>{const r=e.x,n=e.y,i=t.x-r,a=t.y-n;let o=e.width/2,s=e.height/2;if(!i&&!a)return{x:0,y:0};let u,c;return Math.abs(a)*o>Math.abs(i)*s?(a<0&&(s=-s),u=s*i/a,c=s):(i<0&&(o=-o),u=o,c=o*a/i),{x:r+u,y:n+c}},vg=e=>{const t=[],r=[],n=$m(e)+1;for(let i=0;i<n;i++)t.push([]),r.push([]);return e.nodes().forEach(i=>{const o=e.node(i).rank;o!==void 0&&t[o]&&r[o].push(i)}),r==null||r.forEach((i,a)=>{i==null||i.sort((o,s)=>{var u,c;return((u=e.node(o))===null||u===void 0?void 0:u.order)-((c=e.node(s))===null||c===void 0?void 0:c.order)}),i.forEach(o=>{t[a].push(o)})}),t},Bm=e=>{const t=e.nodes().filter(n=>e.node(n).rank!==void 0).map(n=>e.node(n).rank),r=Math.min(...t);e.nodes().forEach(n=>{const i=e.node(n);i.hasOwnProperty("rank")&&(i.rank||(i.rank=0),i.rank-=r)})},Um=e=>{const t=e.nodes().filter(o=>e.node(o).rank!==void 0).map(o=>e.node(o).rank),r=Math.min(...t),n=[];e.nodes().forEach(o=>{var s;const u=(((s=e.node(o))===null||s===void 0?void 0:s.rank)||0)-r;n[u]||(n[u]=[]),n[u].push(o)});let i=0;const a=e.graph().nodeRankFactor||0;for(let o=0;o<n.length;o++){const s=n[o];s===void 0&&o%a!==0?--i:i&&(s==null||s.forEach(u=>{e.node(u).rank||(e.node(u).rank=0),e.node(u).rank+=i}))}},pg=(e,t,r,n)=>{const i={width:0,height:0};return kf(r)&&kf(n)&&(i.rank=r,i.order=n),Fm(e,"border",i,t)},$m=e=>{const t=e.nodes().map(r=>{const n=e.node(r).rank;return n!==void 0?n:-1/0});return Math.max(...t)},mg=(e,t)=>{const r={lhs:[],rhs:[]};return e==null||e.forEach(n=>{t(n)?r.lhs.push(n):r.rhs.push(n)}),r},yg=(e,t)=>{const r=Date.now();try{return t()}finally{console.log(`${e} time: ${Date.now()-r}ms`)}},_g=(e,t)=>t(),Ru=(e,t)=>{let r=1/0,n;return e==null||e.forEach(i=>{const a=t(i);r>a&&(r=a,n=i)}),n},Qt={addDummyNode:Fm,simplify:Gm,asNonCompoundGraph:fg,successorWeights:lg,predecessorWeights:dg,intersectRect:hg,buildLayerMatrix:vg,normalizeRanks:Bm,removeEmptyRanks:Um,addBorderNode:pg,maxRank:$m,partition:mg,time:yg,notime:_g,zipObject:Mo,minBy:Ru},Eg=e=>{e.graph().dummyChains=[],e.edges().forEach(t=>bg(e,t))},bg=(e,t)=>{var r,n;let i=t.v,a=e.node(i).rank;const o=t.w,s=e.node(o).rank,u=t.name,c=e.edge(t),f=c.labelRank;if(s===a+1)return;e.removeEdge(t);let d,p,g;for(g=0,++a;a<s;++g,++a)c.points=[],p={edgeLabel:c,width:0,height:0,edgeObj:t,rank:a},d=Qt.addDummyNode(e,"edge",p,"_d"),a===f&&(p.width=c.width,p.height=c.height,p.dummy="edge-label",p.labelpos=c.labelpos),e.setEdge(i,d,{weight:c.weight},u),g===0&&(e.graph().dummyChains||(e.graph().dummyChains=[]),(n=(r=e.graph())===null||r===void 0?void 0:r.dummyChains)===null||n===void 0||n.push(d)),i=d;e.setEdge(i,o,{weight:c.weight},u)},gg=e=>{var t;(t=e.graph().dummyChains)===null||t===void 0||t.forEach(r=>{var n;let i=e.node(r);const a=i.edgeLabel;let o;i.edgeObj&&e.setEdge(i.edgeObj,a);let s=r;for(;i.dummy;)o=(n=e.successors(s))===null||n===void 0?void 0:n[0],e.removeNode(s),a.points.push({x:i.x,y:i.y}),i.dummy==="edge-label"&&(a.x=i.x,a.y=i.y,a.width=i.width,a.height=i.height),s=o,i=e.node(s)})},Hf={run:Eg,undo:gg},Vm=e=>{var t;const r={},n=i=>{var a;const o=e.node(i);if(r.hasOwnProperty(i))return o.rank;r[i]=!0;const s=(a=e.outEdges(i))===null||a===void 0?void 0:a.map(c=>n(c.w)-e.edge(c).minlen||1/0);let u=Math.min(...s);return(u===Number.POSITIVE_INFINITY||u===void 0||u===null)&&(u=0),o.rank=u,u};(t=e.sources())===null||t===void 0||t.forEach(i=>n(i))},Tg=e=>{var t;const r={};let n=0;const i=o=>{var s;const u=e.node(o);if(r.hasOwnProperty(o))return u.rank;r[o]=!0;const c=(s=e.outEdges(o))===null||s===void 0?void 0:s.map(d=>i(d.w)-e.edge(d).minlen||1/0);let f=Math.min(...c);return(f===Number.POSITIVE_INFINITY||f===void 0||f===null)&&(f=0),u.rank=f,n=Math.min(u.rank,n),u.rank};(t=e.sources())===null||t===void 0||t.forEach(o=>i(o)),n+=1;const a=(o,s)=>{var u;const c=e.node(o),f=isNaN(c.layer)?s:c.layer;(c.rank===void 0||c.rank<f)&&(c.rank=f),(u=e.outEdges(o))===null||u===void 0||u.map(d=>{a(d.w,f+e.edge(d).minlen)})};e.nodes().forEach(o=>{const s=e.node(o);isNaN(s.layer)?s.rank-=n:a(o,s.layer)})},En=(e,t)=>e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen,jm=Tn.Graph,Ag=e=>{const t=new jm({directed:!1}),r=e.nodes()[0],n=e.nodeCount();t.setNode(r,{});let i,a;for(;Sg(t,e)<n;)i=zm(t,e),a=t.hasNode(i.v)?En(e,i):-En(e,i),Hm(t,e,a);return t},Sg=(e,t)=>{const r=n=>{t.nodeEdges(n).forEach(i=>{const a=i.v,o=n===a?i.w:a;!e.hasNode(o)&&!En(t,i)&&(e.setNode(o,{}),e.setEdge(n,o,{}),r(o))})};return e.nodes().forEach(r),e.nodeCount()},wg=e=>{const t=new jm({directed:!1}),r=e.nodes()[0],n=e.nodeCount();t.setNode(r,{});let i,a;for(;Rg(t,e)<n;)i=zm(t,e),a=t.hasNode(i.v)?En(e,i):-En(e,i),Hm(t,e,a);return t},Rg=(e,t)=>{const r=n=>{var i;(i=t.nodeEdges(n))===null||i===void 0||i.forEach(a=>{const o=a.v,s=n===o?a.w:o;!e.hasNode(s)&&(t.node(s).layer!==void 0||!En(t,a))&&(e.setNode(s,{}),e.setEdge(n,s,{}),r(s))})};return e.nodes().forEach(r),e.nodeCount()},zm=(e,t)=>Ru(t.edges(),r=>e.hasNode(r.v)!==e.hasNode(r.w)?En(t,r):1/0),Hm=(e,t,r)=>{e.nodes().forEach(n=>{t.node(n).rank||(t.node(n).rank=0),t.node(n).rank+=r})},Cg=Tn.alg,{preorder:xg,postorder:Ng}=Cg,zn=e=>{e=Gm(e),Vm(e);const t=Ag(e);xu(t),Cu(t,e);let r,n;for(;r=Ym(t);)n=qm(t,e,r),Km(t,e,r,n)},Cu=(e,t)=>{let r=Ng(e,e.nodes());r=r==null?void 0:r.slice(0,(r==null?void 0:r.length)-1),r==null||r.forEach(n=>{Og(e,t,n)})},Og=(e,t,r)=>{const i=e.node(r).parent;e.edge(r,i).cutvalue=Xm(e,t,r)},Xm=(e,t,r)=>{var n;const a=e.node(r).parent;let o=!0,s=t.edge(r,a),u=0;return s||(o=!1,s=t.edge(a,r)),u=s.weight,(n=t.nodeEdges(r))===null||n===void 0||n.forEach(c=>{const f=c.v===r,d=f?c.w:c.v;if(d!==a){const p=f===o,g=t.edge(c).weight;if(u+=p?g:-g,Pg(e,r,d)){const T=e.edge(r,d).cutvalue;u+=p?-T:T}}}),u},xu=(e,t)=>{t!==void 0&&(t=e.nodes()[0]),Wm(e,{},1,t)},Wm=(e,t,r,n,i)=>{var a;const o=r;let s=r;const u=e.node(n);return t[n]=!0,(a=e.neighbors(n))===null||a===void 0||a.forEach(c=>{t.hasOwnProperty(c)||(s=Wm(e,t,s,c,n))}),u.low=o,u.lim=s++,i?u.parent=i:delete u.parent,s},Ym=e=>e.edges().find(t=>e.edge(t).cutvalue<0),qm=(e,t,r)=>{let n=r.v,i=r.w;t.hasEdge(n,i)||(n=r.w,i=r.v);const a=e.node(n),o=e.node(i);let s=a,u=!1;a.lim>o.lim&&(s=o,u=!0);const c=t.edges().filter(f=>u===Xf(e,e.node(f.v),s)&&u!==Xf(e,e.node(f.w),s));return Ru(c,f=>En(t,f))},Km=(e,t,r,n)=>{const i=r.v,a=r.w;e.removeEdge(i,a),e.setEdge(n.v,n.w,{}),xu(e),Cu(e,t),Ig(e,t)},Ig=(e,t)=>{const r=e.nodes().find(i=>!t.node(i).parent);let n=xg(e,r);n=n==null?void 0:n.slice(1),n==null||n.forEach(i=>{const a=e.node(i).parent;let o=t.edge(i,a),s=!1;o||(o=t.edge(a,i),s=!0),t.node(i).rank=t.node(a).rank+(s?o.minlen:-o.minlen)})},Pg=(e,t,r)=>e.hasEdge(t,r),Xf=(e,t,r)=>r.low<=t.lim&&t.lim<=r.lim;zn.initLowLimValues=xu;zn.initCutValues=Cu;zn.calcCutValue=Xm;zn.leaveEdge=Ym;zn.enterEdge=qm;zn.exchangeEdges=Km;const Lg=e=>{switch(e.graph().ranker){case"network-simplex":kg(e);break;case"tight-tree":Wf(e);break;case"longest-path":Mg(e);break;default:Wf(e)}},Mg=Vm,Wf=e=>{Tg(e),wg(e)},kg=e=>{zn(e)},Dg=e=>{var t;const r=Gg(e);(t=e.graph().dummyChains)===null||t===void 0||t.forEach(n=>{var i,a;let o=e.node(n);const s=o.edgeObj;if(!s)return;const u=Fg(e,r,s.v,s.w),c=u.path,f=u.lca;let d=0,p=c[d],g=!0;for(;n!==s.w;){if(o=e.node(n),g){for(;(p=c[d])!==f&&e.node(p).maxRank<o.rank;)d++;p===f&&(g=!1)}if(!g){for(;d<c.length-1&&((i=e.node(p=c[d+1]))===null||i===void 0?void 0:i.minRank)<=o.rank;)d++;p=c[d]}e.setParent(n,p),n=(a=e.successors(n))===null||a===void 0?void 0:a[0]}})},Fg=(e,t,r,n)=>{const i=[],a=[],o=Math.min(t[r].low,t[n].low),s=Math.max(t[r].lim,t[n].lim);let u,c;u=r;do u=e.parent(u),i.push(u);while(u&&(t[u].low>o||s>t[u].lim));for(c=u,u=n;(u=e.parent(u))!==c;)a.push(u);return{lca:c,path:i.concat(a.reverse())}},Gg=e=>{var t;const r={};let n=0;const i=a=>{var o;const s=n;(o=e.children(a))===null||o===void 0||o.forEach(i),r[a]={low:s,lim:n++}};return(t=e.children())===null||t===void 0||t.forEach(i),r},Bg=e=>{var t;const r=Qt.addDummyNode(e,"root",{},"_root"),n=Ug(e),i=Math.max(...Object.values(n))-1,a=2*i+1;e.graph().nestingRoot=r,e.edges().forEach(s=>{e.edge(s).minlen*=a});const o=$g(e)+1;(t=e.children())===null||t===void 0||t.forEach(s=>{Qm(e,r,a,o,i,n,s)}),e.graph().nodeRankFactor=a},Qm=(e,t,r,n,i,a,o)=>{const s=e.children(o);if(!(s!=null&&s.length)){o!==t&&e.setEdge(t,o,{weight:0,minlen:r});return}const u=Qt.addBorderNode(e,"_bt"),c=Qt.addBorderNode(e,"_bb"),f=e.node(o);e.setParent(u,o),f.borderTop=u,e.setParent(c,o),f.borderBottom=c,s==null||s.forEach(d=>{Qm(e,t,r,n,i,a,d);const p=e.node(d),g=p.borderTop?p.borderTop:d,T=p.borderBottom?p.borderBottom:d,x=p.borderTop?n:2*n,O=g!==T?1:i-a[o]+1;e.setEdge(u,g,{minlen:O,weight:x,nestingEdge:!0}),e.setEdge(T,c,{minlen:O,weight:x,nestingEdge:!0})}),e.parent(o)||e.setEdge(t,u,{weight:0,minlen:i+a[o]})},Ug=e=>{var t;const r={},n=(i,a)=>{const o=e.children(i);o==null||o.forEach(s=>n(s,a+1)),r[i]=a};return(t=e.children())===null||t===void 0||t.forEach(i=>n(i,1)),r},$g=e=>{let t=0;return e.edges().forEach(r=>{t+=e.edge(r).weight}),t},Vg=e=>{const t=e.graph();t.nestingRoot&&e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(r=>{e.edge(r).nestingEdge&&e.removeEdge(r)})},Yf={run:Bg,cleanup:Vg},jg=e=>{var t;const r=n=>{const i=e.children(n),a=e.node(n);if(i!=null&&i.length&&i.forEach(o=>r(o)),a.hasOwnProperty("minRank")){a.borderLeft=[],a.borderRight=[];for(let o=a.minRank,s=a.maxRank+1;o<s;++o)qf(e,"borderLeft","_bl",n,a,o),qf(e,"borderRight","_br",n,a,o)}};(t=e.children())===null||t===void 0||t.forEach(n=>r(n))},qf=(e,t,r,n,i,a)=>{const o={rank:a,width:0,height:0,borderType:t},s=i[t][a-1],u=Qt.addDummyNode(e,"border",o,r);i[t][a]=u,e.setParent(u,n),s&&e.setEdge(s,u,{weight:1})},zg=e=>{var t;const r=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(r==="lr"||r==="rl")&&Zm(e)},Hg=e=>{var t;const r=(t=e.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(r==="bt"||r==="rl")&&Xg(e),(r==="lr"||r==="rl")&&(Wg(e),Zm(e))},Zm=e=>{e.nodes().forEach(t=>{Kf(e.node(t))}),e.edges().forEach(t=>{Kf(e.edge(t))})},Kf=e=>{const t=e.width;e.width=e.height,e.height=t},Xg=e=>{e.nodes().forEach(t=>{Bs(e.node(t))}),e.edges().forEach(t=>{var r;const n=e.edge(t);(r=n.points)===null||r===void 0||r.forEach(i=>Bs(i)),n.hasOwnProperty("y")&&Bs(n)})},Bs=e=>{e.y=-e.y},Wg=e=>{e.nodes().forEach(t=>{Us(e.node(t))}),e.edges().forEach(t=>{var r;const n=e.edge(t);(r=n.points)===null||r===void 0||r.forEach(i=>Us(i)),n.hasOwnProperty("x")&&Us(n)})},Us=e=>{const t=e.x;e.x=e.y,e.y=t},Qf={adjust:zg,undo:Hg},Zf=e=>{const t={},r=e.nodes().filter(f=>{var d;return!(!((d=e.children(f))===null||d===void 0)&&d.length)}),n=r.map(f=>e.node(f).rank),i=Math.max(...n),a=[];for(let f=0;f<i+1;f++)a.push([]);const o=f=>{var d;if(t.hasOwnProperty(f))return;t[f]=!0;const p=e.node(f);isNaN(p.rank)||a[p.rank].push(f),(d=e.successors(f))===null||d===void 0||d.forEach(g=>o(g))},s=r.sort((f,d)=>e.node(f).rank-e.node(d).rank),c=s.filter(f=>e.node(f).fixorder!==void 0).sort((f,d)=>e.node(f).fixorder-e.node(d).fixorder);return c==null||c.forEach(f=>{isNaN(e.node(f).rank)||a[e.node(f).rank].push(f),t[f]=!0}),s==null||s.forEach(o),a},Yg=(e,t,r)=>{const n=Mo(r,r.map((f,d)=>d)),a=t.map(f=>{var d;const p=(d=e.outEdges(f))===null||d===void 0?void 0:d.map(g=>({pos:n[g.w]||0,weight:e.edge(g).weight}));return p==null?void 0:p.sort((g,T)=>g.pos-T.pos)}).flat().filter(f=>f!==void 0);let o=1;for(;o<r.length;)o<<=1;const s=2*o-1;o-=1;const u=Array(s).fill(0,0,s);let c=0;return a==null||a.forEach(f=>{let d=f.pos+o;u[d]+=f.weight;let p=0;for(;d>0;)d%2&&(p+=u[d+1]),d=d-1>>1,u[d]+=f.weight;c+=f.weight*p}),c},Jf=(e,t)=>{let r=0;for(let n=1;n<(t==null?void 0:t.length);++n)r+=Yg(e,t[n-1],t[n]);return r},qg=Tn.Graph,Kg=(e,t,r)=>{const n=Qg(e),i=new qg({compound:!0}).setGraph({root:n}).setDefaultNodeLabel(a=>e.node(a));return e.nodes().forEach(a=>{const o=e.node(a),s=e.parent(a);(o.rank===t||o.minRank<=t&&t<=o.maxRank)&&(i.setNode(a),i.setParent(a,s||n),e[r](a).forEach(u=>{const c=u.v===a?u.w:u.v,f=i.edge(c,a),d=f!==void 0?f.weight:0;i.setEdge(c,a,{weight:e.edge(u).weight+d})}),o.hasOwnProperty("minRank")&&i.setNode(a,{borderLeft:o.borderLeft[t],borderRight:o.borderRight[t]}))}),i},Qg=e=>{let t;for(;e.hasNode(t=`_root${Math.random()}`););return t},Zg=(e,t,r)=>{const n={};let i;r==null||r.forEach(a=>{let o=e.parent(a),s,u;for(;o;){if(s=e.parent(o),s?(u=n[s],n[s]=o):(u=i,i=o),u&&u!==o){t.setEdge(u,o);return}o=s}})},Jg=(e,t)=>t.map(r=>{const n=e.inEdges(r);if(!(n!=null&&n.length))return{v:r};{const i={sum:0,weight:0};return n==null||n.forEach(a=>{const o=e.edge(a),s=e.node(a.v);i.sum+=o.weight*s.order,i.weight+=o.weight}),{v:r,barycenter:i.sum/i.weight,weight:i.weight}}}),eT=(e,t)=>{var r,n,i;const a={};e==null||e.forEach((s,u)=>{const c=a[s.v]={i:u,indegree:0,in:[],out:[],vs:[s.v]};s.barycenter!==void 0&&(c.barycenter=s.barycenter,c.weight=s.weight)}),(r=t.edges())===null||r===void 0||r.forEach(s=>{const u=a[s.v],c=a[s.w];u!==void 0&&c!==void 0&&(c.indegree++,u.out.push(a[s.w]))});const o=(i=(n=Object.values(a)).filter)===null||i===void 0?void 0:i.call(n,s=>!s.indegree);return tT(o)},tT=e=>{var t,r;const n=[],i=u=>c=>{c.merged||(c.barycenter===void 0||u.barycenter===void 0||c.barycenter>=u.barycenter)&&rT(u,c)},a=u=>c=>{c.in.push(u),--c.indegree===0&&e.push(c)};for(;e!=null&&e.length;){const u=e.pop();n.push(u),(t=u.in.reverse())===null||t===void 0||t.forEach(c=>i(u)(c)),(r=u.out)===null||r===void 0||r.forEach(c=>a(u)(c))}const o=n.filter(u=>!u.merged),s=["vs","i","barycenter","weight"];return o.map(u=>{const c={};return s==null||s.forEach(f=>{u[f]!==void 0&&(c[f]=u[f])}),c})},rT=(e,t)=>{var r;let n=0,i=0;e.weight&&(n+=e.barycenter*e.weight,i+=e.weight),t.weight&&(n+=t.barycenter*t.weight,i+=t.weight),e.vs=(r=t.vs)===null||r===void 0?void 0:r.concat(e.vs),e.barycenter=n/i,e.weight=i,e.i=Math.min(t.i,e.i),t.merged=!0},nT=(e,t,r)=>{const n=Qt.partition(e,d=>d.hasOwnProperty("fixorder")&&!isNaN(d.fixorder)||d.hasOwnProperty("barycenter")),i=n.lhs,a=n.rhs.sort((d,p)=>-d.i- -p.i),o=[];let s=0,u=0,c=0;i==null||i.sort(iT(!!t,!!r)),c=el(o,a,c),i==null||i.forEach(d=>{var p;c+=(p=d.vs)===null||p===void 0?void 0:p.length,o.push(d.vs),s+=d.barycenter*d.weight,u+=d.weight,c=el(o,a,c)});const f={vs:o.flat()};return u&&(f.barycenter=s/u,f.weight=u),f},el=(e,t,r)=>{let n=r,i;for(;t.length&&(i=t[t.length-1]).i<=n;)t.pop(),e==null||e.push(i.vs),n++;return n},iT=(e,t)=>(r,n)=>{if(r.fixorder!==void 0&&n.fixorder!==void 0)return r.fixorder-n.fixorder;if(r.barycenter<n.barycenter)return-1;if(r.barycenter>n.barycenter)return 1;if(t&&r.order!==void 0&&n.order!==void 0){if(r.order<n.order)return-1;if(r.order>n.order)return 1}return e?n.i-r.i:r.i-n.i},Jm=(e,t,r,n,i)=>{var a,o,s,u;let c=e.children(t);const f=e.node(t),d=f?f.borderLeft:void 0,p=f?f.borderRight:void 0,g={};d&&(c=c==null?void 0:c.filter(z=>z!==d&&z!==p));const T=Jg(e,c||[]);T==null||T.forEach(z=>{var ie;if(!((ie=e.children(z.v))===null||ie===void 0)&&ie.length){const X=Jm(e,z.v,r,n);g[z.v]=X,X.hasOwnProperty("barycenter")&&oT(z,X)}});const x=eT(T,r);aT(x,g),(a=x.filter(z=>{var ie;return!!z.vs||((ie=z.vs)===null||ie===void 0?void 0:ie.length)>0}))===null||a===void 0||a.forEach(z=>{const ie=e.node(z.vs[0]);z.fixorder=ie.fixorder,z.order=ie.order});const O=nT(x,n,i);if(d&&(O.vs=[d,O.vs,p].flat(),!((o=e.predecessors(d))===null||o===void 0)&&o.length)){const z=e.node(((s=e.predecessors(d))===null||s===void 0?void 0:s[0])||{}),ie=e.node(((u=e.predecessors(p))===null||u===void 0?void 0:u[0])||{});O.hasOwnProperty("barycenter")||(O.barycenter=0,O.weight=0),O.barycenter=(O.barycenter*O.weight+z.order+ie.order)/(O.weight+2),O.weight+=2}return O},aT=(e,t)=>{e==null||e.forEach(r=>{var n;const i=(n=r.vs)===null||n===void 0?void 0:n.map(a=>t[a]?t[a].vs:a);r.vs=i.flat()})},oT=(e,t)=>{e.barycenter!==void 0?(e.barycenter=(e.barycenter*e.weight+t.barycenter*t.weight)/(e.weight+t.weight),e.weight+=t.weight):(e.barycenter=t.barycenter,e.weight=t.weight)},sT=Tn.Graph,uT=e=>{const t=Qt.maxRank(e),r=[],n=[];for(let c=1;c<t+1;c++)r.push(c);for(let c=t-1;c>-1;c--)n.push(c);const i=tl(e,r,"inEdges"),a=tl(e,n,"outEdges");let o=Zf(e);$s(e,o);let s=Number.POSITIVE_INFINITY,u;for(let c=0,f=0;f<4;++c,++f){rl(c%2?i:a,c%4>=2),o=Qt.buildLayerMatrix(e);const d=Jf(e,o);d<s&&(f=0,u=Ro(o),s=d)}o=Zf(e),$s(e,o);for(let c=0,f=0;f<4;++c,++f){rl(c%2?i:a,c%4>=2,!0),o=Qt.buildLayerMatrix(e);const d=Jf(e,o);d<s&&(f=0,u=Ro(o),s=d)}$s(e,u)},tl=(e,t,r)=>t.map(n=>Kg(e,n,r)),rl=(e,t,r)=>{const n=new sT;e==null||e.forEach(i=>{var a;const o=i.graph().root,s=Jm(i,o,n,t,r);for(let u=0;u<((a=s.vs)===null||a===void 0?void 0:a.length);u++)i.node(s.vs[u]).order=u;Zg(i,n,s.vs)})},$s=(e,t)=>{t==null||t.forEach(r=>{r==null||r.forEach((n,i)=>{e.node(n).order=i})})},cT=Tn.Graph,fT=(e,t)=>{const r={},n=(i,a)=>{let o=0,s=0;const u=i.length,c=a==null?void 0:a[(a==null?void 0:a.length)-1];return a==null||a.forEach((f,d)=>{var p;const g=dT(e,f),T=g?e.node(g).order:u;(g||f===c)&&((p=a.slice(s,d+1))===null||p===void 0||p.forEach(x=>{var O;(O=e.predecessors(x))===null||O===void 0||O.forEach(z=>{const ie=e.node(z),X=ie.order;(X<o||T<X)&&!(ie.dummy&&e.node(x).dummy)&&ey(r,z,x)})}),s=d+1,o=T)}),a};return t!=null&&t.length&&t.reduce(n),r},lT=(e,t)=>{const r={},n=(a,o,s,u,c)=>{let f;const d=[];for(let p=o;p<s;p++)d.push(p);d.forEach(p=>{var g;f=a[p],e.node(f).dummy&&((g=e.predecessors(f))===null||g===void 0||g.forEach(T=>{const x=e.node(T);x.dummy&&(x.order<u||x.order>c)&&ey(r,T,f)}))})},i=(a,o)=>{let s=-1,u,c=0;return o==null||o.forEach((f,d)=>{if(e.node(f).dummy==="border"){const p=e.predecessors(f)||[];p.length&&(u=e.node(p[0]).order,n(o,c,d,s,u),c=d,s=u)}n(o,c,o.length,u,a.length)}),o};return t!=null&&t.length&&t.reduce(i),r},dT=(e,t)=>{var r;if(e.node(t).dummy)return(r=e.predecessors(t))===null||r===void 0?void 0:r.find(n=>e.node(n).dummy)},ey=(e,t,r)=>{let n=t,i=r;if(n>i){const o=n;n=i,i=o}let a=e[n];a||(e[n]=a={}),a[i]=!0},hT=(e,t,r)=>{let n=t,i=r;if(n>i){const a=t;n=i,i=a}return e[n]&&e[n].hasOwnProperty(i)},vT=(e,t,r,n)=>{const i={},a={},o={};return t==null||t.forEach(s=>{s==null||s.forEach((u,c)=>{i[u]=u,a[u]=u,o[u]=c})}),t==null||t.forEach(s=>{let u=-1;s==null||s.forEach(c=>{let f=n(c);if(f.length){f=f.sort((p,g)=>o[p]-o[g]);const d=(f.length-1)/2;for(let p=Math.floor(d),g=Math.ceil(d);p<=g;++p){const T=f[p];a[c]===c&&u<o[T]&&!hT(r,c,T)&&(a[T]=c,a[c]=i[c]=i[T],u=o[T])}}})}),{root:i,align:a}},pT=(e,t,r,n,i)=>{var a;const o={},s=mT(e,t,r,i),u=i?"borderLeft":"borderRight",c=(p,g)=>{let T=s.nodes(),x=T.pop();const O={};for(;x;)O[x]?p(x):(O[x]=!0,T.push(x),T=T.concat(g(x))),x=T.pop()},f=p=>{o[p]=(s.inEdges(p)||[]).reduce((g,T)=>Math.max(g,(o[T.v]||0)+s.edge(T)),0)},d=p=>{const g=(s.outEdges(p)||[]).reduce((x,O)=>Math.min(x,(o[O.w]||0)-s.edge(O)),Number.POSITIVE_INFINITY),T=e.node(p);g!==Number.POSITIVE_INFINITY&&T.borderType!==u&&(o[p]=Math.max(o[p],g))};return c(f,s.predecessors.bind(s)),c(d,s.successors.bind(s)),(a=Object.values(n))===null||a===void 0||a.forEach(p=>{o[p]=o[r[p]]}),o},mT=(e,t,r,n)=>{const i=new cT,a=e.graph(),o=bT(a.nodesep,a.edgesep,n);return t==null||t.forEach(s=>{let u;s==null||s.forEach(c=>{const f=r[c];if(i.setNode(f),u){const d=r[u],p=i.edge(d,f);i.setEdge(d,f,Math.max(o(e,c,u),p||0))}u=c})}),i},yT=(e,t)=>Qt.minBy(Object.values(t),r=>{var n;let i=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;return(n=Object.keys(r))===null||n===void 0||n.forEach(o=>{const s=r[o],u=gT(e,o)/2;i=Math.max(s+u,i),a=Math.min(s-u,a)}),i-a});function _T(e,t){const r=Object.values(t),n=Math.min(...r),i=Math.max(...r);["u","d"].forEach(a=>{["l","r"].forEach(o=>{const s=a+o,u=e[s];let c;if(u===t)return;const f=Object.values(u);c=o==="l"?n-Math.min(...f):i-Math.max(...f),c&&(e[s]={},Object.keys(u).forEach(d=>{e[s][d]=u[d]+c}))})})}const ET=(e,t)=>{const r={};return Object.keys(e.ul).forEach(n=>{if(t)r[n]=e[t.toLowerCase()][n];else{const a=Object.values(e).map(o=>o[n]).sort((o,s)=>o-s);r[n]=(a[1]+a[2])/2}}),r},bT=(e,t,r)=>(n,i,a)=>{const o=n.node(i),s=n.node(a);let u=0,c;if(u+=o.width/2,o.hasOwnProperty("labelpos"))switch((o.labelpos||"").toLowerCase()){case"l":c=-o.width/2;break;case"r":c=o.width/2;break}if(c&&(u+=r?c:-c),c=0,u+=(o.dummy?t:e)/2,u+=(s.dummy?t:e)/2,u+=s.width/2,s.hasOwnProperty("labelpos"))switch((s.labelpos||"").toLowerCase()){case"l":c=s.width/2;break;case"r":c=-s.width/2;break}return c&&(u+=r?c:-c),c=0,u},gT=(e,t)=>{var r;return((r=e.node(t))===null||r===void 0?void 0:r.width)||0},TT=e=>{const t=Qt.buildLayerMatrix(e),r=e.graph().ranksep;let n=0;t==null||t.forEach(i=>{const a=i.map(s=>e.node(s).height),o=Math.max(...a);i==null||i.forEach(s=>{e.node(s).y=n+o/2}),n+=o+r})},AT=e=>{const t=Qt.buildLayerMatrix(e),r=Object.assign(fT(e,t),lT(e,t)),n={};let i;["u","d"].forEach(o=>{i=o==="u"?t:Object.values(t).reverse(),["l","r"].forEach(s=>{s==="r"&&(i=i.map(d=>Object.values(d).reverse()));const u=(o==="u"?e.predecessors:e.successors).bind(e),c=vT(e,i,r,u),f=pT(e,i,c.root,c.align,s==="r");s==="r"&&Object.keys(f).forEach(d=>f[d]=-f[d]),n[o+s]=f})});const a=yT(e,n);return a&&_T(n,a),ET(n,e.graph().align)},ST=e=>{var t;e=Qt.asNonCompoundGraph(e),TT(e);const r=AT(e);(t=Object.keys(r))===null||t===void 0||t.forEach(n=>{e.node(n).x=r[n]})},wT=(e,t)=>{const n=e.nodes().filter(o=>{var s;return!(!((s=e.children(o))===null||s===void 0)&&s.length)}).map(o=>e.node(o).rank),i=Math.max(...n),a=[];for(let o=0;o<i+1;o++)a.push([]);t==null||t.forEach(o=>{const s=e.node(o);!s||s.dummy||isNaN(s.rank)||(s.fixorder=a[s.rank].length,a[s.rank].push(o))})},RT=Tn.Graph,Jx=(e,t)=>{const r=t&&t.debugTiming?Qt.time:Qt.notime;r("layout",()=>{t&&!t.keepNodeOrder&&t.prevGraph&&r("  inheritOrder",()=>{xT(e,t.prevGraph)});const n=r("  buildLayoutGraph",()=>kT(e));t&&t.edgeLabelSpace===!1||r("  makeSpaceForEdgeLabels",()=>{DT(n)});try{r("  runLayout",()=>{CT(n,r,t)})}catch(i){if(i.message==="Not possible to find intersection inside of the rectangle"){console.error(`The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:
`,i);return}throw i}r("  updateInputGraph",()=>{NT(e,n)})})},CT=(e,t,r)=>{t("    removeSelfEdges",()=>{HT(e)}),t("    acyclic",()=>{zf.run(e)}),t("    nestingGraph.run",()=>{Yf.run(e)}),t("    rank",()=>{Lg(Qt.asNonCompoundGraph(e))}),t("    injectEdgeLabelProxies",()=>{FT(e)}),t("    removeEmptyRanks",()=>{Um(e)}),t("    nestingGraph.cleanup",()=>{Yf.cleanup(e)}),t("    normalizeRanks",()=>{Bm(e)}),t("    assignRankMinMax",()=>{GT(e)}),t("    removeEdgeLabelProxies",()=>{BT(e)}),t("    normalize.run",()=>{Hf.run(e)}),t("    parentDummyChains",()=>{Dg(e)}),t("    addBorderSegments",()=>{jg(e)}),r&&r.keepNodeOrder&&t("    initDataOrder",()=>{wT(e,r.nodeOrder)}),t("    order",()=>{uT(e)}),t("    insertSelfEdges",()=>{XT(e)}),t("    adjustCoordinateSystem",()=>{Qf.adjust(e)}),t("    position",()=>{ST(e)}),t("    positionSelfEdges",()=>{WT(e)}),t("    removeBorderNodes",()=>{zT(e)}),t("    normalize.undo",()=>{Hf.undo(e)}),t("    fixupEdgeLabelCoords",()=>{VT(e)}),t("    undoCoordinateSystem",()=>{Qf.undo(e)}),t("    translateGraph",()=>{UT(e)}),t("    assignNodeIntersects",()=>{$T(e)}),t("    reversePoints",()=>{jT(e)}),t("    acyclic.undo",()=>{zf.undo(e)})},xT=(e,t)=>{const r=t._nodes||{};e.nodes().forEach(n=>{const i=e.node(n);r[n]!==void 0?(i.fixorder=r[n]._order,delete r[n]._order):delete i.fixorder})},NT=(e,t)=>{e.nodes().forEach(r=>{var n;const i=e.node(r),a=t.node(r);i&&(i.x=a.x,i.y=a.y,i._order=a.order,i._rank=a.rank,!((n=t.children(r))===null||n===void 0)&&n.length&&(i.width=a.width,i.height=a.height))}),e.edges().forEach(r=>{const n=e.edge(r),i=t.edge(r);n.points=i.points,i.hasOwnProperty("x")&&(n.x=i.x,n.y=i.y)}),e.graph().width=t.graph().width,e.graph().height=t.graph().height},OT=["nodesep","edgesep","ranksep","marginx","marginy"],IT={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Vs=["acyclicer","ranker","rankdir","align"],PT=["width","height","layer","fixorder"],nl={width:0,height:0},LT=["minlen","weight","width","height","labeloffset"],MT={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},js=["labelpos"],kT=e=>{const t=new RT({multigraph:!0,compound:!0}),r=Hs(e.graph()),n={};return Vs==null||Vs.forEach(i=>{r[i]!==void 0&&(n[i]=r[i])}),t.setGraph(Object.assign({},IT,zs(r,OT),n)),e.nodes().forEach(i=>{const a=Hs(e.node(i)),o=zs(a,PT);Object.keys(nl).forEach(s=>{o[s]===void 0&&(o[s]=nl[s])}),t.setNode(i,o),t.setParent(i,e.parent(i))}),e.edges().forEach(i=>{const a=Hs(e.edge(i)),o={};js==null||js.forEach(s=>{a[s]!==void 0&&(o[s]=a[s])}),t.setEdge(i,Object.assign({},MT,zs(a,LT),o))}),t},DT=e=>{const t=e.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,e.nodes().forEach(r=>{const n=e.node(r);isNaN(n.layer)||(n.layer?n.layer*=2:n.layer=0)}),e.edges().forEach(r=>{var n;const i=e.edge(r);i.minlen*=2,((n=i.labelpos)===null||n===void 0?void 0:n.toLowerCase())!=="c"&&(t.rankdir==="TB"||t.rankdir==="BT"?i.width+=i.labeloffset:i.height+=i.labeloffset)})},FT=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.width&&r.height){const n=e.node(t.v),i=e.node(t.w),a={e:t,rank:(i.rank-n.rank)/2+n.rank};Qt.addDummyNode(e,"edge-proxy",a,"_ep")}})},GT=e=>{let t=0;e.nodes().forEach(r=>{const n=e.node(r);n.borderTop&&(n.minRank=e.node(n.borderTop).rank,n.maxRank=e.node(n.borderBottom).rank,t=Math.max(t,n.maxRank||-1/0))}),e.graph().maxRank=t},BT=e=>{e.nodes().forEach(t=>{const r=e.node(t);r.dummy==="edge-proxy"&&(e.edge(r.e).labelRank=r.rank,e.removeNode(t))})},UT=e=>{let t=Number.POSITIVE_INFINITY,r=0,n=Number.POSITIVE_INFINITY,i=0;const a=e.graph(),o=a.marginx||0,s=a.marginy||0,u=c=>{if(!c)return;const f=c.x,d=c.y,p=c.width,g=c.height;!isNaN(f)&&!isNaN(p)&&(t=Math.min(t,f-p/2),r=Math.max(r,f+p/2)),!isNaN(d)&&!isNaN(g)&&(n=Math.min(n,d-g/2),i=Math.max(i,d+g/2))};e.nodes().forEach(c=>{u(e.node(c))}),e.edges().forEach(c=>{const f=e.edge(c);f.hasOwnProperty("x")&&u(f)}),t-=o,n-=s,e.nodes().forEach(c=>{const f=e.node(c);f.x-=t,f.y-=n}),e.edges().forEach(c=>{var f;const d=e.edge(c);(f=d.points)===null||f===void 0||f.forEach(p=>{p.x-=t,p.y-=n}),d.hasOwnProperty("x")&&(d.x-=t),d.hasOwnProperty("y")&&(d.y-=n)}),a.width=r-t+o,a.height=i-n+s},$T=e=>{e.edges().forEach(t=>{const r=e.edge(t),n=e.node(t.v),i=e.node(t.w);let a,o;r.points?(a=r.points[0],o=r.points[r.points.length-1]):(r.points=[],a=i,o=n),r.points.unshift(Qt.intersectRect(n,a)),r.points.push(Qt.intersectRect(i,o))})},VT=e=>{e.edges().forEach(t=>{const r=e.edge(t);if(r.hasOwnProperty("x"))switch((r.labelpos==="l"||r.labelpos==="r")&&(r.width-=r.labeloffset),r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset;break}})},jT=e=>{e.edges().forEach(t=>{const r=e.edge(t);r.reversed&&r.points.reverse()})},zT=e=>{e.nodes().forEach(t=>{var r,n,i;if(!((r=e.children(t))===null||r===void 0)&&r.length){const a=e.node(t),o=e.node(a.borderTop),s=e.node(a.borderBottom),u=e.node(a.borderLeft[((n=a.borderLeft)===null||n===void 0?void 0:n.length)-1]),c=e.node(a.borderRight[((i=a.borderRight)===null||i===void 0?void 0:i.length)-1]);a.width=Math.abs((c==null?void 0:c.x)-(u==null?void 0:u.x))||10,a.height=Math.abs((s==null?void 0:s.y)-(o==null?void 0:o.y))||10,a.x=((u==null?void 0:u.x)||0)+a.width/2,a.y=((o==null?void 0:o.y)||0)+a.height/2}}),e.nodes().forEach(t=>{e.node(t).dummy==="border"&&e.removeNode(t)})},HT=e=>{e.edges().forEach(t=>{if(t.v===t.w){const r=e.node(t.v);r.selfEdges||(r.selfEdges=[]),r.selfEdges.push({e:t,label:e.edge(t)}),e.removeEdge(t)}})},XT=e=>{const t=Qt.buildLayerMatrix(e);t==null||t.forEach(r=>{let n=0;r==null||r.forEach((i,a)=>{var o;const s=e.node(i);s.order=a+n,(o=s.selfEdges)===null||o===void 0||o.forEach(u=>{Qt.addDummyNode(e,"selfedge",{width:u.label.width,height:u.label.height,rank:s.rank,order:a+ ++n,e:u.e,label:u.label},"_se")}),delete s.selfEdges})})},WT=e=>{e.nodes().forEach(t=>{const r=e.node(t);if(r.dummy==="selfedge"){const n=e.node(r.e.v),i=n.x+n.width/2,a=n.y,o=r.x-i,s=n.height/2;e.setEdge(r.e,r.label),e.removeNode(t),r.label.points=[{x:i+2*o/3,y:a-s},{x:i+5*o/6,y:a-s},{y:a,x:i+o},{x:i+5*o/6,y:a+s},{x:i+2*o/3,y:a+s}],r.label.x=r.x,r.label.y=r.y}})},zs=(e,t)=>{const r={};return t==null||t.forEach(n=>{e[n]!==void 0&&(r[n]=+e[n])}),r},Hs=e=>{const t={};return Object.keys(e).forEach(r=>{const n=e[r];t[r.toLowerCase()]=n}),t};function je(e,t,r,n){!r||Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ze(e,t,r,n,i){var a={};return Object.keys(n).forEach(function(o){a[o]=n[o]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=r.slice().reverse().reduce(function(o,s){return s(e,t,o)||o},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,t,a),a=null),a}/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var il;(function(e){(function(t){var r=typeof su=="object"?su:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),n=i(e);typeof r.Reflect>"u"?r.Reflect=e:n=i(r.Reflect,n),t(n);function i(a,o){return function(s,u){typeof a[s]!="function"&&Object.defineProperty(a,s,{configurable:!0,writable:!0,value:u}),o&&o(s,u)}}})(function(t){var r=Object.prototype.hasOwnProperty,n=typeof Symbol=="function",i=n&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=n&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",s={__proto__:[]}instanceof Array,u=!o&&!s,c={create:o?function(){return y(Object.create(null))}:s?function(){return y({__proto__:null})}:function(){return y({})},has:u?function(j,ae){return r.call(j,ae)}:function(j,ae){return ae in j},get:u?function(j,ae){return r.call(j,ae)?j[ae]:void 0}:function(j,ae){return j[ae]}},f=Object.getPrototypeOf(Function),d=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",p=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Yn(),g=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:$o(),T=!d&&typeof WeakMap=="function"?WeakMap:Vo(),x=new T;function O(j,ae,Ae,Pe){if(tt(Ae)){if(!Aa(j))throw new TypeError;if(!Ri(ae))throw new TypeError;return ht(j,ae)}else{if(!Aa(j))throw new TypeError;if(!Ot(ae))throw new TypeError;if(!Ot(Pe)&&!tt(Pe)&&!Nt(Pe))throw new TypeError;return Nt(Pe)&&(Pe=void 0),Ae=Ir(Ae),yt(j,ae,Ae,Pe)}}t("decorate",O);function z(j,ae){function Ae(Pe,Be){if(!Ot(Pe))throw new TypeError;if(!tt(Be)&&!Sa(Be))throw new TypeError;pe(j,ae,Pe,Be)}return Ae}t("metadata",z);function ie(j,ae,Ae,Pe){if(!Ot(Ae))throw new TypeError;return tt(Pe)||(Pe=Ir(Pe)),pe(j,ae,Ae,Pe)}t("defineMetadata",ie);function X(j,ae,Ae){if(!Ot(ae))throw new TypeError;return tt(Ae)||(Ae=Ir(Ae)),pt(j,ae,Ae)}t("hasMetadata",X);function Te(j,ae,Ae){if(!Ot(ae))throw new TypeError;return tt(Ae)||(Ae=Ir(Ae)),$e(j,ae,Ae)}t("hasOwnMetadata",Te);function ce(j,ae,Ae){if(!Ot(ae))throw new TypeError;return tt(Ae)||(Ae=Ir(Ae)),we(j,ae,Ae)}t("getMetadata",ce);function Re(j,ae,Ae){if(!Ot(ae))throw new TypeError;return tt(Ae)||(Ae=Ir(Ae)),me(j,ae,Ae)}t("getOwnMetadata",Re);function Le(j,ae){if(!Ot(j))throw new TypeError;return tt(ae)||(ae=Ir(ae)),Ie(j,ae)}t("getMetadataKeys",Le);function Xe(j,ae){if(!Ot(j))throw new TypeError;return tt(ae)||(ae=Ir(ae)),qe(j,ae)}t("getOwnMetadataKeys",Xe);function vt(j,ae,Ae){if(!Ot(ae))throw new TypeError;tt(Ae)||(Ae=Ir(Ae));var Pe=Qe(ae,Ae,!1);if(tt(Pe)||!Pe.delete(j))return!1;if(Pe.size>0)return!0;var Be=x.get(ae);return Be.delete(Ae),Be.size>0||x.delete(ae),!0}t("deleteMetadata",vt);function ht(j,ae){for(var Ae=j.length-1;Ae>=0;--Ae){var Pe=j[Ae],Be=Pe(ae);if(!tt(Be)&&!Nt(Be)){if(!Ri(Be))throw new TypeError;ae=Be}}return ae}function yt(j,ae,Ae,Pe){for(var Be=j.length-1;Be>=0;--Be){var Zt=j[Be],st=Zt(ae,Ae,Pe);if(!tt(st)&&!Nt(st)){if(!Ot(st))throw new TypeError;Pe=st}}return Pe}function Qe(j,ae,Ae){var Pe=x.get(j);if(tt(Pe)){if(!Ae)return;Pe=new p,x.set(j,Pe)}var Be=Pe.get(ae);if(tt(Be)){if(!Ae)return;Be=new p,Pe.set(ae,Be)}return Be}function pt(j,ae,Ae){var Pe=$e(j,ae,Ae);if(Pe)return!0;var Be=Wn(ae);return Nt(Be)?!1:pt(j,Be,Ae)}function $e(j,ae,Ae){var Pe=Qe(ae,Ae,!1);return tt(Pe)?!1:on(Pe.has(j))}function we(j,ae,Ae){var Pe=$e(j,ae,Ae);if(Pe)return me(j,ae,Ae);var Be=Wn(ae);if(!Nt(Be))return we(j,Be,Ae)}function me(j,ae,Ae){var Pe=Qe(ae,Ae,!1);if(!tt(Pe))return Pe.get(j)}function pe(j,ae,Ae,Pe){var Be=Qe(Ae,Pe,!0);Be.set(j,ae)}function Ie(j,ae){var Ae=qe(j,ae),Pe=Wn(j);if(Pe===null)return Ae;var Be=Ie(Pe,ae);if(Be.length<=0)return Ae;if(Ae.length<=0)return Be;for(var Zt=new g,st=[],mt=0,et=Ae;mt<et.length;mt++){var wt=et[mt],St=Zt.has(wt);St||(Zt.add(wt),st.push(wt))}for(var $t=0,qn=Be;$t<qn.length;$t++){var wt=qn[$t],St=Zt.has(wt);St||(Zt.add(wt),st.push(wt))}return st}function qe(j,ae){var Ae=[],Pe=Qe(j,ae,!1);if(tt(Pe))return Ae;for(var Be=Pe.keys(),Zt=wa(Be),st=0;;){var mt=Uo(Zt);if(!mt)return Ae.length=st,Ae;var et=Ra(mt);try{Ae[st]=et}catch(wt){try{hr(Zt)}finally{throw wt}}st++}}function Ve(j){if(j===null)return 1;switch(typeof j){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return j===null?1:6;default:return 6}}function tt(j){return j===void 0}function Nt(j){return j===null}function Lt(j){return typeof j=="symbol"}function Ot(j){return typeof j=="object"?j!==null:typeof j=="function"}function dr(j,ae){switch(Ve(j)){case 0:return j;case 1:return j;case 2:return j;case 3:return j;case 4:return j;case 5:return j}var Ae=ae===3?"string":ae===5?"number":"default",Pe=Ci(j,i);if(Pe!==void 0){var Be=Pe.call(j,Ae);if(Ot(Be))throw new TypeError;return Be}return _r(j,Ae==="default"?"number":Ae)}function _r(j,ae){if(ae==="string"){var Ae=j.toString;if(sn(Ae)){var Pe=Ae.call(j);if(!Ot(Pe))return Pe}var Be=j.valueOf;if(sn(Be)){var Pe=Be.call(j);if(!Ot(Pe))return Pe}}else{var Be=j.valueOf;if(sn(Be)){var Pe=Be.call(j);if(!Ot(Pe))return Pe}var Zt=j.toString;if(sn(Zt)){var Pe=Zt.call(j);if(!Ot(Pe))return Pe}}throw new TypeError}function on(j){return!!j}function Bo(j){return""+j}function Ir(j){var ae=dr(j,3);return Lt(ae)?ae:Bo(ae)}function Aa(j){return Array.isArray?Array.isArray(j):j instanceof Object?j instanceof Array:Object.prototype.toString.call(j)==="[object Array]"}function sn(j){return typeof j=="function"}function Ri(j){return typeof j=="function"}function Sa(j){switch(Ve(j)){case 3:return!0;case 4:return!0;default:return!1}}function Ci(j,ae){var Ae=j[ae];if(Ae!=null){if(!sn(Ae))throw new TypeError;return Ae}}function wa(j){var ae=Ci(j,a);if(!sn(ae))throw new TypeError;var Ae=ae.call(j);if(!Ot(Ae))throw new TypeError;return Ae}function Ra(j){return j.value}function Uo(j){var ae=j.next();return ae.done?!1:ae}function hr(j){var ae=j.return;ae&&ae.call(j)}function Wn(j){var ae=Object.getPrototypeOf(j);if(typeof j!="function"||j===f||ae!==f)return ae;var Ae=j.prototype,Pe=Ae&&Object.getPrototypeOf(Ae);if(Pe==null||Pe===Object.prototype)return ae;var Be=Pe.constructor;return typeof Be!="function"||Be===j?ae:Be}function Yn(){var j={},ae=[],Ae=function(){function st(mt,et,wt){this._index=0,this._keys=mt,this._values=et,this._selector=wt}return st.prototype["@@iterator"]=function(){return this},st.prototype[a]=function(){return this},st.prototype.next=function(){var mt=this._index;if(mt>=0&&mt<this._keys.length){var et=this._selector(this._keys[mt],this._values[mt]);return mt+1>=this._keys.length?(this._index=-1,this._keys=ae,this._values=ae):this._index++,{value:et,done:!1}}return{value:void 0,done:!0}},st.prototype.throw=function(mt){throw this._index>=0&&(this._index=-1,this._keys=ae,this._values=ae),mt},st.prototype.return=function(mt){return this._index>=0&&(this._index=-1,this._keys=ae,this._values=ae),{value:mt,done:!0}},st}();return function(){function st(){this._keys=[],this._values=[],this._cacheKey=j,this._cacheIndex=-2}return Object.defineProperty(st.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),st.prototype.has=function(mt){return this._find(mt,!1)>=0},st.prototype.get=function(mt){var et=this._find(mt,!1);return et>=0?this._values[et]:void 0},st.prototype.set=function(mt,et){var wt=this._find(mt,!0);return this._values[wt]=et,this},st.prototype.delete=function(mt){var et=this._find(mt,!1);if(et>=0){for(var wt=this._keys.length,St=et+1;St<wt;St++)this._keys[St-1]=this._keys[St],this._values[St-1]=this._values[St];return this._keys.length--,this._values.length--,mt===this._cacheKey&&(this._cacheKey=j,this._cacheIndex=-2),!0}return!1},st.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=j,this._cacheIndex=-2},st.prototype.keys=function(){return new Ae(this._keys,this._values,Pe)},st.prototype.values=function(){return new Ae(this._keys,this._values,Be)},st.prototype.entries=function(){return new Ae(this._keys,this._values,Zt)},st.prototype["@@iterator"]=function(){return this.entries()},st.prototype[a]=function(){return this.entries()},st.prototype._find=function(mt,et){return this._cacheKey!==mt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=mt)),this._cacheIndex<0&&et&&(this._cacheIndex=this._keys.length,this._keys.push(mt),this._values.push(void 0)),this._cacheIndex},st}();function Pe(st,mt){return st}function Be(st,mt){return mt}function Zt(st,mt){return[st,mt]}}function $o(){return function(){function j(){this._map=new p}return Object.defineProperty(j.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),j.prototype.has=function(ae){return this._map.has(ae)},j.prototype.add=function(ae){return this._map.set(ae,ae),this},j.prototype.delete=function(ae){return this._map.delete(ae)},j.prototype.clear=function(){this._map.clear()},j.prototype.keys=function(){return this._map.keys()},j.prototype.values=function(){return this._map.values()},j.prototype.entries=function(){return this._map.entries()},j.prototype["@@iterator"]=function(){return this.keys()},j.prototype[a]=function(){return this.keys()},j}()}function Vo(){var j=16,ae=c.create(),Ae=Pe();return function(){function et(){this._key=Pe()}return et.prototype.has=function(wt){var St=Be(wt,!1);return St!==void 0?c.has(St,this._key):!1},et.prototype.get=function(wt){var St=Be(wt,!1);return St!==void 0?c.get(St,this._key):void 0},et.prototype.set=function(wt,St){var $t=Be(wt,!0);return $t[this._key]=St,this},et.prototype.delete=function(wt){var St=Be(wt,!1);return St!==void 0?delete St[this._key]:!1},et.prototype.clear=function(){this._key=Pe()},et}();function Pe(){var et;do et="@@WeakMap@@"+mt();while(c.has(ae,et));return ae[et]=!0,et}function Be(et,wt){if(!r.call(et,Ae)){if(!wt)return;Object.defineProperty(et,Ae,{value:c.create()})}return et[Ae]}function Zt(et,wt){for(var St=0;St<wt;++St)et[St]=Math.random()*255|0;return et}function st(et){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(et)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(et)):Zt(new Uint8Array(et),et):Zt(new Array(et),et)}function mt(){var et=st(j);et[6]=et[6]&79|64,et[8]=et[8]&191|128;for(var wt="",St=0;St<j;++St){var $t=et[St];(St===4||St===6||St===8)&&(wt+="-"),$t<16&&(wt+="0"),wt+=$t.toString(16).toLowerCase()}return wt}}function y(j){return j.__=void 0,delete j.__,j}})})(il||(il={}));var ty={exports:{}};(function(e){var t=ab.exports.default;function r(){e.exports=r=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var n={},i=Object.prototype,a=i.hasOwnProperty,o=Object.defineProperty||function(we,me,pe){we[me]=pe.value},s=typeof Symbol=="function"?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",f=s.toStringTag||"@@toStringTag";function d(we,me,pe){return Object.defineProperty(we,me,{value:pe,enumerable:!0,configurable:!0,writable:!0}),we[me]}try{d({},"")}catch{d=function(pe,Ie,qe){return pe[Ie]=qe}}function p(we,me,pe,Ie){var qe=me&&me.prototype instanceof x?me:x,Ve=Object.create(qe.prototype),tt=new Qe(Ie||[]);return o(Ve,"_invoke",{value:Xe(we,pe,tt)}),Ve}function g(we,me,pe){try{return{type:"normal",arg:we.call(me,pe)}}catch(Ie){return{type:"throw",arg:Ie}}}n.wrap=p;var T={};function x(){}function O(){}function z(){}var ie={};d(ie,u,function(){return this});var X=Object.getPrototypeOf,Te=X&&X(X(pt([])));Te&&Te!==i&&a.call(Te,u)&&(ie=Te);var ce=z.prototype=x.prototype=Object.create(ie);function Re(we){["next","throw","return"].forEach(function(me){d(we,me,function(pe){return this._invoke(me,pe)})})}function Le(we,me){function pe(qe,Ve,tt,Nt){var Lt=g(we[qe],we,Ve);if(Lt.type!=="throw"){var Ot=Lt.arg,dr=Ot.value;return dr&&t(dr)=="object"&&a.call(dr,"__await")?me.resolve(dr.__await).then(function(_r){pe("next",_r,tt,Nt)},function(_r){pe("throw",_r,tt,Nt)}):me.resolve(dr).then(function(_r){Ot.value=_r,tt(Ot)},function(_r){return pe("throw",_r,tt,Nt)})}Nt(Lt.arg)}var Ie;o(this,"_invoke",{value:function(Ve,tt){function Nt(){return new me(function(Lt,Ot){pe(Ve,tt,Lt,Ot)})}return Ie=Ie?Ie.then(Nt,Nt):Nt()}})}function Xe(we,me,pe){var Ie="suspendedStart";return function(qe,Ve){if(Ie==="executing")throw new Error("Generator is already running");if(Ie==="completed"){if(qe==="throw")throw Ve;return $e()}for(pe.method=qe,pe.arg=Ve;;){var tt=pe.delegate;if(tt){var Nt=vt(tt,pe);if(Nt){if(Nt===T)continue;return Nt}}if(pe.method==="next")pe.sent=pe._sent=pe.arg;else if(pe.method==="throw"){if(Ie==="suspendedStart")throw Ie="completed",pe.arg;pe.dispatchException(pe.arg)}else pe.method==="return"&&pe.abrupt("return",pe.arg);Ie="executing";var Lt=g(we,me,pe);if(Lt.type==="normal"){if(Ie=pe.done?"completed":"suspendedYield",Lt.arg===T)continue;return{value:Lt.arg,done:pe.done}}Lt.type==="throw"&&(Ie="completed",pe.method="throw",pe.arg=Lt.arg)}}}function vt(we,me){var pe=me.method,Ie=we.iterator[pe];if(Ie===void 0)return me.delegate=null,pe==="throw"&&we.iterator.return&&(me.method="return",me.arg=void 0,vt(we,me),me.method==="throw")||pe!=="return"&&(me.method="throw",me.arg=new TypeError("The iterator does not provide a '"+pe+"' method")),T;var qe=g(Ie,we.iterator,me.arg);if(qe.type==="throw")return me.method="throw",me.arg=qe.arg,me.delegate=null,T;var Ve=qe.arg;return Ve?Ve.done?(me[we.resultName]=Ve.value,me.next=we.nextLoc,me.method!=="return"&&(me.method="next",me.arg=void 0),me.delegate=null,T):Ve:(me.method="throw",me.arg=new TypeError("iterator result is not an object"),me.delegate=null,T)}function ht(we){var me={tryLoc:we[0]};1 in we&&(me.catchLoc=we[1]),2 in we&&(me.finallyLoc=we[2],me.afterLoc=we[3]),this.tryEntries.push(me)}function yt(we){var me=we.completion||{};me.type="normal",delete me.arg,we.completion=me}function Qe(we){this.tryEntries=[{tryLoc:"root"}],we.forEach(ht,this),this.reset(!0)}function pt(we){if(we){var me=we[u];if(me)return me.call(we);if(typeof we.next=="function")return we;if(!isNaN(we.length)){var pe=-1,Ie=function qe(){for(;++pe<we.length;)if(a.call(we,pe))return qe.value=we[pe],qe.done=!1,qe;return qe.value=void 0,qe.done=!0,qe};return Ie.next=Ie}}return{next:$e}}function $e(){return{value:void 0,done:!0}}return O.prototype=z,o(ce,"constructor",{value:z,configurable:!0}),o(z,"constructor",{value:O,configurable:!0}),O.displayName=d(z,f,"GeneratorFunction"),n.isGeneratorFunction=function(we){var me=typeof we=="function"&&we.constructor;return!!me&&(me===O||(me.displayName||me.name)==="GeneratorFunction")},n.mark=function(we){return Object.setPrototypeOf?Object.setPrototypeOf(we,z):(we.__proto__=z,d(we,f,"GeneratorFunction")),we.prototype=Object.create(ce),we},n.awrap=function(we){return{__await:we}},Re(Le.prototype),d(Le.prototype,c,function(){return this}),n.AsyncIterator=Le,n.async=function(we,me,pe,Ie,qe){qe===void 0&&(qe=Promise);var Ve=new Le(p(we,me,pe,Ie),qe);return n.isGeneratorFunction(me)?Ve:Ve.next().then(function(tt){return tt.done?tt.value:Ve.next()})},Re(ce),d(ce,f,"Generator"),d(ce,u,function(){return this}),d(ce,"toString",function(){return"[object Generator]"}),n.keys=function(we){var me=Object(we),pe=[];for(var Ie in me)pe.push(Ie);return pe.reverse(),function qe(){for(;pe.length;){var Ve=pe.pop();if(Ve in me)return qe.value=Ve,qe.done=!1,qe}return qe.done=!0,qe}},n.values=pt,Qe.prototype={constructor:Qe,reset:function(me){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(yt),!me)for(var pe in this)pe.charAt(0)==="t"&&a.call(this,pe)&&!isNaN(+pe.slice(1))&&(this[pe]=void 0)},stop:function(){this.done=!0;var me=this.tryEntries[0].completion;if(me.type==="throw")throw me.arg;return this.rval},dispatchException:function(me){if(this.done)throw me;var pe=this;function Ie(Ot,dr){return tt.type="throw",tt.arg=me,pe.next=Ot,dr&&(pe.method="next",pe.arg=void 0),!!dr}for(var qe=this.tryEntries.length-1;qe>=0;--qe){var Ve=this.tryEntries[qe],tt=Ve.completion;if(Ve.tryLoc==="root")return Ie("end");if(Ve.tryLoc<=this.prev){var Nt=a.call(Ve,"catchLoc"),Lt=a.call(Ve,"finallyLoc");if(Nt&&Lt){if(this.prev<Ve.catchLoc)return Ie(Ve.catchLoc,!0);if(this.prev<Ve.finallyLoc)return Ie(Ve.finallyLoc)}else if(Nt){if(this.prev<Ve.catchLoc)return Ie(Ve.catchLoc,!0)}else{if(!Lt)throw new Error("try statement without catch or finally");if(this.prev<Ve.finallyLoc)return Ie(Ve.finallyLoc)}}}},abrupt:function(me,pe){for(var Ie=this.tryEntries.length-1;Ie>=0;--Ie){var qe=this.tryEntries[Ie];if(qe.tryLoc<=this.prev&&a.call(qe,"finallyLoc")&&this.prev<qe.finallyLoc){var Ve=qe;break}}Ve&&(me==="break"||me==="continue")&&Ve.tryLoc<=pe&&pe<=Ve.finallyLoc&&(Ve=null);var tt=Ve?Ve.completion:{};return tt.type=me,tt.arg=pe,Ve?(this.method="next",this.next=Ve.finallyLoc,T):this.complete(tt)},complete:function(me,pe){if(me.type==="throw")throw me.arg;return me.type==="break"||me.type==="continue"?this.next=me.arg:me.type==="return"?(this.rval=this.arg=me.arg,this.method="return",this.next="end"):me.type==="normal"&&pe&&(this.next=pe),T},finish:function(me){for(var pe=this.tryEntries.length-1;pe>=0;--pe){var Ie=this.tryEntries[pe];if(Ie.finallyLoc===me)return this.complete(Ie.completion,Ie.afterLoc),yt(Ie),T}},catch:function(me){for(var pe=this.tryEntries.length-1;pe>=0;--pe){var Ie=this.tryEntries[pe];if(Ie.tryLoc===me){var qe=Ie.completion;if(qe.type==="throw"){var Ve=qe.arg;yt(Ie)}return Ve}}throw new Error("illegal catch attempt")},delegateYield:function(me,pe,Ie){return this.delegate={iterator:pt(me),resultName:pe,nextLoc:Ie},this.method==="next"&&(this.arg=void 0),T}},n}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports})(ty);var go=ty.exports(),Me=go;try{regeneratorRuntime=go}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=go:Function("r","regeneratorRuntime = r")(go)}function al(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){r(c);return}s.done?t(u):Promise.resolve(u).then(n,i)}function At(e){return function(){var t=this,r=arguments;return new Promise(function(n,i){var a=e.apply(t,r);function o(u){al(a,n,i,o,s,"next",u)}function s(u){al(a,n,i,o,s,"throw",u)}o(void 0)})}}var YT=-1,qT=1;function zr(){return qT++}var Hn=function e(t){Fe(this,e)},Xn=function(){function e(t){Fe(this,e),this.clazz=void 0,this.components=[],this.entities=[],this.lookup={},this.clazz=t}return Ye(e,[{key:"clear",value:function(){this.components=[],this.entities=[],this.lookup={}}},{key:"contains",value:function(r){return this.lookup[r]>-1}},{key:"create",value:function(r,n){this.lookup[r]=this.components.length;var i=new this.clazz(n||{});return this.components.push(i),this.entities.push(r),i}},{key:"remove",value:function(r){var n=this.lookup[r];n>-1&&n<this.components.length-1&&(this.components[n]=this.components[this.components.length-1],this.entities[n]=this.entities[this.entities.length-1],this.lookup[this.entities[n]]=n),this.components.pop(),this.entities.pop(),delete this.lookup[r]}},{key:"removeKeepSorted",value:function(r){var n=this.lookup[r];if(n>-1){var i=this.entities[n];if(n<this.components.length-1){for(var a=n+1;a<this.components.length;++a)this.components[a-1]=this.components[a];for(var o=n+1;o<this.entities.length;++o)this.entities[o-1]=this.entities[o],this.lookup[this.entities[o-1]]=o-1}this.components.pop(),this.entities.pop(),delete this.lookup[i]}}},{key:"moveItem",value:function(r,n){if(r!==n){for(var i=this.components[r],a=this.entities[r],o=r<n?1:-1,s=r;s!==n;s+=o){var u=s+o;this.components[s]=this.components[u],this.entities[s]=this.entities[u],this.lookup[this.entities[s]]=s}this.components[n]=i,this.entities[n]=a,this.lookup[a]=n}}},{key:"getEntity",value:function(r){return this.entities[r]}},{key:"getComponent",value:function(r){return this.components[r]}},{key:"getComponentByEntity",value:function(r){var n=this.lookup[r];return n>-1?this.components[n]:null}},{key:"getCount",value:function(){return this.components.length}},{key:"getEntityByComponentIndex",value:function(r){for(var n=0,i=Object.keys(this.lookup);n<i.length;n++){var a=i[n],o=Number(a);if(this.lookup[o]===r)return o}return YT}},{key:"find",value:function(r){for(var n=0;n<this.getCount();n++){var i=this.getComponent(n);if(r(i,n))return i}return null}},{key:"findIndex",value:function(r){for(var n=0;n<this.getCount();n++){var i=this.getComponent(n);if(r(i,n))return n}return-1}},{key:"forEach",value:function(r){for(var n=0,i=Object.keys(this.lookup);n<i.length;n++){var a=i[n],o=Number(a),s=this.lookup[o];r(o,this.getComponent(s))}}},{key:"forEachAsync",value:function(){var t=At(Me.mark(function n(i){var a,o,s,u,c;return Me.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:a=0,o=Object.keys(this.lookup);case 1:if(!(a<o.length)){d.next=10;break}return s=o[a],u=Number(s),c=this.lookup[u],d.next=7,i(u,this.getComponent(c));case 7:a++,d.next=1;break;case 10:case"end":return d.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"map",value:function(r){for(var n=[],i=0,a=Object.keys(this.lookup);i<a.length;i++){var o=a[i],s=Number(o),u=this.lookup[s];n.push(r(s,this.getComponent(u)))}return n}}]),e}();function KT(e){if(Array.isArray(e))return e}function QT(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,i,a,o,s=[],u=!0,c=!1;try{if(a=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(f){c=!0,i=f}finally{try{if(!u&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw i}}return s}}function ZT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ko(e,t){return KT(e)||QT(e,t)||Cm(e,t)||ZT()}var Dr="named",ry="name",Nu="unmanaged",ny="optional",Do="inject",ma="multi_inject",iy="inversify:tagged",ay="inversify:tagged_props",lu="inversify:paramtypes",JT="design:paramtypes",ol="post_construct";function eA(){return[Do,ma,ry,Nu,Dr,ny]}var sl=eA(),ur={Request:"Request",Singleton:"Singleton",Transient:"Transient"},sr={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},rn={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"},tA=0;function ga(){return tA++}var rA=function(){function e(t,r){this.id=ga(),this.activated=!1,this.serviceIdentifier=t,this.scope=r,this.type=sr.Invalid,this.constraint=function(n){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return e.prototype.clone=function(){var t=new e(this.serviceIdentifier,this.scope);return t.activated=t.scope===ur.Singleton?this.activated:!1,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.factory=this.factory,t.provider=this.provider,t.constraint=this.constraint,t.onActivation=this.onActivation,t.cache=this.cache,t},e}(),nA="Cannot apply @injectable decorator multiple times.",iA="Metadata key was used more than once in a parameter:",Xi="NULL argument",ul="Key Not Found",aA="Ambiguous match found for serviceIdentifier:",oA="Could not unbind serviceIdentifier:",sA="No matching bindings found for serviceIdentifier:",uA="Missing required @injectable annotation in:",cA="Missing required @inject or @multiInject annotation in:",fA=function(e){return"@inject called with undefined this could mean that the class "+e+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."},lA="Circular dependency found:",dA="Invalid binding type:",hA="No snapshot available to restore.",vA="Invalid return type in middleware. Middleware must return!",pA="Value provided to function binding must be a function!",mA="The toSelf function can only be applied when a constructor is used as service identifier",yA="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",_A=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"The number of constructor arguments in the derived class "+(e[0]+" must be >= than the number of constructor arguments of its base class.")},EA="Invalid Container constructor argument. Container options must be an object.",bA="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",gA="Invalid Container option. Auto bind injectable must be a boolean",TA="Invalid Container option. Skip base check must be a boolean",AA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"@postConstruct error in class "+e[0]+": "+e[1]},SA=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"It looks like there is a circular dependency "+("in one of the '"+e[0]+"' bindings. Please investigate bindings with")+("service identifier '"+e[1]+"'.")},wA="Maximum call stack size exceeded",RA=function(){function e(){}return e.prototype.getConstructorMetadata=function(t){var r=Reflect.getMetadata(lu,t),n=Reflect.getMetadata(iy,t);return{compilerGeneratedMetadata:r,userGeneratedMetadata:n||{}}},e.prototype.getPropertiesMetadata=function(t){var r=Reflect.getMetadata(ay,t)||[];return r},e}(),To={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};function oy(e){return e instanceof RangeError||e.message===wA}function ya(e){if(typeof e=="function"){var t=e;return t.name}else{if(typeof e=="symbol")return e.toString();var t=e;return t}}function cl(e,t,r){var n="",i=r(e,t);return i.length!==0&&(n=`
Registered bindings:`,i.forEach(function(a){var o="Object";a.implementationType!==null&&(o=Fo(a.implementationType)),n=n+`
 `+o,a.constraint.metaData&&(n=n+" - "+a.constraint.metaData)})),n}function sy(e,t){return e.parentRequest===null?!1:e.parentRequest.serviceIdentifier===t?!0:sy(e.parentRequest,t)}function CA(e){function t(n,i){i===void 0&&(i=[]);var a=ya(n.serviceIdentifier);return i.push(a),n.parentRequest!==null?t(n.parentRequest,i):i}var r=t(e);return r.reverse().join(" --> ")}function uy(e){e.childRequests.forEach(function(t){if(sy(t,t.serviceIdentifier)){var r=CA(t);throw new Error(lA+" "+r)}else uy(t)})}function xA(e,t){if(t.isTagged()||t.isNamed()){var r="",n=t.getNamedTag(),i=t.getCustomTags();return n!==null&&(r+=n.toString()+`
`),i!==null&&i.forEach(function(a){r+=a.toString()+`
`})," "+e+`
 `+e+" - "+r}else return" "+e}function Fo(e){if(e.name)return e.name;var t=e.toString(),r=t.match(/^function\s*([^\s(]+)/);return r?r[1]:"Anonymous function: "+t}var cy=function(){function e(t){this.id=ga(),this.container=t}return e.prototype.addPlan=function(t){this.plan=t},e.prototype.setCurrentRequest=function(t){this.currentRequest=t},e}(),bn=function(){function e(t,r){this.key=t,this.value=r}return e.prototype.toString=function(){return this.key===Dr?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},e}(),NA=function(){function e(t,r){this.parentContext=t,this.rootRequest=r}return e}();function fy(e,t,r,n){var i=iy;dy(i,e,t,n,r)}function ly(e,t,r){var n=ay;dy(n,e.constructor,t,r)}function dy(e,t,r,n,i){var a={},o=typeof i=="number",s=i!==void 0&&o?i.toString():r;if(o&&r!==void 0)throw new Error(yA);Reflect.hasOwnMetadata(e,t)&&(a=Reflect.getMetadata(e,t));var u=a[s];if(!Array.isArray(u))u=[];else for(var c=0,f=u;c<f.length;c++){var d=f[c];if(d.key===n.key)throw new Error(iA+" "+d.key.toString())}u.push(n),a[s]=u,Reflect.defineMetadata(e,a,t)}var OA=function(){function e(t){this._cb=t}return e.prototype.unwrap=function(){return this._cb()},e}();function He(e){return function(t,r,n){if(e===void 0)throw new Error(fA(t.name));var i=new bn(Do,e);typeof n=="number"?fy(t,r,n,i):ly(t,r,i)}}var IA=function(){function e(t){this.str=t}return e.prototype.startsWith=function(t){return this.str.indexOf(t)===0},e.prototype.endsWith=function(t){var r="",n=t.split("").reverse().join("");return r=this.str.split("").reverse().join(""),this.startsWith.call({str:r},n)},e.prototype.contains=function(t){return this.str.indexOf(t)!==-1},e.prototype.equals=function(t){return this.str===t},e.prototype.value=function(){return this.str},e}(),Go=function(){function e(t,r,n,i){this.id=ga(),this.type=t,this.serviceIdentifier=n,this.name=new IA(r||""),this.metadata=new Array;var a=null;typeof i=="string"?a=new bn(Dr,i):i instanceof bn&&(a=i),a!==null&&this.metadata.push(a)}return e.prototype.hasTag=function(t){for(var r=0,n=this.metadata;r<n.length;r++){var i=n[r];if(i.key===t)return!0}return!1},e.prototype.isArray=function(){return this.hasTag(ma)},e.prototype.matchesArray=function(t){return this.matchesTag(ma)(t)},e.prototype.isNamed=function(){return this.hasTag(Dr)},e.prototype.isTagged=function(){return this.metadata.some(function(t){return sl.every(function(r){return t.key!==r})})},e.prototype.isOptional=function(){return this.matchesTag(ny)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(t){return t.key===Dr})[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(t){return sl.every(function(r){return t.key!==r})}):null},e.prototype.matchesNamedTag=function(t){return this.matchesTag(Dr)(t)},e.prototype.matchesTag=function(t){var r=this;return function(n){for(var i=0,a=r.metadata;i<a.length;i++){var o=a[i];if(o.key===t&&o.value===n)return!0}return!1}},e}(),No=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};function PA(e,t){var r=Fo(t),n=hy(e,r,t,!1);return n}function hy(e,t,r,n){var i=e.getConstructorMetadata(r),a=i.compilerGeneratedMetadata;if(a===void 0){var o=uA+" "+t+".";throw new Error(o)}var s=i.userGeneratedMetadata,u=Object.keys(s),c=r.length===0&&u.length>0,f=u.length>r.length,d=c||f?u.length:r.length,p=MA(n,t,a,s,d),g=vy(e,r),T=No(No([],p),g);return T}function LA(e,t,r,n,i){var a=i[e.toString()]||[],o=my(a),s=o.unmanaged!==!0,u=n[e],c=o.inject||o.multiInject;if(u=c||u,u instanceof OA&&(u=u.unwrap()),s){var f=u===Object,d=u===Function,p=u===void 0,g=f||d||p;if(!t&&g){var T=cA+" argument "+e+" in class "+r+".";throw new Error(T)}var x=new Go(rn.ConstructorArgument,o.targetName,u);return x.metadata=a,x}return null}function MA(e,t,r,n,i){for(var a=[],o=0;o<i;o++){var s=o,u=LA(s,e,t,r,n);u!==null&&a.push(u)}return a}function vy(e,t){for(var r=e.getPropertiesMetadata(t),n=[],i=Object.keys(r),a=0,o=i;a<o.length;a++){var s=o[a],u=r[s],c=my(r[s]),f=c.targetName||s,d=c.inject||c.multiInject,p=new Go(rn.ClassProperty,f,d);p.metadata=u,n.push(p)}var g=Object.getPrototypeOf(t.prototype).constructor;if(g!==Object){var T=vy(e,g);n=No(No([],n),T)}return n}function py(e,t){var r=Object.getPrototypeOf(t.prototype).constructor;if(r!==Object){var n=Fo(r),i=hy(e,n,r,!0),a=i.map(function(u){return u.metadata.filter(function(c){return c.key===Nu})}),o=[].concat.apply([],a).length,s=i.length-o;return s>0?s:py(e,r)}else return 0}function my(e){var t={};return e.forEach(function(r){t[r.key.toString()]=r.value}),{inject:t[Do],multiInject:t[ma],targetName:t[ry],unmanaged:t[Nu]}}var Ou=function(){function e(t,r,n,i,a){this.id=ga(),this.serviceIdentifier=t,this.parentContext=r,this.parentRequest=n,this.target=a,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=n===null?new Map:null}return e.prototype.addChildRequest=function(t,r,n){var i=new e(t,this.parentContext,this,r,n);return this.childRequests.push(i),i},e}();function du(e){return e._bindingDictionary}function kA(e,t,r,n,i,a){var o=e?ma:Do,s=new bn(o,r),u=new Go(t,n,r,s);if(i!==void 0){var c=new bn(i,a);u.metadata.push(c)}return u}function fl(e,t,r,n,i){var a=_a(r.container,i.serviceIdentifier),o=[];return a.length===To.NoBindingsAvailable&&r.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&e.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(r.container.bind(i.serviceIdentifier).toSelf(),a=_a(r.container,i.serviceIdentifier)),t?o=a:o=a.filter(function(s){var u=new Ou(s.serviceIdentifier,r,n,s,i);return s.constraint(u)}),DA(i.serviceIdentifier,o,i,r.container),o}function DA(e,t,r,n){switch(t.length){case To.NoBindingsAvailable:if(r.isOptional())return t;var i=ya(e),a=sA;throw a+=xA(i,r),a+=cl(n,i,_a),new Error(a);case To.OnlyOneBindingAvailable:if(!r.isArray())return t;case To.MultipleBindingsAvailable:default:if(r.isArray())return t;var i=ya(e),a=aA+" "+i;throw a+=cl(n,i,_a),new Error(a)}}function yy(e,t,r,n,i,a){var o,s;if(i===null){o=fl(e,t,n,null,a),s=new Ou(r,n,null,o,a);var u=new NA(n,s);n.addPlan(u)}else o=fl(e,t,n,i,a),s=i.addChildRequest(a.serviceIdentifier,o,a);o.forEach(function(c){var f=null;if(a.isArray())f=s.addChildRequest(c.serviceIdentifier,c,a);else{if(c.cache)return;f=s}if(c.type===sr.Instance&&c.implementationType!==null){var d=PA(e,c.implementationType);if(!n.container.options.skipBaseClassChecks){var p=py(e,c.implementationType);if(d.length<p){var g=_A(Fo(c.implementationType));throw new Error(g)}}d.forEach(function(T){yy(e,!1,T.serviceIdentifier,n,f,T)})}})}function _a(e,t){var r=[],n=du(e);return n.hasKey(t)?r=n.get(t):e.parent!==null&&(r=_a(e.parent,t)),r}function FA(e,t,r,n,i,a,o,s){s===void 0&&(s=!1);var u=new cy(t),c=kA(r,n,i,"",a,o);try{return yy(e,s,i,u,null,c),u}catch(f){throw oy(f)&&u.plan&&uy(u.plan.rootRequest),f}}function GA(e,t,r,n){var i=new Go(rn.Variable,"",t,new bn(r,n)),a=new cy(e),o=new Ou(t,a,null,[],i);return o}var BA=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e};function UA(e,t,r){var n=t.filter(function(a){return a.target!==null&&a.target.type===rn.ClassProperty}),i=n.map(r);return n.forEach(function(a,o){var s="";s=a.target.name.value();var u=i[o];e[s]=u}),e}function $A(e,t){return new(e.bind.apply(e,BA([void 0],t)))}function VA(e,t){if(Reflect.hasMetadata(ol,e)){var r=Reflect.getMetadata(ol,e);try{t[r.value]()}catch(n){throw new Error(AA(e.name,n.message))}}}function jA(e,t,r){var n=null;if(t.length>0){var i=t.filter(function(o){return o.target!==null&&o.target.type===rn.ConstructorArgument}),a=i.map(r);n=$A(e,a),n=UA(n,t,r)}else n=new e;return VA(e,n),n}var Xs=function(e,t,r){try{return r()}catch(n){throw oy(n)?new Error(SA(e,t.toString())):n}},hu=function(e){return function(t){t.parentContext.setCurrentRequest(t);var r=t.bindings,n=t.childRequests,i=t.target&&t.target.isArray(),a=!t.parentRequest||!t.parentRequest.target||!t.target||!t.parentRequest.target.matchesArray(t.target.serviceIdentifier);if(i&&a)return n.map(function(d){var p=hu(e);return p(d)});var o=null;if(t.target.isOptional()&&r.length===0)return;var s=r[0],u=s.scope===ur.Singleton,c=s.scope===ur.Request;if(u&&s.activated)return s.cache;if(c&&e!==null&&e.has(s.id))return e.get(s.id);if(s.type===sr.ConstantValue)o=s.cache,s.activated=!0;else if(s.type===sr.Function)o=s.cache,s.activated=!0;else if(s.type===sr.Constructor)o=s.implementationType;else if(s.type===sr.DynamicValue&&s.dynamicValue!==null)o=Xs("toDynamicValue",s.serviceIdentifier,function(){return s.dynamicValue(t.parentContext)});else if(s.type===sr.Factory&&s.factory!==null)o=Xs("toFactory",s.serviceIdentifier,function(){return s.factory(t.parentContext)});else if(s.type===sr.Provider&&s.provider!==null)o=Xs("toProvider",s.serviceIdentifier,function(){return s.provider(t.parentContext)});else if(s.type===sr.Instance&&s.implementationType!==null)o=jA(s.implementationType,n,hu(e));else{var f=ya(t.serviceIdentifier);throw new Error(dA+" "+f)}return typeof s.onActivation=="function"&&(o=s.onActivation(t.parentContext,o)),u&&(s.cache=o,s.activated=!0),c&&e!==null&&!e.has(s.id)&&e.set(s.id,o),o}};function zA(e){var t=hu(e.plan.rootRequest.requestScope);return t(e.plan.rootRequest)}var en=function(e,t){var r=e.parentRequest;return r!==null?t(r)?!0:en(r,t):!1},ca=function(e){return function(t){var r=function(n){return n!==null&&n.target!==null&&n.target.matchesTag(e)(t)};return r.metaData=new bn(e,t),r}},no=ca(Dr),Ws=function(e){return function(t){var r=null;if(t!==null)if(r=t.bindings[0],typeof e=="string"){var n=r.serviceIdentifier;return n===e}else{var i=t.bindings[0].implementationType;return e===i}return!1}},Iu=function(){function e(t){this._binding=t}return e.prototype.when=function(t){return this._binding.constraint=t,new or(this._binding)},e.prototype.whenTargetNamed=function(t){return this._binding.constraint=no(t),new or(this._binding)},e.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){var r=t.target!==null&&!t.target.isNamed()&&!t.target.isTagged();return r},new or(this._binding)},e.prototype.whenTargetTagged=function(t,r){return this._binding.constraint=ca(t)(r),new or(this._binding)},e.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(r){return Ws(t)(r.parentRequest)},new or(this._binding)},e.prototype.whenParentNamed=function(t){return this._binding.constraint=function(r){return no(t)(r.parentRequest)},new or(this._binding)},e.prototype.whenParentTagged=function(t,r){return this._binding.constraint=function(n){return ca(t)(r)(n.parentRequest)},new or(this._binding)},e.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(r){return en(r,Ws(t))},new or(this._binding)},e.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(r){return!en(r,Ws(t))},new or(this._binding)},e.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(r){return en(r,no(t))},new or(this._binding)},e.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(r){return!en(r,no(t))},new or(this._binding)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._binding.constraint=function(n){return en(n,ca(t)(r))},new or(this._binding)},e.prototype.whenNoAncestorTagged=function(t,r){return this._binding.constraint=function(n){return!en(n,ca(t)(r))},new or(this._binding)},e.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(r){return en(r,t)},new or(this._binding)},e.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(r){return!en(r,t)},new or(this._binding)},e}(),or=function(){function e(t){this._binding=t}return e.prototype.onActivation=function(t){return this._binding.onActivation=t,new Iu(this._binding)},e}(),mn=function(){function e(t){this._binding=t,this._bindingWhenSyntax=new Iu(this._binding),this._bindingOnSyntax=new or(this._binding)}return e.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},e.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(t,r){return this._bindingWhenSyntax.whenTargetTagged(t,r)},e.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},e.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},e.prototype.whenParentTagged=function(t,r){return this._bindingWhenSyntax.whenParentTagged(t,r)},e.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},e.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},e.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,r)},e.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},e.prototype.whenNoAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenNoAncestorTagged(t,r)},e.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},e.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},e.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},e}(),HA=function(){function e(t){this._binding=t}return e.prototype.inRequestScope=function(){return this._binding.scope=ur.Request,new mn(this._binding)},e.prototype.inSingletonScope=function(){return this._binding.scope=ur.Singleton,new mn(this._binding)},e.prototype.inTransientScope=function(){return this._binding.scope=ur.Transient,new mn(this._binding)},e}(),ll=function(){function e(t){this._binding=t,this._bindingWhenSyntax=new Iu(this._binding),this._bindingOnSyntax=new or(this._binding),this._bindingInSyntax=new HA(t)}return e.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},e.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},e.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},e.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},e.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},e.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},e.prototype.whenTargetTagged=function(t,r){return this._bindingWhenSyntax.whenTargetTagged(t,r)},e.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},e.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},e.prototype.whenParentTagged=function(t,r){return this._bindingWhenSyntax.whenParentTagged(t,r)},e.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},e.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},e.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},e.prototype.whenAnyAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,r)},e.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},e.prototype.whenNoAncestorTagged=function(t,r){return this._bindingWhenSyntax.whenNoAncestorTagged(t,r)},e.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},e.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},e.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},e}(),XA=function(){function e(t){this._binding=t}return e.prototype.to=function(t){return this._binding.type=sr.Instance,this._binding.implementationType=t,new ll(this._binding)},e.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+mA);var t=this._binding.serviceIdentifier;return this.to(t)},e.prototype.toConstantValue=function(t){return this._binding.type=sr.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ur.Singleton,new mn(this._binding)},e.prototype.toDynamicValue=function(t){return this._binding.type=sr.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new ll(this._binding)},e.prototype.toConstructor=function(t){return this._binding.type=sr.Constructor,this._binding.implementationType=t,this._binding.scope=ur.Singleton,new mn(this._binding)},e.prototype.toFactory=function(t){return this._binding.type=sr.Factory,this._binding.factory=t,this._binding.scope=ur.Singleton,new mn(this._binding)},e.prototype.toFunction=function(t){if(typeof t!="function")throw new Error(pA);var r=this.toConstantValue(t);return this._binding.type=sr.Function,this._binding.scope=ur.Singleton,r},e.prototype.toAutoFactory=function(t){return this._binding.type=sr.Factory,this._binding.factory=function(r){var n=function(){return r.container.get(t)};return n},this._binding.scope=ur.Singleton,new mn(this._binding)},e.prototype.toProvider=function(t){return this._binding.type=sr.Provider,this._binding.provider=t,this._binding.scope=ur.Singleton,new mn(this._binding)},e.prototype.toService=function(t){this.toDynamicValue(function(r){return r.container.get(t)})},e}(),WA=function(){function e(){}return e.of=function(t,r){var n=new e;return n.bindings=t,n.middleware=r,n},e}(),dl=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(t,r){if(t==null)throw new Error(Xi);if(r==null)throw new Error(Xi);var n=this._map.get(t);n!==void 0?(n.push(r),this._map.set(t,n)):this._map.set(t,[r])},e.prototype.get=function(t){if(t==null)throw new Error(Xi);var r=this._map.get(t);if(r!==void 0)return r;throw new Error(ul)},e.prototype.remove=function(t){if(t==null)throw new Error(Xi);if(!this._map.delete(t))throw new Error(ul)},e.prototype.removeByCondition=function(t){var r=this;this._map.forEach(function(n,i){var a=n.filter(function(o){return!t(o)});a.length>0?r._map.set(i,a):r._map.delete(i)})},e.prototype.hasKey=function(t){if(t==null)throw new Error(Xi);return this._map.has(t)},e.prototype.clone=function(){var t=new e;return this._map.forEach(function(r,n){r.forEach(function(i){return t.add(n,i.clone())})}),t},e.prototype.traverse=function(t){this._map.forEach(function(r,n){t(n,r)})},e}(),YA=globalThis&&globalThis.__awaiter||function(e,t,r,n){function i(a){return a instanceof r?a:new r(function(o){o(a)})}return new(r||(r=Promise))(function(a,o){function s(f){try{c(n.next(f))}catch(d){o(d)}}function u(f){try{c(n.throw(f))}catch(d){o(d)}}function c(f){f.done?a(f.value):i(f.value).then(s,u)}c((n=n.apply(e,t||[])).next())})},qA=globalThis&&globalThis.__generator||function(e,t){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(f){return u([c,f])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=c[0]&2?i.return:c[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,c[1])).done)return a;switch(i=0,a&&(c=[c[0]&2,a.value]),c[0]){case 0:case 1:a=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,i=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!a||c[1]>a[0]&&c[1]<a[3])){r.label=c[1];break}if(c[0]===6&&r.label<a[1]){r.label=a[1],a=c;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(c);break}a[2]&&r.ops.pop(),r.trys.pop();continue}c=t.call(e,r)}catch(f){c=[6,f],i=0}finally{n=a=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},KA=globalThis&&globalThis.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},_y=function(){function e(t){this._appliedMiddleware=[];var r=t||{};if(typeof r!="object")throw new Error(""+EA);if(r.defaultScope===void 0)r.defaultScope=ur.Transient;else if(r.defaultScope!==ur.Singleton&&r.defaultScope!==ur.Transient&&r.defaultScope!==ur.Request)throw new Error(""+bA);if(r.autoBindInjectable===void 0)r.autoBindInjectable=!1;else if(typeof r.autoBindInjectable!="boolean")throw new Error(""+gA);if(r.skipBaseClassChecks===void 0)r.skipBaseClassChecks=!1;else if(typeof r.skipBaseClassChecks!="boolean")throw new Error(""+TA);this.options={autoBindInjectable:r.autoBindInjectable,defaultScope:r.defaultScope,skipBaseClassChecks:r.skipBaseClassChecks},this.id=ga(),this._bindingDictionary=new dl,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new RA}return e.merge=function(t,r){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var a=new e,o=KA([t,r],n).map(function(c){return du(c)}),s=du(a);function u(c,f){c.traverse(function(d,p){p.forEach(function(g){f.add(g.serviceIdentifier,g.clone())})})}return o.forEach(function(c){u(c,s)}),a},e.prototype.load=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];for(var n=this._getContainerModuleHelpersFactory(),i=0,a=t;i<a.length;i++){var o=a[i],s=n(o.id);o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)}},e.prototype.loadAsync=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return YA(this,void 0,void 0,function(){var n,i,a,o,s;return qA(this,function(u){switch(u.label){case 0:n=this._getContainerModuleHelpersFactory(),i=0,a=t,u.label=1;case 1:return i<a.length?(o=a[i],s=n(o.id),[4,o.registry(s.bindFunction,s.unbindFunction,s.isboundFunction,s.rebindFunction)]):[3,4];case 2:u.sent(),u.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},e.prototype.unload=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];var i=function(a){return function(o){return o.moduleId===a}};r.forEach(function(a){var o=i(a.id);t._bindingDictionary.removeByCondition(o)})},e.prototype.bind=function(t){var r=this.options.defaultScope||ur.Transient,n=new rA(t,r);return this._bindingDictionary.add(t,n),new XA(n)},e.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},e.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch{throw new Error(oA+" "+ya(t))}},e.prototype.unbindAll=function(){this._bindingDictionary=new dl},e.prototype.isBound=function(t){var r=this._bindingDictionary.hasKey(t);return!r&&this.parent&&(r=this.parent.isBound(t)),r},e.prototype.isBoundNamed=function(t,r){return this.isBoundTagged(t,Dr,r)},e.prototype.isBoundTagged=function(t,r,n){var i=!1;if(this._bindingDictionary.hasKey(t)){var a=this._bindingDictionary.get(t),o=GA(this,t,r,n);i=a.some(function(s){return s.constraint(o)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(t,r,n)),i},e.prototype.snapshot=function(){this._snapshots.push(WA.of(this._bindingDictionary.clone(),this._middleware))},e.prototype.restore=function(){var t=this._snapshots.pop();if(t===void 0)throw new Error(hA);this._bindingDictionary=t.bindings,this._middleware=t.middleware},e.prototype.createChild=function(t){var r=new e(t||this.options);return r.parent=this,r},e.prototype.applyMiddleware=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce(function(i,a){return a(i)},n)},e.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},e.prototype.get=function(t){return this._get(!1,!1,rn.Variable,t)},e.prototype.getTagged=function(t,r,n){return this._get(!1,!1,rn.Variable,t,r,n)},e.prototype.getNamed=function(t,r){return this.getTagged(t,Dr,r)},e.prototype.getAll=function(t){return this._get(!0,!0,rn.Variable,t)},e.prototype.getAllTagged=function(t,r,n){return this._get(!1,!0,rn.Variable,t,r,n)},e.prototype.getAllNamed=function(t,r){return this.getAllTagged(t,Dr,r)},e.prototype.resolve=function(t){var r=this.createChild();return r.bind(t).toSelf(),this._appliedMiddleware.forEach(function(n){r.applyMiddleware(n)}),r.get(t)},e.prototype._getContainerModuleHelpersFactory=function(){var t=this,r=function(s,u){s._binding.moduleId=u},n=function(s){return function(u){var c=t.bind.bind(t),f=c(u);return r(f,s),f}},i=function(s){return function(u){var c=t.unbind.bind(t);c(u)}},a=function(s){return function(u){var c=t.isBound.bind(t);return c(u)}},o=function(s){return function(u){var c=t.rebind.bind(t),f=c(u);return r(f,s),f}};return function(s){return{bindFunction:n(s),isboundFunction:a(),rebindFunction:o(s),unbindFunction:i()}}},e.prototype._get=function(t,r,n,i,a,o){var s=null,u={avoidConstraints:t,contextInterceptor:function(c){return c},isMultiInject:r,key:a,serviceIdentifier:i,targetType:n,value:o};if(this._middleware){if(s=this._middleware(u),s==null)throw new Error(vA)}else s=this._planAndResolve()(u);return s},e.prototype._planAndResolve=function(){var t=this;return function(r){var n=FA(t._metadataReader,t,r.isMultiInject,r.targetType,r.serviceIdentifier,r.key,r.value,r.avoidConstraints);n=r.contextInterceptor(n);var i=zA(n);return i}},e}();function Rt(){return function(e){if(Reflect.hasOwnMetadata(lu,e))throw new Error(nA);var t=Reflect.getMetadata(JT,e)||[];return Reflect.defineMetadata(lu,t,e),e}}function Xr(e){return function(t,r,n){var i=new bn(Dr,e);typeof n=="number"?fy(t,r,n,i):ly(t,r,i)}}var te={HierarchyComponentManager:Symbol("HierarchyComponentManager"),TransformComponentManager:Symbol("TransformComponentManager"),NameComponentManager:Symbol("NameComponentManager"),SceneGraphSystem:Symbol("SceneGraphSystem"),FrameGraphSystem:Symbol("FrameGraphSystem"),ResourcePool:Symbol("ResourcePool"),ResourceHandleComponentManager:Symbol("ResourceHandleComponentManager"),PassNodeComponentManager:Symbol("PassNodeComponentManager"),RendererSystem:Symbol("RendererSystem"),RenderPass:Symbol("RenderPass"),RenderPassFactory:Symbol("Factory<IRenderPass>"),Renderable:Symbol("Factory<IRenderPass>"),MeshSystem:Symbol("MeshSystem"),MeshComponentManager:Symbol("MeshComponentManager"),CullableComponentManager:Symbol("CullableComponentManager"),Geometry:Symbol("Geometry"),GeometrySystem:Symbol("GeometrySystem"),GeometryComponentManager:Symbol("GeometryComponentManager"),Material:Symbol("Material"),MaterialSystem:Symbol("MaterialSystem"),MaterialComponentManager:Symbol("MaterialComponentManager"),ForwardRenderPath:Symbol("ForwardRenderPath"),ComputeSystem:Symbol("ComputeSystem"),ComputeComponentManager:Symbol("ComputeComponentManager"),ComputeStrategy:Symbol("ComputeStrategy"),Systems:Symbol("Systems"),World:Symbol("World"),RenderEngine:Symbol("RenderEngine"),WebGPUEngine:Symbol("WebGPUEngine"),WebGLEngine:Symbol("WebGLEngine"),ShaderModuleService:Symbol("ShaderModuleService"),ConfigService:Symbol("ConfigService"),InteractorService:Symbol("InteractorService"),IEventEmitter:Symbol("IEventEmitter"),Light:Symbol("Light")},QA=function e(){Fe(this,e),this.index=void 0},ZA=function e(){Fe(this,e),this.name=void 0,this.data=void 0,this.execute=void 0,this.tearDown=void 0},JA=function(){function e(){Fe(this,e),this.name=void 0,this.refCount=0,this.hasSideEffect=!1,this.devirtualize=[],this.destroy=[],this.reads=[],this.writes=[]}return Ye(e,[{key:"read",value:function(r){return this.reads.find(function(n){return n.index===r.index})||this.reads.push(r),r}},{key:"sample",value:function(r){return this.read(r),r}},{key:"write",value:function(r,n){var i=this.writes.find(function(u){return u.index===n.index});if(i)return n;var a=r.getResourceNode(n);a.resource.version++,a.resource.imported&&(this.hasSideEffect=!0);var o=r.createResourceNode(a.resource),s=r.getResourceNode(o);return s.writer=this,this.writes.push(o),o}}]),e}(),eS=function e(){Fe(this,e),this.first=void 0,this.last=void 0};function tS(e){var t=rS();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function rS(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var hl=function(e){fr(r,e);var t=tS(r);function r(){var n;Fe(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),n.version=0,n.refs=0,n.name=void 0,n.imported=void 0,n.priority=void 0,n.discardStart=!0,n.discardEnd=!1,n.descriptor=void 0,n.resource=void 0,n}return Ye(r,[{key:"preExecuteDestroy",value:function(){this.discardEnd=!0}},{key:"postExecuteDestroy",value:function(){this.imported}},{key:"postExecuteDevirtualize",value:function(){this.discardStart=!1}},{key:"preExecuteDevirtualize",value:function(){this.imported}}]),r}(eS),nS=function e(){Fe(this,e),this.resource=void 0,this.writer=void 0,this.readerCount=0,this.version=void 0},vl,pl,ml,Ys,yl,_l;function Rr(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=iS(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function iS(e,t){if(!!e){if(typeof e=="string")return El(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return El(e,t)}}function El(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var aS=(vl=Rt(),pl=He(te.RenderEngine),vl(ml=(Ys=(_l=function(){function e(){Fe(this,e),this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[],je(this,"engine",yl,this)}return Ye(e,[{key:"execute",value:function(){var t=At(Me.mark(function n(i){return Me.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.compile(),o.next=3,this.executePassNodes(i);case 3:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.frameGraphPasses.forEach(function(r){r.tearDown&&r.tearDown()}),this.reset()}},{key:"addPass",value:function(r,n,i,a){var o=new ZA;o.execute=i,a&&(o.tearDown=a),o.name=r;var s=new JA;return s.name=r,this.passNodes.push(s),this.frameGraphPasses.push(o),n(this,s,o),o}},{key:"getPass",value:function(r){return this.frameGraphPasses.find(function(n){return n.name===r})}},{key:"compile",value:function(){var r=this,n=Rr(this.passNodes),i;try{for(n.s();!(i=n.n()).done;){var a=i.value;a.refCount=a.writes.length+(a.hasSideEffect?1:0),a.reads.forEach(function(Ie){r.resourceNodes[Ie.index].readerCount++})}}catch(Ie){n.e(Ie)}finally{n.f()}var o=[],s=Rr(this.resourceNodes),u;try{for(s.s();!(u=s.n()).done;){var c=u.value;c.readerCount===0&&o.push(c)}}catch(Ie){s.e(Ie)}finally{s.f()}for(;o.length;){var f=o.pop(),d=f&&f.writer;if(d&&--d.refCount===0){var p=Rr(d.reads),g;try{for(p.s();!(g=p.n()).done;){var T=g.value,x=this.resourceNodes[T.index];--x.readerCount===0&&o.push(x)}}catch(Ie){p.e(Ie)}finally{p.f()}}}this.resourceNodes.forEach(function(Ie){Ie.resource.refs+=Ie.readerCount});var O=Rr(this.passNodes),z;try{for(O.s();!(z=O.n()).done;){var ie=z.value;if(!!ie.refCount){var X=Rr(ie.reads),Te;try{for(X.s();!(Te=X.n()).done;){var ce=Te.value,Re=this.resourceNodes[ce.index].resource;Re.first=Re.first?Re.first:ie,Re.last=ie}}catch(Ie){X.e(Ie)}finally{X.f()}var Le=Rr(ie.writes),Xe;try{for(Le.s();!(Xe=Le.n()).done;){var vt=Xe.value,ht=this.resourceNodes[vt.index].resource;ht.first=ht.first?ht.first:ie,ht.last=ie}}catch(Ie){Le.e(Ie)}finally{Le.f()}}}}catch(Ie){O.e(Ie)}finally{O.f()}for(var yt=0;yt<2;yt++){var Qe=Rr(this.resourceNodes),pt;try{for(Qe.s();!(pt=Qe.n()).done;){var $e=pt.value,we=$e.resource;if(we.priority===yt&&we.refs){var me=we.first,pe=we.last;me&&pe&&(me.devirtualize.push(we),pe.destroy.push(we))}}}catch(Ie){Qe.e(Ie)}finally{Qe.f()}}}},{key:"executePassNodes",value:function(){var t=At(Me.mark(function n(i){var a,o,s,u,c,f,d,p,g,T,x,O,z,ie,X,Te,ce;return Me.wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:a=Rr(this.passNodes.entries()),Le.prev=1,a.s();case 3:if((o=a.n()).done){Le.next=18;break}if(s=ko(o.value,2),u=s[0],c=s[1],!c.refCount){Le.next=16;break}f=Rr(c.devirtualize);try{for(f.s();!(d=f.n()).done;)p=d.value,p.preExecuteDevirtualize(this.engine)}catch(Xe){f.e(Xe)}finally{f.f()}g=Rr(c.destroy);try{for(g.s();!(T=g.n()).done;)x=T.value,x.preExecuteDestroy(this.engine)}catch(Xe){g.e(Xe)}finally{g.f()}return Le.next=12,this.frameGraphPasses[u].execute(this,this.frameGraphPasses[u],i);case 12:O=Rr(c.devirtualize);try{for(O.s();!(z=O.n()).done;)ie=z.value,ie.postExecuteDevirtualize(this.engine)}catch(Xe){O.e(Xe)}finally{O.f()}X=Rr(c.destroy);try{for(X.s();!(Te=X.n()).done;)ce=Te.value,ce.postExecuteDestroy(this.engine)}catch(Xe){X.e(Xe)}finally{X.f()}case 16:Le.next=3;break;case 18:Le.next=23;break;case 20:Le.prev=20,Le.t0=Le.catch(1),a.e(Le.t0);case 23:return Le.prev=23,a.f(),Le.finish(23);case 26:this.reset();case 27:case"end":return Le.stop()}},n,this,[[1,20,23,26]])}));function r(n){return t.apply(this,arguments)}return r}()},{key:"reset",value:function(){this.passNodes=[],this.resourceNodes=[],this.frameGraphPasses=[]}},{key:"getResourceNode",value:function(r){return this.resourceNodes[r.index]}},{key:"createResourceNode",value:function(r){var n=new nS;n.resource=r,n.version=r.version,this.resourceNodes.push(n);var i=new QA;return i.index=this.resourceNodes.length-1,i}},{key:"createTexture",value:function(r,n,i){var a=new hl;return a.name=n,a.descriptor=i,this.createResourceNode(a)}},{key:"createRenderTarget",value:function(r,n,i){var a=new hl;return a.name=n,a.descriptor=i,this.createResourceNode(a)}},{key:"present",value:function(r){this.addPass("Present",function(n,i){i.read(r),i.hasSideEffect=!0},At(Me.mark(function n(){return Me.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},n)})))}}]),e}(),_l),yl=ze(Ys.prototype,"engine",[pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys))||ml),Ao=1e-6,yr=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Ta(){var e=new yr(9);return yr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function oS(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function sS(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],f=t[8],d=t[9],p=t[10],g=t[11],T=t[12],x=t[13],O=t[14],z=t[15],ie=r*s-n*o,X=r*u-i*o,Te=r*c-a*o,ce=n*u-i*s,Re=n*c-a*s,Le=i*c-a*u,Xe=f*x-d*T,vt=f*O-p*T,ht=f*z-g*T,yt=d*O-p*x,Qe=d*z-g*x,pt=p*z-g*O,$e=ie*pt-X*Qe+Te*yt+ce*ht-Re*vt+Le*Xe;return $e?($e=1/$e,e[0]=(s*pt-u*Qe+c*yt)*$e,e[1]=(u*ht-o*pt-c*vt)*$e,e[2]=(o*Qe-s*ht+c*Xe)*$e,e[3]=(i*Qe-n*pt-a*yt)*$e,e[4]=(r*pt-i*ht+a*vt)*$e,e[5]=(n*ht-r*Qe-a*Xe)*$e,e[6]=(x*Le-O*Re+z*ce)*$e,e[7]=(O*Te-T*Le-z*X)*$e,e[8]=(T*Re-x*Te+z*ie)*$e,e):null}function Tr(){var e=new yr(16);return yr!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function uS(e){var t=new yr(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function vu(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ey(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Oo(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],c=t[7],f=t[8],d=t[9],p=t[10],g=t[11],T=t[12],x=t[13],O=t[14],z=t[15],ie=r*s-n*o,X=r*u-i*o,Te=r*c-a*o,ce=n*u-i*s,Re=n*c-a*s,Le=i*c-a*u,Xe=f*x-d*T,vt=f*O-p*T,ht=f*z-g*T,yt=d*O-p*x,Qe=d*z-g*x,pt=p*z-g*O,$e=ie*pt-X*Qe+Te*yt+ce*ht-Re*vt+Le*Xe;return $e?($e=1/$e,e[0]=(s*pt-u*Qe+c*yt)*$e,e[1]=(i*Qe-n*pt-a*yt)*$e,e[2]=(x*Le-O*Re+z*ce)*$e,e[3]=(p*Re-d*Le-g*ce)*$e,e[4]=(u*ht-o*pt-c*vt)*$e,e[5]=(r*pt-i*ht+a*vt)*$e,e[6]=(O*Te-T*Le-z*X)*$e,e[7]=(f*Le-p*Te+g*X)*$e,e[8]=(o*Qe-s*ht+c*Xe)*$e,e[9]=(n*ht-r*Qe-a*Xe)*$e,e[10]=(T*Re-x*Te+z*ie)*$e,e[11]=(d*Te-f*Re-g*ie)*$e,e[12]=(s*vt-o*yt-u*Xe)*$e,e[13]=(r*yt-n*vt+i*Xe)*$e,e[14]=(x*X-T*ce-O*ie)*$e,e[15]=(f*ce-d*X+p*ie)*$e,e):null}function Un(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],c=t[6],f=t[7],d=t[8],p=t[9],g=t[10],T=t[11],x=t[12],O=t[13],z=t[14],ie=t[15],X=r[0],Te=r[1],ce=r[2],Re=r[3];return e[0]=X*n+Te*s+ce*d+Re*x,e[1]=X*i+Te*u+ce*p+Re*O,e[2]=X*a+Te*c+ce*g+Re*z,e[3]=X*o+Te*f+ce*T+Re*ie,X=r[4],Te=r[5],ce=r[6],Re=r[7],e[4]=X*n+Te*s+ce*d+Re*x,e[5]=X*i+Te*u+ce*p+Re*O,e[6]=X*a+Te*c+ce*g+Re*z,e[7]=X*o+Te*f+ce*T+Re*ie,X=r[8],Te=r[9],ce=r[10],Re=r[11],e[8]=X*n+Te*s+ce*d+Re*x,e[9]=X*i+Te*u+ce*p+Re*O,e[10]=X*a+Te*c+ce*g+Re*z,e[11]=X*o+Te*f+ce*T+Re*ie,X=r[12],Te=r[13],ce=r[14],Re=r[15],e[12]=X*n+Te*s+ce*d+Re*x,e[13]=X*i+Te*u+ce*p+Re*O,e[14]=X*a+Te*c+ce*g+Re*z,e[15]=X*o+Te*f+ce*T+Re*ie,e}function Wi(e,t,r){var n=r[0],i=r[1],a=r[2],o,s,u,c,f,d,p,g,T,x,O,z;return t===e?(e[12]=t[0]*n+t[4]*i+t[8]*a+t[12],e[13]=t[1]*n+t[5]*i+t[9]*a+t[13],e[14]=t[2]*n+t[6]*i+t[10]*a+t[14],e[15]=t[3]*n+t[7]*i+t[11]*a+t[15]):(o=t[0],s=t[1],u=t[2],c=t[3],f=t[4],d=t[5],p=t[6],g=t[7],T=t[8],x=t[9],O=t[10],z=t[11],e[0]=o,e[1]=s,e[2]=u,e[3]=c,e[4]=f,e[5]=d,e[6]=p,e[7]=g,e[8]=T,e[9]=x,e[10]=O,e[11]=z,e[12]=o*n+f*i+T*a+t[12],e[13]=s*n+d*i+x*a+t[13],e[14]=u*n+p*i+O*a+t[14],e[15]=c*n+g*i+z*a+t[15]),e}function cS(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],u=t[7],c=t[8],f=t[9],d=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+c*n,e[5]=o*i+f*n,e[6]=s*i+d*n,e[7]=u*i+p*n,e[8]=c*i-a*n,e[9]=f*i-o*n,e[10]=d*i-s*n,e[11]=p*i-u*n,e}function fS(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],u=t[3],c=t[8],f=t[9],d=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-c*n,e[1]=o*i-f*n,e[2]=s*i-d*n,e[3]=u*i-p*n,e[8]=a*n+c*i,e[9]=o*n+f*i,e[10]=s*n+d*i,e[11]=u*n+p*i,e}function Yi(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function gi(e,t){var r=t[0],n=t[1],i=t[2],a=t[4],o=t[5],s=t[6],u=t[8],c=t[9],f=t[10];return e[0]=Math.hypot(r,n,i),e[1]=Math.hypot(a,o,s),e[2]=Math.hypot(u,c,f),e}function qi(e,t){var r=new yr(3);gi(r,t);var n=1/r[0],i=1/r[1],a=1/r[2],o=t[0]*n,s=t[1]*i,u=t[2]*a,c=t[4]*n,f=t[5]*i,d=t[6]*a,p=t[8]*n,g=t[9]*i,T=t[10]*a,x=o+f+T,O=0;return x>0?(O=Math.sqrt(x+1)*2,e[3]=.25*O,e[0]=(d-g)/O,e[1]=(p-u)/O,e[2]=(s-c)/O):o>f&&o>T?(O=Math.sqrt(1+o-f-T)*2,e[3]=(d-g)/O,e[0]=.25*O,e[1]=(s+c)/O,e[2]=(p+u)/O):f>T?(O=Math.sqrt(1+f-o-T)*2,e[3]=(p-u)/O,e[0]=(s+c)/O,e[1]=.25*O,e[2]=(d+g)/O):(O=Math.sqrt(1+T-o-f)*2,e[3]=(s-c)/O,e[0]=(p+u)/O,e[1]=(d+g)/O,e[2]=.25*O),e}function lS(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],u=i+i,c=a+a,f=o+o,d=i*u,p=i*c,g=i*f,T=a*c,x=a*f,O=o*f,z=s*u,ie=s*c,X=s*f,Te=n[0],ce=n[1],Re=n[2];return e[0]=(1-(T+O))*Te,e[1]=(p+X)*Te,e[2]=(g-ie)*Te,e[3]=0,e[4]=(p-X)*ce,e[5]=(1-(d+O))*ce,e[6]=(x+z)*ce,e[7]=0,e[8]=(g+ie)*Re,e[9]=(x-z)*Re,e[10]=(1-(d+T))*Re,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function bl(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,u=i+i,c=r*o,f=n*o,d=n*s,p=i*o,g=i*s,T=i*u,x=a*o,O=a*s,z=a*u;return e[0]=1-d-T,e[1]=f+z,e[2]=p-O,e[3]=0,e[4]=f-z,e[5]=1-c-T,e[6]=g+x,e[7]=0,e[8]=p+O,e[9]=g-x,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function dS(e,t,r,n,i){var a=1/Math.tan(t/2),o;return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(o=1/(n-i),e[10]=(i+n)*o,e[14]=2*i*n*o):(e[10]=-1,e[14]=-2*n),e}var hS=dS;function vS(e,t,r,n,i,a,o){var s=1/(t-r),u=1/(n-i),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*u,e[14]=(o+a)*c,e[15]=1,e}var pS=vS;function mS(e,t,r,n){var i,a,o,s,u,c,f,d,p,g,T=t[0],x=t[1],O=t[2],z=n[0],ie=n[1],X=n[2],Te=r[0],ce=r[1],Re=r[2];return Math.abs(T-Te)<Ao&&Math.abs(x-ce)<Ao&&Math.abs(O-Re)<Ao?Ey(e):(f=T-Te,d=x-ce,p=O-Re,g=1/Math.hypot(f,d,p),f*=g,d*=g,p*=g,i=ie*p-X*d,a=X*f-z*p,o=z*d-ie*f,g=Math.hypot(i,a,o),g?(g=1/g,i*=g,a*=g,o*=g):(i=0,a=0,o=0),s=d*o-p*a,u=p*i-f*o,c=f*a-d*i,g=Math.hypot(s,u,c),g?(g=1/g,s*=g,u*=g,c*=g):(s=0,u=0,c=0),e[0]=i,e[1]=s,e[2]=f,e[3]=0,e[4]=a,e[5]=u,e[6]=d,e[7]=0,e[8]=o,e[9]=c,e[10]=p,e[11]=0,e[12]=-(i*T+a*x+o*O),e[13]=-(s*T+u*x+c*O),e[14]=-(f*T+d*x+p*O),e[15]=1,e)}function Ct(){var e=new yr(3);return yr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function tn(e){var t=new yr(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function So(e){var t=e[0],r=e[1],n=e[2];return Math.hypot(t,r,n)}function lt(e,t,r){var n=new yr(3);return n[0]=e,n[1]=t,n[2]=r,n}function cr(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function di(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function nn(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function pu(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function yS(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function Ea(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function _S(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.hypot(r,n,i)}function da(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Io(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function qs(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[0],s=r[1],u=r[2];return e[0]=i*u-a*s,e[1]=a*o-n*u,e[2]=n*s-i*o,e}function Vn(e,t,r,n){var i=t[0],a=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e[2]=o+n*(r[2]-o),e}function Pu(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e}function Lu(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=n*r[0]+i*r[3]+a*r[6],e[1]=n*r[1]+i*r[4]+a*r[7],e[2]=n*r[2]+i*r[5]+a*r[8],e}function ES(e,t,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=t[0],u=t[1],c=t[2],f=i*c-a*u,d=a*s-n*c,p=n*u-i*s,g=i*p-a*d,T=a*f-n*p,x=n*d-i*f,O=o*2;return f*=O,d*=O,p*=O,g*=2,T*=2,x*=2,e[0]=s+f+g,e[1]=u+d+T,e[2]=c+p+x,e}var mu=pu,gl=_S,by=So;(function(){var e=Ct();return function(t,r,n,i,a,o){var s,u;for(r||(r=3),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();function fa(){var e=new yr(4);return yr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function gy(e,t,r,n){var i=new yr(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}function bS(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function gS(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o,e}function la(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e}(function(){var e=fa();return function(t,r,n,i,a,o){var s,u;for(r||(r=4),n||(n=0),i?u=Math.min(i*r+n,t.length):u=t.length,s=n;s<u;s+=r)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}})();function tr(){var e=new yr(4);return yr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Gn(e,t,r){r=r*.5;var n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function xr(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],c=r[2],f=r[3];return e[0]=n*f+o*s+i*c-a*u,e[1]=i*f+o*u+a*s-n*c,e[2]=a*f+o*c+n*u-i*s,e[3]=o*f-n*s-i*u-a*c,e}function wo(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=t[3],u=r[0],c=r[1],f=r[2],d=r[3],p,g,T,x,O;return g=i*u+a*c+o*f+s*d,g<0&&(g=-g,u=-u,c=-c,f=-f,d=-d),1-g>Ao?(p=Math.acos(g),T=Math.sin(p),x=Math.sin((1-n)*p)/T,O=Math.sin(n*p)/T):(x=1-n,O=n),e[0]=x*i+O*u,e[1]=x*a+O*c,e[2]=x*o+O*f,e[3]=x*s+O*d,e}function Tl(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-n*s,e[2]=-i*s,e[3]=a*s,e}function TS(e,t){var r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var i=0;t[4]>t[0]&&(i=1),t[8]>t[i*3+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[i*3+i]-t[a*3+a]-t[o*3+o]+1),e[i]=.5*n,n=.5/n,e[3]=(t[a*3+o]-t[o*3+a])*n,e[a]=(t[a*3+i]+t[i*3+a])*n,e[o]=(t[o*3+i]+t[i*3+o])*n}return e}function Ks(e,t,r,n){var i=.5*Math.PI/180;t*=i,r*=i,n*=i;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),u=Math.cos(r),c=Math.sin(n),f=Math.cos(n);return e[0]=a*u*f-o*s*c,e[1]=o*s*f+a*u*c,e[2]=o*u*c-a*s*f,e[3]=o*u*f+a*s*c,e}var Qs=gy,Ki=bS,AS=xr,Ti=gS;(function(){var e=Ct(),t=lt(1,0,0),r=lt(0,1,0);return function(n,i,a){var o=Io(i,a);return o<-.999999?(qs(e,t,i),by(e)<1e-6&&qs(e,r,i),da(e,e),Gn(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(qs(e,i,a),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,Ti(n,n))}})();(function(){var e=tr(),t=tr();return function(r,n,i,a,o,s){return wo(e,n,o,s),wo(t,i,a,s),wo(r,e,t,2*s*(1-s)),r}})();(function(){var e=Ta();return function(t,r,n,i){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=i[0],e[4]=i[1],e[7]=i[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Ti(t,TS(t,e))}})();var SS=9007199254740991,wS="[object Arguments]",RS="[object Array]",CS="[object Boolean]",xS="[object Date]",NS="[object Error]",OS="[object Function]",IS="[object Map]",PS="[object Number]",LS="[object Object]",MS="[object RegExp]",kS="[object Set]",DS="[object String]",FS="[object WeakMap]",GS="[object ArrayBuffer]",BS="[object DataView]",US="[object Float32Array]",$S="[object Float64Array]",VS="[object Int8Array]",jS="[object Int16Array]",zS="[object Int32Array]",HS="[object Uint8Array]",XS="[object Uint8ClampedArray]",WS="[object Uint16Array]",YS="[object Uint32Array]",Mt={};Mt[US]=Mt[$S]=Mt[VS]=Mt[jS]=Mt[zS]=Mt[HS]=Mt[XS]=Mt[WS]=Mt[YS]=!0;Mt[wS]=Mt[RS]=Mt[GS]=Mt[CS]=Mt[BS]=Mt[xS]=Mt[NS]=Mt[OS]=Mt[IS]=Mt[PS]=Mt[LS]=Mt[MS]=Mt[kS]=Mt[DS]=Mt[FS]=!1;var qS=Object.prototype,KS=qS.toString;function QS(e){return JS(e)&&ZS(e.length)&&!!Mt[KS.call(e)]}function ZS(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=SS}function JS(e){return!!e&&wi(e)==="object"}var Al=QS;function Sl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function wl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Sl(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function e1(e){var t=t1();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function t1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var r1=function(e){fr(r,e);var t=e1(r);function r(n){var i;return Fe(this,r),i=t.call(this,n),i.dirty=!0,i.attributes=[],i.indices=void 0,i.indicesBuffer=void 0,i.vertexCount=0,i.maxInstancedCount=void 0,i.aabb=void 0,i.entity=void 0,Object.assign(Xt(i),n),i}return Ye(r,[{key:"setAttribute",value:function(i,a,o,s){var u=this.attributes.find(function(c){return c.name===i});return u?(u.data=a,u.dirty=!0):this.attributes.push(wl(wl({dirty:!0,name:i,data:a},o),{},{bufferGetter:s})),this.dirty=!0,this}},{key:"setIndex",value:function(i){return this.indices=new Uint32Array(i.buffer?i.buffer:i),this.dirty=!0,this}},{key:"applyMatrix",value:function(i){var a=this.attributes.find(function(p){var g=p.name;return g==="position"}),o=this.attributes.find(function(p){var g=p.name;return g==="normal"});if(a&&(a.dirty=!0,a.data&&a.data.length))for(var s=0;s<a.data.length;s+=3){var u=gy(a.data[s],a.data[s+1],a.data[s+2],1);la(u,u,i),Al(a.data)?a.data.set([u[0],u[1],u[2]],s):(a.data[s]=u[0],a.data[s+1]=u[1],a.data[s+2]=u[2])}if(o){var c=sS(Ta(),i);if(o.data&&o.data.length)for(var f=0;f<o.data.length;f+=3){var d=lt(o.data[f],o.data[f+1],o.data[f+2]);Lu(d,d,c),da(d,d),Al(o.data)?o.data.set([d[0],d[1],d[2]],f):(o.data[f]=d[0],o.data[f+1]=d[1],o.data[f+2]=d[2])}}}}]),r}(Hn),M;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.SAMPLED=4]="SAMPLED",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(M||(M={}));var Rl,Cl,xl,Nl,io,Ol,Il,Pl,n1=(Rl=Rt(),Cl=He(te.GeometryComponentManager),xl=He(te.RenderEngine),Rl(Nl=(io=(Pl=function(){function e(){Fe(this,e),je(this,"geometry",Ol,this),je(this,"engine",Il,this)}return Ye(e,[{key:"execute",value:function(){var t=At(Me.mark(function n(){var i=this;return Me.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:this.geometry.forEach(function(s,u){u.dirty&&(u.attributes.forEach(function(c){if(c.dirty&&c.data){if(!c.buffer)c.buffer=i.engine.createBuffer({data:c.data,type:M.FLOAT});else{var f;(f=c.buffer)===null||f===void 0||f.subData({data:c.data,offset:0})}c.dirty=!1}}),u.indices&&(u.indicesBuffer?u.indicesBuffer.subData({data:u.indices,offset:0}):u.indicesBuffer=i.engine.createElements({data:u.indices,count:u.indices.length,type:M.UNSIGNED_INT,usage:M.STATIC_DRAW})),u.dirty=!1)});case 1:case"end":return o.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.geometry.forEach(function(r,n){n.indicesBuffer&&n.indicesBuffer.destroy(),n.attributes.forEach(function(i){i.buffer&&i.buffer.destroy()})}),this.geometry.clear()}},{key:"createBufferGeometry",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{vertexCount:3},n=r.vertexCount,i=zr();return this.geometry.create(i,{vertexCount:n})}},{key:"createInstancedBufferGeometry",value:function(r){var n=r.maxInstancedCount,i=r.vertexCount,a=zr();return this.geometry.create(a,{maxInstancedCount:n,vertexCount:i})}}]),e}(),Pl),Ol=ze(io.prototype,"geometry",[Cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Il=ze(io.prototype,"engine",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),io))||Nl);function Ll(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ml(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ll(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ll(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function i1(e){var t=a1();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function a1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var o1=function(e){fr(r,e);var t=i1(r);function r(n){var i;return Fe(this,r),i=t.call(this,n),i.vertexShaderGLSL=void 0,i.fragmentShaderGLSL=void 0,i.defines={},i.dirty=!0,i.uniforms=[],i.cull={enable:!0,face:M.BACK},i.depth={enable:!0},i.blend=void 0,i.entity=void 0,i.type=void 0,Object.assign(Xt(i),n),i}return Ye(r,[{key:"setDefines",value:function(i){return this.defines=Ml(Ml({},this.defines),i),this}},{key:"setCull",value:function(i){return this.cull=i,this}},{key:"setDepth",value:function(i){return this.depth=i,this}},{key:"setBlend",value:function(i){return this.blend=i,this}},{key:"setUniform",value:function(i,a){var o=this;if(typeof i!="string")return Object.keys(i).forEach(function(u){return o.setUniform(u,i[u])}),this;var s=this.uniforms.find(function(u){return u.name===i});return s?(s.dirty=!0,s.data=a):this.uniforms.push({name:i,dirty:!0,data:a}),this.dirty=!0,this}}]),r}(Hn),kl,Dl,Fl,Gl,Bl,Qi,Ul,$l,Vl,jl;function zl(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Hl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zl(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var s1=(kl=Rt(),Dl=He(te.MaterialComponentManager),Fl=He(te.RenderEngine),Gl=He(te.ShaderModuleService),kl(Bl=(Qi=(jl=function(){function e(){Fe(this,e),je(this,"material",Ul,this),je(this,"engine",$l,this),je(this,"shaderModule",Vl,this)}return Ye(e,[{key:"execute",value:function(){var t=At(Me.mark(function n(){return Me.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:case"end":return a.stop()}},n)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.material.clear()}},{key:"createShaderMaterial",value:function(r){var n=zr(),i=r.vertexShader,a=r.fragmentShader,o=[];if(!this.engine.supportWebGPU){var s="material-".concat(n);this.shaderModule.registerModule(s,{vs:r.vertexShader,fs:r.fragmentShader});var u=this.shaderModule.getModule(s);i=u.vs,a=u.fs,u.uniforms&&(o=Object.keys(u.uniforms).map(function(c){return{dirty:!0,name:c,data:u.uniforms[c]}}))}return this.material.create(n,Hl(Hl({vertexShaderGLSL:i,fragmentShaderGLSL:a},r),{},{uniforms:o}))}}]),e}(),jl),Ul=ze(Qi.prototype,"material",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$l=ze(Qi.prototype,"engine",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vl=ze(Qi.prototype,"shaderModule",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qi))||Bl);function u1(e){var t=c1();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function c1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var yu;(function(e){e[e.Standard=0]="Standard"})(yu||(yu={}));var f1=function(e){fr(r,e);var t=u1(r);function r(n){var i;return Fe(this,r),i=t.call(this,n),i.strategy=yu.Standard,i.visibilityPlaneMask=0,i.visible=!1,Object.assign(Xt(i),n),i}return r}(Hn),Mu=function(){function e(t,r){Fe(this,e),this.center=void 0,this.halfExtents=void 0,this.min=Ct(),this.max=Ct(),this.update(t,r)}return Ye(e,[{key:"update",value:function(r,n){this.center=r||Ct(),this.halfExtents=n||lt(.5,.5,.5),this.min=mu(this.min,this.center,this.halfExtents),this.max=nn(this.max,this.center,this.halfExtents)}},{key:"setMinMax",value:function(r,n){nn(this.center,n,r),Ea(this.center,this.center,.5),mu(this.halfExtents,n,r),Ea(this.halfExtents,this.halfExtents,.5),cr(this.min,r),cr(this.max,n)}},{key:"getMin",value:function(){return this.min}},{key:"getMax",value:function(){return this.max}},{key:"add",value:function(r){var n=this.center,i=n[0],a=n[1],o=n[2],s=this.halfExtents,u=s[0],c=s[1],f=s[2],d=i-u,p=i+u,g=a-c,T=a+c,x=o-f,O=o+f,z=r.center,ie=z[0],X=z[1],Te=z[2],ce=r.halfExtents,Re=ce[0],Le=ce[1],Xe=ce[2],vt=ie-Re,ht=ie+Re,yt=X-Le,Qe=X+Le,pt=Te-Xe,$e=Te+Xe;vt<d&&(d=vt),ht>p&&(p=ht),yt<g&&(g=yt),Qe>T&&(T=Qe),pt<x&&(x=pt),$e>O&&(O=$e),n[0]=(d+p)*.5,n[1]=(g+T)*.5,n[2]=(x+O)*.5,s[0]=(p-d)*.5,s[1]=(T-g)*.5,s[2]=(O-x)*.5,this.min[0]=d,this.min[1]=g,this.min[2]=x,this.max[0]=p,this.max[1]=T,this.max[2]=O}},{key:"intersects",value:function(r){var n=this.getMax(),i=this.getMin(),a=r.getMax(),o=r.getMin();return i[0]<=a[0]&&n[0]>=o[0]&&i[1]<=a[1]&&n[1]>=o[1]&&i[2]<=a[2]&&n[2]>=o[2]}},{key:"containsPoint",value:function(r){var n=this.getMin(),i=this.getMax();return!(r[0]<n[0]||r[0]>i[0]||r[1]<n[1]||r[1]>i[1]||r[2]<n[2]||r[2]>i[2])}},{key:"getNegativeFarPoint",value:function(r){return r.pnVertexFlag===273?cr(Ct(),this.min):r.pnVertexFlag===272?lt(this.min[0],this.min[1],this.max[2]):r.pnVertexFlag===257?lt(this.min[0],this.max[1],this.min[2]):r.pnVertexFlag===256?lt(this.min[0],this.max[1],this.max[2]):r.pnVertexFlag===17?lt(this.max[0],this.min[1],this.min[2]):r.pnVertexFlag===16?lt(this.max[0],this.min[1],this.max[2]):r.pnVertexFlag===1?lt(this.max[0],this.max[1],this.min[2]):lt(this.max[0],this.max[1],this.max[2])}},{key:"getPositiveFarPoint",value:function(r){return r.pnVertexFlag===273?cr(Ct(),this.max):r.pnVertexFlag===272?lt(this.max[0],this.max[1],this.min[2]):r.pnVertexFlag===257?lt(this.max[0],this.min[1],this.max[2]):r.pnVertexFlag===256?lt(this.max[0],this.min[1],this.min[2]):r.pnVertexFlag===17?lt(this.min[0],this.max[1],this.max[2]):r.pnVertexFlag===16?lt(this.min[0],this.max[1],this.min[2]):r.pnVertexFlag===1?lt(this.min[0],this.min[1],this.max[2]):lt(this.min[0],this.min[1],this.min[2])}}]),e}();function l1(e){var t=d1();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function d1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var h1=function(e){fr(r,e);var t=l1(r);function r(n){var i;return Fe(this,r),i=t.call(this,n),i.material=void 0,i.geometry=void 0,i.aabb=new Mu,i.aabbDirty=!0,i.model=void 0,i.visible=!0,i.children=[],Object.assign(Xt(i),n),i}return r}(Hn),v1=function(){function e(t,r){Fe(this,e),this.distance=void 0,this.normal=void 0,this.pnVertexFlag=void 0,this.distance=t||0,this.normal=r||lt(0,1,0),this.updatePNVertexFlag()}return Ye(e,[{key:"updatePNVertexFlag",value:function(){this.pnVertexFlag=(Number(this.normal[0]>=0)<<8)+(Number(this.normal[1]>=0)<<4)+Number(this.normal[2]>=0)}},{key:"distanceToPoint",value:function(r){return Io(r,this.normal)-this.distance}},{key:"normalize",value:function(){var r=1/by(this.normal);Ea(this.normal,this.normal,r),this.distance*=r}},{key:"intersectsLine",value:function(r,n,i){var a=this.distanceToPoint(r),o=this.distanceToPoint(n),s=a/(a-o),u=s>=0&&s<=1;return u&&i&&Vn(i,r,n,s),u}}]),e}(),pn;(function(e){e[e.OUTSIDE=4294967295]="OUTSIDE",e[e.INSIDE=0]="INSIDE",e[e.INDETERMINATE=2147483647]="INDETERMINATE"})(pn||(pn={}));var p1=function(){function e(t){if(Fe(this,e),this.planes=[],t)this.planes=t;else for(var r=0;r<6;r++)this.planes.push(new v1)}return Ye(e,[{key:"extractFromVPMatrix",value:function(r){var n=ko(r,16),i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=n[5],f=n[6],d=n[7],p=n[8],g=n[9],T=n[10],x=n[11],O=n[12],z=n[13],ie=n[14],X=n[15];di(this.planes[0].normal,s-i,d-u,x-p),this.planes[0].distance=-(X-O),di(this.planes[1].normal,s+i,d+u,x+p),this.planes[1].distance=-(X+O),di(this.planes[2].normal,s+a,d+c,x+g),this.planes[2].distance=-(X+z),di(this.planes[3].normal,s-a,d-c,x-g),this.planes[3].distance=-(X-z),di(this.planes[4].normal,s-o,d-f,x-T),this.planes[4].distance=-(X-ie),di(this.planes[5].normal,s+o,d+f,x+T),this.planes[5].distance=-(X+ie),this.planes.forEach(function(Te){Te.normalize(),Te.updatePNVertexFlag()})}}]),e}();function m1(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function y1(e){var t=ko(e,3),r=t[0],n=t[1],i=t[2],a=r+n*256+i*65536-1;return a}var Xl,Wl,Yl,ql,Kl,Ql,Zl,Mn,Jl,ed,td,rd,nd,id;function ad(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=_1(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function _1(e,t){if(!!e){if(typeof e=="string")return od(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return od(e,t)}}function od(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var E1=(Xl=Rt(),Wl=He(te.MeshComponentManager),Yl=He(te.CullableComponentManager),ql=He(te.GeometryComponentManager),Kl=He(te.HierarchyComponentManager),Ql=He(te.TransformComponentManager),Xl(Zl=(Mn=(id=function(){function e(){Fe(this,e),je(this,"mesh",Jl,this),je(this,"cullable",ed,this),je(this,"geometry",td,this),je(this,"hierarchy",rd,this),je(this,"transform",nd,this),this.planes=void 0}return Ye(e,[{key:"setFrustumPlanes",value:function(r){this.planes=r}},{key:"execute",value:function(){var t=At(Me.mark(function n(i){var a,o,s,u,c,f,d,p,g,T,x,O,z,ie,X,Te,ce,Re,Le,Xe,vt;return Me.wrap(function(yt){for(;;)switch(yt.prev=yt.next){case 0:a=ad(i);try{for(a.s();!(o=a.n()).done;){s=o.value,u=s.getScene(),c=s.getCamera(),f=ad(u.getEntities());try{for(f.s();!(d=f.n()).done;)p=d.value,g=this.mesh.getComponentByEntity(p),g&&(T=this.hierarchy.getComponentByEntity(p),x=this.cullable.getComponentByEntity(p),O=g.geometry,z=this.transform.getComponentByEntity(p),O&&O.aabb&&z&&g.aabbDirty&&(ie=z.worldTransform,X=O.aabb,Te=X.center,ce=X.halfExtents,Re=Pu(Ct(),Te,ie),Le=m1(ie,Ta()),Xe=Lu(Ct(),ce,Le),g.aabb.update(Re,Xe),g.aabbDirty=!1),x&&O&&(vt=this.cullable.getComponentByEntity((T==null?void 0:T.parentID)||-1),x.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(g.aabb,(vt==null?void 0:vt.visibilityPlaneMask)||pn.INDETERMINATE,this.planes||c.getFrustum().planes),x.visible=x.visibilityPlaneMask!==pn.OUTSIDE))}catch(Qe){f.e(Qe)}finally{f.f()}}}catch(Qe){a.e(Qe)}finally{a.f()}case 2:case"end":return yt.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.cullable.clear(),this.mesh.clear()}},{key:"computeVisibilityWithPlaneMask",value:function(r,n,i){if(n===pn.OUTSIDE||n===pn.INSIDE)return n;for(var a=pn.INSIDE,o=0,s=i.length;o<s;++o){var u=o<31?1<<o:0;if(!(o<31&&(n&u)===0)){var c=i[o],f=c.normal,d=c.distance;if(Io(f,r.getNegativeFarPoint(i[o]))+d>0)return pn.OUTSIDE;Io(f,r.getPositiveFarPoint(i[o]))+d>0&&(a|=u)}}return a}}]),e}(),id),Jl=ze(Mn.prototype,"mesh",[Wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed=ze(Mn.prototype,"cullable",[Yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),td=ze(Mn.prototype,"geometry",[ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rd=ze(Mn.prototype,"hierarchy",[Kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd=ze(Mn.prototype,"transform",[Ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mn))||Zl),sd,ud,cd,fd,ld,dd,hd,vd,pd,md,yd,_d,kr,Ed,bd,gd,Td,Ad,Sd,wd,Rd,Cd,xd,Nd;function ao(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=b1(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function b1(e,t){if(!!e){if(typeof e=="string")return Od(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Od(e,t)}}function Od(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Si=(sd=Rt(),ud=He(te.MeshComponentManager),cd=He(te.GeometryComponentManager),fd=He(te.MaterialComponentManager),ld=He(te.CullableComponentManager),dd=He(te.TransformComponentManager),hd=He(te.HierarchyComponentManager),vd=He(te.Systems),pd=Xr(te.FrameGraphSystem),md=He(te.RenderEngine),yd=He(te.ResourcePool),sd(_d=(kr=(Nd=xd=function(){function e(){var t=this;Fe(this,e),je(this,"mesh",Ed,this),je(this,"geometry",bd,this),je(this,"material",gd,this),je(this,"cullable",Td,this),je(this,"transform",Ad,this),je(this,"hierarchy",Sd,this),je(this,"frameGraphSystem",wd,this),je(this,"engine",Rd,this),je(this,"resourcePool",Cd,this),this.modelCache={},this.setup=function(r,n,i){var a=r.createRenderTarget(n,"color buffer",{width:1,height:1,usage:M.RENDER_ATTACHMENT|M.SAMPLED|M.COPY_SRC});i.data={output:n.write(r,a)}},this.execute=function(){var r=At(Me.mark(function n(i,a,o){var s,u,c,f,d,p;return Me.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:s=i.getResourceNode(a.data.output),u=t.resourcePool.getOrCreateResource(s.resource),c=ao(o),T.prev=3,c.s();case 5:if((f=c.n()).done){T.next=11;break}return d=f.value,T.next=9,t.initView(d);case 9:T.next=5;break;case 11:T.next=16;break;case 13:T.prev=13,T.t0=T.catch(3),c.e(T.t0);case 16:return T.prev=16,c.f(),T.finish(16);case 19:p=t.engine.getCanvas(),u.resize({width:p.width,height:p.height}),t.engine.setScissor({enable:!1}),t.engine.clear({framebuffer:u,color:o[0].getClearColor(),depth:1}),t.engine.useFramebuffer(u,function(){var x=ao(o),O;try{for(x.s();!(O=x.n()).done;){var z=O.value;t.renderView(z)}}catch(ie){x.e(ie)}finally{x.f()}});case 24:case"end":return T.stop()}},n,null,[[3,13,16,19]])}));return function(n,i,a){return r.apply(this,arguments)}}()}return Ye(e,[{key:"renderView",value:function(r){var n=r.getScene(),i=r.getCamera(),a=i.getViewTransform(),o=Un(Tr(),i.getPerspective(),a);i.getFrustum().extractFromVPMatrix(o);var s=r.getViewport(),u=s.x,c=s.y,f=s.width,d=s.height;this.engine.viewport({x:u,y:c,width:f,height:d});var p=ao(n.getEntities()),g;try{for(p.s();!(g=p.n()).done;){var T=g.value;this.renderMesh(T,{camera:i,view:r,viewMatrix:a})}}catch(x){p.e(x)}finally{p.f()}}},{key:"renderMesh",value:function(r,n){var i=n.camera,a=n.view,o=n.viewMatrix,s=this.mesh.getComponentByEntity(r);if(!(!s||!s.visible)){var u=s.material,c=s.geometry;if(!(!c||c.dirty||!u)){var f=this.transform.getComponentByEntity(r),d=Un(Tr(),o,f.worldTransform),p=a.getViewport(),g=p.width,T=p.height;u.setUniform({projectionMatrix:i.getPerspective(),modelViewMatrix:d,modelMatrix:f.worldTransform,viewMatrix:o,cameraPosition:i.getPosition(),u_viewport:[g,T]}),s.model&&(s.model.draw({uniforms:u.uniforms.reduce(function(x,O){return x[O.name]=O.data,x},{})}),u.uniforms.forEach(function(x){x.dirty=!1}),u.dirty=!1)}}}},{key:"initMesh",value:function(){var t=At(Me.mark(function n(i,a){var o,s,u,c,f,d,p,g;return Me.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(o=this.mesh.getComponentByEntity(i),o){x.next=3;break}return x.abrupt("return");case 3:if(s=o.material,u=o.geometry,!(!u||u.dirty||!s)){x.next=7;break}return x.abrupt("return");case 7:if(o.model){x.next=24;break}if(c="m-".concat(s.entity,"-g-").concat(u.entity),!this.modelCache[c]){x.next=12;break}return o.model=this.modelCache[c],x.abrupt("return");case 12:return s.setUniform({projectionMatrix:1,modelViewMatrix:1,modelMatrix:1,viewMatrix:1,cameraPosition:1,u_viewport:1}),f=this.engine,d=f.createModel,p=f.createAttribute,g={vs:s.vertexShaderGLSL,fs:s.fragmentShaderGLSL,defines:s.defines,attributes:u.attributes.reduce(function(O,z){return z.data&&z.buffer&&(O[z.name]=p({buffer:z.buffer,attributes:z.attributes,arrayStride:z.arrayStride,stepMode:z.stepMode,divisor:z.stepMode==="vertex"?0:1})),O},{}),uniforms:s.uniforms.reduce(function(O,z){return O[z.name]=z.data,O},{}),scissor:{enable:!0,box:function(){return a.getViewport()}}},s.cull&&(g.cull=s.cull),s.depth&&(g.depth=s.depth),s.blend&&(g.blend=s.blend),u.indicesBuffer&&(g.elements=u.indicesBuffer),u.maxInstancedCount&&(g.instances=u.maxInstancedCount,g.count=u.vertexCount||3),x.next=22,d(g);case 22:o.model=x.sent,this.modelCache[c]=o.model;case 24:case"end":return x.stop()}},n,this)}));function r(n,i){return t.apply(this,arguments)}return r}()},{key:"initView",value:function(){var t=At(Me.mark(function n(i){var a,o,s,u;return Me.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:a=i.getScene(),o=ao(a.getEntities()),f.prev=2,o.s();case 4:if((s=o.n()).done){f.next=10;break}return u=s.value,f.next=8,this.initMesh(u,i);case 8:f.next=4;break;case 10:f.next=15;break;case 12:f.prev=12,f.t0=f.catch(2),o.e(f.t0);case 15:return f.prev=15,o.f(),f.finish(15);case 18:case"end":return f.stop()}},n,this,[[2,12,15,18]])}));function r(n){return t.apply(this,arguments)}return r}()}]),e}(),xd.IDENTIFIER="Render Pass",Nd),Ed=ze(kr.prototype,"mesh",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd=ze(kr.prototype,"geometry",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd=ze(kr.prototype,"material",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td=ze(kr.prototype,"cullable",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad=ze(kr.prototype,"transform",[dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd=ze(kr.prototype,"hierarchy",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=ze(kr.prototype,"frameGraphSystem",[vd,pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd=ze(kr.prototype,"engine",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd=ze(kr.prototype,"resourcePool",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kr))||_d),Id,Pd,Ld,Md,kd,Dd,hi,Fd,Gd,Bd,Ud,$d,Vd;function Zs(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=g1(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function g1(e,t){if(!!e){if(typeof e=="string")return jd(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jd(e,t)}}function jd(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Js={NONE:0,ENCODE:1,HIGHLIGHT:2},_u=(Id=Rt(),Pd=He(te.RenderEngine),Ld=He(te.ResourcePool),Md=He(te.RenderPassFactory),kd=He(te.MeshComponentManager),Id(Dd=(hi=(Vd=$d=function(){function e(){var t=this;Fe(this,e),je(this,"engine",Fd,this),je(this,"resourcePool",Gd,this),je(this,"renderPassFactory",Bd,this),je(this,"mesh",Ud,this),this.pickingFBO=void 0,this.views=void 0,this.highlightEnabled=!0,this.highlightColor=[255,0,0,255],this.alreadyInRendering=!1,this.setup=function(r,n,i){var a=r.createRenderTarget(n,"picking fbo",{width:1,height:1});i.data={output:n.write(r,a)},n.hasSideEffect=!0},this.execute=function(){var r=At(Me.mark(function n(i,a,o){var s,u,c;return Me.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(t.views=o,!t.alreadyInRendering){d.next=3;break}return d.abrupt("return");case 3:s=Zs(o);try{for(c=function(){var g=u.value,T=g.getViewport(),x=T.width,O=T.height;t.alreadyInRendering=!0;var z=i.getResourceNode(a.data.output);t.pickingFBO=t.resourcePool.getOrCreateResource(z.resource),t.pickingFBO.resize({width:x,height:O}),t.engine.useFramebuffer(t.pickingFBO,function(){t.engine.clear({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var ie=t.renderPassFactory(Si.IDENTIFIER),X=[],Te=g.getScene(),ce=Zs(Te.getEntities()),Re;try{for(ce.s();!(Re=ce.n()).done;){var Le=Re.value,Xe=t.mesh.getComponentByEntity(Le),vt=Xe.material;vt.setUniform("u_PickingStage",Js.ENCODE),X.push(Xe)}}catch(ht){ce.e(ht)}finally{ce.f()}ie.renderView(g),X.forEach(function(ht){var yt=ht.material;yt.setUniform("u_PickingStage",Js.HIGHLIGHT)}),t.alreadyInRendering=!1})},s.s();!(u=s.n()).done;)c()}catch(p){s.e(p)}finally{s.f()}case 5:case"end":return d.stop()}},n)}));return function(n,i,a){return r.apply(this,arguments)}}(),this.pick=function(r,n){var i=r.x,a=r.y,o=t.engine,s=o.readPixels,u=o.useFramebuffer,c=n.getViewport(),f=c.width,d=c.height,p=i*window.devicePixelRatio,g=a*window.devicePixelRatio;if(!(p>f||p<0||g>d||g<0)){var T,x;return u(t.pickingFBO,function(){T=s({x:Math.round(p),y:Math.round(d-(a+1)*window.devicePixelRatio),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:t.pickingFBO}),(T[0]!==0||T[1]!==0||T[2]!==0)&&(x=y1(T),t.highlightEnabled&&t.highlightPickedFeature(T,n))}),x}}}return Ye(e,[{key:"enableHighlight",value:function(r){this.highlightEnabled=r}},{key:"setHighlightColor",value:function(r){this.highlightColor=r}},{key:"highlightPickedFeature",value:function(r,n){if(r){var i=Zs(n.getScene().getEntities()),a;try{for(i.s();!(a=i.n()).done;){var o=a.value,s=this.mesh.getComponentByEntity(o),u=s.material;u.setUniform("u_PickingStage",Js.HIGHLIGHT),u.setUniform("u_PickingColor",[r[0],r[1],r[2]]),u.setUniform("u_HighlightColor",this.highlightColor)}}catch(c){i.e(c)}finally{i.f()}}}}]),e}(),$d.IDENTIFIER="PixelPicking Pass",Vd),Fd=ze(hi.prototype,"engine",[Pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=ze(hi.prototype,"resourcePool",[Ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=ze(hi.prototype,"renderPassFactory",[Md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud=ze(hi.prototype,"mesh",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hi))||Dd),zd,Hd,Xd,Wd,oo,Yd,qd,Kd,Qd,T1=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,A1=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,S1=`layout(set = 0, binding = 0) uniform sampler u_TextureSampler;
layout(set = 0, binding = 1) uniform texture2D u_Texture;

layout(location = 0) in vec2 v_UV;
layout(location = 0) out vec4 outColor;

void main() {
  outColor = texture(sampler2D(u_Texture, u_TextureSampler), v_UV);
}`,w1=`layout(location = 0) in vec2 a_Position;
layout(location = 0) out vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Po=(zd=Rt(),Hd=He(te.RenderEngine),Xd=He(te.ResourcePool),zd(Wd=(oo=(Qd=Kd=function e(){var t=this;Fe(this,e),je(this,"engine",Yd,this),je(this,"resourcePool",qd,this),this.model=void 0,this.setup=function(r,n,i){var a=r.getPass(Si.IDENTIFIER);if(a){var o=r.createRenderTarget(n,"render to screen",{width:1,height:1});i.data={input:n.read(a.data.output),output:n.write(r,o)}}},this.execute=function(){var r=At(Me.mark(function n(i,a){var o,s,u,c,f,d,p;return Me.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(o=t.engine,s=o.createModel,u=o.createAttribute,c=o.createBuffer,t.model){T.next=6;break}return T.next=4,s({vs:t.engine.supportWebGPU?w1:A1,fs:t.engine.supportWebGPU?S1:T1,attributes:{a_Position:u({buffer:c({data:[-4,-4,4,-4,0,4],type:M.FLOAT}),size:2,arrayStride:8,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})},uniforms:{u_Texture:null},depth:{enable:!1},count:3,blend:{enable:!0}});case 4:f=T.sent,t.model=f;case 6:d=i.getResourceNode(a.data.input),p=t.resourcePool.getOrCreateResource(d.resource),t.engine.useFramebuffer(null,function(){t.engine.clear({framebuffer:null,color:[0,0,0,0],depth:1,stencil:0}),t.model.draw({uniforms:{u_Texture:p}})});case 9:case"end":return T.stop()}},n)}));return function(n,i){return r.apply(this,arguments)}}(),this.tearDown=function(){t.model=void 0}},Kd.IDENTIFIER="Copy Pass",Qd),Yd=ze(oo.prototype,"engine",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=ze(oo.prototype,"resourcePool",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oo))||Wd),Zd,Jd,eh,th,rh,nh,ih,vi,ah,oh,sh,uh,ch,R1=(Zd=Rt(),Jd=He(te.Systems),eh=Xr(te.FrameGraphSystem),th=He(te.RenderPassFactory),rh=He(te.ConfigService),nh=He(te.ResourcePool),Zd(ih=(vi=(ch=function(){function e(){Fe(this,e),je(this,"frameGraphSystem",ah,this),je(this,"renderPassFactory",oh,this),je(this,"configService",sh,this),je(this,"resourcePool",uh,this)}return Ye(e,[{key:"execute",value:function(){var t=At(Me.mark(function n(i){var a,o,s,u,c,f,d,p;return Me.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:a=this.renderPassFactory(Si.IDENTIFIER),o=a.setup,s=a.execute,this.frameGraphSystem.addPass(Si.IDENTIFIER,o,s),u=this.renderPassFactory(Po.IDENTIFIER),c=u.setup,f=u.execute,d=u.tearDown,p=this.frameGraphSystem.addPass(Po.IDENTIFIER,c,f,d),this.frameGraphSystem.present(p.data.output);case 5:case"end":return T.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.resourcePool.clean()}},{key:"pick",value:function(r,n){var i=this.renderPassFactory(_u.IDENTIFIER);return i.pick(r,n)}}]),e}(),ch),ah=ze(vi.prototype,"frameGraphSystem",[Jd,eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oh=ze(vi.prototype,"renderPassFactory",[th],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh=ze(vi.prototype,"configService",[rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=ze(vi.prototype,"resourcePool",[nh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vi))||ih);function C1(e){var t=x1();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function x1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var N1=function(e){fr(r,e);var t=C1(r);function r(n){var i;return Fe(this,r),i=t.call(this,n),i.parentID=void 0,Object.assign(Xt(i),n),i}return r}(Hn),fh,lh,dh,hh,vh,Zi,ph,mh,yh,_h,O1=(fh=Rt(),lh=He(te.HierarchyComponentManager),dh=He(te.TransformComponentManager),hh=He(te.MeshComponentManager),fh(vh=(Zi=(_h=function(){function e(){Fe(this,e),je(this,"hierarchy",ph,this),je(this,"transform",mh,this),je(this,"mesh",yh,this)}return Ye(e,[{key:"execute",value:function(){var t=At(Me.mark(function n(){return Me.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:this.runTransformUpdateSystem(),this.runHierarchyUpdateSystem();case 2:case"end":return a.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"tearDown",value:function(){this.hierarchy.clear(),this.transform.clear()}},{key:"getHierarchyComponentManager",value:function(){return this.hierarchy}},{key:"getTransformComponentManager",value:function(){return this.transform}},{key:"runTransformUpdateSystem",value:function(){var r=this;this.transform.forEach(function(n,i){(i.isDirty()||i.isLocalDirty())&&(r.setMeshAABBDirty(r.mesh.getComponentByEntity(n)),i.updateTransform())})}},{key:"runHierarchyUpdateSystem",value:function(){var r=this;this.hierarchy.forEach(function(n,i){var a=r.transform.getComponentByEntity(n),o=r.transform.getComponentByEntity(i.parentID);a!==null&&o!==null&&a.updateTransformWithParent(o)})}},{key:"attach",value:function(r,n,i){this.hierarchy.contains(r)&&this.detach(r),this.hierarchy.create(r,{parentID:n});var a=this.mesh.getComponentByEntity(n);if(this.setMeshAABBDirty(a),a&&a.children.indexOf(r)===-1&&a.children.push(r),this.hierarchy.getCount()>1)for(var o=this.hierarchy.getCount()-1;o>0;--o)for(var s=this.hierarchy.getEntity(o),u=0;u<o;++u){var c=this.hierarchy.getComponent(u);if(c.parentID===s){this.hierarchy.moveItem(o,u),++o;break}}this.hierarchy.getComponentByEntity(r);var f=this.transform.getComponentByEntity(n);f===null&&(f=this.transform.create(n));var d=this.transform.getComponentByEntity(r);d===null&&(d=this.transform.create(r),f=this.transform.getComponentByEntity(n)),d.parent=f,!i&&f&&(d.matrixTransform(Oo(Tr(),f.worldTransform)),d.updateTransform()),f&&d.updateTransformWithParent(f)}},{key:"detach",value:function(r){var n=this.hierarchy.getComponentByEntity(r);if(n!==null){var i=this.transform.getComponentByEntity(r);i!==null&&(i.parent=null,i.applyTransform()),this.hierarchy.removeKeepSorted(r);var a=this.mesh.getComponentByEntity(n.parentID);if(a){var o=a.children.indexOf(r);a.children.splice(o,1)}this.setMeshAABBDirty(a)}}},{key:"detachChildren",value:function(r){var n=this.mesh.getComponentByEntity(r);n&&(n.children=[]);for(var i=0;i<this.hierarchy.getCount();){var a;if(((a=this.hierarchy.getComponent(i))===null||a===void 0?void 0:a.parentID)===r){var o=this.hierarchy.getEntity(i);this.detach(o)}else++i}}},{key:"setMeshAABBDirty",value:function(r){r&&(r.aabbDirty=!0)}}]),e}(),_h),ph=ze(Zi.prototype,"hierarchy",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mh=ze(Zi.prototype,"transform",[dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yh=ze(Zi.prototype,"mesh",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zi))||vh);function I1(e){var t=P1();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function P1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Ty=function(e){fr(r,e);var t=I1(r);function r(n){var i;return Fe(this,r),i=t.call(this,n),i.dirtyFlag=void 0,i.localDirtyFlag=void 0,i.parent=null,i.localPosition=lt(0,0,0),i.localRotation=Qs(0,0,0,1),i.localScale=lt(1,1,1),i.localTransform=Tr(),i.position=lt(0,0,0),i.rotation=Qs(0,0,0,1),i.scaling=lt(1,1,1),i.worldTransform=Tr(),i.matrixTransform=function(){var a=Tr();return function(o){Un(a,i.getLocalTransform(),o),gi(i.localScale,a),Yi(i.localPosition,a),qi(i.localRotation,a)}}(),i.rotateRollPitchYaw=function(){var a=tr(),o=tr(),s=tr();return function(u,c,f){i.setDirty(),Ks(a,u,0,0),Ks(o,0,c,0),Ks(s,0,0,f),xr(i.localRotation,a,i.localRotation),xr(i.localRotation,i.localRotation,o),xr(i.localRotation,s,i.localRotation),Ti(i.localRotation,i.localRotation)}}(),i.lerp=function(){var a=Ct(),o=tr(),s=Ct(),u=Ct(),c=tr(),f=Ct();return function(d,p,g){i.setDirty(),gi(a,d.worldTransform),Yi(s,d.worldTransform),qi(o,d.worldTransform),gi(u,p.worldTransform),Yi(f,p.worldTransform),qi(c,p.worldTransform),Vn(i.localScale,a,u,g),wo(i.localRotation,o,c,g),Vn(i.localPosition,s,f,g)}}(),i.translate=function(){var a=Ct();return function(o){return nn(a,i.getPosition(),o),i.setPosition(a),i.setDirty(!0),Xt(i)}}(),i.translateLocal=function(){return function(a){return ES(a,a,i.localRotation),nn(i.localPosition,i.localPosition,a),i.setLocalDirty(!0),Xt(i)}}(),i.setPosition=function(){var a=Tr();return function(o){return i.position=o,i.setLocalDirty(!0),i.parent===null?cr(i.localPosition,o):(vu(a,i.parent.worldTransform),Oo(a,a),Pu(i.localPosition,o,a)),Xt(i)}}(),i.rotate=function(){var a=tr();return function(o){if(i.parent===null)xr(i.localRotation,i.localRotation,o),Ti(i.localRotation,i.localRotation);else{var s=i.getRotation(),u=i.parent.getRotation();Ki(a,u),Tl(a,a),xr(a,a,o),xr(i.localRotation,o,s),Ti(i.localRotation,i.localRotation)}return i.setLocalDirty(),Xt(i)}}(),i.rotateLocal=function(){return function(a){return xr(i.localRotation,i.localRotation,a),Ti(i.localRotation,i.localRotation),i.setLocalDirty(!0),Xt(i)}}(),i.setRotation=function(){var a=tr();return function(o){return i.parent===null?Ki(i.localRotation,o):(Ki(a,i.parent.getRotation()),Tl(a,a),Ki(i.localRotation,a),AS(i.localRotation,i.localRotation,o)),i.setLocalDirty(!0),Xt(i)}}(),i}return Ye(r,[{key:"setLocalPosition",value:function(i){cr(this.localPosition,i),this.setLocalDirty(!0)}},{key:"setLocalScale",value:function(i){cr(this.localScale,i),this.setLocalDirty(!0)}},{key:"setLocalRotation",value:function(i){return Ki(this.localRotation,i),this.setLocalDirty(!0),this}},{key:"isDirty",value:function(){return this.dirtyFlag}},{key:"setDirty",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i?this.dirtyFlag|=r.DIRTY:this.dirtyFlag&=~r.DIRTY}},{key:"isLocalDirty",value:function(){return this.localDirtyFlag}},{key:"setLocalDirty",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i?(this.localDirtyFlag|=r.DIRTY,this.setDirty(!0)):this.localDirtyFlag&=~r.DIRTY}},{key:"updateTransform",value:function(){this.isLocalDirty()&&this.getLocalTransform(),this.isDirty()&&this.parent===null&&(vu(this.worldTransform,this.getLocalTransform()),this.setDirty(!1))}},{key:"updateTransformWithParent",value:function(i){Un(this.worldTransform,i.worldTransform,this.getLocalTransform())}},{key:"applyTransform",value:function(){this.setDirty(),gi(this.localScale,this.worldTransform),Yi(this.localPosition,this.worldTransform),qi(this.localRotation,this.worldTransform)}},{key:"clearTransform",value:function(){this.setDirty(),this.localPosition=lt(0,0,0),this.localRotation=Qs(0,0,0,1),this.localScale=lt(1,1,1)}},{key:"scaleLocal",value:function(i){return this.setLocalDirty(),yS(this.localScale,this.localScale,i),this}},{key:"getLocalPosition",value:function(){return this.localPosition}},{key:"getLocalRotation",value:function(){return this.localRotation}},{key:"getLocalScale",value:function(){return this.localScale}},{key:"getLocalTransform",value:function(){return this.localDirtyFlag&&(lS(this.localTransform,this.localRotation,this.localPosition,this.localScale),this.setLocalDirty(!1)),this.localTransform}},{key:"getWorldTransform",value:function(){return!this.isLocalDirty()&&!this.isDirty()?this.worldTransform:(this.parent&&this.parent.getWorldTransform(),this.updateTransform(),this.worldTransform)}},{key:"getPosition",value:function(){return Yi(this.position,this.worldTransform),this.position}},{key:"getRotation",value:function(){return qi(this.rotation,this.worldTransform),this.rotation}},{key:"getScale",value:function(){return gi(this.scaling,this.worldTransform),this.scaling}}]),r}(Hn);Ty.DIRTY=1<<0;var Eh,bh,gh,eu,Th,Ah,L1=(Eh=Rt(),bh=He(te.RenderEngine),Eh(gh=(eu=(Ah=function(){function e(){Fe(this,e),je(this,"engine",Th,this),this.resourcePool={}}return Ye(e,[{key:"getOrCreateResource",value:function(r){if(!this.resourcePool[r.name]){var n=r.descriptor,i=n.width,a=n.height,o=n.usage;this.resourcePool[r.name]=this.engine.createFramebuffer({color:this.engine.createTexture2D({width:i,height:a,wrapS:M.CLAMP_TO_EDGE,wrapT:M.CLAMP_TO_EDGE,usage:o})})}return this.resourcePool[r.name]}},{key:"clean",value:function(){this.resourcePool={}}}]),e}(),Ah),Th=ze(eu.prototype,"engine",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eu))||gh);function M1(e){var t=k1();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function k1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var D1=function(e){fr(r,e);var t=M1(r);function r(n){var i;return Fe(this,r),i=t.call(this,n),i.name=void 0,i.name=n.name||"",i}return r}(Hn),Sh,wh,Rh,F1=(Sh=Rt(),Sh(wh=(Rh=function(){function e(){Fe(this,e),this.config=void 0}return Ye(e,[{key:"get",value:function(){return this.config}},{key:"set",value:function(r){this.config=r}}]),e}(),Rh))||wh),Ch,xh,Nh;(function(e){e.PANSTART="PANSTART",e.PANEND="PANEND",e.PANMOVE="PANMOVE",e.PINCH="PINCH",e.KEYDOWN="KEYDOWN",e.KEYUP="KEYUP",e.HOVER="HOVER"})(Nh||(Nh={}));var G1=(Ch=Rt(),Ch(xh=function(){function e(){Fe(this,e)}return Ye(e,[{key:"listen",value:function(r){}},{key:"on",value:function(r,n){}},{key:"connect",value:function(){}},{key:"disconnect",value:function(){}},{key:"destroy",value:function(){}}]),e}())||xh);function B1(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16;break}return t}var U1=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Oh(e){var t={};return e=e.replace(U1,function(r,n,i){var a=i.split(":"),o=a[0].trim(),s="";switch(a.length>1&&(s=a[1].trim()),n){case"bool":s=s==="true";break;case"float":case"int":s=Number(s);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":s?s=s.replace("[","").replace("]","").split(",").reduce(function(u,c){return u.push(Number(c.trim())),u},[]):s=new Array(B1(n)).fill(0);break}return t[o]=s,"uniform ".concat(n," ").concat(o,`;
`)}),{content:e,uniforms:t}}function $1(e){return e.filter(function(t,r,n){return n.indexOf(t)===r})}var Ih,Ph,Lh;function Mh(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ji(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Mh(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var V1=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,j1=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}`,z1=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}`,H1=/precision\s+(high|low|medium)p\s+float/,X1=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,W1=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Y1=(Ih=Rt(),Ih(Ph=(Lh=function(){function e(){Fe(this,e),this.moduleCache={},this.rawContentCache={}}return Ye(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("picking",{vs:j1,fs:V1}),this.registerModule("sdf2d",{vs:"",fs:z1})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var i=n.vs,a=i===void 0?"":i,o=n.fs,s=o===void 0?"":o,u=n.uniforms,c=Oh(a),f=c.content,d=c.uniforms,p=Oh(s),g=p.content,T=p.uniforms;this.rawContentCache[r]={fs:g,uniforms:Ji(Ji(Ji({},d),T),u),vs:f}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var i=this.rawContentCache[r].vs||"",a=this.rawContentCache[r].fs||"",o=this.processModule(i,[],"vs"),s=o.content,u=o.includeList,c=this.processModule(a,[],"fs"),f=c.content,d=c.includeList,p=f,g=$1(u.concat(d).concat(r)).reduce(function(T,x){return Ji(Ji({},T),n.rawContentCache[x].uniforms)},{});return H1.test(f)||(p=X1+f),this.moduleCache[r]={fs:p.trim(),uniforms:g,vs:s.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,i){var a=this,o=r.replace(W1,function(s,u){var c=u.split(" "),f=c[0].replace(/"/g,"");if(n.indexOf(f)>-1)return"";var d=a.rawContentCache[f][i];n.push(f);var p=a.processModule(d||"",n,i),g=p.content;return g});return{content:o,includeList:n}}}]),e}(),Lh))||Ph),an=new _y;an.bind(te.ShaderModuleService).to(Y1).inSingletonScope();an.bind(te.NameComponentManager).toConstantValue(new Xn(D1));an.bind(te.HierarchyComponentManager).toConstantValue(new Xn(N1));an.bind(te.TransformComponentManager).toConstantValue(new Xn(Ty));an.bind(te.MeshComponentManager).toConstantValue(new Xn(h1));an.bind(te.CullableComponentManager).toConstantValue(new Xn(f1));an.bind(te.GeometryComponentManager).toConstantValue(new Xn(r1));an.bind(te.MaterialComponentManager).toConstantValue(new Xn(o1));function q1(){var e=new _y;return e.parent=an,e.bind(te.Systems).to(O1).inSingletonScope().whenTargetNamed(te.SceneGraphSystem),e.bind(te.Systems).to(aS).inSingletonScope().whenTargetNamed(te.FrameGraphSystem),e.bind(te.Systems).to(E1).inSingletonScope().whenTargetNamed(te.MeshSystem),e.bind(te.Systems).to(n1).inSingletonScope().whenTargetNamed(te.GeometrySystem),e.bind(te.Systems).to(s1).inSingletonScope().whenTargetNamed(te.MaterialSystem),e.bind(te.Systems).to(R1).inSingletonScope().whenTargetNamed(te.RendererSystem),e.bind(te.ResourcePool).to(L1).inSingletonScope(),e.bind(te.ConfigService).to(F1).inSingletonScope(),e.bind(te.InteractorService).to(G1).inSingletonScope(),e.bind(te.RenderPass).to(Si).inSingletonScope().whenTargetNamed(Si.IDENTIFIER),e.bind(te.RenderPass).to(Po).inSingletonScope().whenTargetNamed(Po.IDENTIFIER),e.bind(te.RenderPass).to(_u).inSingletonScope().whenTargetNamed(_u.IDENTIFIER),e.bind(te.RenderPassFactory).toFactory(function(t){return function(r){return t.container.getNamed(te.RenderPass,r)}}),e}function ku(e){for(var t=new Mu,r=lt(e[0],e[1],e[2]),n=lt(e[0],e[1],e[2]),i=3;i<e.length;){var a=e[i++],o=e[i++],s=e[i++];a<r[0]&&(r[0]=a),o<r[1]&&(r[1]=o),s<r[2]&&(r[2]=s),a>n[0]&&(n[0]=a),o>n[1]&&(n[1]=o),s>n[2]&&(n[2]=s)}return t.setMinMax(r,n),t}var gr=typeof navigator<"u"&&/Version\/[\d\.]+.*Safari/.test(navigator.userAgent);Ct();Ct();Ct();Ct();Ct();Ct();var kh;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(kh||(kh={}));var jn;(function(e){e.Void="Void",e.Boolean="Boolean",e.Float="Float",e.Uint32="Uint32",e.Int32="Int32",e.Vector="Vector",e.Vector2Float="vec2<f32>",e.Vector3Float="vec3<f32>",e.Vector4Float="vec4<f32>",e.Vector2Boolean="vec2<bool>",e.Vector3Boolean="vec3<bool>",e.Vector4Boolean="vec4<bool>",e.Vector2Uint="vec2<u32>",e.Vector3Uint="vec3<u32>",e.Vector4Uint="vec4<u32>",e.Vector2Int="vec2<i32>",e.Vector3Int="vec3<i32>",e.Vector4Int="vec4<i32>",e.Matrix="Matrix",e.Matrix3x3Float="mat3x3<f32>",e.Matrix4x4Float="mat4x4<i32>",e.Struct="Struct",e.FloatArray="Float[]",e.Vector4FloatArray="vec4<f32>[]"})(jn||(jn={}));var Dh;(function(e){e.Program="Program",e.Identifier="Identifier",e.VariableDeclaration="VariableDeclaration",e.BlockStatement="BlockStatement",e.ReturnStatement="ReturnStatement",e.FunctionDeclaration="FunctionDeclaration",e.VariableDeclarator="VariableDeclarator",e.AssignmentExpression="AssignmentExpression",e.LogicalExpression="LogicalExpression",e.BinaryExpression="BinaryExpression",e.ArrayExpression="ArrayExpression",e.UnaryExpression="UnaryExpression",e.UpdateExpression="UpdateExpression",e.FunctionExpression="FunctionExpression",e.MemberExpression="MemberExpression",e.ConditionalExpression="ConditionalExpression",e.ExpressionStatement="ExpressionStatement",e.CallExpression="CallExpression",e.NumThreadStatement="NumThreadStatement",e.StorageStatement="StorageStatement",e.DoWhileStatement="DoWhileStatement",e.WhileStatement="WhileStatement",e.ForStatement="ForStatement",e.BreakStatement="BreakStatement",e.ContinueStatement="ContinueStatement",e.IfStatement="IfStatement",e.ImportedFunctionStatement="ImportedFunctionStatement"})(Dh||(Dh={}));var gn;(function(e){e.Input="Input",e.Output="Output",e.Uniform="Uniform",e.Workgroup="Workgroup",e.UniformConstant="UniformConstant",e.Image="Image",e.StorageBuffer="StorageBuffer",e.Private="Private",e.Function="Function"})(gn||(gn={}));var ha;(function(e){e.GLSL100="GLSL100",e.GLSL450="GLSL450",e.WGSL="WGSL"})(ha||(ha={}));var K1="__DefineValuePlaceholder__";function Du(e){return typeof e=="number"}function qr(e){return e===void 0?0:e>360||e<-360?e%360:e}function kn(e,t,r){return Du(e)?lt(e,t,r):e.length===3?tn(e):lt(e[0],e[1],e[2])}var Fh=function(){function e(t,r){Fe(this,e),this.name=void 0,this.matrix=void 0,this.right=void 0,this.up=void 0,this.forward=void 0,this.position=void 0,this.focalPoint=void 0,this.distanceVector=void 0,this.distance=void 0,this.dollyingStep=void 0,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.name=t,this.matrix=uS(r.matrix),this.right=tn(r.right),this.up=tn(r.up),this.forward=tn(r.forward),this.position=tn(r.position),this.focalPoint=tn(r.focalPoint),this.distanceVector=tn(r.distanceVector),this.azimuth=r.azimuth,this.elevation=r.elevation,this.roll=r.roll,this.relAzimuth=r.relAzimuth,this.relElevation=r.relElevation,this.relRoll=r.relRoll,this.dollyingStep=r.dollyingStep,this.distance=r.distance}return Ye(e,[{key:"getPosition",value:function(){return this.position}},{key:"getFocalPoint",value:function(){return this.focalPoint}},{key:"getRoll",value:function(){return this.roll}},{key:"retrieve",value:function(r){r.matrix=vu(r.matrix,this.matrix),r.right=cr(r.right,this.right),r.up=cr(r.up,this.up),r.forward=cr(r.forward,this.forward),r.position=cr(r.position,this.position),r.focalPoint=cr(r.focalPoint,this.focalPoint),r.distanceVector=cr(r.distanceVector,this.distanceVector),r.azimuth=this.azimuth,r.elevation=this.elevation,r.roll=this.roll,r.relAzimuth=this.relAzimuth,r.relElevation=this.relElevation,r.relRoll=this.relRoll,r.dollyingStep=this.dollyingStep,r.distance=this.distance}}]),e}(),Gh,Bh,Uh,tu,$h,Vh,jh,It;(function(e){e.ORBITING="ORBITING",e.EXPLORING="EXPLORING",e.TRACKING="TRACKING"})(It||(It={}));var Lo;(function(e){e.DEFAULT="DEFAULT",e.ROTATIONAL="ROTATIONAL",e.TRANSLATIONAL="TRANSLATIONAL",e.CINEMATIC="CINEMATIC"})(Lo||(Lo={}));var Bn;(function(e){e.ORTHOGRAPHIC="ORTHOGRAPHIC",e.PERSPECTIVE="PERSPECTIVE"})(Bn||(Bn={}));var Kr=Math.PI/180,hn=180/Math.PI,zh=(Gh=Rt(),Bh=He(te.InteractorService),Gh(Uh=(tu=(jh=Vh=function(){function e(){Fe(this,e),this.matrix=Tr(),this.right=lt(1,0,0),this.up=lt(0,1,0),this.forward=lt(0,0,1),this.position=lt(0,0,1),this.focalPoint=lt(0,0,0),this.distanceVector=lt(0,0,0),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.rotateWorld=!1,je(this,"interactor",$h,this),this.fov=30,this.near=.1,this.far=1e4,this.aspect=1,this.left=void 0,this.rright=void 0,this.top=void 0,this.bottom=void 0,this.zoom=1,this.perspective=Tr(),this.view=void 0,this.following=void 0,this.type=It.EXPLORING,this.trackingMode=Lo.DEFAULT,this.projectionMode=Bn.PERSPECTIVE,this.frustum=new p1,this.landmarks=[],this.landmarkAnimationID=void 0}return Ye(e,[{key:"clone",value:function(){var r=new e;return r.setType(this.type,void 0),r.interactor=this.interactor,r}},{key:"getProjectionMode",value:function(){return this.projectionMode}},{key:"getPerspective",value:function(){return this.perspective}},{key:"getFrustum",value:function(){return this.frustum}},{key:"getPosition",value:function(){return this.position}},{key:"setType",value:function(r,n){return this.type=r,this.type===It.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===It.TRACKING&&n!==void 0&&this.setTrackingMode(n),this}},{key:"setProjectionMode",value:function(r){return this.projectionMode=r,this}},{key:"setTrackingMode",value:function(r){if(this.type!==It.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=r,this}},{key:"setWorldRotation",value:function(r){this.rotateWorld=r,this._getAngles()}},{key:"getViewTransform",value:function(){return Oo(Tr(),this.matrix)}},{key:"getWorldTransform",value:function(){return this.matrix}},{key:"setMatrix",value:function(r){return this.matrix=r,this._update(),this}},{key:"setAspect",value:function(r){return this.setPerspective(this.near,this.far,this.fov,r),this}},{key:"setViewOffset",value:function(r,n,i,a,o,s){return this.aspect=r/n,this.view===void 0&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=r,this.view.fullHeight=n,this.view.offsetX=i,this.view.offsetY=a,this.view.width=o,this.view.height=s,this.projectionMode===Bn.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"clearViewOffset",value:function(){return this.view!==void 0&&(this.view.enabled=!1),this.projectionMode===Bn.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this}},{key:"setPerspective",value:function(r,n,i,a){return this.projectionMode=Bn.PERSPECTIVE,this.fov=i,this.near=r,this.far=n,this.aspect=a,hS(this.perspective,this.fov*Kr,this.aspect,this.near,this.far),this}},{key:"setOrthographic",value:function(r,n,i,a,o,s){this.projectionMode=Bn.ORTHOGRAPHIC,this.rright=n,this.left=r,this.top=i,this.bottom=a,this.near=o,this.far=s;var u=(this.rright-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),f=(this.rright+this.left)/2,d=(this.top+this.bottom)/2,p=f-u,g=f+u,T=d+c,x=d-c;if(this.view!==void 0&&this.view.enabled){var O=(this.rright-this.left)/this.view.fullWidth/this.zoom,z=(this.top-this.bottom)/this.view.fullHeight/this.zoom;p+=O*this.view.offsetX,g=p+O*this.view.width,T-=z*this.view.offsetY,x=T-z*this.view.height}return pS(this.perspective,p,g,T,x,o,s),this}},{key:"setPosition",value:function(r,n,i){return this._setPosition(r,n,i),this.setFocalPoint(this.focalPoint),this}},{key:"setFocalPoint",value:function(r,n,i){var a=lt(0,1,0);if(this.focalPoint=kn(r,n,i),this.trackingMode===Lo.CINEMATIC){var o=pu(Ct(),this.focalPoint,this.position);r=o[0],n=o[1],i=o[2];var s=So(o),u=Math.asin(n/s)*hn,c=90+Math.atan2(i,r)*hn,f=Tr();fS(f,f,c*Kr),cS(f,f,u*Kr),a=Pu(Ct(),[0,1,0],f)}return Oo(this.matrix,mS(Tr(),this.position,this.focalPoint,a)),this._getAxes(),this._getDistance(),this._getAngles(),this}},{key:"setDistance",value:function(r){if(!(this.distance===r||r<0)){this.distance=r,this.distance<2e-4&&(this.distance=2e-4),this.dollyingStep=this.distance/100;var n=Ct();r=this.distance;var i=this.forward,a=this.focalPoint;return n[0]=r*i[0]+a[0],n[1]=r*i[1]+a[1],n[2]=r*i[2]+a[2],this._setPosition(n),this}}},{key:"setMaxDistance",value:function(r){return this.maxDistance=r,this}},{key:"setMinDistance",value:function(r){return this.minDistance=r,this}},{key:"changeAzimuth",value:function(r){return this.setAzimuth(this.azimuth+r),this}},{key:"changeElevation",value:function(r){return this.setElevation(this.elevation+r),this}},{key:"changeRoll",value:function(r){return this.setRoll(this.roll+r),this}},{key:"setAzimuth",value:function(r){return this.azimuth=qr(r),this.computeMatrix(),this._getAxes(),this.type===It.ORBITING||this.type===It.EXPLORING?this._getPosition():this.type===It.TRACKING&&this._getFocalPoint(),this}},{key:"getAzimuth",value:function(){return this.azimuth}},{key:"setElevation",value:function(r){return this.elevation=qr(r),this.computeMatrix(),this._getAxes(),this.type===It.ORBITING||this.type===It.EXPLORING?this._getPosition():this.type===It.TRACKING&&this._getFocalPoint(),this}},{key:"setRoll",value:function(r){return this.roll=qr(r),this.computeMatrix(),this._getAxes(),this.type===It.ORBITING||this.type===It.EXPLORING?this._getPosition():this.type===It.TRACKING&&this._getFocalPoint(),this}},{key:"rotate",value:function(r,n,i){if(this.type===It.EXPLORING){r=qr(r),n=qr(n),i=qr(i);var a=Gn(tr(),[1,0,0],(this.rotateWorld?1:-1)*n*Kr),o=Gn(tr(),[0,1,0],(this.rotateWorld?1:-1)*r*Kr),s=Gn(tr(),[0,0,1],i*Kr),u=xr(tr(),o,a);u=xr(tr(),u,s);var c=bl(Tr(),u);Wi(this.matrix,this.matrix,[0,0,-this.distance]),Un(this.matrix,this.matrix,c),Wi(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation+n)>90)return;this.relElevation=qr(n),this.relAzimuth=qr(r),this.relRoll=qr(i),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.computeMatrix()}return this._getAxes(),this.type===It.ORBITING||this.type===It.EXPLORING?this._getPosition():this.type===It.TRACKING&&this._getFocalPoint(),this._update(),this}},{key:"pan",value:function(r,n){var i=kn(r,n,0),a=tn(this.position);return nn(a,a,Ea(Ct(),this.right,i[0])),nn(a,a,Ea(Ct(),this.up,i[1])),this._setPosition(a),this}},{key:"dolly",value:function(r){var n=this.forward,i=tn(this.position),a=r*this.dollyingStep,o=this.distance+r*this.dollyingStep;return a=Math.max(Math.min(o,this.maxDistance),this.minDistance)-this.distance,i[0]+=a*n[0],i[1]+=a*n[1],i[2]+=a*n[2],this._setPosition(i),this.type===It.ORBITING||this.type===It.EXPLORING?this._getDistance():this.type===It.TRACKING&&nn(this.focalPoint,i,this.distanceVector),this}},{key:"createLandmark",value:function(r,n){var i=this.clone();i.setPosition(n.position),i.setFocalPoint(n.focalPoint),n.roll!==void 0&&i.setRoll(n.roll);var a=new Fh(r,i);return this.landmarks.push(a),a}},{key:"setLandmark",value:function(r){var n=new Fh(r,this);return this.landmarks.push(n),this}},{key:"gotoLandmark",value:function(r){var n=this,i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3,a=this.landmarks.find(function(d){return d.name===r});if(a){if(i===0){a.retrieve(this);return}this.landmarkAnimationID!==void 0&&window.cancelAnimationFrame(this.landmarkAnimationID),this.interactor.disconnect();var o=a.getPosition(),s=a.getFocalPoint(),u=a.getRoll(),c,f=function d(p){c===void 0&&(c=p);var g=p-c,T=(1-Math.cos(g/i*Math.PI))/2,x=Ct(),O=Ct(),z=0;Vn(x,n.focalPoint,s,T),Vn(O,n.position,o,T),z=n.roll*(1-T)+u*T,n.setFocalPoint(x),n.setPosition(O),n.setRoll(z),n.computeMatrix();var ie=gl(x,s)+gl(O,o);if(!(ie>.01)){n.setFocalPoint(x),n.setPosition(O),n.setRoll(z),n.computeMatrix(),n.interactor.connect();return}g<i&&(n.landmarkAnimationID=window.requestAnimationFrame(d))};window.requestAnimationFrame(f)}}},{key:"_update",value:function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles()}},{key:"computeMatrix",value:function(){var r,n,i=Gn(tr(),[0,0,1],this.roll*Kr);Ey(this.matrix),r=Gn(tr(),[1,0,0],(this.rotateWorld&&this.type!==It.TRACKING||this.type===It.TRACKING?1:-1)*this.elevation*Kr),n=Gn(tr(),[0,1,0],(this.rotateWorld&&this.type!==It.TRACKING||this.type===It.TRACKING?1:-1)*this.azimuth*Kr);var a=xr(tr(),n,r);a=xr(tr(),a,i);var o=bl(Tr(),a);this.type===It.ORBITING||this.type===It.EXPLORING?(Wi(this.matrix,this.matrix,this.focalPoint),Un(this.matrix,this.matrix,o),Wi(this.matrix,this.matrix,[0,0,this.distance])):this.type===It.TRACKING&&(Wi(this.matrix,this.matrix,this.position),Un(this.matrix,this.matrix,o))}},{key:"_setPosition",value:function(r,n,i){this.position=kn(r,n,i);var a=this.matrix;a[12]=this.position[0],a[13]=this.position[1],a[14]=this.position[2],a[15]=1}},{key:"_getAxes",value:function(){cr(this.right,kn(la(fa(),[1,0,0,0],this.matrix))),cr(this.up,kn(la(fa(),[0,1,0,0],this.matrix))),cr(this.forward,kn(la(fa(),[0,0,1,0],this.matrix))),da(this.right,this.right),da(this.up,this.up),da(this.forward,this.forward)}},{key:"_getAngles",value:function(){var r=this.distanceVector[0],n=this.distanceVector[1],i=this.distanceVector[2],a=So(this.distanceVector);if(a===0){this.elevation=0,this.azimuth=0;return}this.type===It.TRACKING?(this.elevation=Math.asin(n/a)*hn,this.azimuth=Math.atan2(-r,-i)*hn):this.rotateWorld?(this.elevation=Math.asin(n/a)*hn,this.azimuth=Math.atan2(-r,-i)*hn):(this.elevation=-Math.asin(n/a)*hn,this.azimuth=-Math.atan2(-r,-i)*hn)}},{key:"_getPosition",value:function(){cr(this.position,kn(la(fa(),[0,0,0,1],this.matrix))),this._getDistance()}},{key:"_getFocalPoint",value:function(){Lu(this.distanceVector,[0,0,-this.distance],oS(Ta(),this.matrix)),nn(this.focalPoint,this.position,this.distanceVector),this._getDistance()}},{key:"_getDistance",value:function(){this.distanceVector=pu(Ct(),this.focalPoint,this.position),this.distance=So(this.distanceVector),this.dollyingStep=this.distance/100}}]),e}(),Vh.ProjectionMode={ORTHOGRAPHIC:"ORTHOGRAPHIC",PERSPECTIVE:"PERSPECTIVE"},jh),$h=ze(tu.prototype,"interactor",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tu))||Uh),Hh,Xh,Wh,ru,Yh,ea,qh,_n=(Hh=Rt(),Xh=He(te.GeometryComponentManager),Hh(Wh=(ru=(qh=ea=function(){function e(){Fe(this,e),this.config=void 0,je(this,"geometry",Yh,this),this.entity=void 0,this.component=void 0}return Ye(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r){this.entity=r,this.component=this.geometry.create(r),this.component.entity=r,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),e}(),ea.BOX="box",ea.SPHERE="sphere",ea.PLANE="plane",ea.MERGED="merged",qh),Yh=ze(ru.prototype,"geometry",[Xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ru))||Wh),ge={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.TextureCompressionBC="texture-compression-bc"}(e.ExtensionName||(e.ExtensionName={})),function(t){t.ClampToEdge="clamp-to-edge",t.Repeat="repeat",t.MirrorRepeat="mirror-repeat"}(e.AddressMode||(e.AddressMode={})),function(t){t.UniformBuffer="uniform-buffer",t.StorageBuffer="storage-buffer",t.ReadonlyStorageBuffer="readonly-storage-buffer",t.Sampler="sampler",t.ComparisonSampler="comparison-sampler",t.SampledTexture="sampled-texture",t.ReadonlyStorageTexture="readonly-storage-texture",t.WriteonlyStorageTexture="writeonly-storage-texture"}(e.BindingType||(e.BindingType={})),function(t){t.Zero="zero",t.One="one",t.SrcColor="src-color",t.OneMinusSrcColor="one-minus-src-color",t.SrcAlpha="src-alpha",t.OneMinusSrcAlpha="one-minus-src-alpha",t.DstColor="dst-color",t.OneMinusDstColor="one-minus-dst-color",t.DstAlpha="dst-alpha",t.OneMinusDstAlpha="one-minus-dst-alpha",t.SrcAlphaSaturated="src-alpha-saturated",t.BlendColor="blend-color",t.OneMinusBlendColor="one-minus-blend-color"}(e.BlendFactor||(e.BlendFactor={})),function(t){t.Add="add",t.Subtract="subtract",t.ReverseSubtract="reverse-subtract",t.Min="min",t.Max="max"}(e.BlendOperation||(e.BlendOperation={})),function(t){t.Never="never",t.Less="less",t.Equal="equal",t.LessEqual="less-equal",t.Greater="greater",t.NotEqual="not-equal",t.GreaterEqual="greater-equal",t.Always="always"}(e.CompareFunction||(e.CompareFunction={})),function(t){t.None="none",t.Front="front",t.Back="back"}(e.CullMode||(e.CullMode={})),function(t){t.Nearest="nearest",t.Linear="linear"}(e.FilterMode||(e.FilterMode={})),function(t){t.CCW="ccw",t.CW="cw"}(e.FrontFace||(e.FrontFace={})),function(t){t.Uint16="uint16",t.Uint32="uint32"}(e.IndexFormat||(e.IndexFormat={})),function(t){t.Vertex="vertex",t.Instance="instance"}(e.InputStepMode||(e.InputStepMode={})),function(t){t.Load="load"}(e.LoadOp||(e.LoadOp={})),function(t){t.PointList="point-list",t.LineList="line-list",t.LineStrip="line-strip",t.TriangleList="triangle-list",t.TriangleStrip="triangle-strip"}(e.PrimitiveTopology||(e.PrimitiveTopology={})),function(t){t.Keep="keep",t.Zero="zero",t.Replace="replace",t.Invert="invert",t.IncrementClamp="increment-clamp",t.DecrementClamp="decrement-clamp",t.IncrementWrap="increment-wrap",t.DecrementWrap="decrement-wrap"}(e.StencilOperation||(e.StencilOperation={})),function(t){t.Store="store",t.Clear="clear"}(e.StoreOp||(e.StoreOp={})),function(t){t.E1d="1d",t.E2d="2d",t.E3d="3d"}(e.TextureDimension||(e.TextureDimension={})),function(t){t.R8Unorm="r8unorm",t.R8Snorm="r8snorm",t.R8Uint="r8uint",t.R8Sint="r8sint",t.R16Uint="r16uint",t.R16Sint="r16sint",t.R16Float="r16float",t.RG8Unorm="rg8unorm",t.RG8Snorm="rg8snorm",t.RG8Uint="rg8uint",t.RG8Sint="rg8sint",t.R32Uint="r32uint",t.R32Sint="r32sint",t.R32Float="r32float",t.RG16Uint="rg16uint",t.RG16Sint="rg16sint",t.RG16Float="rg16float",t.RGBA8Unorm="rgba8unorm",t.RGBA8UnormSRGB="rgba8unorm-srgb",t.RGBA8Snorm="rgba8snorm",t.RGBA8Uint="rgba8uint",t.RGBA8Sint="rgba8sint",t.BGRA8Unorm="bgra8unorm",t.BGRA8UnormSRGB="bgra8unorm-srgb",t.RGB10A2Unorm="rgb10a2unorm",t.RG11B10Float="rg11b10float",t.RG32Uint="rg32uint",t.RG32Sint="rg32sint",t.RG32Float="rg32float",t.RGBA16Uint="rgba16uint",t.RGBA16Sint="rgba16sint",t.RGBA16Float="rgba16float",t.RGBA32Uint="rgba32uint",t.RGBA32Sint="rgba32sint",t.RGBA32Float="rgba32float",t.Depth32Float="depth32float",t.Depth24Plus="depth24plus",t.Depth24PlusStencil8="depth24plus-stencil8"}(e.TextureFormat||(e.TextureFormat={})),function(t){t.Float="float",t.Sint="sint",t.Uint="uint"}(e.TextureComponentType||(e.TextureComponentType={})),function(t){t.E1d="1d",t.E2d="2d",t.E2dArray="2d-array",t.Cube="cube",t.CubeArray="cube-array",t.E3d="3d"}(e.TextureViewDimension||(e.TextureViewDimension={})),function(t){t.Uchar2="uchar2",t.Uchar4="uchar4",t.Char2="char2",t.Char4="char4",t.Uchar2Norm="uchar2norm",t.Uchar4Norm="uchar4norm",t.Char2Norm="char2norm",t.Char4Norm="char4norm",t.Ushort2="ushort2",t.Ushort4="ushort4",t.Short2="short2",t.Short4="short4",t.Ushort2Norm="ushort2norm",t.Ushort4Norm="ushort4norm",t.Short2Norm="short2norm",t.Short4Norm="short4norm",t.Half2="half2",t.Half4="half4",t.Float="float",t.Float2="float2",t.Float3="float3",t.Float4="float4",t.Uint="uint",t.Uint2="uint2",t.Uint3="uint3",t.Uint4="uint4",t.Int="int",t.Int2="int2",t.Int3="int3",t.Int4="int4"}(e.VertexFormat||(e.VertexFormat={})),function(t){t.All="all",t.StencilOnly="stencil-only",t.DepthOnly="depth-only"}(e.TextureAspect||(e.TextureAspect={})),function(t){t.Error="error",t.Warning="warning",t.Info="info"}(e.CompilationMessageType||(e.CompilationMessageType={})),function(t){t.Occlusion="occlusion"}(e.QueryType||(e.QueryType={})),function(t){t[t.MapRead=1]="MapRead",t[t.MapWrite=2]="MapWrite",t[t.CopySrc=4]="CopySrc",t[t.CopyDst=8]="CopyDst",t[t.Index=16]="Index",t[t.Vertex=32]="Vertex",t[t.Uniform=64]="Uniform",t[t.Storage=128]="Storage",t[t.Indirect=256]="Indirect",t[t.QueryResolve=512]="QueryResolve"}(e.BufferUsage||(e.BufferUsage={})),function(t){t[t.Red=1]="Red",t[t.Green=2]="Green",t[t.Blue=4]="Blue",t[t.Alpha=8]="Alpha",t[t.All=15]="All"}(e.ColorWrite||(e.ColorWrite={})),function(t){t[t.Vertex=1]="Vertex",t[t.Fragment=2]="Fragment",t[t.Compute=4]="Compute"}(e.ShaderStage||(e.ShaderStage={})),function(t){t[t.CopySrc=1]="CopySrc",t[t.CopyDst=2]="CopyDst",t[t.Sampled=4]="Sampled",t[t.Storage=8]="Storage",t[t.OutputAttachment=16]="OutputAttachment"}(e.TextureUsage||(e.TextureUsage={})),function(t){t[t.Read=1]="Read",t[t.Write=2]="Write"}(e.MapMode||(e.MapMode={}))})(ge);function Ay(){if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}var Q1={}.toString,Z1=function(t,r){return Q1.call(t)==="[object "+r+"]"};const J1=function(e){return Array.isArray?Array.isArray(e):Z1(e,"Array")};var ew=9007199254740991,tw="[object Arguments]",rw="[object Array]",nw="[object Boolean]",iw="[object Date]",aw="[object Error]",ow="[object Function]",sw="[object Map]",uw="[object Number]",cw="[object Object]",fw="[object RegExp]",lw="[object Set]",dw="[object String]",hw="[object WeakMap]",vw="[object ArrayBuffer]",pw="[object DataView]",mw="[object Float32Array]",yw="[object Float64Array]",_w="[object Int8Array]",Ew="[object Int16Array]",bw="[object Int32Array]",gw="[object Uint8Array]",Tw="[object Uint8ClampedArray]",Aw="[object Uint16Array]",Sw="[object Uint32Array]",kt={};kt[mw]=kt[yw]=kt[_w]=kt[Ew]=kt[bw]=kt[gw]=kt[Tw]=kt[Aw]=kt[Sw]=!0;kt[tw]=kt[rw]=kt[vw]=kt[nw]=kt[pw]=kt[iw]=kt[aw]=kt[ow]=kt[sw]=kt[uw]=kt[cw]=kt[fw]=kt[lw]=kt[dw]=kt[hw]=!1;var ww=Object.prototype,Rw=ww.toString;function Cw(e){return Nw(e)&&xw(e.length)&&!!kt[Rw.call(e)]}function xw(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=ew}function Nw(e){return!!e&&wi(e)==="object"}var Sy=Cw,Kh,Qh,Zh,Jh,so,ev,tv,rv;function nv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function iv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nv(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var av=(Kh=Rt(),Qh=He(te.RenderEngine),Zh=He(te.ConfigService),Kh(Jh=(so=(rv=function(){function e(){Fe(this,e),je(this,"engine",ev,this),je(this,"configService",tv,this),this.entity=zr(),this.model=void 0,this.dirty=!0,this.compiledBundle=void 0,this.initPromise=void 0}return Ye(e,[{key:"init",value:function(){var r=this.configService.get(),n=r.canvas,i=r.engineOptions;this.initPromise=this.engine.init(iv({canvas:n||Ay(),swapChainFormat:ge.TextureFormat.BGRA8Unorm,antialiasing:!1},i))}},{key:"setBundle",value:function(r){this.compiledBundle=JSON.parse(JSON.stringify(r))}},{key:"setDispatch",value:function(r){return this.compiledBundle.context&&(this.compiledBundle.context.dispatch=r),this}},{key:"setMaxIteration",value:function(r){return this.compiledBundle.context&&(this.compiledBundle.context.maxIteration=r),this}},{key:"setBinding",value:function(r,n){var i=this;if(typeof r=="string"){var a=Du(n)||Sy(n)||J1(n);if(this.compiledBundle&&this.compiledBundle.context){var o=this.compiledBundle.context.defines.find(function(u){return u.name===r});if(o)return o.value=n,this;var s=this.compiledBundle.context.uniforms.find(function(u){return u.name===r});s&&(a?(s.data=n,s.isReferer=!1,s.storageClass===gn.Uniform?this.model&&this.model.updateUniform(r,n):this.model&&this.model.updateBuffer(r,n)):(s.isReferer=!0,s.data=n))}}else Object.keys(r).forEach(function(u){i.setBinding(u,r[u])});return this}},{key:"execute",value:function(){var t=At(Me.mark(function n(){var i=this,a,o,s=arguments;return Me.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(a=s.length>0&&s[0]!==void 0?s[0]:1,!this.dirty){c.next=6;break}return this.compiledBundle.context&&(a>1?this.compiledBundle.context.maxIteration=a:this.compiledBundle.context.maxIteration++),c.next=5,this.compile();case 5:this.dirty=!1;case 6:for(this.engine.beginFrame(),this.engine.clear({}),this.compiledBundle.context&&this.compiledBundle.context.uniforms.filter(function(f){var d=f.isReferer;return d}).forEach(function(f){var d=f.data,p=f.name;i.model.confirmInput(d.model,p)}),o=0;o<a;o++)this.model.run();return this.engine.endFrame(),c.abrupt("return",this);case 12:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getOutput",value:function(){var t=At(Me.mark(function n(){return Me.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.model.readData());case 1:case"end":return a.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"compile",value:function(){var t=At(Me.mark(function n(){var i,a,o;return Me.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.initPromise;case 2:return i=iv({},this.compiledBundle.context),a=this.engine.supportWebGPU?this.engine.useWGSL?ha.WGSL:ha.GLSL450:ha.GLSL100,o=this.compiledBundle.shaders[a],i.defines.filter(function(c){return c.runtime}).forEach(function(c){var f="".concat(K1).concat(c.name);o=o.replace(f,"".concat(c.value))}),i.shader=o,i.uniforms.forEach(function(c){if(!c.data&&c.storageClass===gn.StorageBuffer){var f=1;c.type===jn.FloatArray?f=1:c.type===jn.Vector4FloatArray&&(f=4),c.data=new Float32Array(i.output.length*f).fill(0)}}),this.compiledBundle.context=i,u.next=11,this.engine.createComputeModel(this.compiledBundle.context);case 11:this.model=u.sent;case 12:case"end":return u.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()}]),e}(),rv),ev=ze(so.prototype,"engine",[Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=ze(so.prototype,"configService",[Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so))||Jh),ov,sv,uv,nu,cv,fv,lv,wy=(ov=Rt(),sv=He(te.MaterialComponentManager),ov(uv=(nu=(lv=fv=function(){function e(){Fe(this,e),this.config=void 0,je(this,"material",cv,this),this.entity=void 0,this.component=void 0}return Ye(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getComponent",value:function(){return this.component}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r,n){this.entity=r,this.component=this.material.create(r),this.component.entity=r,this.component.type=n,this.onEntityCreated()}},{key:"onEntityCreated",value:function(){}}]),e}(),fv.BASIC="basic",lv),cv=ze(nu.prototype,"material",[sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nu))||uv),dv,hv,vv,pv,mv,yv,_v,pi,Ev,bv,gv,Tv,uo,Av,yn=(dv=Rt(),hv=He(te.MeshComponentManager),vv=He(te.CullableComponentManager),pv=He(te.TransformComponentManager),mv=He(te.Systems),yv=Xr(te.SceneGraphSystem),dv(_v=(pi=(Av=uo=function(){function e(){Fe(this,e),this.attributes={},this.config=void 0,je(this,"mesh",Ev,this),je(this,"cullable",bv,this),je(this,"transform",gv,this),je(this,"sceneGraphSystem",Tv,this),this.meshComponent=void 0,this.transformComponent=void 0,this.entity=void 0}return Ye(e,[{key:"getEntity",value:function(){return this.entity}},{key:"getTransformComponent",value:function(){return this.transformComponent}},{key:"getMeshComponent",value:function(){return this.meshComponent}},{key:"setConfig",value:function(r){this.config=r}},{key:"setEntity",value:function(r){this.entity=r,this.cullable.create(r),this.meshComponent=this.mesh.create(r),this.transformComponent=this.transform.create(r),this.onEntityCreated()}},{key:"setMaterial",value:function(r){return this.meshComponent.material=r,this}},{key:"setGeometry",value:function(r){return this.meshComponent.geometry=r,this}},{key:"setAttributes",value:function(r){var n=this;Object.keys(r).forEach(function(i){r[i]!==void 0&&r[i]!==n.attributes[i]&&(n.onAttributeChanged({name:i,data:r[i]}),n.attributes[i]=r[i])})}},{key:"setVisible",value:function(r){var n=this;return this.meshComponent.visible=r,this.meshComponent.children.forEach(function(i){var a=n.mesh.getComponentByEntity(i);a&&(a.visible=r)}),this}},{key:"isVisible",value:function(){return this.meshComponent.visible}},{key:"attach",value:function(r){return this.sceneGraphSystem.attach(this.entity,r.entity),this}},{key:"detach",value:function(){return this.sceneGraphSystem.detach(this.entity),this}},{key:"detachChildren",value:function(){return this.sceneGraphSystem.detachChildren(this.entity),this}},{key:"onEntityCreated",value:function(){}},{key:"onAttributeChanged",value:function(r){var n=r.name,i=r.data;this.meshComponent&&this.meshComponent.material&&this.meshComponent.material.setUniform(this.convertAttributeName2UniformName(n),i)}},{key:"convertAttributeName2UniformName",value:function(r){return r}}]),e}(),uo.POINT="point",uo.LINE="line",uo.GRID="grid",Av),Ev=ze(pi.prototype,"mesh",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bv=ze(pi.prototype,"cullable",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv=ze(pi.prototype,"transform",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=ze(pi.prototype,"sceneGraphSystem",[mv,yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pi))||_v),Ry={exports:{}};(function(e,t){(function(r,n){e.exports=n()})(su,function(){var r=function(l){return l instanceof Uint8Array||l instanceof Uint16Array||l instanceof Uint32Array||l instanceof Int8Array||l instanceof Int16Array||l instanceof Int32Array||l instanceof Float32Array||l instanceof Float64Array||l instanceof Uint8ClampedArray},n=function(l,v){for(var A=Object.keys(v),B=0;B<A.length;++B)l[A[B]]=v[A[B]];return l},i=`
`;function a(l){return typeof atob<"u"?atob(l):"base64:"+l}function o(l){var v=new Error("(regl) "+l);throw console.error(v),v}function s(l,v){l||o(v)}function u(l){return l?": "+l:""}function c(l,v,A){l in v||o("unknown parameter ("+l+")"+u(A)+". possible values: "+Object.keys(v).join())}function f(l,v){r(l)||o("invalid parameter type"+u(v)+". must be a typed array")}function d(l,v){switch(v){case"number":return typeof l=="number";case"object":return typeof l=="object";case"string":return typeof l=="string";case"boolean":return typeof l=="boolean";case"function":return typeof l=="function";case"undefined":return typeof l>"u";case"symbol":return typeof l=="symbol"}}function p(l,v,A){d(l,v)||o("invalid parameter type"+u(A)+". expected "+v+", got "+typeof l)}function g(l,v){l>=0&&(l|0)===l||o("invalid parameter type, ("+l+")"+u(v)+". must be a nonnegative integer")}function T(l,v,A){v.indexOf(l)<0&&o("invalid value"+u(A)+". must be one of: "+v)}var x=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function O(l){Object.keys(l).forEach(function(v){x.indexOf(v)<0&&o('invalid regl constructor argument "'+v+'". must be one of '+x)})}function z(l,v){for(l=l+"";l.length<v;)l=" "+l;return l}function ie(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function X(l,v){this.number=l,this.line=v,this.errors=[]}function Te(l,v,A){this.file=l,this.line=v,this.message=A}function ce(){var l=new Error,v=(l.stack||l).toString(),A=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(v);if(A)return A[1];var B=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(v);return B?B[1]:"unknown"}function Re(){var l=new Error,v=(l.stack||l).toString(),A=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(v);if(A)return A[1];var B=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(v);return B?B[1]:"unknown"}function Le(l,v){var A=l.split(`
`),B=1,q=0,G={unknown:new ie,0:new ie};G.unknown.name=G[0].name=v||ce(),G.unknown.lines.push(new X(0,""));for(var $=0;$<A.length;++$){var re=A[$],oe=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(re);if(oe)switch(oe[1]){case"line":var le=/(\d+)(\s+\d+)?/.exec(oe[2]);le&&(B=le[1]|0,le[2]&&(q=le[2]|0,q in G||(G[q]=new ie)));break;case"define":var se=/SHADER_NAME(_B64)?\s+(.*)$/.exec(oe[2]);se&&(G[q].name=se[1]?a(se[2]):se[2]);break}G[q].lines.push(new X(B++,re))}return Object.keys(G).forEach(function(he){var Ee=G[he];Ee.lines.forEach(function(ne){Ee.index[ne.number]=ne})}),G}function Xe(l){var v=[];return l.split(`
`).forEach(function(A){if(!(A.length<5)){var B=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(A);B?v.push(new Te(B[1]|0,B[2]|0,B[3].trim())):A.length>0&&v.push(new Te("unknown",0,A))}}),v}function vt(l,v){v.forEach(function(A){var B=l[A.file];if(B){var q=B.index[A.line];if(q){q.errors.push(A),B.hasErrors=!0;return}}l.unknown.hasErrors=!0,l.unknown.lines[0].errors.push(A)})}function ht(l,v,A,B,q){if(!l.getShaderParameter(v,l.COMPILE_STATUS)){var G=l.getShaderInfoLog(v),$=B===l.FRAGMENT_SHADER?"fragment":"vertex";pe(A,"string",$+" shader source must be a string",q);var re=Le(A,q),oe=Xe(G);vt(re,oe),Object.keys(re).forEach(function(le){var se=re[le];if(!se.hasErrors)return;var he=[""],Ee=[""];function ne(ve,L){he.push(ve),Ee.push(L||"")}ne("file number "+le+": "+se.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),se.lines.forEach(function(ve){if(ve.errors.length>0){ne(z(ve.number,4)+"|  ","background-color:yellow; font-weight:bold"),ne(ve.line+i,"color:red; background-color:yellow; font-weight:bold");var L=0;ve.errors.forEach(function(V){var fe=V.message,Se=/^\s*'(.*)'\s*:\s*(.*)$/.exec(fe);if(Se){var Z=Se[1];switch(fe=Se[2],Z){case"assign":Z="=";break}L=Math.max(ve.line.indexOf(Z,L),0)}else L=0;ne(z("| ",6)),ne(z("^^^",L+3)+i,"font-weight:bold"),ne(z("| ",6)),ne(fe+i,"font-weight:bold")}),ne(z("| ",6)+i)}else ne(z(ve.number,4)+"|  "),ne(ve.line+i,"color:red")}),typeof document<"u"&&!window.chrome?(Ee[0]=he.join("%c"),console.log.apply(console,Ee)):console.log(he.join(""))}),s.raise("Error compiling "+$+" shader, "+re[0].name)}}function yt(l,v,A,B,q){if(!l.getProgramParameter(v,l.LINK_STATUS)){var G=l.getProgramInfoLog(v),$=Le(A,q),re=Le(B,q),oe='Error linking program with vertex shader, "'+re[0].name+'", and fragment shader "'+$[0].name+'"';typeof document<"u"?console.log("%c"+oe+i+"%c"+G,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(oe+i+G),s.raise(oe)}}function Qe(l){l._commandRef=ce()}function pt(l,v,A,B){Qe(l);function q(oe){return oe?B.id(oe):0}l._fragId=q(l.static.frag),l._vertId=q(l.static.vert);function G(oe,le){Object.keys(le).forEach(function(se){oe[B.id(se)]=!0})}var $=l._uniformSet={};G($,v.static),G($,v.dynamic);var re=l._attributeSet={};G(re,A.static),G(re,A.dynamic),l._hasCount="count"in l.static||"count"in l.dynamic||"elements"in l.static||"elements"in l.dynamic}function $e(l,v){var A=Re();o(l+" in command "+(v||ce())+(A==="unknown"?"":" called from "+A))}function we(l,v,A){l||$e(v,A||ce())}function me(l,v,A,B){l in v||$e("unknown parameter ("+l+")"+u(A)+". possible values: "+Object.keys(v).join(),B||ce())}function pe(l,v,A,B){d(l,v)||$e("invalid parameter type"+u(A)+". expected "+v+", got "+typeof l,B||ce())}function Ie(l){l()}function qe(l,v,A){l.texture?T(l.texture._texture.internalformat,v,"unsupported texture format for attachment"):T(l.renderbuffer._renderbuffer.format,A,"unsupported renderbuffer format for attachment")}var Ve=33071,tt=9728,Nt=9984,Lt=9985,Ot=9986,dr=9987,_r=5120,on=5121,Bo=5122,Ir=5123,Aa=5124,sn=5125,Ri=5126,Sa=32819,Ci=32820,wa=33635,Ra=34042,Uo=36193,hr={};hr[_r]=hr[on]=1,hr[Bo]=hr[Ir]=hr[Uo]=hr[wa]=hr[Sa]=hr[Ci]=2,hr[Aa]=hr[sn]=hr[Ri]=hr[Ra]=4;function Wn(l,v){return l===Ci||l===Sa||l===wa?2:l===Ra?4:hr[l]*v}function Yn(l){return!(l&l-1)&&!!l}function $o(l,v,A){var B,q=v.width,G=v.height,$=v.channels;s(q>0&&q<=A.maxTextureSize&&G>0&&G<=A.maxTextureSize,"invalid texture shape"),(l.wrapS!==Ve||l.wrapT!==Ve)&&s(Yn(q)&&Yn(G),"incompatible wrap mode for texture, both width and height must be power of 2"),v.mipmask===1?q!==1&&G!==1&&s(l.minFilter!==Nt&&l.minFilter!==Ot&&l.minFilter!==Lt&&l.minFilter!==dr,"min filter requires mipmap"):(s(Yn(q)&&Yn(G),"texture must be a square power of 2 to support mipmapping"),s(v.mipmask===(q<<1)-1,"missing or incomplete mipmap data")),v.type===Ri&&(A.extensions.indexOf("oes_texture_float_linear")<0&&s(l.minFilter===tt&&l.magFilter===tt,"filter not supported, must enable oes_texture_float_linear"),s(!l.genMipmaps,"mipmap generation not supported with float textures"));var re=v.images;for(B=0;B<16;++B)if(re[B]){var oe=q>>B,le=G>>B;s(v.mipmask&1<<B,"missing mipmap data");var se=re[B];if(s(se.width===oe&&se.height===le,"invalid shape for mip images"),s(se.format===v.format&&se.internalformat===v.internalformat&&se.type===v.type,"incompatible type for mip image"),!se.compressed)if(se.data){var he=Math.ceil(Wn(se.type,$)*oe/se.unpackAlignment)*se.unpackAlignment;s(se.data.byteLength===he*le,"invalid data for image, buffer size is inconsistent with image format")}else se.element||se.copy}else l.genMipmaps||s((v.mipmask&1<<B)===0,"extra mipmap data");v.compressed&&s(!l.genMipmaps,"mipmap generation for compressed images not supported")}function Vo(l,v,A,B){var q=l.width,G=l.height,$=l.channels;s(q>0&&q<=B.maxTextureSize&&G>0&&G<=B.maxTextureSize,"invalid texture shape"),s(q===G,"cube map must be square"),s(v.wrapS===Ve&&v.wrapT===Ve,"wrap mode not supported by cube map");for(var re=0;re<A.length;++re){var oe=A[re];s(oe.width===q&&oe.height===G,"inconsistent cube map face shape"),v.genMipmaps&&(s(!oe.compressed,"can not generate mipmap for compressed textures"),s(oe.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var le=oe.images,se=0;se<16;++se){var he=le[se];if(he){var Ee=q>>se,ne=G>>se;s(oe.mipmask&1<<se,"missing mipmap data"),s(he.width===Ee&&he.height===ne,"invalid shape for mip images"),s(he.format===l.format&&he.internalformat===l.internalformat&&he.type===l.type,"incompatible type for mip image"),he.compressed||(he.data?s(he.data.byteLength===Ee*ne*Math.max(Wn(he.type,$),he.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):he.element||he.copy)}}}}var y=n(s,{optional:Ie,raise:o,commandRaise:$e,command:we,parameter:c,commandParameter:me,constructor:O,type:p,commandType:pe,isTypedArray:f,nni:g,oneOf:T,shaderError:ht,linkError:yt,callSite:Re,saveCommandRef:Qe,saveDrawInfo:pt,framebufferFormat:qe,guessCommand:ce,texture2D:$o,textureCube:Vo}),j=0,ae=0,Ae=5,Pe=6;function Be(l,v){this.id=j++,this.type=l,this.data=v}function Zt(l){return l.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function st(l){if(l.length===0)return[];var v=l.charAt(0),A=l.charAt(l.length-1);if(l.length>1&&v===A&&(v==='"'||v==="'"))return['"'+Zt(l.substr(1,l.length-2))+'"'];var B=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(l);if(B)return st(l.substr(0,B.index)).concat(st(B[1])).concat(st(l.substr(B.index+B[0].length)));var q=l.split(".");if(q.length===1)return['"'+Zt(l)+'"'];for(var G=[],$=0;$<q.length;++$)G=G.concat(st(q[$]));return G}function mt(l){return"["+st(l).join("][")+"]"}function et(l,v){return new Be(l,mt(v+""))}function wt(l){return typeof l=="function"&&!l._reglType||l instanceof Be}function St(l,v){if(typeof l=="function")return new Be(ae,l);if(typeof l=="number"||typeof l=="boolean")return new Be(Ae,l);if(Array.isArray(l))return new Be(Pe,l.map((A,B)=>St(A,v+"["+B+"]")));if(l instanceof Be)return l;y(!1,"invalid option type in uniform "+v)}var $t={DynamicVariable:Be,define:et,isDynamic:wt,unbox:St,accessor:mt},qn={next:typeof requestAnimationFrame=="function"?function(l){return requestAnimationFrame(l)}:function(l){return setTimeout(l,16)},cancel:typeof cancelAnimationFrame=="function"?function(l){return cancelAnimationFrame(l)}:clearTimeout},Bu=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function qy(){var l={"":0},v=[""];return{id:function(A){var B=l[A];return B||(B=l[A]=v.length,v.push(A),B)},str:function(A){return v[A]}}}function Ky(l,v,A){var B=document.createElement("canvas");n(B.style,{border:0,margin:0,padding:0,top:0,left:0}),l.appendChild(B),l===document.body&&(B.style.position="absolute",n(l.style,{margin:0,padding:0}));function q(){var re=window.innerWidth,oe=window.innerHeight;if(l!==document.body){var le=l.getBoundingClientRect();re=le.right-le.left,oe=le.bottom-le.top}B.width=A*re,B.height=A*oe,n(B.style,{width:re+"px",height:oe+"px"})}var G;l!==document.body&&typeof ResizeObserver=="function"?(G=new ResizeObserver(function(){setTimeout(q)}),G.observe(l)):window.addEventListener("resize",q,!1);function $(){G?G.disconnect():window.removeEventListener("resize",q),l.removeChild(B)}return q(),{canvas:B,onDestroy:$}}function Qy(l,v){function A(B){try{return l.getContext(B,v)}catch{return null}}return A("webgl")||A("experimental-webgl")||A("webgl-experimental")}function Zy(l){return typeof l.nodeName=="string"&&typeof l.appendChild=="function"&&typeof l.getBoundingClientRect=="function"}function Jy(l){return typeof l.drawArrays=="function"||typeof l.drawElements=="function"}function Uu(l){return typeof l=="string"?l.split():(y(Array.isArray(l),"invalid extension array"),l)}function $u(l){return typeof l=="string"?(y(typeof document<"u","not supported outside of DOM"),document.querySelector(l)):l}function e_(l){var v=l||{},A,B,q,G,$={},re=[],oe=[],le=typeof window>"u"?1:window.devicePixelRatio,se=!1,he=function(ve){ve&&y.raise(ve)},Ee=function(){};if(typeof v=="string"?(y(typeof document<"u","selector queries only supported in DOM enviroments"),A=document.querySelector(v),y(A,"invalid query string for element")):typeof v=="object"?Zy(v)?A=v:Jy(v)?(G=v,q=G.canvas):(y.constructor(v),"gl"in v?G=v.gl:"canvas"in v?q=$u(v.canvas):"container"in v&&(B=$u(v.container)),"attributes"in v&&($=v.attributes,y.type($,"object","invalid context attributes")),"extensions"in v&&(re=Uu(v.extensions)),"optionalExtensions"in v&&(oe=Uu(v.optionalExtensions)),"onDone"in v&&(y.type(v.onDone,"function","invalid or missing onDone callback"),he=v.onDone),"profile"in v&&(se=!!v.profile),"pixelRatio"in v&&(le=+v.pixelRatio,y(le>0,"invalid pixel ratio"))):y.raise("invalid arguments to regl"),A&&(A.nodeName.toLowerCase()==="canvas"?q=A:B=A),!G){if(!q){y(typeof document<"u","must manually specify webgl context outside of DOM environments");var ne=Ky(B||document.body,he,le);if(!ne)return null;q=ne.canvas,Ee=ne.onDestroy}$.premultipliedAlpha===void 0&&($.premultipliedAlpha=!0),G=Qy(q,$)}return G?{gl:G,canvas:q,container:B,extensions:re,optionalExtensions:oe,pixelRatio:le,profile:se,onDone:he,onDestroy:Ee}:(Ee(),he("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function t_(l,v){var A={};function B($){y.type($,"string","extension name must be string");var re=$.toLowerCase(),oe;try{oe=A[re]=l.getExtension(re)}catch{}return!!oe}for(var q=0;q<v.extensions.length;++q){var G=v.extensions[q];if(!B(G))return v.onDestroy(),v.onDone('"'+G+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return v.optionalExtensions.forEach(B),{extensions:A,restore:function(){Object.keys(A).forEach(function($){if(A[$]&&!B($))throw new Error("(regl): error restoring extension "+$)})}}}function Er(l,v){for(var A=Array(l),B=0;B<l;++B)A[B]=v(B);return A}var r_=5120,n_=5121,i_=5122,a_=5123,o_=5124,s_=5125,u_=5126;function c_(l){for(var v=16;v<=1<<28;v*=16)if(l<=v)return v;return 0}function Vu(l){var v,A;return v=(l>65535)<<4,l>>>=v,A=(l>255)<<3,l>>>=A,v|=A,A=(l>15)<<2,l>>>=A,v|=A,A=(l>3)<<1,l>>>=A,v|=A,v|l>>1}function ju(){var l=Er(8,function(){return[]});function v(G){var $=c_(G),re=l[Vu($)>>2];return re.length>0?re.pop():new ArrayBuffer($)}function A(G){l[Vu(G.byteLength)>>2].push(G)}function B(G,$){var re=null;switch(G){case r_:re=new Int8Array(v($),0,$);break;case n_:re=new Uint8Array(v($),0,$);break;case i_:re=new Int16Array(v(2*$),0,$);break;case a_:re=new Uint16Array(v(2*$),0,$);break;case o_:re=new Int32Array(v(4*$),0,$);break;case s_:re=new Uint32Array(v(4*$),0,$);break;case u_:re=new Float32Array(v(4*$),0,$);break;default:return null}return re.length!==$?re.subarray(0,$):re}function q(G){A(G.buffer)}return{alloc:v,free:A,allocType:B,freeType:q}}var Vt=ju();Vt.zero=ju();var f_=3408,l_=3410,d_=3411,h_=3412,v_=3413,p_=3414,m_=3415,y_=33901,__=33902,E_=3379,b_=3386,g_=34921,T_=36347,A_=36348,S_=35661,w_=35660,R_=34930,C_=36349,x_=34076,N_=34024,O_=7936,I_=7937,P_=7938,L_=35724,M_=34047,k_=36063,D_=34852,Ca=3553,zu=34067,F_=34069,G_=33984,xi=6408,jo=5126,Hu=5121,zo=36160,B_=36053,U_=36064,$_=16384,V_=function(l,v){var A=1;v.ext_texture_filter_anisotropic&&(A=l.getParameter(M_));var B=1,q=1;v.webgl_draw_buffers&&(B=l.getParameter(D_),q=l.getParameter(k_));var G=!!v.oes_texture_float;if(G){var $=l.createTexture();l.bindTexture(Ca,$),l.texImage2D(Ca,0,xi,1,1,0,xi,jo,null);var re=l.createFramebuffer();if(l.bindFramebuffer(zo,re),l.framebufferTexture2D(zo,U_,Ca,$,0),l.bindTexture(Ca,null),l.checkFramebufferStatus(zo)!==B_)G=!1;else{l.viewport(0,0,1,1),l.clearColor(1,0,0,1),l.clear($_);var oe=Vt.allocType(jo,4);l.readPixels(0,0,1,1,xi,jo,oe),l.getError()?G=!1:(l.deleteFramebuffer(re),l.deleteTexture($),G=oe[0]===1),Vt.freeType(oe)}}var le=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),se=!0;if(!le){var he=l.createTexture(),Ee=Vt.allocType(Hu,36);l.activeTexture(G_),l.bindTexture(zu,he),l.texImage2D(F_,0,xi,3,3,0,xi,Hu,Ee),Vt.freeType(Ee),l.bindTexture(zu,null),l.deleteTexture(he),se=!l.getError()}return{colorBits:[l.getParameter(l_),l.getParameter(d_),l.getParameter(h_),l.getParameter(v_)],depthBits:l.getParameter(p_),stencilBits:l.getParameter(m_),subpixelBits:l.getParameter(f_),extensions:Object.keys(v).filter(function(ne){return!!v[ne]}),maxAnisotropic:A,maxDrawbuffers:B,maxColorAttachments:q,pointSizeDims:l.getParameter(y_),lineWidthDims:l.getParameter(__),maxViewportDims:l.getParameter(b_),maxCombinedTextureUnits:l.getParameter(S_),maxCubeMapSize:l.getParameter(x_),maxRenderbufferSize:l.getParameter(N_),maxTextureUnits:l.getParameter(R_),maxTextureSize:l.getParameter(E_),maxAttributes:l.getParameter(g_),maxVertexUniforms:l.getParameter(T_),maxVertexTextureUnits:l.getParameter(w_),maxVaryingVectors:l.getParameter(A_),maxFragmentUniforms:l.getParameter(C_),glsl:l.getParameter(L_),renderer:l.getParameter(I_),vendor:l.getParameter(O_),version:l.getParameter(P_),readFloat:G,npotTextureCube:se}};function Pr(l){return!!l&&typeof l=="object"&&Array.isArray(l.shape)&&Array.isArray(l.stride)&&typeof l.offset=="number"&&l.shape.length===l.stride.length&&(Array.isArray(l.data)||r(l.data))}var Ar=function(l){return Object.keys(l).map(function(v){return l[v]})},xa={shape:X_,flatten:H_};function j_(l,v,A){for(var B=0;B<v;++B)A[B]=l[B]}function z_(l,v,A,B){for(var q=0,G=0;G<v;++G)for(var $=l[G],re=0;re<A;++re)B[q++]=$[re]}function Xu(l,v,A,B,q,G){for(var $=G,re=0;re<v;++re)for(var oe=l[re],le=0;le<A;++le)for(var se=oe[le],he=0;he<B;++he)q[$++]=se[he]}function Wu(l,v,A,B,q){for(var G=1,$=A+1;$<v.length;++$)G*=v[$];var re=v[A];if(v.length-A===4){var oe=v[A+1],le=v[A+2],se=v[A+3];for($=0;$<re;++$)Xu(l[$],oe,le,se,B,q),q+=G}else for($=0;$<re;++$)Wu(l[$],v,A+1,B,q),q+=G}function H_(l,v,A,B){var q=1;if(v.length)for(var G=0;G<v.length;++G)q*=v[G];else q=0;var $=B||Vt.allocType(A,q);switch(v.length){case 0:break;case 1:j_(l,v[0],$);break;case 2:z_(l,v[0],v[1],$);break;case 3:Xu(l,v[0],v[1],v[2],$,0);break;default:Wu(l,v,0,$,0)}return $}function X_(l){for(var v=[],A=l;A.length;A=A[0])v.push(A.length);return v}var Ho={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},W_=5120,Y_=5122,q_=5124,K_=5121,Q_=5123,Z_=5125,J_=5126,e0=5126,An={int8:W_,int16:Y_,int32:q_,uint8:K_,uint16:Q_,uint32:Z_,float:J_,float32:e0},t0=35048,r0=35040,Na={dynamic:t0,stream:r0,static:35044},Xo=xa.flatten,Yu=xa.shape,qu=35044,n0=35040,Wo=5121,Yo=5126,un=[];un[5120]=1,un[5122]=2,un[5124]=4,un[5121]=1,un[5123]=2,un[5125]=4,un[5126]=4;function Oa(l){return Ho[Object.prototype.toString.call(l)]|0}function Ku(l,v){for(var A=0;A<v.length;++A)l[A]=v[A]}function Qu(l,v,A,B,q,G,$){for(var re=0,oe=0;oe<A;++oe)for(var le=0;le<B;++le)l[re++]=v[q*oe+G*le+$]}function i0(l,v,A,B){var q=0,G={};function $(L){this.id=q++,this.buffer=l.createBuffer(),this.type=L,this.usage=qu,this.byteLength=0,this.dimension=1,this.dtype=Wo,this.persistentData=null,A.profile&&(this.stats={size:0})}$.prototype.bind=function(){l.bindBuffer(this.type,this.buffer)},$.prototype.destroy=function(){Ee(this)};var re=[];function oe(L,V){var fe=re.pop();return fe||(fe=new $(L)),fe.bind(),he(fe,V,n0,0,1,!1),fe}function le(L){re.push(L)}function se(L,V,fe){L.byteLength=V.byteLength,l.bufferData(L.type,V,fe)}function he(L,V,fe,Se,Z,Ce){var ee;if(L.usage=fe,Array.isArray(V)){if(L.dtype=Se||Yo,V.length>0){var ye;if(Array.isArray(V[0])){ee=Yu(V);for(var J=1,_e=1;_e<ee.length;++_e)J*=ee[_e];L.dimension=J,ye=Xo(V,ee,L.dtype),se(L,ye,fe),Ce?L.persistentData=ye:Vt.freeType(ye)}else if(typeof V[0]=="number"){L.dimension=Z;var De=Vt.allocType(L.dtype,V.length);Ku(De,V),se(L,De,fe),Ce?L.persistentData=De:Vt.freeType(De)}else r(V[0])?(L.dimension=V[0].length,L.dtype=Se||Oa(V[0])||Yo,ye=Xo(V,[V.length,V[0].length],L.dtype),se(L,ye,fe),Ce?L.persistentData=ye:Vt.freeType(ye)):y.raise("invalid buffer data")}}else if(r(V))L.dtype=Se||Oa(V),L.dimension=Z,se(L,V,fe),Ce&&(L.persistentData=new Uint8Array(new Uint8Array(V.buffer)));else if(Pr(V)){ee=V.shape;var Ke=V.stride,be=V.offset,de=0,Q=0,We=0,rt=0;ee.length===1?(de=ee[0],Q=1,We=Ke[0],rt=0):ee.length===2?(de=ee[0],Q=ee[1],We=Ke[0],rt=Ke[1]):y.raise("invalid shape"),L.dtype=Se||Oa(V.data)||Yo,L.dimension=Q;var Ne=Vt.allocType(L.dtype,de*Q);Qu(Ne,V.data,de,Q,We,rt,be),se(L,Ne,fe),Ce?L.persistentData=Ne:Vt.freeType(Ne)}else V instanceof ArrayBuffer?(L.dtype=Wo,L.dimension=Z,se(L,V,fe),Ce&&(L.persistentData=new Uint8Array(new Uint8Array(V)))):y.raise("invalid buffer data")}function Ee(L){v.bufferCount--,B(L);var V=L.buffer;y(V,"buffer must not be deleted already"),l.deleteBuffer(V),L.buffer=null,delete G[L.id]}function ne(L,V,fe,Se){v.bufferCount++;var Z=new $(V);G[Z.id]=Z;function Ce(J){var _e=qu,De=null,Ke=0,be=0,de=1;return Array.isArray(J)||r(J)||Pr(J)||J instanceof ArrayBuffer?De=J:typeof J=="number"?Ke=J|0:J&&(y.type(J,"object","buffer arguments must be an object, a number or an array"),"data"in J&&(y(De===null||Array.isArray(De)||r(De)||Pr(De),"invalid data for buffer"),De=J.data),"usage"in J&&(y.parameter(J.usage,Na,"invalid buffer usage"),_e=Na[J.usage]),"type"in J&&(y.parameter(J.type,An,"invalid buffer type"),be=An[J.type]),"dimension"in J&&(y.type(J.dimension,"number","invalid dimension"),de=J.dimension|0),"length"in J&&(y.nni(Ke,"buffer length must be a nonnegative integer"),Ke=J.length|0)),Z.bind(),De?he(Z,De,_e,be,de,Se):(Ke&&l.bufferData(Z.type,Ke,_e),Z.dtype=be||Wo,Z.usage=_e,Z.dimension=de,Z.byteLength=Ke),A.profile&&(Z.stats.size=Z.byteLength*un[Z.dtype]),Ce}function ee(J,_e){y(_e+J.byteLength<=Z.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+J.byteLength+" starting from offset "+_e+" to a buffer of size "+Z.byteLength),l.bufferSubData(Z.type,_e,J)}function ye(J,_e){var De=(_e||0)|0,Ke;if(Z.bind(),r(J)||J instanceof ArrayBuffer)ee(J,De);else if(Array.isArray(J)){if(J.length>0)if(typeof J[0]=="number"){var be=Vt.allocType(Z.dtype,J.length);Ku(be,J),ee(be,De),Vt.freeType(be)}else if(Array.isArray(J[0])||r(J[0])){Ke=Yu(J);var de=Xo(J,Ke,Z.dtype);ee(de,De),Vt.freeType(de)}else y.raise("invalid buffer data")}else if(Pr(J)){Ke=J.shape;var Q=J.stride,We=0,rt=0,Ne=0,ut=0;Ke.length===1?(We=Ke[0],rt=1,Ne=Q[0],ut=0):Ke.length===2?(We=Ke[0],rt=Ke[1],Ne=Q[0],ut=Q[1]):y.raise("invalid shape");var Ze=Array.isArray(J.data)?Z.dtype:Oa(J.data),ot=Vt.allocType(Ze,We*rt);Qu(ot,J.data,We,rt,Ne,ut,J.offset),ee(ot,De),Vt.freeType(ot)}else y.raise("invalid data for buffer subdata");return Ce}return fe||Ce(L),Ce._reglType="buffer",Ce._buffer=Z,Ce.subdata=ye,A.profile&&(Ce.stats=Z.stats),Ce.destroy=function(){Ee(Z)},Ce}function ve(){Ar(G).forEach(function(L){L.buffer=l.createBuffer(),l.bindBuffer(L.type,L.buffer),l.bufferData(L.type,L.persistentData||L.byteLength,L.usage)})}return A.profile&&(v.getTotalBufferSize=function(){var L=0;return Object.keys(G).forEach(function(V){L+=G[V].stats.size}),L}),{create:ne,createStream:oe,destroyStream:le,clear:function(){Ar(G).forEach(Ee),re.forEach(Ee)},getBuffer:function(L){return L&&L._buffer instanceof $?L._buffer:null},restore:ve,_initBuffer:he}}var a0=0,o0=0,s0=1,u0=1,c0=4,f0=4,Kn={points:a0,point:o0,lines:s0,line:u0,triangles:c0,triangle:f0,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},l0=0,d0=1,Ni=4,h0=5120,Qn=5121,Zu=5122,Zn=5123,Ju=5124,Sn=5125,qo=34963,v0=35040,p0=35044;function m0(l,v,A,B){var q={},G=0,$={uint8:Qn,uint16:Zn};v.oes_element_index_uint&&($.uint32=Sn);function re(ve){this.id=G++,q[this.id]=this,this.buffer=ve,this.primType=Ni,this.vertCount=0,this.type=0}re.prototype.bind=function(){this.buffer.bind()};var oe=[];function le(ve){var L=oe.pop();return L||(L=new re(A.create(null,qo,!0,!1)._buffer)),he(L,ve,v0,-1,-1,0,0),L}function se(ve){oe.push(ve)}function he(ve,L,V,fe,Se,Z,Ce){ve.buffer.bind();var ee;if(L){var ye=Ce;!Ce&&(!r(L)||Pr(L)&&!r(L.data))&&(ye=v.oes_element_index_uint?Sn:Zn),A._initBuffer(ve.buffer,L,V,ye,3)}else l.bufferData(qo,Z,V),ve.buffer.dtype=ee||Qn,ve.buffer.usage=V,ve.buffer.dimension=3,ve.buffer.byteLength=Z;if(ee=Ce,!Ce){switch(ve.buffer.dtype){case Qn:case h0:ee=Qn;break;case Zn:case Zu:ee=Zn;break;case Sn:case Ju:ee=Sn;break;default:y.raise("unsupported type for element array")}ve.buffer.dtype=ee}ve.type=ee,y(ee!==Sn||!!v.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var J=Se;J<0&&(J=ve.buffer.byteLength,ee===Zn?J>>=1:ee===Sn&&(J>>=2)),ve.vertCount=J;var _e=fe;if(fe<0){_e=Ni;var De=ve.buffer.dimension;De===1&&(_e=l0),De===2&&(_e=d0),De===3&&(_e=Ni)}ve.primType=_e}function Ee(ve){B.elementsCount--,y(ve.buffer!==null,"must not double destroy elements"),delete q[ve.id],ve.buffer.destroy(),ve.buffer=null}function ne(ve,L){var V=A.create(null,qo,!0),fe=new re(V._buffer);B.elementsCount++;function Se(Z){if(!Z)V(),fe.primType=Ni,fe.vertCount=0,fe.type=Qn;else if(typeof Z=="number")V(Z),fe.primType=Ni,fe.vertCount=Z|0,fe.type=Qn;else{var Ce=null,ee=p0,ye=-1,J=-1,_e=0,De=0;Array.isArray(Z)||r(Z)||Pr(Z)?Ce=Z:(y.type(Z,"object","invalid arguments for elements"),"data"in Z&&(Ce=Z.data,y(Array.isArray(Ce)||r(Ce)||Pr(Ce),"invalid data for element buffer")),"usage"in Z&&(y.parameter(Z.usage,Na,"invalid element buffer usage"),ee=Na[Z.usage]),"primitive"in Z&&(y.parameter(Z.primitive,Kn,"invalid element buffer primitive"),ye=Kn[Z.primitive]),"count"in Z&&(y(typeof Z.count=="number"&&Z.count>=0,"invalid vertex count for elements"),J=Z.count|0),"type"in Z&&(y.parameter(Z.type,$,"invalid buffer type"),De=$[Z.type]),"length"in Z?_e=Z.length|0:(_e=J,De===Zn||De===Zu?_e*=2:(De===Sn||De===Ju)&&(_e*=4))),he(fe,Ce,ee,ye,J,_e,De)}return Se}return Se(ve),Se._reglType="elements",Se._elements=fe,Se.subdata=function(Z,Ce){return V.subdata(Z,Ce),Se},Se.destroy=function(){Ee(fe)},Se}return{create:ne,createStream:le,destroyStream:se,getElements:function(ve){return typeof ve=="function"&&ve._elements instanceof re?ve._elements:null},clear:function(){Ar(q).forEach(Ee)}}}var ec=new Float32Array(1),y0=new Uint32Array(ec.buffer),_0=5123;function tc(l){for(var v=Vt.allocType(_0,l.length),A=0;A<l.length;++A)if(isNaN(l[A]))v[A]=65535;else if(l[A]===1/0)v[A]=31744;else if(l[A]===-1/0)v[A]=64512;else{ec[0]=l[A];var B=y0[0],q=B>>>31<<15,G=(B<<1>>>24)-127,$=B>>13&(1<<10)-1;if(G<-24)v[A]=q;else if(G<-14){var re=-14-G;v[A]=q+($+(1<<10)>>re)}else G>15?v[A]=q+31744:v[A]=q+(G+15<<10)+$}return v}function Gt(l){return Array.isArray(l)||r(l)}var rc=function(l){return!(l&l-1)&&!!l},E0=34467,Fr=3553,Ko=34067,Ia=34069,wn=6408,Qo=6406,Pa=6407,Oi=6409,La=6410,nc=32854,Zo=32855,ic=36194,b0=32819,g0=32820,T0=33635,A0=34042,Jo=6402,Ma=34041,es=35904,ts=35906,Jn=36193,rs=33776,ns=33777,is=33778,as=33779,ac=35986,oc=35987,sc=34798,uc=35840,cc=35841,fc=35842,lc=35843,dc=36196,ei=5121,os=5123,ss=5125,Ii=5126,S0=10242,w0=10243,R0=10497,us=33071,C0=33648,x0=10240,N0=10241,cs=9728,O0=9729,fs=9984,hc=9985,vc=9986,ls=9987,I0=33170,ka=4352,P0=4353,L0=4354,M0=34046,k0=3317,D0=37440,F0=37441,G0=37443,pc=37444,Pi=33984,B0=[fs,vc,hc,ls],Da=[0,Oi,La,Pa,wn],Sr={};Sr[Oi]=Sr[Qo]=Sr[Jo]=1,Sr[Ma]=Sr[La]=2,Sr[Pa]=Sr[es]=3,Sr[wn]=Sr[ts]=4;function ti(l){return"[object "+l+"]"}var mc=ti("HTMLCanvasElement"),yc=ti("OffscreenCanvas"),_c=ti("CanvasRenderingContext2D"),Ec=ti("ImageBitmap"),bc=ti("HTMLImageElement"),gc=ti("HTMLVideoElement"),U0=Object.keys(Ho).concat([mc,yc,_c,Ec,bc,gc]),ri=[];ri[ei]=1,ri[Ii]=4,ri[Jn]=2,ri[os]=2,ri[ss]=4;var rr=[];rr[nc]=2,rr[Zo]=2,rr[ic]=2,rr[Ma]=4,rr[rs]=.5,rr[ns]=.5,rr[is]=1,rr[as]=1,rr[ac]=.5,rr[oc]=1,rr[sc]=1,rr[uc]=.5,rr[cc]=.25,rr[fc]=.5,rr[lc]=.25,rr[dc]=.5;function Tc(l){return Array.isArray(l)&&(l.length===0||typeof l[0]=="number")}function Ac(l){if(!Array.isArray(l))return!1;var v=l.length;return!(v===0||!Gt(l[0]))}function Rn(l){return Object.prototype.toString.call(l)}function Sc(l){return Rn(l)===mc}function wc(l){return Rn(l)===yc}function $0(l){return Rn(l)===_c}function V0(l){return Rn(l)===Ec}function j0(l){return Rn(l)===bc}function z0(l){return Rn(l)===gc}function ds(l){if(!l)return!1;var v=Rn(l);return U0.indexOf(v)>=0?!0:Tc(l)||Ac(l)||Pr(l)}function Rc(l){return Ho[Object.prototype.toString.call(l)]|0}function H0(l,v){var A=v.length;switch(l.type){case ei:case os:case ss:case Ii:var B=Vt.allocType(l.type,A);B.set(v),l.data=B;break;case Jn:l.data=tc(v);break;default:y.raise("unsupported texture type, must specify a typed array")}}function Cc(l,v){return Vt.allocType(l.type===Jn?Ii:l.type,v)}function xc(l,v){l.type===Jn?(l.data=tc(v),Vt.freeType(v)):l.data=v}function X0(l,v,A,B,q,G){for(var $=l.width,re=l.height,oe=l.channels,le=$*re*oe,se=Cc(l,le),he=0,Ee=0;Ee<re;++Ee)for(var ne=0;ne<$;++ne)for(var ve=0;ve<oe;++ve)se[he++]=v[A*ne+B*Ee+q*ve+G];xc(l,se)}function Fa(l,v,A,B,q,G){var $;if(typeof rr[l]<"u"?$=rr[l]:$=Sr[l]*ri[v],G&&($*=6),q){for(var re=0,oe=A;oe>=1;)re+=$*oe*oe,oe/=2;return re}else return $*A*B}function W0(l,v,A,B,q,G,$){var re={"don't care":ka,"dont care":ka,nice:L0,fast:P0},oe={repeat:R0,clamp:us,mirror:C0},le={nearest:cs,linear:O0},se=n({mipmap:ls,"nearest mipmap nearest":fs,"linear mipmap nearest":hc,"nearest mipmap linear":vc,"linear mipmap linear":ls},le),he={none:0,browser:pc},Ee={uint8:ei,rgba4:b0,rgb565:T0,"rgb5 a1":g0},ne={alpha:Qo,luminance:Oi,"luminance alpha":La,rgb:Pa,rgba:wn,rgba4:nc,"rgb5 a1":Zo,rgb565:ic},ve={};v.ext_srgb&&(ne.srgb=es,ne.srgba=ts),v.oes_texture_float&&(Ee.float32=Ee.float=Ii),v.oes_texture_half_float&&(Ee.float16=Ee["half float"]=Jn),v.webgl_depth_texture&&(n(ne,{depth:Jo,"depth stencil":Ma}),n(Ee,{uint16:os,uint32:ss,"depth stencil":A0})),v.webgl_compressed_texture_s3tc&&n(ve,{"rgb s3tc dxt1":rs,"rgba s3tc dxt1":ns,"rgba s3tc dxt3":is,"rgba s3tc dxt5":as}),v.webgl_compressed_texture_atc&&n(ve,{"rgb atc":ac,"rgba atc explicit alpha":oc,"rgba atc interpolated alpha":sc}),v.webgl_compressed_texture_pvrtc&&n(ve,{"rgb pvrtc 4bppv1":uc,"rgb pvrtc 2bppv1":cc,"rgba pvrtc 4bppv1":fc,"rgba pvrtc 2bppv1":lc}),v.webgl_compressed_texture_etc1&&(ve["rgb etc1"]=dc);var L=Array.prototype.slice.call(l.getParameter(E0));Object.keys(ve).forEach(function(b){var U=ve[b];L.indexOf(U)>=0&&(ne[b]=U)});var V=Object.keys(ne);A.textureFormats=V;var fe=[];Object.keys(ne).forEach(function(b){var U=ne[b];fe[U]=b});var Se=[];Object.keys(Ee).forEach(function(b){var U=Ee[b];Se[U]=b});var Z=[];Object.keys(le).forEach(function(b){var U=le[b];Z[U]=b});var Ce=[];Object.keys(se).forEach(function(b){var U=se[b];Ce[U]=b});var ee=[];Object.keys(oe).forEach(function(b){var U=oe[b];ee[U]=b});var ye=V.reduce(function(b,U){var F=ne[U];return F===Oi||F===Qo||F===Oi||F===La||F===Jo||F===Ma||v.ext_srgb&&(F===es||F===ts)?b[F]=F:F===Zo||U.indexOf("rgba")>=0?b[F]=wn:b[F]=Pa,b},{});function J(){this.internalformat=wn,this.format=wn,this.type=ei,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=pc,this.width=0,this.height=0,this.channels=0}function _e(b,U){b.internalformat=U.internalformat,b.format=U.format,b.type=U.type,b.compressed=U.compressed,b.premultiplyAlpha=U.premultiplyAlpha,b.flipY=U.flipY,b.unpackAlignment=U.unpackAlignment,b.colorSpace=U.colorSpace,b.width=U.width,b.height=U.height,b.channels=U.channels}function De(b,U){if(!(typeof U!="object"||!U)){if("premultiplyAlpha"in U&&(y.type(U.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),b.premultiplyAlpha=U.premultiplyAlpha),"flipY"in U&&(y.type(U.flipY,"boolean","invalid texture flip"),b.flipY=U.flipY),"alignment"in U&&(y.oneOf(U.alignment,[1,2,4,8],"invalid texture unpack alignment"),b.unpackAlignment=U.alignment),"colorSpace"in U&&(y.parameter(U.colorSpace,he,"invalid colorSpace"),b.colorSpace=he[U.colorSpace]),"type"in U){var F=U.type;y(v.oes_texture_float||!(F==="float"||F==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),y(v.oes_texture_half_float||!(F==="half float"||F==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),y(v.webgl_depth_texture||!(F==="uint16"||F==="uint32"||F==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(F,Ee,"invalid texture type"),b.type=Ee[F]}var xe=b.width,ct=b.height,_=b.channels,h=!1;"shape"in U?(y(Array.isArray(U.shape)&&U.shape.length>=2,"shape must be an array"),xe=U.shape[0],ct=U.shape[1],U.shape.length===3&&(_=U.shape[2],y(_>0&&_<=4,"invalid number of channels"),h=!0),y(xe>=0&&xe<=A.maxTextureSize,"invalid width"),y(ct>=0&&ct<=A.maxTextureSize,"invalid height")):("radius"in U&&(xe=ct=U.radius,y(xe>=0&&xe<=A.maxTextureSize,"invalid radius")),"width"in U&&(xe=U.width,y(xe>=0&&xe<=A.maxTextureSize,"invalid width")),"height"in U&&(ct=U.height,y(ct>=0&&ct<=A.maxTextureSize,"invalid height")),"channels"in U&&(_=U.channels,y(_>0&&_<=4,"invalid number of channels"),h=!0)),b.width=xe|0,b.height=ct|0,b.channels=_|0;var w=!1;if("format"in U){var P=U.format;y(v.webgl_depth_texture||!(P==="depth"||P==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),y.parameter(P,ne,"invalid texture format");var k=b.internalformat=ne[P];b.format=ye[k],P in Ee&&("type"in U||(b.type=Ee[P])),P in ve&&(b.compressed=!0),w=!0}!h&&w?b.channels=Sr[b.format]:h&&!w?b.channels!==Da[b.format]&&(b.format=b.internalformat=Da[b.channels]):w&&h&&y(b.channels===Sr[b.format],"number of channels inconsistent with specified format")}}function Ke(b){l.pixelStorei(D0,b.flipY),l.pixelStorei(F0,b.premultiplyAlpha),l.pixelStorei(G0,b.colorSpace),l.pixelStorei(k0,b.unpackAlignment)}function be(){J.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function de(b,U){var F=null;if(ds(U)?F=U:U&&(y.type(U,"object","invalid pixel data type"),De(b,U),"x"in U&&(b.xOffset=U.x|0),"y"in U&&(b.yOffset=U.y|0),ds(U.data)&&(F=U.data)),y(!b.compressed||F instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),U.copy){y(!F,"can not specify copy and data field for the same texture");var xe=q.viewportWidth,ct=q.viewportHeight;b.width=b.width||xe-b.xOffset,b.height=b.height||ct-b.yOffset,b.needsCopy=!0,y(b.xOffset>=0&&b.xOffset<xe&&b.yOffset>=0&&b.yOffset<ct&&b.width>0&&b.width<=xe&&b.height>0&&b.height<=ct,"copy texture read out of bounds")}else if(!F)b.width=b.width||1,b.height=b.height||1,b.channels=b.channels||4;else if(r(F))b.channels=b.channels||4,b.data=F,!("type"in U)&&b.type===ei&&(b.type=Rc(F));else if(Tc(F))b.channels=b.channels||4,H0(b,F),b.alignment=1,b.needsFree=!0;else if(Pr(F)){var _=F.data;!Array.isArray(_)&&b.type===ei&&(b.type=Rc(_));var h=F.shape,w=F.stride,P,k,C,R,N,E;h.length===3?(C=h[2],E=w[2]):(y(h.length===2,"invalid ndarray pixel data, must be 2 or 3D"),C=1,E=1),P=h[0],k=h[1],R=w[0],N=w[1],b.alignment=1,b.width=P,b.height=k,b.channels=C,b.format=b.internalformat=Da[C],b.needsFree=!0,X0(b,_,R,N,E,F.offset)}else if(Sc(F)||wc(F)||$0(F))Sc(F)||wc(F)?b.element=F:b.element=F.canvas,b.width=b.element.width,b.height=b.element.height,b.channels=4;else if(V0(F))b.element=F,b.width=F.width,b.height=F.height,b.channels=4;else if(j0(F))b.element=F,b.width=F.naturalWidth,b.height=F.naturalHeight,b.channels=4;else if(z0(F))b.element=F,b.width=F.videoWidth,b.height=F.videoHeight,b.channels=4;else if(Ac(F)){var S=b.width||F[0].length,m=b.height||F.length,I=b.channels;Gt(F[0][0])?I=I||F[0][0].length:I=I||1;for(var D=xa.shape(F),W=1,K=0;K<D.length;++K)W*=D[K];var H=Cc(b,W);xa.flatten(F,D,"",H),xc(b,H),b.alignment=1,b.width=S,b.height=m,b.channels=I,b.format=b.internalformat=Da[I],b.needsFree=!0}b.type===Ii?y(A.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):b.type===Jn&&y(A.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Q(b,U,F){var xe=b.element,ct=b.data,_=b.internalformat,h=b.format,w=b.type,P=b.width,k=b.height;Ke(b),xe?l.texImage2D(U,F,h,h,w,xe):b.compressed?l.compressedTexImage2D(U,F,_,P,k,0,ct):b.needsCopy?(B(),l.copyTexImage2D(U,F,h,b.xOffset,b.yOffset,P,k,0)):l.texImage2D(U,F,h,P,k,0,h,w,ct||null)}function We(b,U,F,xe,ct){var _=b.element,h=b.data,w=b.internalformat,P=b.format,k=b.type,C=b.width,R=b.height;Ke(b),_?l.texSubImage2D(U,ct,F,xe,P,k,_):b.compressed?l.compressedTexSubImage2D(U,ct,F,xe,w,C,R,h):b.needsCopy?(B(),l.copyTexSubImage2D(U,ct,F,xe,b.xOffset,b.yOffset,C,R)):l.texSubImage2D(U,ct,F,xe,C,R,P,k,h)}var rt=[];function Ne(){return rt.pop()||new be}function ut(b){b.needsFree&&Vt.freeType(b.data),be.call(b),rt.push(b)}function Ze(){J.call(this),this.genMipmaps=!1,this.mipmapHint=ka,this.mipmask=0,this.images=Array(16)}function ot(b,U,F){var xe=b.images[0]=Ne();b.mipmask=1,xe.width=b.width=U,xe.height=b.height=F,xe.channels=b.channels=4}function Et(b,U){var F=null;if(ds(U))F=b.images[0]=Ne(),_e(F,b),de(F,U),b.mipmask=1;else if(De(b,U),Array.isArray(U.mipmap))for(var xe=U.mipmap,ct=0;ct<xe.length;++ct)F=b.images[ct]=Ne(),_e(F,b),F.width>>=ct,F.height>>=ct,de(F,xe[ct]),b.mipmask|=1<<ct;else F=b.images[0]=Ne(),_e(F,b),de(F,U),b.mipmask=1;_e(b,b.images[0]),b.compressed&&(b.internalformat===rs||b.internalformat===ns||b.internalformat===is||b.internalformat===as)&&y(b.width%4===0&&b.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function zt(b,U){for(var F=b.images,xe=0;xe<F.length;++xe){if(!F[xe])return;Q(F[xe],U,xe)}}var Jt=[];function dt(){var b=Jt.pop()||new Ze;J.call(b),b.mipmask=0;for(var U=0;U<16;++U)b.images[U]=null;return b}function Wt(b){for(var U=b.images,F=0;F<U.length;++F)U[F]&&ut(U[F]),U[F]=null;Jt.push(b)}function Pt(){this.minFilter=cs,this.magFilter=cs,this.wrapS=us,this.wrapT=us,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ka}function Ht(b,U){if("min"in U){var F=U.min;y.parameter(F,se),b.minFilter=se[F],B0.indexOf(b.minFilter)>=0&&!("faces"in U)&&(b.genMipmaps=!0)}if("mag"in U){var xe=U.mag;y.parameter(xe,le),b.magFilter=le[xe]}var ct=b.wrapS,_=b.wrapT;if("wrap"in U){var h=U.wrap;typeof h=="string"?(y.parameter(h,oe),ct=_=oe[h]):Array.isArray(h)&&(y.parameter(h[0],oe),y.parameter(h[1],oe),ct=oe[h[0]],_=oe[h[1]])}else{if("wrapS"in U){var w=U.wrapS;y.parameter(w,oe),ct=oe[w]}if("wrapT"in U){var P=U.wrapT;y.parameter(P,oe),_=oe[P]}}if(b.wrapS=ct,b.wrapT=_,"anisotropic"in U){var k=U.anisotropic;y(typeof k=="number"&&k>=1&&k<=A.maxAnisotropic,"aniso samples must be between 1 and "),b.anisotropic=U.anisotropic}if("mipmap"in U){var C=!1;switch(typeof U.mipmap){case"string":y.parameter(U.mipmap,re,"invalid mipmap hint"),b.mipmapHint=re[U.mipmap],b.genMipmaps=!0,C=!0;break;case"boolean":C=b.genMipmaps=U.mipmap;break;case"object":y(Array.isArray(U.mipmap),"invalid mipmap type"),b.genMipmaps=!1,C=!0;break;default:y.raise("invalid mipmap type")}C&&!("min"in U)&&(b.minFilter=fs)}}function Yt(b,U){l.texParameteri(U,N0,b.minFilter),l.texParameteri(U,x0,b.magFilter),l.texParameteri(U,S0,b.wrapS),l.texParameteri(U,w0,b.wrapT),v.ext_texture_filter_anisotropic&&l.texParameteri(U,M0,b.anisotropic),b.genMipmaps&&(l.hint(I0,b.mipmapHint),l.generateMipmap(U))}var qt=0,er={},nr=A.maxTextureUnits,Bt=Array(nr).map(function(){return null});function nt(b){J.call(this),this.mipmask=0,this.internalformat=wn,this.id=qt++,this.refCount=1,this.target=b,this.texture=l.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Pt,$.profile&&(this.stats={size:0})}function ir(b){l.activeTexture(Pi),l.bindTexture(b.target,b.texture)}function Tt(){var b=Bt[0];b?l.bindTexture(b.target,b.texture):l.bindTexture(Fr,null)}function Ge(b){var U=b.texture;y(U,"must not double destroy texture");var F=b.unit,xe=b.target;F>=0&&(l.activeTexture(Pi+F),l.bindTexture(xe,null),Bt[F]=null),l.deleteTexture(U),b.texture=null,b.params=null,b.pixels=null,b.refCount=0,delete er[b.id],G.textureCount--}n(nt.prototype,{bind:function(){var b=this;b.bindCount+=1;var U=b.unit;if(U<0){for(var F=0;F<nr;++F){var xe=Bt[F];if(xe){if(xe.bindCount>0)continue;xe.unit=-1}Bt[F]=b,U=F;break}U>=nr&&y.raise("insufficient number of texture units"),$.profile&&G.maxTextureUnits<U+1&&(G.maxTextureUnits=U+1),b.unit=U,l.activeTexture(Pi+U),l.bindTexture(b.target,b.texture)}return U},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ge(this)}});function ft(b,U){var F=new nt(Fr);er[F.id]=F,G.textureCount++;function xe(h,w){var P=F.texInfo;Pt.call(P);var k=dt();return typeof h=="number"?typeof w=="number"?ot(k,h|0,w|0):ot(k,h|0,h|0):h?(y.type(h,"object","invalid arguments to regl.texture"),Ht(P,h),Et(k,h)):ot(k,1,1),P.genMipmaps&&(k.mipmask=(k.width<<1)-1),F.mipmask=k.mipmask,_e(F,k),y.texture2D(P,k,A),F.internalformat=k.internalformat,xe.width=k.width,xe.height=k.height,ir(F),zt(k,Fr),Yt(P,Fr),Tt(),Wt(k),$.profile&&(F.stats.size=Fa(F.internalformat,F.type,k.width,k.height,P.genMipmaps,!1)),xe.format=fe[F.internalformat],xe.type=Se[F.type],xe.mag=Z[P.magFilter],xe.min=Ce[P.minFilter],xe.wrapS=ee[P.wrapS],xe.wrapT=ee[P.wrapT],xe}function ct(h,w,P,k){y(!!h,"must specify image data");var C=w|0,R=P|0,N=k|0,E=Ne();return _e(E,F),E.width=0,E.height=0,de(E,h),E.width=E.width||(F.width>>N)-C,E.height=E.height||(F.height>>N)-R,y(F.type===E.type&&F.format===E.format&&F.internalformat===E.internalformat,"incompatible format for texture.subimage"),y(C>=0&&R>=0&&C+E.width<=F.width&&R+E.height<=F.height,"texture.subimage write out of bounds"),y(F.mipmask&1<<N,"missing mipmap data"),y(E.data||E.element||E.needsCopy,"missing image data"),ir(F),We(E,Fr,C,R,N),Tt(),ut(E),xe}function _(h,w){var P=h|0,k=w|0||P;if(P===F.width&&k===F.height)return xe;xe.width=F.width=P,xe.height=F.height=k,ir(F);for(var C=0;F.mipmask>>C;++C){var R=P>>C,N=k>>C;if(!R||!N)break;l.texImage2D(Fr,C,F.format,R,N,0,F.format,F.type,null)}return Tt(),$.profile&&(F.stats.size=Fa(F.internalformat,F.type,P,k,!1,!1)),xe}return xe(b,U),xe.subimage=ct,xe.resize=_,xe._reglType="texture2d",xe._texture=F,$.profile&&(xe.stats=F.stats),xe.destroy=function(){F.decRef()},xe}function _t(b,U,F,xe,ct,_){var h=new nt(Ko);er[h.id]=h,G.cubeCount++;var w=new Array(6);function P(R,N,E,S,m,I){var D,W=h.texInfo;for(Pt.call(W),D=0;D<6;++D)w[D]=dt();if(typeof R=="number"||!R){var K=R|0||1;for(D=0;D<6;++D)ot(w[D],K,K)}else if(typeof R=="object")if(N)Et(w[0],R),Et(w[1],N),Et(w[2],E),Et(w[3],S),Et(w[4],m),Et(w[5],I);else if(Ht(W,R),De(h,R),"faces"in R){var H=R.faces;for(y(Array.isArray(H)&&H.length===6,"cube faces must be a length 6 array"),D=0;D<6;++D)y(typeof H[D]=="object"&&!!H[D],"invalid input for cube map face"),_e(w[D],h),Et(w[D],H[D])}else for(D=0;D<6;++D)Et(w[D],R);else y.raise("invalid arguments to cube map");for(_e(h,w[0]),A.npotTextureCube||y(rc(h.width)&&rc(h.height),"your browser does not support non power or two texture dimensions"),W.genMipmaps?h.mipmask=(w[0].width<<1)-1:h.mipmask=w[0].mipmask,y.textureCube(h,W,w,A),h.internalformat=w[0].internalformat,P.width=w[0].width,P.height=w[0].height,ir(h),D=0;D<6;++D)zt(w[D],Ia+D);for(Yt(W,Ko),Tt(),$.profile&&(h.stats.size=Fa(h.internalformat,h.type,P.width,P.height,W.genMipmaps,!0)),P.format=fe[h.internalformat],P.type=Se[h.type],P.mag=Z[W.magFilter],P.min=Ce[W.minFilter],P.wrapS=ee[W.wrapS],P.wrapT=ee[W.wrapT],D=0;D<6;++D)Wt(w[D]);return P}function k(R,N,E,S,m){y(!!N,"must specify image data"),y(typeof R=="number"&&R===(R|0)&&R>=0&&R<6,"invalid face");var I=E|0,D=S|0,W=m|0,K=Ne();return _e(K,h),K.width=0,K.height=0,de(K,N),K.width=K.width||(h.width>>W)-I,K.height=K.height||(h.height>>W)-D,y(h.type===K.type&&h.format===K.format&&h.internalformat===K.internalformat,"incompatible format for texture.subimage"),y(I>=0&&D>=0&&I+K.width<=h.width&&D+K.height<=h.height,"texture.subimage write out of bounds"),y(h.mipmask&1<<W,"missing mipmap data"),y(K.data||K.element||K.needsCopy,"missing image data"),ir(h),We(K,Ia+R,I,D,W),Tt(),ut(K),P}function C(R){var N=R|0;if(N!==h.width){P.width=h.width=N,P.height=h.height=N,ir(h);for(var E=0;E<6;++E)for(var S=0;h.mipmask>>S;++S)l.texImage2D(Ia+E,S,h.format,N>>S,N>>S,0,h.format,h.type,null);return Tt(),$.profile&&(h.stats.size=Fa(h.internalformat,h.type,P.width,P.height,!1,!0)),P}}return P(b,U,F,xe,ct,_),P.subimage=k,P.resize=C,P._reglType="textureCube",P._texture=h,$.profile&&(P.stats=h.stats),P.destroy=function(){h.decRef()},P}function Ut(){for(var b=0;b<nr;++b)l.activeTexture(Pi+b),l.bindTexture(Fr,null),Bt[b]=null;Ar(er).forEach(Ge),G.cubeCount=0,G.textureCount=0}$.profile&&(G.getTotalTextureSize=function(){var b=0;return Object.keys(er).forEach(function(U){b+=er[U].stats.size}),b});function Br(){for(var b=0;b<nr;++b){var U=Bt[b];U&&(U.bindCount=0,U.unit=-1,Bt[b]=null)}Ar(er).forEach(function(F){F.texture=l.createTexture(),l.bindTexture(F.target,F.texture);for(var xe=0;xe<32;++xe)if((F.mipmask&1<<xe)!==0)if(F.target===Fr)l.texImage2D(Fr,xe,F.internalformat,F.width>>xe,F.height>>xe,0,F.internalformat,F.type,null);else for(var ct=0;ct<6;++ct)l.texImage2D(Ia+ct,xe,F.internalformat,F.width>>xe,F.height>>xe,0,F.internalformat,F.type,null);Yt(F.texInfo,F.target)})}function Ln(){for(var b=0;b<nr;++b){var U=Bt[b];U&&(U.bindCount=0,U.unit=-1,Bt[b]=null),l.activeTexture(Pi+b),l.bindTexture(Fr,null),l.bindTexture(Ko,null)}}return{create2D:ft,createCube:_t,clear:Ut,getTexture:function(b){return null},restore:Br,refresh:Ln}}var cn=36161,Ga=32854,Nc=32855,Oc=36194,Ic=33189,Pc=36168,Lc=34041,Mc=35907,kc=34836,Dc=34842,Fc=34843,Lr=[];Lr[Ga]=2,Lr[Nc]=2,Lr[Oc]=2,Lr[Ic]=2,Lr[Pc]=1,Lr[Lc]=4,Lr[Mc]=4,Lr[kc]=16,Lr[Dc]=8,Lr[Fc]=6;function Gc(l,v,A){return Lr[l]*v*A}var Y0=function(l,v,A,B,q){var G={rgba4:Ga,rgb565:Oc,"rgb5 a1":Nc,depth:Ic,stencil:Pc,"depth stencil":Lc};v.ext_srgb&&(G.srgba=Mc),v.ext_color_buffer_half_float&&(G.rgba16f=Dc,G.rgb16f=Fc),v.webgl_color_buffer_float&&(G.rgba32f=kc);var $=[];Object.keys(G).forEach(function(ne){var ve=G[ne];$[ve]=ne});var re=0,oe={};function le(ne){this.id=re++,this.refCount=1,this.renderbuffer=ne,this.format=Ga,this.width=0,this.height=0,q.profile&&(this.stats={size:0})}le.prototype.decRef=function(){--this.refCount<=0&&se(this)};function se(ne){var ve=ne.renderbuffer;y(ve,"must not double destroy renderbuffer"),l.bindRenderbuffer(cn,null),l.deleteRenderbuffer(ve),ne.renderbuffer=null,ne.refCount=0,delete oe[ne.id],B.renderbufferCount--}function he(ne,ve){var L=new le(l.createRenderbuffer());oe[L.id]=L,B.renderbufferCount++;function V(Se,Z){var Ce=0,ee=0,ye=Ga;if(typeof Se=="object"&&Se){var J=Se;if("shape"in J){var _e=J.shape;y(Array.isArray(_e)&&_e.length>=2,"invalid renderbuffer shape"),Ce=_e[0]|0,ee=_e[1]|0}else"radius"in J&&(Ce=ee=J.radius|0),"width"in J&&(Ce=J.width|0),"height"in J&&(ee=J.height|0);"format"in J&&(y.parameter(J.format,G,"invalid renderbuffer format"),ye=G[J.format])}else typeof Se=="number"?(Ce=Se|0,typeof Z=="number"?ee=Z|0:ee=Ce):Se?y.raise("invalid arguments to renderbuffer constructor"):Ce=ee=1;if(y(Ce>0&&ee>0&&Ce<=A.maxRenderbufferSize&&ee<=A.maxRenderbufferSize,"invalid renderbuffer size"),!(Ce===L.width&&ee===L.height&&ye===L.format))return V.width=L.width=Ce,V.height=L.height=ee,L.format=ye,l.bindRenderbuffer(cn,L.renderbuffer),l.renderbufferStorage(cn,ye,Ce,ee),y(l.getError()===0,"invalid render buffer format"),q.profile&&(L.stats.size=Gc(L.format,L.width,L.height)),V.format=$[L.format],V}function fe(Se,Z){var Ce=Se|0,ee=Z|0||Ce;return Ce===L.width&&ee===L.height||(y(Ce>0&&ee>0&&Ce<=A.maxRenderbufferSize&&ee<=A.maxRenderbufferSize,"invalid renderbuffer size"),V.width=L.width=Ce,V.height=L.height=ee,l.bindRenderbuffer(cn,L.renderbuffer),l.renderbufferStorage(cn,L.format,Ce,ee),y(l.getError()===0,"invalid render buffer format"),q.profile&&(L.stats.size=Gc(L.format,L.width,L.height))),V}return V(ne,ve),V.resize=fe,V._reglType="renderbuffer",V._renderbuffer=L,q.profile&&(V.stats=L.stats),V.destroy=function(){L.decRef()},V}q.profile&&(B.getTotalRenderbufferSize=function(){var ne=0;return Object.keys(oe).forEach(function(ve){ne+=oe[ve].stats.size}),ne});function Ee(){Ar(oe).forEach(function(ne){ne.renderbuffer=l.createRenderbuffer(),l.bindRenderbuffer(cn,ne.renderbuffer),l.renderbufferStorage(cn,ne.format,ne.width,ne.height)}),l.bindRenderbuffer(cn,null)}return{create:he,clear:function(){Ar(oe).forEach(se)},restore:Ee}},Wr=36160,hs=36161,Cn=3553,Ba=34069,Bc=36064,Uc=36096,$c=36128,Vc=33306,jc=36053,q0=36054,K0=36055,Q0=36057,Z0=36061,J0=36193,eE=5121,tE=5126,zc=6407,Hc=6408,rE=6402,nE=[zc,Hc],vs=[];vs[Hc]=4,vs[zc]=3;var Ua=[];Ua[eE]=1,Ua[tE]=4,Ua[J0]=2;var iE=32854,aE=32855,oE=36194,sE=33189,uE=36168,Xc=34041,cE=35907,fE=34836,lE=34842,dE=34843,hE=[iE,aE,oE,cE,lE,dE,fE],ni={};ni[jc]="complete",ni[q0]="incomplete attachment",ni[Q0]="incomplete dimensions",ni[K0]="incomplete, missing attachment",ni[Z0]="unsupported";function vE(l,v,A,B,q,G){var $={cur:null,next:null,dirty:!1,setFBO:null},re=["rgba"],oe=["rgba4","rgb565","rgb5 a1"];v.ext_srgb&&oe.push("srgba"),v.ext_color_buffer_half_float&&oe.push("rgba16f","rgb16f"),v.webgl_color_buffer_float&&oe.push("rgba32f");var le=["uint8"];v.oes_texture_half_float&&le.push("half float","float16"),v.oes_texture_float&&le.push("float","float32");function se(be,de,Q){this.target=be,this.texture=de,this.renderbuffer=Q;var We=0,rt=0;de?(We=de.width,rt=de.height):Q&&(We=Q.width,rt=Q.height),this.width=We,this.height=rt}function he(be){be&&(be.texture&&be.texture._texture.decRef(),be.renderbuffer&&be.renderbuffer._renderbuffer.decRef())}function Ee(be,de,Q){if(!!be)if(be.texture){var We=be.texture._texture,rt=Math.max(1,We.width),Ne=Math.max(1,We.height);y(rt===de&&Ne===Q,"inconsistent width/height for supplied texture"),We.refCount+=1}else{var ut=be.renderbuffer._renderbuffer;y(ut.width===de&&ut.height===Q,"inconsistent width/height for renderbuffer"),ut.refCount+=1}}function ne(be,de){de&&(de.texture?l.framebufferTexture2D(Wr,be,de.target,de.texture._texture.texture,0):l.framebufferRenderbuffer(Wr,be,hs,de.renderbuffer._renderbuffer.renderbuffer))}function ve(be){var de=Cn,Q=null,We=null,rt=be;typeof be=="object"&&(rt=be.data,"target"in be&&(de=be.target|0)),y.type(rt,"function","invalid attachment data");var Ne=rt._reglType;return Ne==="texture2d"?(Q=rt,y(de===Cn)):Ne==="textureCube"?(Q=rt,y(de>=Ba&&de<Ba+6,"invalid cube map target")):Ne==="renderbuffer"?(We=rt,de=hs):y.raise("invalid regl object for attachment"),new se(de,Q,We)}function L(be,de,Q,We,rt){if(Q){var Ne=B.create2D({width:be,height:de,format:We,type:rt});return Ne._texture.refCount=0,new se(Cn,Ne,null)}else{var ut=q.create({width:be,height:de,format:We});return ut._renderbuffer.refCount=0,new se(hs,null,ut)}}function V(be){return be&&(be.texture||be.renderbuffer)}function fe(be,de,Q){be&&(be.texture?be.texture.resize(de,Q):be.renderbuffer&&be.renderbuffer.resize(de,Q),be.width=de,be.height=Q)}var Se=0,Z={};function Ce(){this.id=Se++,Z[this.id]=this,this.framebuffer=l.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function ee(be){be.colorAttachments.forEach(he),he(be.depthAttachment),he(be.stencilAttachment),he(be.depthStencilAttachment)}function ye(be){var de=be.framebuffer;y(de,"must not double destroy framebuffer"),l.deleteFramebuffer(de),be.framebuffer=null,G.framebufferCount--,delete Z[be.id]}function J(be){var de;l.bindFramebuffer(Wr,be.framebuffer);var Q=be.colorAttachments;for(de=0;de<Q.length;++de)ne(Bc+de,Q[de]);for(de=Q.length;de<A.maxColorAttachments;++de)l.framebufferTexture2D(Wr,Bc+de,Cn,null,0);l.framebufferTexture2D(Wr,Vc,Cn,null,0),l.framebufferTexture2D(Wr,Uc,Cn,null,0),l.framebufferTexture2D(Wr,$c,Cn,null,0),ne(Uc,be.depthAttachment),ne($c,be.stencilAttachment),ne(Vc,be.depthStencilAttachment);var We=l.checkFramebufferStatus(Wr);!l.isContextLost()&&We!==jc&&y.raise("framebuffer configuration not supported, status = "+ni[We]),l.bindFramebuffer(Wr,$.next?$.next.framebuffer:null),$.cur=$.next,l.getError()}function _e(be,de){var Q=new Ce;G.framebufferCount++;function We(Ne,ut){var Ze;y($.next!==Q,"can not update framebuffer which is currently in use");var ot=0,Et=0,zt=!0,Jt=!0,dt=null,Wt=!0,Pt="rgba",Ht="uint8",Yt=1,qt=null,er=null,nr=null,Bt=!1;if(typeof Ne=="number")ot=Ne|0,Et=ut|0||ot;else if(!Ne)ot=Et=1;else{y.type(Ne,"object","invalid arguments for framebuffer");var nt=Ne;if("shape"in nt){var ir=nt.shape;y(Array.isArray(ir)&&ir.length>=2,"invalid shape for framebuffer"),ot=ir[0],Et=ir[1]}else"radius"in nt&&(ot=Et=nt.radius),"width"in nt&&(ot=nt.width),"height"in nt&&(Et=nt.height);("color"in nt||"colors"in nt)&&(dt=nt.color||nt.colors,Array.isArray(dt)&&y(dt.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),dt||("colorCount"in nt&&(Yt=nt.colorCount|0,y(Yt>0,"invalid color buffer count")),"colorTexture"in nt&&(Wt=!!nt.colorTexture,Pt="rgba4"),"colorType"in nt&&(Ht=nt.colorType,Wt?(y(v.oes_texture_float||!(Ht==="float"||Ht==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),y(v.oes_texture_half_float||!(Ht==="half float"||Ht==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ht==="half float"||Ht==="float16"?(y(v.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Pt="rgba16f"):(Ht==="float"||Ht==="float32")&&(y(v.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Pt="rgba32f"),y.oneOf(Ht,le,"invalid color type")),"colorFormat"in nt&&(Pt=nt.colorFormat,re.indexOf(Pt)>=0?Wt=!0:oe.indexOf(Pt)>=0?Wt=!1:Wt?y.oneOf(nt.colorFormat,re,"invalid color format for texture"):y.oneOf(nt.colorFormat,oe,"invalid color format for renderbuffer"))),("depthTexture"in nt||"depthStencilTexture"in nt)&&(Bt=!!(nt.depthTexture||nt.depthStencilTexture),y(!Bt||v.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in nt&&(typeof nt.depth=="boolean"?zt=nt.depth:(qt=nt.depth,Jt=!1)),"stencil"in nt&&(typeof nt.stencil=="boolean"?Jt=nt.stencil:(er=nt.stencil,zt=!1)),"depthStencil"in nt&&(typeof nt.depthStencil=="boolean"?zt=Jt=nt.depthStencil:(nr=nt.depthStencil,zt=!1,Jt=!1))}var Tt=null,Ge=null,ft=null,_t=null;if(Array.isArray(dt))Tt=dt.map(ve);else if(dt)Tt=[ve(dt)];else for(Tt=new Array(Yt),Ze=0;Ze<Yt;++Ze)Tt[Ze]=L(ot,Et,Wt,Pt,Ht);y(v.webgl_draw_buffers||Tt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),y(Tt.length<=A.maxColorAttachments,"too many color attachments, not supported"),ot=ot||Tt[0].width,Et=Et||Tt[0].height,qt?Ge=ve(qt):zt&&!Jt&&(Ge=L(ot,Et,Bt,"depth","uint32")),er?ft=ve(er):Jt&&!zt&&(ft=L(ot,Et,!1,"stencil","uint8")),nr?_t=ve(nr):!qt&&!er&&Jt&&zt&&(_t=L(ot,Et,Bt,"depth stencil","depth stencil")),y(!!qt+!!er+!!nr<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ut=null;for(Ze=0;Ze<Tt.length;++Ze)if(Ee(Tt[Ze],ot,Et),y(!Tt[Ze]||Tt[Ze].texture&&nE.indexOf(Tt[Ze].texture._texture.format)>=0||Tt[Ze].renderbuffer&&hE.indexOf(Tt[Ze].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ze+" is invalid"),Tt[Ze]&&Tt[Ze].texture){var Br=vs[Tt[Ze].texture._texture.format]*Ua[Tt[Ze].texture._texture.type];Ut===null?Ut=Br:y(Ut===Br,"all color attachments much have the same number of bits per pixel.")}return Ee(Ge,ot,Et),y(!Ge||Ge.texture&&Ge.texture._texture.format===rE||Ge.renderbuffer&&Ge.renderbuffer._renderbuffer.format===sE,"invalid depth attachment for framebuffer object"),Ee(ft,ot,Et),y(!ft||ft.renderbuffer&&ft.renderbuffer._renderbuffer.format===uE,"invalid stencil attachment for framebuffer object"),Ee(_t,ot,Et),y(!_t||_t.texture&&_t.texture._texture.format===Xc||_t.renderbuffer&&_t.renderbuffer._renderbuffer.format===Xc,"invalid depth-stencil attachment for framebuffer object"),ee(Q),Q.width=ot,Q.height=Et,Q.colorAttachments=Tt,Q.depthAttachment=Ge,Q.stencilAttachment=ft,Q.depthStencilAttachment=_t,We.color=Tt.map(V),We.depth=V(Ge),We.stencil=V(ft),We.depthStencil=V(_t),We.width=Q.width,We.height=Q.height,J(Q),We}function rt(Ne,ut){y($.next!==Q,"can not resize a framebuffer which is currently in use");var Ze=Math.max(Ne|0,1),ot=Math.max(ut|0||Ze,1);if(Ze===Q.width&&ot===Q.height)return We;for(var Et=Q.colorAttachments,zt=0;zt<Et.length;++zt)fe(Et[zt],Ze,ot);return fe(Q.depthAttachment,Ze,ot),fe(Q.stencilAttachment,Ze,ot),fe(Q.depthStencilAttachment,Ze,ot),Q.width=We.width=Ze,Q.height=We.height=ot,J(Q),We}return We(be,de),n(We,{resize:rt,_reglType:"framebuffer",_framebuffer:Q,destroy:function(){ye(Q),ee(Q)},use:function(Ne){$.setFBO({framebuffer:We},Ne)}})}function De(be){var de=Array(6);function Q(rt){var Ne;y(de.indexOf($.next)<0,"can not update framebuffer which is currently in use");var ut={color:null},Ze=0,ot=null,Et="rgba",zt="uint8",Jt=1;if(typeof rt=="number")Ze=rt|0;else if(!rt)Ze=1;else{y.type(rt,"object","invalid arguments for framebuffer");var dt=rt;if("shape"in dt){var Wt=dt.shape;y(Array.isArray(Wt)&&Wt.length>=2,"invalid shape for framebuffer"),y(Wt[0]===Wt[1],"cube framebuffer must be square"),Ze=Wt[0]}else"radius"in dt&&(Ze=dt.radius|0),"width"in dt?(Ze=dt.width|0,"height"in dt&&y(dt.height===Ze,"must be square")):"height"in dt&&(Ze=dt.height|0);("color"in dt||"colors"in dt)&&(ot=dt.color||dt.colors,Array.isArray(ot)&&y(ot.length===1||v.webgl_draw_buffers,"multiple render targets not supported")),ot||("colorCount"in dt&&(Jt=dt.colorCount|0,y(Jt>0,"invalid color buffer count")),"colorType"in dt&&(y.oneOf(dt.colorType,le,"invalid color type"),zt=dt.colorType),"colorFormat"in dt&&(Et=dt.colorFormat,y.oneOf(dt.colorFormat,re,"invalid color format for texture"))),"depth"in dt&&(ut.depth=dt.depth),"stencil"in dt&&(ut.stencil=dt.stencil),"depthStencil"in dt&&(ut.depthStencil=dt.depthStencil)}var Pt;if(ot)if(Array.isArray(ot))for(Pt=[],Ne=0;Ne<ot.length;++Ne)Pt[Ne]=ot[Ne];else Pt=[ot];else{Pt=Array(Jt);var Ht={radius:Ze,format:Et,type:zt};for(Ne=0;Ne<Jt;++Ne)Pt[Ne]=B.createCube(Ht)}for(ut.color=Array(Pt.length),Ne=0;Ne<Pt.length;++Ne){var Yt=Pt[Ne];y(typeof Yt=="function"&&Yt._reglType==="textureCube","invalid cube map"),Ze=Ze||Yt.width,y(Yt.width===Ze&&Yt.height===Ze,"invalid cube map shape"),ut.color[Ne]={target:Ba,data:Pt[Ne]}}for(Ne=0;Ne<6;++Ne){for(var qt=0;qt<Pt.length;++qt)ut.color[qt].target=Ba+Ne;Ne>0&&(ut.depth=de[0].depth,ut.stencil=de[0].stencil,ut.depthStencil=de[0].depthStencil),de[Ne]?de[Ne](ut):de[Ne]=_e(ut)}return n(Q,{width:Ze,height:Ze,color:Pt})}function We(rt){var Ne,ut=rt|0;if(y(ut>0&&ut<=A.maxCubeMapSize,"invalid radius for cube fbo"),ut===Q.width)return Q;var Ze=Q.color;for(Ne=0;Ne<Ze.length;++Ne)Ze[Ne].resize(ut);for(Ne=0;Ne<6;++Ne)de[Ne].resize(ut);return Q.width=Q.height=ut,Q}return Q(be),n(Q,{faces:de,resize:We,_reglType:"framebufferCube",destroy:function(){de.forEach(function(rt){rt.destroy()})}})}function Ke(){$.cur=null,$.next=null,$.dirty=!0,Ar(Z).forEach(function(be){be.framebuffer=l.createFramebuffer(),J(be)})}return n($,{getFramebuffer:function(be){if(typeof be=="function"&&be._reglType==="framebuffer"){var de=be._framebuffer;if(de instanceof Ce)return de}return null},create:_e,createCube:De,clear:function(){Ar(Z).forEach(ye)},restore:Ke})}var pE=5126,Wc=34962;function ps(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=pE,this.offset=0,this.stride=0,this.divisor=0}function mE(l,v,A,B,q){for(var G=A.maxAttributes,$=new Array(G),re=0;re<G;++re)$[re]=new ps;var oe=0,le={},se={Record:ps,scope:{},state:$,currentVAO:null,targetVAO:null,restore:Ee()?Z:function(){},createVAO:Ce,getVAO:ve,destroyBuffer:he,setVAO:Ee()?L:V,clear:Ee()?fe:function(){}};function he(ee){for(var ye=0;ye<$.length;++ye){var J=$[ye];J.buffer===ee&&(l.disableVertexAttribArray(ye),J.buffer=null)}}function Ee(){return v.oes_vertex_array_object}function ne(){return v.angle_instanced_arrays}function ve(ee){return typeof ee=="function"&&ee._vao?ee._vao:null}function L(ee){if(ee!==se.currentVAO){var ye=Ee();ee?ye.bindVertexArrayOES(ee.vao):ye.bindVertexArrayOES(null),se.currentVAO=ee}}function V(ee){if(ee!==se.currentVAO){if(ee)ee.bindAttrs();else for(var ye=ne(),J=0;J<$.length;++J){var _e=$[J];_e.buffer?(l.enableVertexAttribArray(J),l.vertexAttribPointer(J,_e.size,_e.type,_e.normalized,_e.stride,_e.offfset),ye&&_e.divisor&&ye.vertexAttribDivisorANGLE(J,_e.divisor)):(l.disableVertexAttribArray(J),l.vertexAttrib4f(J,_e.x,_e.y,_e.z,_e.w))}se.currentVAO=ee}}function fe(){Ar(le).forEach(function(ee){ee.destroy()})}function Se(){this.id=++oe,this.attributes=[];var ee=Ee();ee?this.vao=ee.createVertexArrayOES():this.vao=null,le[this.id]=this,this.buffers=[]}Se.prototype.bindAttrs=function(){for(var ee=ne(),ye=this.attributes,J=0;J<ye.length;++J){var _e=ye[J];_e.buffer?(l.enableVertexAttribArray(J),l.bindBuffer(Wc,_e.buffer.buffer),l.vertexAttribPointer(J,_e.size,_e.type,_e.normalized,_e.stride,_e.offset),ee&&_e.divisor&&ee.vertexAttribDivisorANGLE(J,_e.divisor)):(l.disableVertexAttribArray(J),l.vertexAttrib4f(J,_e.x,_e.y,_e.z,_e.w))}for(var De=ye.length;De<G;++De)l.disableVertexAttribArray(De)},Se.prototype.refresh=function(){var ee=Ee();ee&&(ee.bindVertexArrayOES(this.vao),this.bindAttrs(),se.currentVAO=this)},Se.prototype.destroy=function(){if(this.vao){var ee=Ee();this===se.currentVAO&&(se.currentVAO=null,ee.bindVertexArrayOES(null)),ee.deleteVertexArrayOES(this.vao),this.vao=null}le[this.id]&&(delete le[this.id],B.vaoCount-=1)};function Z(){var ee=Ee();ee&&Ar(le).forEach(function(ye){ye.refresh()})}function Ce(ee){var ye=new Se;B.vaoCount+=1;function J(_e){y(Array.isArray(_e),"arguments to vertex array constructor must be an array"),y(_e.length<G,"too many attributes"),y(_e.length>0,"must specify at least one attribute");var De={},Ke=ye.attributes;Ke.length=_e.length;for(var be=0;be<_e.length;++be){var de=_e[be],Q=Ke[be]=new ps,We=de.data||de;if(Array.isArray(We)||r(We)||Pr(We)){var rt;ye.buffers[be]&&(rt=ye.buffers[be],r(We)&&rt._buffer.byteLength>=We.byteLength?rt.subdata(We):(rt.destroy(),ye.buffers[be]=null)),ye.buffers[be]||(rt=ye.buffers[be]=q.create(de,Wc,!1,!0)),Q.buffer=q.getBuffer(rt),Q.size=Q.buffer.dimension|0,Q.normalized=!1,Q.type=Q.buffer.dtype,Q.offset=0,Q.stride=0,Q.divisor=0,Q.state=1,De[be]=1}else q.getBuffer(de)?(Q.buffer=q.getBuffer(de),Q.size=Q.buffer.dimension|0,Q.normalized=!1,Q.type=Q.buffer.dtype,Q.offset=0,Q.stride=0,Q.divisor=0,Q.state=1):q.getBuffer(de.buffer)?(Q.buffer=q.getBuffer(de.buffer),Q.size=(+de.size||Q.buffer.dimension)|0,Q.normalized=!!de.normalized||!1,"type"in de?(y.parameter(de.type,An,"invalid buffer type"),Q.type=An[de.type]):Q.type=Q.buffer.dtype,Q.offset=(de.offset||0)|0,Q.stride=(de.stride||0)|0,Q.divisor=(de.divisor||0)|0,Q.state=1,y(Q.size>=1&&Q.size<=4,"size must be between 1 and 4"),y(Q.offset>=0,"invalid offset"),y(Q.stride>=0&&Q.stride<=255,"stride must be between 0 and 255"),y(Q.divisor>=0,"divisor must be positive"),y(!Q.divisor||!!v.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in de?(y(be>0,"first attribute must not be a constant"),Q.x=+de.x||0,Q.y=+de.y||0,Q.z=+de.z||0,Q.w=+de.w||0,Q.state=2):y(!1,"invalid attribute spec for location "+be)}for(var Ne=0;Ne<ye.buffers.length;++Ne)!De[Ne]&&ye.buffers[Ne]&&(ye.buffers[Ne].destroy(),ye.buffers[Ne]=null);return ye.refresh(),J}return J.destroy=function(){for(var _e=0;_e<ye.buffers.length;++_e)ye.buffers[_e]&&ye.buffers[_e].destroy();ye.buffers.length=0,ye.destroy()},J._vao=ye,J._reglType="vao",J(ee)}return se}var Yc=35632,yE=35633,_E=35718,EE=35721;function bE(l,v,A,B){var q={},G={};function $(L,V,fe,Se){this.name=L,this.id=V,this.location=fe,this.info=Se}function re(L,V){for(var fe=0;fe<L.length;++fe)if(L[fe].id===V.id){L[fe].location=V.location;return}L.push(V)}function oe(L,V,fe){var Se=L===Yc?q:G,Z=Se[V];if(!Z){var Ce=v.str(V);Z=l.createShader(L),l.shaderSource(Z,Ce),l.compileShader(Z),y.shaderError(l,Z,Ce,L,fe),Se[V]=Z}return Z}var le={},se=[],he=0;function Ee(L,V){this.id=he++,this.fragId=L,this.vertId=V,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,B.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function ne(L,V,fe){var Se,Z,Ce=oe(Yc,L.fragId),ee=oe(yE,L.vertId),ye=L.program=l.createProgram();if(l.attachShader(ye,Ce),l.attachShader(ye,ee),fe)for(Se=0;Se<fe.length;++Se){var J=fe[Se];l.bindAttribLocation(ye,J[0],J[1])}l.linkProgram(ye),y.linkError(l,ye,v.str(L.fragId),v.str(L.vertId),V);var _e=l.getProgramParameter(ye,_E);B.profile&&(L.stats.uniformsCount=_e);var De=L.uniforms;for(Se=0;Se<_e;++Se)if(Z=l.getActiveUniform(ye,Se),Z)if(Z.size>1)for(var Ke=0;Ke<Z.size;++Ke){var be=Z.name.replace("[0]","["+Ke+"]");re(De,new $(be,v.id(be),l.getUniformLocation(ye,be),Z))}else re(De,new $(Z.name,v.id(Z.name),l.getUniformLocation(ye,Z.name),Z));var de=l.getProgramParameter(ye,EE);B.profile&&(L.stats.attributesCount=de);var Q=L.attributes;for(Se=0;Se<de;++Se)Z=l.getActiveAttrib(ye,Se),Z&&re(Q,new $(Z.name,v.id(Z.name),l.getAttribLocation(ye,Z.name),Z))}B.profile&&(A.getMaxUniformsCount=function(){var L=0;return se.forEach(function(V){V.stats.uniformsCount>L&&(L=V.stats.uniformsCount)}),L},A.getMaxAttributesCount=function(){var L=0;return se.forEach(function(V){V.stats.attributesCount>L&&(L=V.stats.attributesCount)}),L});function ve(){q={},G={};for(var L=0;L<se.length;++L)ne(se[L],null,se[L].attributes.map(function(V){return[V.location,V.name]}))}return{clear:function(){var L=l.deleteShader.bind(l);Ar(q).forEach(L),q={},Ar(G).forEach(L),G={},se.forEach(function(V){l.deleteProgram(V.program)}),se.length=0,le={},A.shaderCount=0},program:function(L,V,fe,Se){y.command(L>=0,"missing vertex shader",fe),y.command(V>=0,"missing fragment shader",fe);var Z=le[V];Z||(Z=le[V]={});var Ce=Z[L];if(Ce&&(Ce.refCount++,!Se))return Ce;var ee=new Ee(V,L);return A.shaderCount++,ne(ee,fe,Se),Ce||(Z[L]=ee),se.push(ee),n(ee,{destroy:function(){if(ee.refCount--,ee.refCount<=0){l.deleteProgram(ee.program);var ye=se.indexOf(ee);se.splice(ye,1),A.shaderCount--}Z[ee.vertId].refCount<=0&&(l.deleteShader(G[ee.vertId]),delete G[ee.vertId],delete le[ee.fragId][ee.vertId]),Object.keys(le[ee.fragId]).length||(l.deleteShader(q[ee.fragId]),delete q[ee.fragId],delete le[ee.fragId])}})},restore:ve,shader:oe,frag:-1,vert:-1}}var gE=6408,Li=5121,TE=3333,$a=5126;function AE(l,v,A,B,q,G,$){function re(se){var he;v.next===null?(y(q.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),he=Li):(y(v.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),he=v.next.colorAttachments[0].texture._texture.type,G.oes_texture_float?(y(he===Li||he===$a,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),he===$a&&y($.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):y(he===Li,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Ee=0,ne=0,ve=B.framebufferWidth,L=B.framebufferHeight,V=null;r(se)?V=se:se&&(y.type(se,"object","invalid arguments to regl.read()"),Ee=se.x|0,ne=se.y|0,y(Ee>=0&&Ee<B.framebufferWidth,"invalid x offset for regl.read"),y(ne>=0&&ne<B.framebufferHeight,"invalid y offset for regl.read"),ve=(se.width||B.framebufferWidth-Ee)|0,L=(se.height||B.framebufferHeight-ne)|0,V=se.data||null),V&&(he===Li?y(V instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):he===$a&&y(V instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),y(ve>0&&ve+Ee<=B.framebufferWidth,"invalid width for read pixels"),y(L>0&&L+ne<=B.framebufferHeight,"invalid height for read pixels"),A();var fe=ve*L*4;return V||(he===Li?V=new Uint8Array(fe):he===$a&&(V=V||new Float32Array(fe))),y.isTypedArray(V,"data buffer for regl.read() must be a typedarray"),y(V.byteLength>=fe,"data buffer for regl.read() too small"),l.pixelStorei(TE,4),l.readPixels(Ee,ne,ve,L,gE,he,V),V}function oe(se){var he;return v.setFBO({framebuffer:se.framebuffer},function(){he=re(se)}),he}function le(se){return!se||!("framebuffer"in se)?re(se):oe(se)}return le}function ii(l){return Array.prototype.slice.call(l)}function ai(l){return ii(l).join("")}function SE(){var l=0,v=[],A=[];function B(he){for(var Ee=0;Ee<A.length;++Ee)if(A[Ee]===he)return v[Ee];var ne="g"+l++;return v.push(ne),A.push(he),ne}function q(){var he=[];function Ee(){he.push.apply(he,ii(arguments))}var ne=[];function ve(){var L="v"+l++;return ne.push(L),arguments.length>0&&(he.push(L,"="),he.push.apply(he,ii(arguments)),he.push(";")),L}return n(Ee,{def:ve,toString:function(){return ai([ne.length>0?"var "+ne.join(",")+";":"",ai(he)])}})}function G(){var he=q(),Ee=q(),ne=he.toString,ve=Ee.toString;function L(V,fe){Ee(V,fe,"=",he.def(V,fe),";")}return n(function(){he.apply(he,ii(arguments))},{def:he.def,entry:he,exit:Ee,save:L,set:function(V,fe,Se){L(V,fe),he(V,fe,"=",Se,";")},toString:function(){return ne()+ve()}})}function $(){var he=ai(arguments),Ee=G(),ne=G(),ve=Ee.toString,L=ne.toString;return n(Ee,{then:function(){return Ee.apply(Ee,ii(arguments)),this},else:function(){return ne.apply(ne,ii(arguments)),this},toString:function(){var V=L();return V&&(V="else{"+V+"}"),ai(["if(",he,"){",ve(),"}",V])}})}var re=q(),oe={};function le(he,Ee){var ne=[];function ve(){var Z="a"+ne.length;return ne.push(Z),Z}Ee=Ee||0;for(var L=0;L<Ee;++L)ve();var V=G(),fe=V.toString,Se=oe[he]=n(V,{arg:ve,toString:function(){return ai(["function(",ne.join(),"){",fe(),"}"])}});return Se}function se(){var he=['"use strict";',re,"return {"];Object.keys(oe).forEach(function(ve){he.push('"',ve,'":',oe[ve].toString(),",")}),he.push("}");var Ee=ai(he).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),ne=Function.apply(null,v.concat(Ee));return ne.apply(null,A)}return{global:re,link:B,block:q,proc:le,scope:G,cond:$,compile:se}}var oi="xyzw".split(""),qc=5121,si=1,ms=2,ys=0,_s=1,Es=2,bs=3,Va=4,Kc=5,Qc=6,Zc="dither",Jc="blend.enable",ef="blend.color",gs="blend.equation",Ts="blend.func",tf="depth.enable",rf="depth.func",nf="depth.range",af="depth.mask",As="colorMask",of="cull.enable",sf="cull.face",Ss="frontFace",ws="lineWidth",uf="polygonOffset.enable",Rs="polygonOffset.offset",cf="sample.alpha",ff="sample.enable",Cs="sample.coverage",lf="stencil.enable",df="stencil.mask",xs="stencil.func",Ns="stencil.opFront",Mi="stencil.opBack",hf="scissor.enable",ja="scissor.box",Yr="viewport",ki="profile",xn="framebuffer",Di="vert",Fi="frag",Nn="elements",On="primitive",In="count",za="offset",Ha="instances",Gi="vao",Os="Width",Is="Height",ui=xn+Os,ci=xn+Is,wE=Yr+Os,RE=Yr+Is,vf="drawingBuffer",pf=vf+Os,mf=vf+Is,CE=[Ts,gs,xs,Ns,Mi,Cs,Yr,ja,Rs],fi=34962,xE=34963,NE=35632,OE=35633,yf=3553,IE=34067,PE=2884,LE=3042,ME=3024,kE=2960,DE=2929,FE=3089,GE=32823,BE=32926,UE=32928,Ps=5126,Xa=35664,Wa=35665,Ya=35666,Ls=5124,qa=35667,Ka=35668,Qa=35669,Ms=35670,Za=35671,Ja=35672,eo=35673,Bi=35674,Ui=35675,$i=35676,Vi=35678,ji=35680,_f=4,zi=1028,Pn=1029,Ef=2304,ks=2305,$E=32775,VE=32776,jE=519,fn=7680,bf=0,gf=1,Tf=32774,zE=513,Af=36160,HE=36064,Gr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Sf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],li={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ln={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},wf={frag:NE,vert:OE},Ds={cw:Ef,ccw:ks};function to(l){return Array.isArray(l)||r(l)||Pr(l)}function Rf(l){return l.sort(function(v,A){return v===Yr?-1:A===Yr?1:v<A?-1:1})}function vr(l,v,A,B){this.thisDep=l,this.contextDep=v,this.propDep=A,this.append=B}function dn(l){return l&&!(l.thisDep||l.contextDep||l.propDep)}function jt(l){return new vr(!1,!1,!1,l)}function br(l,v){var A=l.type;if(A===ys){var B=l.data.length;return new vr(!0,B>=1,B>=2,v)}else if(A===Va){var q=l.data;return new vr(q.thisDep,q.contextDep,q.propDep,v)}else{if(A===Kc)return new vr(!1,!1,!1,v);if(A===Qc){for(var G=!1,$=!1,re=!1,oe=0;oe<l.data.length;++oe){var le=l.data[oe];if(le.type===_s)re=!0;else if(le.type===Es)$=!0;else if(le.type===bs)G=!0;else if(le.type===ys){G=!0;var se=le.data;se>=1&&($=!0),se>=2&&(re=!0)}else le.type===Va&&(G=G||le.data.thisDep,$=$||le.data.contextDep,re=re||le.data.propDep)}return new vr(G,$,re,v)}else return new vr(A===bs,A===Es,A===_s,v)}}var Cf=new vr(!1,!1,!1,function(){});function XE(l,v,A,B,q,G,$,re,oe,le,se,he,Ee,ne,ve){var L=le.Record,V={add:32774,subtract:32778,"reverse subtract":32779};A.ext_blend_minmax&&(V.min=$E,V.max=VE);var fe=A.angle_instanced_arrays,Se=A.webgl_draw_buffers,Z={dirty:!0,profile:ve.profile},Ce={},ee=[],ye={},J={};function _e(_){return _.replace(".","_")}function De(_,h,w){var P=_e(_);ee.push(_),Ce[P]=Z[P]=!!w,ye[P]=h}function Ke(_,h,w){var P=_e(_);ee.push(_),Array.isArray(w)?(Z[P]=w.slice(),Ce[P]=w.slice()):Z[P]=Ce[P]=w,J[P]=h}De(Zc,ME),De(Jc,LE),Ke(ef,"blendColor",[0,0,0,0]),Ke(gs,"blendEquationSeparate",[Tf,Tf]),Ke(Ts,"blendFuncSeparate",[gf,bf,gf,bf]),De(tf,DE,!0),Ke(rf,"depthFunc",zE),Ke(nf,"depthRange",[0,1]),Ke(af,"depthMask",!0),Ke(As,As,[!0,!0,!0,!0]),De(of,PE),Ke(sf,"cullFace",Pn),Ke(Ss,Ss,ks),Ke(ws,ws,1),De(uf,GE),Ke(Rs,"polygonOffset",[0,0]),De(cf,BE),De(ff,UE),Ke(Cs,"sampleCoverage",[1,!1]),De(lf,kE),Ke(df,"stencilMask",-1),Ke(xs,"stencilFunc",[jE,0,-1]),Ke(Ns,"stencilOpSeparate",[zi,fn,fn,fn]),Ke(Mi,"stencilOpSeparate",[Pn,fn,fn,fn]),De(hf,FE),Ke(ja,"scissor",[0,0,l.drawingBufferWidth,l.drawingBufferHeight]),Ke(Yr,Yr,[0,0,l.drawingBufferWidth,l.drawingBufferHeight]);var be={gl:l,context:Ee,strings:v,next:Ce,current:Z,draw:he,elements:G,buffer:q,shader:se,attributes:le.state,vao:le,uniforms:oe,framebuffer:re,extensions:A,timer:ne,isBufferArgs:to},de={primTypes:Kn,compareFuncs:li,blendFuncs:Gr,blendEquations:V,stencilOps:ln,glTypes:An,orientationType:Ds};y.optional(function(){be.isArrayLike=Gt}),Se&&(de.backBuffer=[Pn],de.drawBuffer=Er(B.maxDrawbuffers,function(_){return _===0?[0]:Er(_,function(h){return HE+h})}));var Q=0;function We(){var _=SE(),h=_.link,w=_.global;_.id=Q++,_.batchId="0";var P=h(be),k=_.shared={props:"a0"};Object.keys(be).forEach(function(S){k[S]=w.def(P,".",S)}),y.optional(function(){_.CHECK=h(y),_.commandStr=y.guessCommand(),_.command=h(_.commandStr),_.assert=function(S,m,I){S("if(!(",m,"))",this.CHECK,".commandRaise(",h(I),",",this.command,");")},de.invalidBlendCombinations=Sf});var C=_.next={},R=_.current={};Object.keys(J).forEach(function(S){Array.isArray(Z[S])&&(C[S]=w.def(k.next,".",S),R[S]=w.def(k.current,".",S))});var N=_.constants={};Object.keys(de).forEach(function(S){N[S]=w.def(JSON.stringify(de[S]))}),_.invoke=function(S,m){switch(m.type){case ys:var I=["this",k.context,k.props,_.batchId];return S.def(h(m.data),".call(",I.slice(0,Math.max(m.data.length+1,4)),")");case _s:return S.def(k.props,m.data);case Es:return S.def(k.context,m.data);case bs:return S.def("this",m.data);case Va:return m.data.append(_,S),m.data.ref;case Kc:return m.data.toString();case Qc:return m.data.map(function(D){return _.invoke(S,D)})}},_.attribCache={};var E={};return _.scopeAttrib=function(S){var m=v.id(S);if(m in E)return E[m];var I=le.scope[m];I||(I=le.scope[m]=new L);var D=E[m]=h(I);return D},_}function rt(_){var h=_.static,w=_.dynamic,P;if(ki in h){var k=!!h[ki];P=jt(function(R,N){return k}),P.enable=k}else if(ki in w){var C=w[ki];P=br(C,function(R,N){return R.invoke(N,C)})}return P}function Ne(_,h){var w=_.static,P=_.dynamic;if(xn in w){var k=w[xn];return k?(k=re.getFramebuffer(k),y.command(k,"invalid framebuffer object"),jt(function(R,N){var E=R.link(k),S=R.shared;N.set(S.framebuffer,".next",E);var m=S.context;return N.set(m,"."+ui,E+".width"),N.set(m,"."+ci,E+".height"),E})):jt(function(R,N){var E=R.shared;N.set(E.framebuffer,".next","null");var S=E.context;return N.set(S,"."+ui,S+"."+pf),N.set(S,"."+ci,S+"."+mf),"null"})}else if(xn in P){var C=P[xn];return br(C,function(R,N){var E=R.invoke(N,C),S=R.shared,m=S.framebuffer,I=N.def(m,".getFramebuffer(",E,")");y.optional(function(){R.assert(N,"!"+E+"||"+I,"invalid framebuffer object")}),N.set(m,".next",I);var D=S.context;return N.set(D,"."+ui,I+"?"+I+".width:"+D+"."+pf),N.set(D,"."+ci,I+"?"+I+".height:"+D+"."+mf),I})}else return null}function ut(_,h,w){var P=_.static,k=_.dynamic;function C(E){if(E in P){var S=P[E];y.commandType(S,"object","invalid "+E,w.commandStr);var m=!0,I=S.x|0,D=S.y|0,W,K;return"width"in S?(W=S.width|0,y.command(W>=0,"invalid "+E,w.commandStr)):m=!1,"height"in S?(K=S.height|0,y.command(K>=0,"invalid "+E,w.commandStr)):m=!1,new vr(!m&&h&&h.thisDep,!m&&h&&h.contextDep,!m&&h&&h.propDep,function(ke,it){var Oe=ke.shared.context,Ue=W;"width"in S||(Ue=it.def(Oe,".",ui,"-",I));var Je=K;return"height"in S||(Je=it.def(Oe,".",ci,"-",D)),[I,D,Ue,Je]})}else if(E in k){var H=k[E],ue=br(H,function(ke,it){var Oe=ke.invoke(it,H);y.optional(function(){ke.assert(it,Oe+"&&typeof "+Oe+'==="object"',"invalid "+E)});var Ue=ke.shared.context,Je=it.def(Oe,".x|0"),bt=it.def(Oe,".y|0"),Ft=it.def('"width" in ',Oe,"?",Oe,".width|0:","(",Ue,".",ui,"-",Je,")"),pr=it.def('"height" in ',Oe,"?",Oe,".height|0:","(",Ue,".",ci,"-",bt,")");return y.optional(function(){ke.assert(it,Ft+">=0&&"+pr+">=0","invalid "+E)}),[Je,bt,Ft,pr]});return h&&(ue.thisDep=ue.thisDep||h.thisDep,ue.contextDep=ue.contextDep||h.contextDep,ue.propDep=ue.propDep||h.propDep),ue}else return h?new vr(h.thisDep,h.contextDep,h.propDep,function(ke,it){var Oe=ke.shared.context;return[0,0,it.def(Oe,".",ui),it.def(Oe,".",ci)]}):null}var R=C(Yr);if(R){var N=R;R=new vr(R.thisDep,R.contextDep,R.propDep,function(E,S){var m=N.append(E,S),I=E.shared.context;return S.set(I,"."+wE,m[2]),S.set(I,"."+RE,m[3]),m})}return{viewport:R,scissor_box:C(ja)}}function Ze(_,h){var w=_.static,P=typeof w[Fi]=="string"&&typeof w[Di]=="string";if(P){if(Object.keys(h.dynamic).length>0)return null;var k=h.static,C=Object.keys(k);if(C.length>0&&typeof k[C[0]]=="number"){for(var R=[],N=0;N<C.length;++N)y(typeof k[C[N]]=="number","must specify all vertex attribute locations when using vaos"),R.push([k[C[N]]|0,C[N]]);return R}}return null}function ot(_,h,w){var P=_.static,k=_.dynamic;function C(m){if(m in P){var I=v.id(P[m]);y.optional(function(){se.shader(wf[m],I,y.guessCommand())});var D=jt(function(){return I});return D.id=I,D}else if(m in k){var W=k[m];return br(W,function(K,H){var ue=K.invoke(H,W),ke=H.def(K.shared.strings,".id(",ue,")");return y.optional(function(){H(K.shared.shader,".shader(",wf[m],",",ke,",",K.command,");")}),ke})}return null}var R=C(Fi),N=C(Di),E=null,S;return dn(R)&&dn(N)?(E=se.program(N.id,R.id,null,w),S=jt(function(m,I){return m.link(E)})):S=new vr(R&&R.thisDep||N&&N.thisDep,R&&R.contextDep||N&&N.contextDep,R&&R.propDep||N&&N.propDep,function(m,I){var D=m.shared.shader,W;R?W=R.append(m,I):W=I.def(D,".",Fi);var K;N?K=N.append(m,I):K=I.def(D,".",Di);var H=D+".program("+K+","+W;return y.optional(function(){H+=","+m.command}),I.def(H+")")}),{frag:R,vert:N,progVar:S,program:E}}function Et(_,h){var w=_.static,P=_.dynamic;function k(){if(Nn in w){var m=w[Nn];to(m)?m=G.getElements(G.create(m,!0)):m&&(m=G.getElements(m),y.command(m,"invalid elements",h.commandStr));var I=jt(function(W,K){if(m){var H=W.link(m);return W.ELEMENTS=H,H}return W.ELEMENTS=null,null});return I.value=m,I}else if(Nn in P){var D=P[Nn];return br(D,function(W,K){var H=W.shared,ue=H.isBufferArgs,ke=H.elements,it=W.invoke(K,D),Oe=K.def("null"),Ue=K.def(ue,"(",it,")"),Je=W.cond(Ue).then(Oe,"=",ke,".createStream(",it,");").else(Oe,"=",ke,".getElements(",it,");");return y.optional(function(){W.assert(Je.else,"!"+it+"||"+Oe,"invalid elements")}),K.entry(Je),K.exit(W.cond(Ue).then(ke,".destroyStream(",Oe,");")),W.ELEMENTS=Oe,Oe})}return null}var C=k();function R(){if(On in w){var m=w[On];return y.commandParameter(m,Kn,"invalid primitve",h.commandStr),jt(function(D,W){return Kn[m]})}else if(On in P){var I=P[On];return br(I,function(D,W){var K=D.constants.primTypes,H=D.invoke(W,I);return y.optional(function(){D.assert(W,H+" in "+K,"invalid primitive, must be one of "+Object.keys(Kn))}),W.def(K,"[",H,"]")})}else if(C)return dn(C)?C.value?jt(function(D,W){return W.def(D.ELEMENTS,".primType")}):jt(function(){return _f}):new vr(C.thisDep,C.contextDep,C.propDep,function(D,W){var K=D.ELEMENTS;return W.def(K,"?",K,".primType:",_f)});return null}function N(m,I){if(m in w){var D=w[m]|0;return y.command(!I||D>=0,"invalid "+m,h.commandStr),jt(function(K,H){return I&&(K.OFFSET=D),D})}else if(m in P){var W=P[m];return br(W,function(K,H){var ue=K.invoke(H,W);return I&&(K.OFFSET=ue,y.optional(function(){K.assert(H,ue+">=0","invalid "+m)})),ue})}else if(I&&C)return jt(function(K,H){return K.OFFSET="0",0});return null}var E=N(za,!0);function S(){if(In in w){var m=w[In]|0;return y.command(typeof m=="number"&&m>=0,"invalid vertex count",h.commandStr),jt(function(){return m})}else if(In in P){var I=P[In];return br(I,function(K,H){var ue=K.invoke(H,I);return y.optional(function(){K.assert(H,"typeof "+ue+'==="number"&&'+ue+">=0&&"+ue+"===("+ue+"|0)","invalid vertex count")}),ue})}else if(C)if(dn(C)){if(C)return E?new vr(E.thisDep,E.contextDep,E.propDep,function(K,H){var ue=H.def(K.ELEMENTS,".vertCount-",K.OFFSET);return y.optional(function(){K.assert(H,ue+">=0","invalid vertex offset/element buffer too small")}),ue}):jt(function(K,H){return H.def(K.ELEMENTS,".vertCount")});var D=jt(function(){return-1});return y.optional(function(){D.MISSING=!0}),D}else{var W=new vr(C.thisDep||E.thisDep,C.contextDep||E.contextDep,C.propDep||E.propDep,function(K,H){var ue=K.ELEMENTS;return K.OFFSET?H.def(ue,"?",ue,".vertCount-",K.OFFSET,":-1"):H.def(ue,"?",ue,".vertCount:-1")});return y.optional(function(){W.DYNAMIC=!0}),W}return null}return{elements:C,primitive:R(),count:S(),instances:N(Ha,!1),offset:E}}function zt(_,h){var w=_.static,P=_.dynamic,k={};return ee.forEach(function(C){var R=_e(C);function N(E,S){if(C in w){var m=E(w[C]);k[R]=jt(function(){return m})}else if(C in P){var I=P[C];k[R]=br(I,function(D,W){return S(D,W,D.invoke(W,I))})}}switch(C){case of:case Jc:case Zc:case lf:case tf:case hf:case uf:case cf:case ff:case af:return N(function(E){return y.commandType(E,"boolean",C,h.commandStr),E},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="boolean"',"invalid flag "+C,E.commandStr)}),m});case rf:return N(function(E){return y.commandParameter(E,li,"invalid "+C,h.commandStr),li[E]},function(E,S,m){var I=E.constants.compareFuncs;return y.optional(function(){E.assert(S,m+" in "+I,"invalid "+C+", must be one of "+Object.keys(li))}),S.def(I,"[",m,"]")});case nf:return N(function(E){return y.command(Gt(E)&&E.length===2&&typeof E[0]=="number"&&typeof E[1]=="number"&&E[0]<=E[1],"depth range is 2d array",h.commandStr),E},function(E,S,m){y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===2&&typeof "+m+'[0]==="number"&&typeof '+m+'[1]==="number"&&'+m+"[0]<="+m+"[1]","depth range must be a 2d array")});var I=S.def("+",m,"[0]"),D=S.def("+",m,"[1]");return[I,D]});case Ts:return N(function(E){y.commandType(E,"object","blend.func",h.commandStr);var S="srcRGB"in E?E.srcRGB:E.src,m="srcAlpha"in E?E.srcAlpha:E.src,I="dstRGB"in E?E.dstRGB:E.dst,D="dstAlpha"in E?E.dstAlpha:E.dst;return y.commandParameter(S,Gr,R+".srcRGB",h.commandStr),y.commandParameter(m,Gr,R+".srcAlpha",h.commandStr),y.commandParameter(I,Gr,R+".dstRGB",h.commandStr),y.commandParameter(D,Gr,R+".dstAlpha",h.commandStr),y.command(Sf.indexOf(S+", "+I)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+S+", "+I+")",h.commandStr),[Gr[S],Gr[I],Gr[m],Gr[D]]},function(E,S,m){var I=E.constants.blendFuncs;y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid blend func, must be an object")});function D(Oe,Ue){var Je=S.def('"',Oe,Ue,'" in ',m,"?",m,".",Oe,Ue,":",m,".",Oe);return y.optional(function(){E.assert(S,Je+" in "+I,"invalid "+C+"."+Oe+Ue+", must be one of "+Object.keys(Gr))}),Je}var W=D("src","RGB"),K=D("dst","RGB");y.optional(function(){var Oe=E.constants.invalidBlendCombinations;E.assert(S,Oe+".indexOf("+W+'+", "+'+K+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var H=S.def(I,"[",W,"]"),ue=S.def(I,"[",D("src","Alpha"),"]"),ke=S.def(I,"[",K,"]"),it=S.def(I,"[",D("dst","Alpha"),"]");return[H,ke,ue,it]});case gs:return N(function(E){if(typeof E=="string")return y.commandParameter(E,V,"invalid "+C,h.commandStr),[V[E],V[E]];if(typeof E=="object")return y.commandParameter(E.rgb,V,C+".rgb",h.commandStr),y.commandParameter(E.alpha,V,C+".alpha",h.commandStr),[V[E.rgb],V[E.alpha]];y.commandRaise("invalid blend.equation",h.commandStr)},function(E,S,m){var I=E.constants.blendEquations,D=S.def(),W=S.def(),K=E.cond("typeof ",m,'==="string"');return y.optional(function(){function H(ue,ke,it){E.assert(ue,it+" in "+I,"invalid "+ke+", must be one of "+Object.keys(V))}H(K.then,C,m),E.assert(K.else,m+"&&typeof "+m+'==="object"',"invalid "+C),H(K.else,C+".rgb",m+".rgb"),H(K.else,C+".alpha",m+".alpha")}),K.then(D,"=",W,"=",I,"[",m,"];"),K.else(D,"=",I,"[",m,".rgb];",W,"=",I,"[",m,".alpha];"),S(K),[D,W]});case ef:return N(function(E){return y.command(Gt(E)&&E.length===4,"blend.color must be a 4d array",h.commandStr),Er(4,function(S){return+E[S]})},function(E,S,m){return y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===4","blend.color must be a 4d array")}),Er(4,function(I){return S.def("+",m,"[",I,"]")})});case df:return N(function(E){return y.commandType(E,"number",R,h.commandStr),E|0},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="number"',"invalid stencil.mask")}),S.def(m,"|0")});case xs:return N(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.cmp||"keep",m=E.ref||0,I="mask"in E?E.mask:-1;return y.commandParameter(S,li,C+".cmp",h.commandStr),y.commandType(m,"number",C+".ref",h.commandStr),y.commandType(I,"number",C+".mask",h.commandStr),[li[S],m,I]},function(E,S,m){var I=E.constants.compareFuncs;y.optional(function(){function H(){E.assert(S,Array.prototype.join.call(arguments,""),"invalid stencil.func")}H(m+"&&typeof ",m,'==="object"'),H('!("cmp" in ',m,")||(",m,".cmp in ",I,")")});var D=S.def('"cmp" in ',m,"?",I,"[",m,".cmp]",":",fn),W=S.def(m,".ref|0"),K=S.def('"mask" in ',m,"?",m,".mask|0:-1");return[D,W,K]});case Ns:case Mi:return N(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.fail||"keep",m=E.zfail||"keep",I=E.zpass||"keep";return y.commandParameter(S,ln,C+".fail",h.commandStr),y.commandParameter(m,ln,C+".zfail",h.commandStr),y.commandParameter(I,ln,C+".zpass",h.commandStr),[C===Mi?Pn:zi,ln[S],ln[m],ln[I]]},function(E,S,m){var I=E.constants.stencilOps;y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid "+C)});function D(W){return y.optional(function(){E.assert(S,'!("'+W+'" in '+m+")||("+m+"."+W+" in "+I+")","invalid "+C+"."+W+", must be one of "+Object.keys(ln))}),S.def('"',W,'" in ',m,"?",I,"[",m,".",W,"]:",fn)}return[C===Mi?Pn:zi,D("fail"),D("zfail"),D("zpass")]});case Rs:return N(function(E){y.commandType(E,"object",R,h.commandStr);var S=E.factor|0,m=E.units|0;return y.commandType(S,"number",R+".factor",h.commandStr),y.commandType(m,"number",R+".units",h.commandStr),[S,m]},function(E,S,m){y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid "+C)});var I=S.def(m,".factor|0"),D=S.def(m,".units|0");return[I,D]});case sf:return N(function(E){var S=0;return E==="front"?S=zi:E==="back"&&(S=Pn),y.command(!!S,R,h.commandStr),S},function(E,S,m){return y.optional(function(){E.assert(S,m+'==="front"||'+m+'==="back"',"invalid cull.face")}),S.def(m,'==="front"?',zi,":",Pn)});case ws:return N(function(E){return y.command(typeof E=="number"&&E>=B.lineWidthDims[0]&&E<=B.lineWidthDims[1],"invalid line width, must be a positive number between "+B.lineWidthDims[0]+" and "+B.lineWidthDims[1],h.commandStr),E},function(E,S,m){return y.optional(function(){E.assert(S,"typeof "+m+'==="number"&&'+m+">="+B.lineWidthDims[0]+"&&"+m+"<="+B.lineWidthDims[1],"invalid line width")}),m});case Ss:return N(function(E){return y.commandParameter(E,Ds,R,h.commandStr),Ds[E]},function(E,S,m){return y.optional(function(){E.assert(S,m+'==="cw"||'+m+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),S.def(m+'==="cw"?'+Ef+":"+ks)});case As:return N(function(E){return y.command(Gt(E)&&E.length===4,"color.mask must be length 4 array",h.commandStr),E.map(function(S){return!!S})},function(E,S,m){return y.optional(function(){E.assert(S,E.shared.isArrayLike+"("+m+")&&"+m+".length===4","invalid color.mask")}),Er(4,function(I){return"!!"+m+"["+I+"]"})});case Cs:return N(function(E){y.command(typeof E=="object"&&E,R,h.commandStr);var S="value"in E?E.value:1,m=!!E.invert;return y.command(typeof S=="number"&&S>=0&&S<=1,"sample.coverage.value must be a number between 0 and 1",h.commandStr),[S,m]},function(E,S,m){y.optional(function(){E.assert(S,m+"&&typeof "+m+'==="object"',"invalid sample.coverage")});var I=S.def('"value" in ',m,"?+",m,".value:1"),D=S.def("!!",m,".invert");return[I,D]})}}),k}function Jt(_,h){var w=_.static,P=_.dynamic,k={};return Object.keys(w).forEach(function(C){var R=w[C],N;if(typeof R=="number"||typeof R=="boolean")N=jt(function(){return R});else if(typeof R=="function"){var E=R._reglType;E==="texture2d"||E==="textureCube"?N=jt(function(S){return S.link(R)}):E==="framebuffer"||E==="framebufferCube"?(y.command(R.color.length>0,'missing color attachment for framebuffer sent to uniform "'+C+'"',h.commandStr),N=jt(function(S){return S.link(R.color[0])})):y.commandRaise('invalid data for uniform "'+C+'"',h.commandStr)}else Gt(R)?N=jt(function(S){var m=S.global.def("[",Er(R.length,function(I){return y.command(typeof R[I]=="number"||typeof R[I]=="boolean","invalid uniform "+C,S.commandStr),R[I]}),"]");return m}):y.commandRaise('invalid or missing data for uniform "'+C+'"',h.commandStr);N.value=R,k[C]=N}),Object.keys(P).forEach(function(C){var R=P[C];k[C]=br(R,function(N,E){return N.invoke(E,R)})}),k}function dt(_,h){var w=_.static,P=_.dynamic,k={};return Object.keys(w).forEach(function(C){var R=w[C],N=v.id(C),E=new L;if(to(R))E.state=si,E.buffer=q.getBuffer(q.create(R,fi,!1,!0)),E.type=0;else{var S=q.getBuffer(R);if(S)E.state=si,E.buffer=S,E.type=0;else if(y.command(typeof R=="object"&&R,"invalid data for attribute "+C,h.commandStr),"constant"in R){var m=R.constant;E.buffer="null",E.state=ms,typeof m=="number"?E.x=m:(y.command(Gt(m)&&m.length>0&&m.length<=4,"invalid constant for attribute "+C,h.commandStr),oi.forEach(function(ke,it){it<m.length&&(E[ke]=m[it])}))}else{to(R.buffer)?S=q.getBuffer(q.create(R.buffer,fi,!1,!0)):S=q.getBuffer(R.buffer),y.command(!!S,'missing buffer for attribute "'+C+'"',h.commandStr);var I=R.offset|0;y.command(I>=0,'invalid offset for attribute "'+C+'"',h.commandStr);var D=R.stride|0;y.command(D>=0&&D<256,'invalid stride for attribute "'+C+'", must be integer betweeen [0, 255]',h.commandStr);var W=R.size|0;y.command(!("size"in R)||W>0&&W<=4,'invalid size for attribute "'+C+'", must be 1,2,3,4',h.commandStr);var K=!!R.normalized,H=0;"type"in R&&(y.commandParameter(R.type,An,"invalid type for attribute "+C,h.commandStr),H=An[R.type]);var ue=R.divisor|0;"divisor"in R&&(y.command(ue===0||fe,'cannot specify divisor for attribute "'+C+'", instancing not supported',h.commandStr),y.command(ue>=0,'invalid divisor for attribute "'+C+'"',h.commandStr)),y.optional(function(){var ke=h.commandStr,it=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(R).forEach(function(Oe){y.command(it.indexOf(Oe)>=0,'unknown parameter "'+Oe+'" for attribute pointer "'+C+'" (valid parameters are '+it+")",ke)})}),E.buffer=S,E.state=si,E.size=W,E.normalized=K,E.type=H||S.dtype,E.offset=I,E.stride=D,E.divisor=ue}}k[C]=jt(function(ke,it){var Oe=ke.attribCache;if(N in Oe)return Oe[N];var Ue={isStream:!1};return Object.keys(E).forEach(function(Je){Ue[Je]=E[Je]}),E.buffer&&(Ue.buffer=ke.link(E.buffer),Ue.type=Ue.type||Ue.buffer+".dtype"),Oe[N]=Ue,Ue})}),Object.keys(P).forEach(function(C){var R=P[C];function N(E,S){var m=E.invoke(S,R),I=E.shared,D=E.constants,W=I.isBufferArgs,K=I.buffer;y.optional(function(){E.assert(S,m+"&&(typeof "+m+'==="object"||typeof '+m+'==="function")&&('+W+"("+m+")||"+K+".getBuffer("+m+")||"+K+".getBuffer("+m+".buffer)||"+W+"("+m+'.buffer)||("constant" in '+m+"&&(typeof "+m+'.constant==="number"||'+I.isArrayLike+"("+m+".constant))))",'invalid dynamic attribute "'+C+'"')});var H={isStream:S.def(!1)},ue=new L;ue.state=si,Object.keys(ue).forEach(function(Ue){H[Ue]=S.def(""+ue[Ue])});var ke=H.buffer,it=H.type;S("if(",W,"(",m,")){",H.isStream,"=true;",ke,"=",K,".createStream(",fi,",",m,");",it,"=",ke,".dtype;","}else{",ke,"=",K,".getBuffer(",m,");","if(",ke,"){",it,"=",ke,".dtype;",'}else if("constant" in ',m,"){",H.state,"=",ms,";","if(typeof "+m+'.constant === "number"){',H[oi[0]],"=",m,".constant;",oi.slice(1).map(function(Ue){return H[Ue]}).join("="),"=0;","}else{",oi.map(function(Ue,Je){return H[Ue]+"="+m+".constant.length>"+Je+"?"+m+".constant["+Je+"]:0;"}).join(""),"}}else{","if(",W,"(",m,".buffer)){",ke,"=",K,".createStream(",fi,",",m,".buffer);","}else{",ke,"=",K,".getBuffer(",m,".buffer);","}",it,'="type" in ',m,"?",D.glTypes,"[",m,".type]:",ke,".dtype;",H.normalized,"=!!",m,".normalized;");function Oe(Ue){S(H[Ue],"=",m,".",Ue,"|0;")}return Oe("size"),Oe("offset"),Oe("stride"),Oe("divisor"),S("}}"),S.exit("if(",H.isStream,"){",K,".destroyStream(",ke,");","}"),H}k[C]=br(R,N)}),k}function Wt(_,h){var w=_.static,P=_.dynamic;if(Gi in w){var k=w[Gi];return k!==null&&le.getVAO(k)===null&&(k=le.createVAO(k)),jt(function(R){return R.link(le.getVAO(k))})}else if(Gi in P){var C=P[Gi];return br(C,function(R,N){var E=R.invoke(N,C);return N.def(R.shared.vao+".getVAO("+E+")")})}return null}function Pt(_){var h=_.static,w=_.dynamic,P={};return Object.keys(h).forEach(function(k){var C=h[k];P[k]=jt(function(R,N){return typeof C=="number"||typeof C=="boolean"?""+C:R.link(C)})}),Object.keys(w).forEach(function(k){var C=w[k];P[k]=br(C,function(R,N){return R.invoke(N,C)})}),P}function Ht(_,h,w,P,k){var C=_.static,R=_.dynamic;y.optional(function(){var Oe=[xn,Di,Fi,Nn,On,za,In,Ha,ki,Gi].concat(ee);function Ue(Je){Object.keys(Je).forEach(function(bt){y.command(Oe.indexOf(bt)>=0,'unknown parameter "'+bt+'"',k.commandStr)})}Ue(C),Ue(R)});var N=Ze(_,h),E=Ne(_),S=ut(_,E,k),m=Et(_,k),I=zt(_,k),D=ot(_,k,N);function W(Oe){var Ue=S[Oe];Ue&&(I[Oe]=Ue)}W(Yr),W(_e(ja));var K=Object.keys(I).length>0,H={framebuffer:E,draw:m,shader:D,state:I,dirty:K,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(H.profile=rt(_),H.uniforms=Jt(w,k),H.drawVAO=H.scopeVAO=Wt(_),!H.drawVAO&&D.program&&!N&&A.angle_instanced_arrays){var ue=!0,ke=D.program.attributes.map(function(Oe){var Ue=h.static[Oe];return ue=ue&&!!Ue,Ue});if(ue&&ke.length>0){var it=le.getVAO(le.createVAO(ke));H.drawVAO=new vr(null,null,null,function(Oe,Ue){return Oe.link(it)}),H.useVAO=!0}}return N?H.useVAO=!0:H.attributes=dt(h,k),H.context=Pt(P),H}function Yt(_,h,w){var P=_.shared,k=P.context,C=_.scope();Object.keys(w).forEach(function(R){h.save(k,"."+R);var N=w[R],E=N.append(_,h);Array.isArray(E)?C(k,".",R,"=[",E.join(),"];"):C(k,".",R,"=",E,";")}),h(C)}function qt(_,h,w,P){var k=_.shared,C=k.gl,R=k.framebuffer,N;Se&&(N=h.def(k.extensions,".webgl_draw_buffers"));var E=_.constants,S=E.drawBuffer,m=E.backBuffer,I;w?I=w.append(_,h):I=h.def(R,".next"),P||h("if(",I,"!==",R,".cur){"),h("if(",I,"){",C,".bindFramebuffer(",Af,",",I,".framebuffer);"),Se&&h(N,".drawBuffersWEBGL(",S,"[",I,".colorAttachments.length]);"),h("}else{",C,".bindFramebuffer(",Af,",null);"),Se&&h(N,".drawBuffersWEBGL(",m,");"),h("}",R,".cur=",I,";"),P||h("}")}function er(_,h,w){var P=_.shared,k=P.gl,C=_.current,R=_.next,N=P.current,E=P.next,S=_.cond(N,".dirty");ee.forEach(function(m){var I=_e(m);if(!(I in w.state)){var D,W;if(I in R){D=R[I],W=C[I];var K=Er(Z[I].length,function(ue){return S.def(D,"[",ue,"]")});S(_.cond(K.map(function(ue,ke){return ue+"!=="+W+"["+ke+"]"}).join("||")).then(k,".",J[I],"(",K,");",K.map(function(ue,ke){return W+"["+ke+"]="+ue}).join(";"),";"))}else{D=S.def(E,".",I);var H=_.cond(D,"!==",N,".",I);S(H),I in ye?H(_.cond(D).then(k,".enable(",ye[I],");").else(k,".disable(",ye[I],");"),N,".",I,"=",D,";"):H(k,".",J[I],"(",D,");",N,".",I,"=",D,";")}}}),Object.keys(w.state).length===0&&S(N,".dirty=false;"),h(S)}function nr(_,h,w,P){var k=_.shared,C=_.current,R=k.current,N=k.gl;Rf(Object.keys(w)).forEach(function(E){var S=w[E];if(!(P&&!P(S))){var m=S.append(_,h);if(ye[E]){var I=ye[E];dn(S)?m?h(N,".enable(",I,");"):h(N,".disable(",I,");"):h(_.cond(m).then(N,".enable(",I,");").else(N,".disable(",I,");")),h(R,".",E,"=",m,";")}else if(Gt(m)){var D=C[E];h(N,".",J[E],"(",m,");",m.map(function(W,K){return D+"["+K+"]="+W}).join(";"),";")}else h(N,".",J[E],"(",m,");",R,".",E,"=",m,";")}})}function Bt(_,h){fe&&(_.instancing=h.def(_.shared.extensions,".angle_instanced_arrays"))}function nt(_,h,w,P,k){var C=_.shared,R=_.stats,N=C.current,E=C.timer,S=w.profile;function m(){return typeof performance>"u"?"Date.now()":"performance.now()"}var I,D;function W(Oe){I=h.def(),Oe(I,"=",m(),";"),typeof k=="string"?Oe(R,".count+=",k,";"):Oe(R,".count++;"),ne&&(P?(D=h.def(),Oe(D,"=",E,".getNumPendingQueries();")):Oe(E,".beginQuery(",R,");"))}function K(Oe){Oe(R,".cpuTime+=",m(),"-",I,";"),ne&&(P?Oe(E,".pushScopeStats(",D,",",E,".getNumPendingQueries(),",R,");"):Oe(E,".endQuery();"))}function H(Oe){var Ue=h.def(N,".profile");h(N,".profile=",Oe,";"),h.exit(N,".profile=",Ue,";")}var ue;if(S){if(dn(S)){S.enable?(W(h),K(h.exit),H("true")):H("false");return}ue=S.append(_,h),H(ue)}else ue=h.def(N,".profile");var ke=_.block();W(ke),h("if(",ue,"){",ke,"}");var it=_.block();K(it),h.exit("if(",ue,"){",it,"}")}function ir(_,h,w,P,k){var C=_.shared;function R(E){switch(E){case Xa:case qa:case Za:return 2;case Wa:case Ka:case Ja:return 3;case Ya:case Qa:case eo:return 4;default:return 1}}function N(E,S,m){var I=C.gl,D=h.def(E,".location"),W=h.def(C.attributes,"[",D,"]"),K=m.state,H=m.buffer,ue=[m.x,m.y,m.z,m.w],ke=["buffer","normalized","offset","stride"];function it(){h("if(!",W,".buffer){",I,".enableVertexAttribArray(",D,");}");var Ue=m.type,Je;if(m.size?Je=h.def(m.size,"||",S):Je=S,h("if(",W,".type!==",Ue,"||",W,".size!==",Je,"||",ke.map(function(Ft){return W+"."+Ft+"!=="+m[Ft]}).join("||"),"){",I,".bindBuffer(",fi,",",H,".buffer);",I,".vertexAttribPointer(",[D,Je,Ue,m.normalized,m.stride,m.offset],");",W,".type=",Ue,";",W,".size=",Je,";",ke.map(function(Ft){return W+"."+Ft+"="+m[Ft]+";"}).join(""),"}"),fe){var bt=m.divisor;h("if(",W,".divisor!==",bt,"){",_.instancing,".vertexAttribDivisorANGLE(",[D,bt],");",W,".divisor=",bt,";}")}}function Oe(){h("if(",W,".buffer){",I,".disableVertexAttribArray(",D,");",W,".buffer=null;","}if(",oi.map(function(Ue,Je){return W+"."+Ue+"!=="+ue[Je]}).join("||"),"){",I,".vertexAttrib4f(",D,",",ue,");",oi.map(function(Ue,Je){return W+"."+Ue+"="+ue[Je]+";"}).join(""),"}")}K===si?it():K===ms?Oe():(h("if(",K,"===",si,"){"),it(),h("}else{"),Oe(),h("}"))}P.forEach(function(E){var S=E.name,m=w.attributes[S],I;if(m){if(!k(m))return;I=m.append(_,h)}else{if(!k(Cf))return;var D=_.scopeAttrib(S);y.optional(function(){_.assert(h,D+".state","missing attribute "+S)}),I={},Object.keys(new L).forEach(function(W){I[W]=h.def(D,".",W)})}N(_.link(E),R(E.info.type),I)})}function Tt(_,h,w,P,k){for(var C=_.shared,R=C.gl,N,E=0;E<P.length;++E){var S=P[E],m=S.name,I=S.info.type,D=w.uniforms[m],W=_.link(S),K=W+".location",H;if(D){if(!k(D))continue;if(dn(D)){var ue=D.value;if(y.command(ue!==null&&typeof ue<"u",'missing uniform "'+m+'"',_.commandStr),I===Vi||I===ji){y.command(typeof ue=="function"&&(I===Vi&&(ue._reglType==="texture2d"||ue._reglType==="framebuffer")||I===ji&&(ue._reglType==="textureCube"||ue._reglType==="framebufferCube")),"invalid texture for uniform "+m,_.commandStr);var ke=_.link(ue._texture||ue.color[0]._texture);h(R,".uniform1i(",K,",",ke+".bind());"),h.exit(ke,".unbind();")}else if(I===Bi||I===Ui||I===$i){y.optional(function(){y.command(Gt(ue),"invalid matrix for uniform "+m,_.commandStr),y.command(I===Bi&&ue.length===4||I===Ui&&ue.length===9||I===$i&&ue.length===16,"invalid length for matrix uniform "+m,_.commandStr)});var it=_.global.def("new Float32Array(["+Array.prototype.slice.call(ue)+"])"),Oe=2;I===Ui?Oe=3:I===$i&&(Oe=4),h(R,".uniformMatrix",Oe,"fv(",K,",false,",it,");")}else{switch(I){case Ps:y.commandType(ue,"number","uniform "+m,_.commandStr),N="1f";break;case Xa:y.command(Gt(ue)&&ue.length===2,"uniform "+m,_.commandStr),N="2f";break;case Wa:y.command(Gt(ue)&&ue.length===3,"uniform "+m,_.commandStr),N="3f";break;case Ya:y.command(Gt(ue)&&ue.length===4,"uniform "+m,_.commandStr),N="4f";break;case Ms:y.commandType(ue,"boolean","uniform "+m,_.commandStr),N="1i";break;case Ls:y.commandType(ue,"number","uniform "+m,_.commandStr),N="1i";break;case Za:y.command(Gt(ue)&&ue.length===2,"uniform "+m,_.commandStr),N="2i";break;case qa:y.command(Gt(ue)&&ue.length===2,"uniform "+m,_.commandStr),N="2i";break;case Ja:y.command(Gt(ue)&&ue.length===3,"uniform "+m,_.commandStr),N="3i";break;case Ka:y.command(Gt(ue)&&ue.length===3,"uniform "+m,_.commandStr),N="3i";break;case eo:y.command(Gt(ue)&&ue.length===4,"uniform "+m,_.commandStr),N="4i";break;case Qa:y.command(Gt(ue)&&ue.length===4,"uniform "+m,_.commandStr),N="4i";break}h(R,".uniform",N,"(",K,",",Gt(ue)?Array.prototype.slice.call(ue):ue,");")}continue}else H=D.append(_,h)}else{if(!k(Cf))continue;H=h.def(C.uniforms,"[",v.id(m),"]")}I===Vi?(y(!Array.isArray(H),"must specify a scalar prop for textures"),h("if(",H,"&&",H,'._reglType==="framebuffer"){',H,"=",H,".color[0];","}")):I===ji&&(y(!Array.isArray(H),"must specify a scalar prop for cube maps"),h("if(",H,"&&",H,'._reglType==="framebufferCube"){',H,"=",H,".color[0];","}")),y.optional(function(){function pr(Mr,Mf){_.assert(h,Mr,'bad data or missing for uniform "'+m+'".  '+Mf)}function Fs(Mr){y(!Array.isArray(H),"must not specify an array type for uniform"),pr("typeof "+H+'==="'+Mr+'"',"invalid type, expected "+Mr)}function wr(Mr,Mf){Array.isArray(H)?y(H.length===Mr,"must have length "+Mr):pr(C.isArrayLike+"("+H+")&&"+H+".length==="+Mr,"invalid vector, should have length "+Mr,_.commandStr)}function Lf(Mr){y(!Array.isArray(H),"must not specify a value type"),pr("typeof "+H+'==="function"&&'+H+'._reglType==="texture'+(Mr===yf?"2d":"Cube")+'"',"invalid texture type",_.commandStr)}switch(I){case Ls:Fs("number");break;case qa:wr(2);break;case Ka:wr(3);break;case Qa:wr(4);break;case Ps:Fs("number");break;case Xa:wr(2);break;case Wa:wr(3);break;case Ya:wr(4);break;case Ms:Fs("boolean");break;case Za:wr(2);break;case Ja:wr(3);break;case eo:wr(4);break;case Bi:wr(4);break;case Ui:wr(9);break;case $i:wr(16);break;case Vi:Lf(yf);break;case ji:Lf(IE);break}});var Ue=1;switch(I){case Vi:case ji:var Je=h.def(H,"._texture");h(R,".uniform1i(",K,",",Je,".bind());"),h.exit(Je,".unbind();");continue;case Ls:case Ms:N="1i";break;case qa:case Za:N="2i",Ue=2;break;case Ka:case Ja:N="3i",Ue=3;break;case Qa:case eo:N="4i",Ue=4;break;case Ps:N="1f";break;case Xa:N="2f",Ue=2;break;case Wa:N="3f",Ue=3;break;case Ya:N="4f",Ue=4;break;case Bi:N="Matrix2fv";break;case Ui:N="Matrix3fv";break;case $i:N="Matrix4fv";break}if(h(R,".uniform",N,"(",K,","),N.charAt(0)==="M"){var bt=Math.pow(I-Bi+2,2),Ft=_.global.def("new Float32Array(",bt,")");Array.isArray(H)?h("false,(",Er(bt,function(pr){return Ft+"["+pr+"]="+H[pr]}),",",Ft,")"):h("false,(Array.isArray(",H,")||",H," instanceof Float32Array)?",H,":(",Er(bt,function(pr){return Ft+"["+pr+"]="+H+"["+pr+"]"}),",",Ft,")")}else Ue>1?h(Er(Ue,function(pr){return Array.isArray(H)?H[pr]:H+"["+pr+"]"})):(y(!Array.isArray(H),"uniform value must not be an array"),h(H));h(");")}}function Ge(_,h,w,P){var k=_.shared,C=k.gl,R=k.draw,N=P.draw;function E(){var Je=N.elements,bt,Ft=h;return Je?((Je.contextDep&&P.contextDynamic||Je.propDep)&&(Ft=w),bt=Je.append(_,Ft)):bt=Ft.def(R,".",Nn),bt&&Ft("if("+bt+")"+C+".bindBuffer("+xE+","+bt+".buffer.buffer);"),bt}function S(){var Je=N.count,bt,Ft=h;return Je?((Je.contextDep&&P.contextDynamic||Je.propDep)&&(Ft=w),bt=Je.append(_,Ft),y.optional(function(){Je.MISSING&&_.assert(h,"false","missing vertex count"),Je.DYNAMIC&&_.assert(Ft,bt+">=0","missing vertex count")})):(bt=Ft.def(R,".",In),y.optional(function(){_.assert(Ft,bt+">=0","missing vertex count")})),bt}var m=E();function I(Je){var bt=N[Je];return bt?bt.contextDep&&P.contextDynamic||bt.propDep?bt.append(_,w):bt.append(_,h):h.def(R,".",Je)}var D=I(On),W=I(za),K=S();if(typeof K=="number"){if(K===0)return}else w("if(",K,"){"),w.exit("}");var H,ue;fe&&(H=I(Ha),ue=_.instancing);var ke=m+".type",it=N.elements&&dn(N.elements);function Oe(){function Je(){w(ue,".drawElementsInstancedANGLE(",[D,K,ke,W+"<<(("+ke+"-"+qc+")>>1)",H],");")}function bt(){w(ue,".drawArraysInstancedANGLE(",[D,W,K,H],");")}m?it?Je():(w("if(",m,"){"),Je(),w("}else{"),bt(),w("}")):bt()}function Ue(){function Je(){w(C+".drawElements("+[D,K,ke,W+"<<(("+ke+"-"+qc+")>>1)"]+");")}function bt(){w(C+".drawArrays("+[D,W,K]+");")}m?it?Je():(w("if(",m,"){"),Je(),w("}else{"),bt(),w("}")):bt()}fe&&(typeof H!="number"||H>=0)?typeof H=="string"?(w("if(",H,">0){"),Oe(),w("}else if(",H,"<0){"),Ue(),w("}")):Oe():Ue()}function ft(_,h,w,P,k){var C=We(),R=C.proc("body",k);return y.optional(function(){C.commandStr=h.commandStr,C.command=C.link(h.commandStr)}),fe&&(C.instancing=R.def(C.shared.extensions,".angle_instanced_arrays")),_(C,R,w,P),C.compile().body}function _t(_,h,w,P){Bt(_,h),w.useVAO?w.drawVAO?h(_.shared.vao,".setVAO(",w.drawVAO.append(_,h),");"):h(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(h(_.shared.vao,".setVAO(null);"),ir(_,h,w,P.attributes,function(){return!0})),Tt(_,h,w,P.uniforms,function(){return!0}),Ge(_,h,h,w)}function Ut(_,h){var w=_.proc("draw",1);Bt(_,w),Yt(_,w,h.context),qt(_,w,h.framebuffer),er(_,w,h),nr(_,w,h.state),nt(_,w,h,!1,!0);var P=h.shader.progVar.append(_,w);if(w(_.shared.gl,".useProgram(",P,".program);"),h.shader.program)_t(_,w,h,h.shader.program);else{w(_.shared.vao,".setVAO(null);");var k=_.global.def("{}"),C=w.def(P,".id"),R=w.def(k,"[",C,"]");w(_.cond(R).then(R,".call(this,a0);").else(R,"=",k,"[",C,"]=",_.link(function(N){return ft(_t,_,h,N,1)}),"(",P,");",R,".call(this,a0);"))}Object.keys(h.state).length>0&&w(_.shared.current,".dirty=true;")}function Br(_,h,w,P){_.batchId="a1",Bt(_,h);function k(){return!0}ir(_,h,w,P.attributes,k),Tt(_,h,w,P.uniforms,k),Ge(_,h,h,w)}function Ln(_,h,w,P){Bt(_,h);var k=w.contextDep,C=h.def(),R="a0",N="a1",E=h.def();_.shared.props=E,_.batchId=C;var S=_.scope(),m=_.scope();h(S.entry,"for(",C,"=0;",C,"<",N,";++",C,"){",E,"=",R,"[",C,"];",m,"}",S.exit);function I(ke){return ke.contextDep&&k||ke.propDep}function D(ke){return!I(ke)}if(w.needsContext&&Yt(_,m,w.context),w.needsFramebuffer&&qt(_,m,w.framebuffer),nr(_,m,w.state,I),w.profile&&I(w.profile)&&nt(_,m,w,!1,!0),P)w.useVAO?w.drawVAO?I(w.drawVAO)?m(_.shared.vao,".setVAO(",w.drawVAO.append(_,m),");"):S(_.shared.vao,".setVAO(",w.drawVAO.append(_,S),");"):S(_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"):(S(_.shared.vao,".setVAO(null);"),ir(_,S,w,P.attributes,D),ir(_,m,w,P.attributes,I)),Tt(_,S,w,P.uniforms,D),Tt(_,m,w,P.uniforms,I),Ge(_,S,m,w);else{var W=_.global.def("{}"),K=w.shader.progVar.append(_,m),H=m.def(K,".id"),ue=m.def(W,"[",H,"]");m(_.shared.gl,".useProgram(",K,".program);","if(!",ue,"){",ue,"=",W,"[",H,"]=",_.link(function(ke){return ft(Br,_,w,ke,2)}),"(",K,");}",ue,".call(this,a0[",C,"],",C,");")}}function b(_,h){var w=_.proc("batch",2);_.batchId="0",Bt(_,w);var P=!1,k=!0;Object.keys(h.context).forEach(function(W){P=P||h.context[W].propDep}),P||(Yt(_,w,h.context),k=!1);var C=h.framebuffer,R=!1;C?(C.propDep?P=R=!0:C.contextDep&&P&&(R=!0),R||qt(_,w,C)):qt(_,w,null),h.state.viewport&&h.state.viewport.propDep&&(P=!0);function N(W){return W.contextDep&&P||W.propDep}er(_,w,h),nr(_,w,h.state,function(W){return!N(W)}),(!h.profile||!N(h.profile))&&nt(_,w,h,!1,"a1"),h.contextDep=P,h.needsContext=k,h.needsFramebuffer=R;var E=h.shader.progVar;if(E.contextDep&&P||E.propDep)Ln(_,w,h,null);else{var S=E.append(_,w);if(w(_.shared.gl,".useProgram(",S,".program);"),h.shader.program)Ln(_,w,h,h.shader.program);else{w(_.shared.vao,".setVAO(null);");var m=_.global.def("{}"),I=w.def(S,".id"),D=w.def(m,"[",I,"]");w(_.cond(D).then(D,".call(this,a0,a1);").else(D,"=",m,"[",I,"]=",_.link(function(W){return ft(Ln,_,h,W,2)}),"(",S,");",D,".call(this,a0,a1);"))}}Object.keys(h.state).length>0&&w(_.shared.current,".dirty=true;")}function U(_,h){var w=_.proc("scope",3);_.batchId="a2";var P=_.shared,k=P.current;Yt(_,w,h.context),h.framebuffer&&h.framebuffer.append(_,w),Rf(Object.keys(h.state)).forEach(function(R){var N=h.state[R],E=N.append(_,w);Gt(E)?E.forEach(function(S,m){w.set(_.next[R],"["+m+"]",S)}):w.set(P.next,"."+R,E)}),nt(_,w,h,!0,!0),[Nn,za,In,Ha,On].forEach(function(R){var N=h.draw[R];!N||w.set(P.draw,"."+R,""+N.append(_,w))}),Object.keys(h.uniforms).forEach(function(R){var N=h.uniforms[R].append(_,w);Array.isArray(N)&&(N="["+N.join()+"]"),w.set(P.uniforms,"["+v.id(R)+"]",N)}),Object.keys(h.attributes).forEach(function(R){var N=h.attributes[R].append(_,w),E=_.scopeAttrib(R);Object.keys(new L).forEach(function(S){w.set(E,"."+S,N[S])})}),h.scopeVAO&&w.set(P.vao,".targetVAO",h.scopeVAO.append(_,w));function C(R){var N=h.shader[R];N&&w.set(P.shader,"."+R,N.append(_,w))}C(Di),C(Fi),Object.keys(h.state).length>0&&(w(k,".dirty=true;"),w.exit(k,".dirty=true;")),w("a1(",_.shared.context,",a0,",_.batchId,");")}function F(_){if(!(typeof _!="object"||Gt(_))){for(var h=Object.keys(_),w=0;w<h.length;++w)if($t.isDynamic(_[h[w]]))return!0;return!1}}function xe(_,h,w){var P=h.static[w];if(!P||!F(P))return;var k=_.global,C=Object.keys(P),R=!1,N=!1,E=!1,S=_.global.def("{}");C.forEach(function(I){var D=P[I];if($t.isDynamic(D)){typeof D=="function"&&(D=P[I]=$t.unbox(D));var W=br(D,null);R=R||W.thisDep,E=E||W.propDep,N=N||W.contextDep}else{switch(k(S,".",I,"="),typeof D){case"number":k(D);break;case"string":k('"',D,'"');break;case"object":Array.isArray(D)&&k("[",D.join(),"]");break;default:k(_.link(D));break}k(";")}});function m(I,D){C.forEach(function(W){var K=P[W];if(!!$t.isDynamic(K)){var H=I.invoke(D,K);D(S,".",W,"=",H,";")}})}h.dynamic[w]=new $t.DynamicVariable(Va,{thisDep:R,contextDep:N,propDep:E,ref:S,append:m}),delete h.static[w]}function ct(_,h,w,P,k){var C=We();C.stats=C.link(k),Object.keys(h.static).forEach(function(N){xe(C,h,N)}),CE.forEach(function(N){xe(C,_,N)});var R=Ht(_,h,w,P,C);return Ut(C,R),U(C,R),b(C,R),n(C.compile(),{destroy:function(){R.shader.program.destroy()}})}return{next:Ce,current:Z,procs:function(){var _=We(),h=_.proc("poll"),w=_.proc("refresh"),P=_.block();h(P),w(P);var k=_.shared,C=k.gl,R=k.next,N=k.current;P(N,".dirty=false;"),qt(_,h),qt(_,w,null,!0);var E;fe&&(E=_.link(fe)),A.oes_vertex_array_object&&w(_.link(A.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var S=0;S<B.maxAttributes;++S){var m=w.def(k.attributes,"[",S,"]"),I=_.cond(m,".buffer");I.then(C,".enableVertexAttribArray(",S,");",C,".bindBuffer(",fi,",",m,".buffer.buffer);",C,".vertexAttribPointer(",S,",",m,".size,",m,".type,",m,".normalized,",m,".stride,",m,".offset);").else(C,".disableVertexAttribArray(",S,");",C,".vertexAttrib4f(",S,",",m,".x,",m,".y,",m,".z,",m,".w);",m,".buffer=null;"),w(I),fe&&w(E,".vertexAttribDivisorANGLE(",S,",",m,".divisor);")}return w(_.shared.vao,".currentVAO=null;",_.shared.vao,".setVAO(",_.shared.vao,".targetVAO);"),Object.keys(ye).forEach(function(D){var W=ye[D],K=P.def(R,".",D),H=_.block();H("if(",K,"){",C,".enable(",W,")}else{",C,".disable(",W,")}",N,".",D,"=",K,";"),w(H),h("if(",K,"!==",N,".",D,"){",H,"}")}),Object.keys(J).forEach(function(D){var W=J[D],K=Z[D],H,ue,ke=_.block();if(ke(C,".",W,"("),Gt(K)){var it=K.length;H=_.global.def(R,".",D),ue=_.global.def(N,".",D),ke(Er(it,function(Oe){return H+"["+Oe+"]"}),");",Er(it,function(Oe){return ue+"["+Oe+"]="+H+"["+Oe+"];"}).join("")),h("if(",Er(it,function(Oe){return H+"["+Oe+"]!=="+ue+"["+Oe+"]"}).join("||"),"){",ke,"}")}else H=P.def(R,".",D),ue=P.def(N,".",D),ke(H,");",N,".",D,"=",H,";"),h("if(",H,"!==",ue,"){",ke,"}");w(ke)}),_.compile()}(),compile:ct}}function WE(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var YE=34918,qE=34919,xf=35007,KE=function(l,v){if(!v.ext_disjoint_timer_query)return null;var A=[];function B(){return A.pop()||v.ext_disjoint_timer_query.createQueryEXT()}function q(fe){A.push(fe)}var G=[];function $(fe){var Se=B();v.ext_disjoint_timer_query.beginQueryEXT(xf,Se),G.push(Se),ne(G.length-1,G.length,fe)}function re(){v.ext_disjoint_timer_query.endQueryEXT(xf)}function oe(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var le=[];function se(){return le.pop()||new oe}function he(fe){le.push(fe)}var Ee=[];function ne(fe,Se,Z){var Ce=se();Ce.startQueryIndex=fe,Ce.endQueryIndex=Se,Ce.sum=0,Ce.stats=Z,Ee.push(Ce)}var ve=[],L=[];function V(){var fe,Se,Z=G.length;if(Z!==0){L.length=Math.max(L.length,Z+1),ve.length=Math.max(ve.length,Z+1),ve[0]=0,L[0]=0;var Ce=0;for(fe=0,Se=0;Se<G.length;++Se){var ee=G[Se];v.ext_disjoint_timer_query.getQueryObjectEXT(ee,qE)?(Ce+=v.ext_disjoint_timer_query.getQueryObjectEXT(ee,YE),q(ee)):G[fe++]=ee,ve[Se+1]=Ce,L[Se+1]=fe}for(G.length=fe,fe=0,Se=0;Se<Ee.length;++Se){var ye=Ee[Se],J=ye.startQueryIndex,_e=ye.endQueryIndex;ye.sum+=ve[_e]-ve[J];var De=L[J],Ke=L[_e];Ke===De?(ye.stats.gpuTime+=ye.sum/1e6,he(ye)):(ye.startQueryIndex=De,ye.endQueryIndex=Ke,Ee[fe++]=ye)}Ee.length=fe}}return{beginQuery:$,endQuery:re,pushScopeStats:ne,update:V,getNumPendingQueries:function(){return G.length},clear:function(){A.push.apply(A,G);for(var fe=0;fe<A.length;fe++)v.ext_disjoint_timer_query.deleteQueryEXT(A[fe]);G.length=0,A.length=0},restore:function(){G.length=0,A.length=0}}},QE=16384,ZE=256,JE=1024,eb=34962,Nf="webglcontextlost",Of="webglcontextrestored",If=1,tb=2,rb=3;function Pf(l,v){for(var A=0;A<l.length;++A)if(l[A]===v)return A;return-1}function nb(l){var v=e_(l);if(!v)return null;var A=v.gl,B=A.getContextAttributes(),q=A.isContextLost(),G=t_(A,v);if(!G)return null;var $=qy(),re=WE(),oe=G.extensions,le=KE(A,oe),se=Bu(),he=A.drawingBufferWidth,Ee=A.drawingBufferHeight,ne={tick:0,time:0,viewportWidth:he,viewportHeight:Ee,framebufferWidth:he,framebufferHeight:Ee,drawingBufferWidth:he,drawingBufferHeight:Ee,pixelRatio:v.pixelRatio},ve={},L={elements:null,primitive:4,count:-1,offset:0,instances:-1},V=V_(A,oe),fe=i0(A,re,v,Z),Se=mE(A,oe,V,re,fe);function Z(Ge){return Se.destroyBuffer(Ge)}var Ce=m0(A,oe,fe,re),ee=bE(A,$,re,v),ye=W0(A,oe,V,function(){De.procs.poll()},ne,re,v),J=Y0(A,oe,V,re,v),_e=vE(A,oe,V,ye,J,re),De=XE(A,$,oe,V,fe,Ce,ye,_e,ve,Se,ee,L,ne,le,v),Ke=AE(A,_e,De.procs.poll,ne,B,oe,V),be=De.next,de=A.canvas,Q=[],We=[],rt=[],Ne=[v.onDestroy],ut=null;function Ze(){if(Q.length===0){le&&le.update(),ut=null;return}ut=qn.next(Ze),nr();for(var Ge=Q.length-1;Ge>=0;--Ge){var ft=Q[Ge];ft&&ft(ne,null,0)}A.flush(),le&&le.update()}function ot(){!ut&&Q.length>0&&(ut=qn.next(Ze))}function Et(){ut&&(qn.cancel(Ze),ut=null)}function zt(Ge){Ge.preventDefault(),q=!0,Et(),We.forEach(function(ft){ft()})}function Jt(Ge){A.getError(),q=!1,G.restore(),ee.restore(),fe.restore(),ye.restore(),J.restore(),_e.restore(),Se.restore(),le&&le.restore(),De.procs.refresh(),ot(),rt.forEach(function(ft){ft()})}de&&(de.addEventListener(Nf,zt,!1),de.addEventListener(Of,Jt,!1));function dt(){Q.length=0,Et(),de&&(de.removeEventListener(Nf,zt),de.removeEventListener(Of,Jt)),ee.clear(),_e.clear(),J.clear(),ye.clear(),Ce.clear(),fe.clear(),Se.clear(),le&&le.clear(),Ne.forEach(function(Ge){Ge()})}function Wt(Ge){y(!!Ge,"invalid args to regl({...})"),y.type(Ge,"object","invalid args to regl({...})");function ft(k){var C=n({},k);delete C.uniforms,delete C.attributes,delete C.context,delete C.vao,"stencil"in C&&C.stencil.op&&(C.stencil.opBack=C.stencil.opFront=C.stencil.op,delete C.stencil.op);function R(N){if(N in C){var E=C[N];delete C[N],Object.keys(E).forEach(function(S){C[N+"."+S]=E[S]})}}return R("blend"),R("depth"),R("cull"),R("stencil"),R("polygonOffset"),R("scissor"),R("sample"),"vao"in k&&(C.vao=k.vao),C}function _t(k,C){var R={},N={};return Object.keys(k).forEach(function(E){var S=k[E];if($t.isDynamic(S)){N[E]=$t.unbox(S,E);return}else if(C&&Array.isArray(S)){for(var m=0;m<S.length;++m)if($t.isDynamic(S[m])){N[E]=$t.unbox(S,E);return}}R[E]=S}),{dynamic:N,static:R}}var Ut=_t(Ge.context||{},!0),Br=_t(Ge.uniforms||{},!0),Ln=_t(Ge.attributes||{},!1),b=_t(ft(Ge),!1),U={gpuTime:0,cpuTime:0,count:0},F=De.compile(b,Ln,Br,Ut,U),xe=F.draw,ct=F.batch,_=F.scope,h=[];function w(k){for(;h.length<k;)h.push(null);return h}function P(k,C){var R;if(q&&y.raise("context lost"),typeof k=="function")return _.call(this,null,k,0);if(typeof C=="function")if(typeof k=="number")for(R=0;R<k;++R)_.call(this,null,C,R);else if(Array.isArray(k))for(R=0;R<k.length;++R)_.call(this,k[R],C,R);else return _.call(this,k,C,0);else if(typeof k=="number"){if(k>0)return ct.call(this,w(k|0),k|0)}else if(Array.isArray(k)){if(k.length)return ct.call(this,k,k.length)}else return xe.call(this,k)}return n(P,{stats:U,destroy:function(){F.destroy()}})}var Pt=_e.setFBO=Wt({framebuffer:$t.define.call(null,If,"framebuffer")});function Ht(Ge,ft){var _t=0;De.procs.poll();var Ut=ft.color;Ut&&(A.clearColor(+Ut[0]||0,+Ut[1]||0,+Ut[2]||0,+Ut[3]||0),_t|=QE),"depth"in ft&&(A.clearDepth(+ft.depth),_t|=ZE),"stencil"in ft&&(A.clearStencil(ft.stencil|0),_t|=JE),y(!!_t,"called regl.clear with no buffer specified"),A.clear(_t)}function Yt(Ge){if(y(typeof Ge=="object"&&Ge,"regl.clear() takes an object as input"),"framebuffer"in Ge)if(Ge.framebuffer&&Ge.framebuffer_reglType==="framebufferCube")for(var ft=0;ft<6;++ft)Pt(n({framebuffer:Ge.framebuffer.faces[ft]},Ge),Ht);else Pt(Ge,Ht);else Ht(null,Ge)}function qt(Ge){y.type(Ge,"function","regl.frame() callback must be a function"),Q.push(Ge);function ft(){var _t=Pf(Q,Ge);y(_t>=0,"cannot cancel a frame twice");function Ut(){var Br=Pf(Q,Ut);Q[Br]=Q[Q.length-1],Q.length-=1,Q.length<=0&&Et()}Q[_t]=Ut}return ot(),{cancel:ft}}function er(){var Ge=be.viewport,ft=be.scissor_box;Ge[0]=Ge[1]=ft[0]=ft[1]=0,ne.viewportWidth=ne.framebufferWidth=ne.drawingBufferWidth=Ge[2]=ft[2]=A.drawingBufferWidth,ne.viewportHeight=ne.framebufferHeight=ne.drawingBufferHeight=Ge[3]=ft[3]=A.drawingBufferHeight}function nr(){ne.tick+=1,ne.time=nt(),er(),De.procs.poll()}function Bt(){ye.refresh(),er(),De.procs.refresh(),le&&le.update()}function nt(){return(Bu()-se)/1e3}Bt();function ir(Ge,ft){y.type(ft,"function","listener callback must be a function");var _t;switch(Ge){case"frame":return qt(ft);case"lost":_t=We;break;case"restore":_t=rt;break;case"destroy":_t=Ne;break;default:y.raise("invalid event, must be one of frame,lost,restore,destroy")}return _t.push(ft),{cancel:function(){for(var Ut=0;Ut<_t.length;++Ut)if(_t[Ut]===ft){_t[Ut]=_t[_t.length-1],_t.pop();return}}}}var Tt=n(Wt,{clear:Yt,prop:$t.define.bind(null,If),context:$t.define.bind(null,tb),this:$t.define.bind(null,rb),draw:Wt({}),buffer:function(Ge){return fe.create(Ge,eb,!1,!1)},elements:function(Ge){return Ce.create(Ge,!1)},texture:ye.create2D,cube:ye.createCube,renderbuffer:J.create,framebuffer:_e.create,framebufferCube:_e.createCube,vao:Se.createVAO,attributes:B,frame:qt,on:ir,limits:V,hasExtension:function(Ge){return V.extensions.indexOf(Ge.toLowerCase())>=0},read:Ke,destroy:dt,_gl:A,_refresh:Bt,poll:function(){nr(),le&&le.update()},now:nt,stats:re});return v.onDone(null,Tt),Tt}return nb})})(Ry);const Ow=Ry.exports;var Iw=function(){function e(t,r){Fe(this,e),this.attribute=void 0,this.buffer=void 0;var n=r.buffer,i=r.offset,a=r.stride,o=r.normalized,s=r.size,u=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:o||!1,divisor:u||0},s&&(this.attribute.size=s)}return Ye(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Qr,ta,Zr,Cr,ra,vn,na,co,Ur,Dn,ar,$r,Vr,fo,Pw=(Qr={},Y(Qr,M.POINTS,"points"),Y(Qr,M.LINES,"lines"),Y(Qr,M.LINE_LOOP,"line loop"),Y(Qr,M.LINE_STRIP,"line strip"),Y(Qr,M.TRIANGLES,"triangles"),Y(Qr,M.TRIANGLE_FAN,"triangle fan"),Y(Qr,M.TRIANGLE_STRIP,"triangle strip"),Qr),Cy=(ta={},Y(ta,M.STATIC_DRAW,"static"),Y(ta,M.DYNAMIC_DRAW,"dynamic"),Y(ta,M.STREAM_DRAW,"stream"),ta),Fu=(Zr={},Y(Zr,M.BYTE,"int8"),Y(Zr,M.UNSIGNED_INT,"int16"),Y(Zr,M.INT,"int32"),Y(Zr,M.UNSIGNED_BYTE,"uint8"),Y(Zr,M.UNSIGNED_SHORT,"uint16"),Y(Zr,M.UNSIGNED_INT,"uint32"),Y(Zr,M.FLOAT,"float"),Zr),Lw=(Cr={},Y(Cr,M.ALPHA,"alpha"),Y(Cr,M.LUMINANCE,"luminance"),Y(Cr,M.LUMINANCE_ALPHA,"luminance alpha"),Y(Cr,M.RGB,"rgb"),Y(Cr,M.RGBA,"rgba"),Y(Cr,M.RGBA4,"rgba4"),Y(Cr,M.RGB5_A1,"rgb5 a1"),Y(Cr,M.RGB565,"rgb565"),Y(Cr,M.DEPTH_COMPONENT,"depth"),Y(Cr,M.DEPTH_STENCIL,"depth stencil"),Cr),Mw=(ra={},Y(ra,M.DONT_CARE,"dont care"),Y(ra,M.NICEST,"nice"),Y(ra,M.FASTEST,"fast"),ra),Sv=(vn={},Y(vn,M.NEAREST,"nearest"),Y(vn,M.LINEAR,"linear"),Y(vn,M.LINEAR_MIPMAP_LINEAR,"mipmap"),Y(vn,M.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),Y(vn,M.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),Y(vn,M.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),vn),wv=(na={},Y(na,M.REPEAT,"repeat"),Y(na,M.CLAMP_TO_EDGE,"clamp"),Y(na,M.MIRRORED_REPEAT,"mirror"),na),kw=(co={},Y(co,M.NONE,"none"),Y(co,M.BROWSER_DEFAULT_WEBGL,"browser"),co),Dw=(Ur={},Y(Ur,M.NEVER,"never"),Y(Ur,M.ALWAYS,"always"),Y(Ur,M.LESS,"less"),Y(Ur,M.LEQUAL,"lequal"),Y(Ur,M.GREATER,"greater"),Y(Ur,M.GEQUAL,"gequal"),Y(Ur,M.EQUAL,"equal"),Y(Ur,M.NOTEQUAL,"notequal"),Ur),Rv=(Dn={},Y(Dn,M.FUNC_ADD,"add"),Y(Dn,M.MIN_EXT,"min"),Y(Dn,M.MAX_EXT,"max"),Y(Dn,M.FUNC_SUBTRACT,"subtract"),Y(Dn,M.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Dn),lo=(ar={},Y(ar,M.ZERO,"zero"),Y(ar,M.ONE,"one"),Y(ar,M.SRC_COLOR,"src color"),Y(ar,M.ONE_MINUS_SRC_COLOR,"one minus src color"),Y(ar,M.SRC_ALPHA,"src alpha"),Y(ar,M.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),Y(ar,M.DST_COLOR,"dst color"),Y(ar,M.ONE_MINUS_DST_COLOR,"one minus dst color"),Y(ar,M.DST_ALPHA,"dst alpha"),Y(ar,M.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),Y(ar,M.CONSTANT_COLOR,"constant color"),Y(ar,M.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),Y(ar,M.CONSTANT_ALPHA,"constant alpha"),Y(ar,M.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),Y(ar,M.SRC_ALPHA_SATURATE,"src alpha saturate"),ar),Fw=($r={},Y($r,M.NEVER,"never"),Y($r,M.ALWAYS,"always"),Y($r,M.LESS,"less"),Y($r,M.LEQUAL,"lequal"),Y($r,M.GREATER,"greater"),Y($r,M.GEQUAL,"gequal"),Y($r,M.EQUAL,"equal"),Y($r,M.NOTEQUAL,"notequal"),$r),mi=(Vr={},Y(Vr,M.ZERO,"zero"),Y(Vr,M.KEEP,"keep"),Y(Vr,M.REPLACE,"replace"),Y(Vr,M.INVERT,"invert"),Y(Vr,M.INCR,"increment"),Y(Vr,M.DECR,"decrement"),Y(Vr,M.INCR_WRAP,"increment wrap"),Y(Vr,M.DECR_WRAP,"decrement wrap"),Vr),Gw=(fo={},Y(fo,M.FRONT,"front"),Y(fo,M.BACK,"back"),fo),Bw=function(){function e(t,r){Fe(this,e),this.buffer=void 0;var n=r.data,i=r.usage,a=r.type;this.buffer=t.buffer({data:n,usage:Cy[i||M.STATIC_DRAW],type:Fu[a||M.UNSIGNED_BYTE]})}return Ye(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.buffer.subdata(n,i)}}]),e}();function Uw(e){if(Array.isArray(e))return ob(e)}function $w(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Vw(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Kt(e){return Uw(e)||$w(e)||Cm(e)||Vw()}var jw=9007199254740991,zw="[object Arguments]",Hw="[object Array]",Xw="[object Boolean]",Ww="[object Date]",Yw="[object Error]",qw="[object Function]",Kw="[object Map]",Qw="[object Number]",Zw="[object Object]",Jw="[object RegExp]",eR="[object Set]",tR="[object String]",rR="[object WeakMap]",nR="[object ArrayBuffer]",iR="[object DataView]",aR="[object Float32Array]",oR="[object Float64Array]",sR="[object Int8Array]",uR="[object Int16Array]",cR="[object Int32Array]",fR="[object Uint8Array]",lR="[object Uint8ClampedArray]",dR="[object Uint16Array]",hR="[object Uint32Array]",Dt={};Dt[aR]=Dt[oR]=Dt[sR]=Dt[uR]=Dt[cR]=Dt[fR]=Dt[lR]=Dt[dR]=Dt[hR]=!0;Dt[zw]=Dt[Hw]=Dt[nR]=Dt[Xw]=Dt[iR]=Dt[Ww]=Dt[Yw]=Dt[qw]=Dt[Kw]=Dt[Qw]=Dt[Zw]=Dt[Jw]=Dt[eR]=Dt[tR]=Dt[rR]=!1;var vR=Object.prototype,pR=vR.toString;function mR(e){return _R(e)&&yR(e.length)&&!!Dt[pR.call(e)]}function yR(e){return typeof e=="number"&&e>-1&&e%1===0&&e<=jw}function _R(e){return!!e&&wi(e)==="object"}var Eu=mR;function Cv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function xv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Cv(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Cv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ER=`attribute vec3 a_Position;
attribute vec2 a_TexCoord;

varying vec2 v_TexCoord;

void main() {
  gl_Position = vec4(a_Position, 1.0);
  v_TexCoord = a_TexCoord;
}`,Nv=0,bR=function(){function e(t,r){var n=this;Fe(this,e),this.reGl=t,this.context=r,this.entity=zr(),this.texFBO=void 0,this.computeCommand=void 0,this.textureCache={},this.outputTextureName=void 0,this.swapOutputTextureName=void 0,this.compiledPingpong=void 0,this.dynamicPingpong=void 0;var i={};this.context.uniforms.forEach(function(c){var f=c.name,d=c.type,p=c.data,g=c.isReferer,T=c.storageClass;if(T===gn.StorageBuffer){if(g)n.textureCache[f]={data:void 0},i["".concat(f,"Size")]=function(){return p.compiledBundle.context.output.textureSize};else{n.textureCache[f]=n.calcDataTexture(f,d,p);var x=n.textureCache[f],O=x.textureWidth,z=x.isOutput;i["".concat(f,"Size")]=[O,O],z&&(n.outputTextureName=f,n.context.needPingpong&&(n.outputTextureName="".concat(f,"Output"),n.textureCache[n.outputTextureName]=n.calcDataTexture(f,d,p)))}i[f]=function(){return n.textureCache[f].texture}}else if(T===gn.Uniform){if(p&&(Array.isArray(p)||Eu(p))&&p.length>16)throw new Error("invalid data type ".concat(d));i[f]=function(){return c.data}}});var a=this.getOuputDataTexture(),o=a.textureWidth,s=a.texelCount;i.u_OutputTextureSize=[o,o],i.u_OutputTexelCount=s,this.context.output.textureSize=[o,o];var u={attributes:{a_Position:[[-1,1,0],[-1,-1,0],[1,1,0],[1,-1,0]],a_TexCoord:[[0,1],[0,0],[1,1],[1,0]]},frag:`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif
`.concat(this.context.shader),uniforms:i,vert:ER,primitive:"triangle strip",count:4};this.computeCommand=this.reGl(u)}return Ye(e,[{key:"run",value:function(){var r=this;this.context.maxIteration>1&&this.context.needPingpong&&(this.compiledPingpong=!0),(this.compiledPingpong||this.dynamicPingpong)&&this.swap(),this.texFBO=this.reGl.framebuffer({color:this.getOuputDataTexture().texture}),this.texFBO.use(function(){r.computeCommand()})}},{key:"readData",value:function(){var t=At(Me.mark(function n(){var i=this,a,o,s,u,c,f,d,p;return Me.wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(this.reGl({framebuffer:this.texFBO})(function(){a=i.reGl.read()}),!a){T.next=6;break}if(o=this.getOuputDataTexture(),s=o.originalDataLength,u=o.elementsPerTexel,c=o.typedArrayConstructor,f=c===void 0?Float32Array:c,d=[],u!==4)for(p=0;p<a.length;p+=4)u===1?d.push(a[p]):u===2?d.push(a[p],a[p+1]):d.push(a[p],a[p+1],a[p+2]);else d=a;return T.abrupt("return",new f(d.slice(0,s)));case 6:return T.abrupt("return",new Float32Array);case 7:case"end":return T.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"confirmInput",value:function(r,n){var i;this.entity===r.entity?(this.dynamicPingpong=!0,i=this):i=r,this.textureCache[n].id=i.getOuputDataTexture().id,this.textureCache[n].texture=i.getOuputDataTexture().texture}},{key:"updateUniform",value:function(){}},{key:"updateBuffer",value:function(r,n){var i=this.context.uniforms.find(function(u){var c=u.name;return c===r});if(i){var a=this.calcDataTexture(r,i.type,n),o=a.texture,s=a.data;this.textureCache[r].data=s,this.textureCache[r].texture=o}}},{key:"destroy",value:function(){}},{key:"swap",value:function(){if(this.swapOutputTextureName||this.createSwapOutputDataTexture(),this.compiledPingpong){var r=this.context.output.name;this.textureCache[r].id=this.getOuputDataTexture().id,this.textureCache[r].texture=this.getOuputDataTexture().texture}var n=this.outputTextureName;this.outputTextureName=this.swapOutputTextureName,this.swapOutputTextureName=n}},{key:"getOuputDataTexture",value:function(){return this.textureCache[this.outputTextureName]}},{key:"createSwapOutputDataTexture",value:function(){var r=this.cloneDataTexture(this.getOuputDataTexture());this.swapOutputTextureName="".concat(this.entity,"-swap"),this.textureCache[this.swapOutputTextureName]=r}},{key:"cloneDataTexture",value:function(r){var n=r.data,i=r.textureWidth;return xv(xv({},r),{},{id:Nv++,texture:this.reGl.texture({width:i,height:i,data:n,type:"float"})})}},{key:"calcDataTexture",value:function(r,n,i){var a=1;n===jn.Vector4FloatArray&&(a=4);for(var o=[],s=0;s<i.length;s+=a)a===1?o.push(i[s],0,0,0):a===2?o.push(i[s],i[s+1],0,0):a===3?o.push(i[s],i[s+1],i[s+2],0):a===4&&o.push(i[s],i[s+1],i[s+2],i[s+3]);var u=i.length,c=Math.ceil(u/a),f=Math.ceil(Math.sqrt(c)),d=f*f;c<d&&o.push.apply(o,Kt(new Array((d-c)*4).fill(0)));var p=this.reGl.texture({width:f,height:f,data:o,type:"float"});return{id:Nv++,data:o,originalDataLength:u,typedArrayConstructor:Eu(i)?i.constructor:void 0,textureWidth:f,texture:p,texelCount:c,elementsPerTexel:a,isOutput:r===this.context.output.name}}}]),e}(),gR=function(){function e(t,r){Fe(this,e),this.elements=void 0;var n=r.data,i=r.usage,a=r.type,o=r.count;this.elements=t.elements({data:n,usage:Cy[i||M.STATIC_DRAW],type:Fu[a||M.UNSIGNED_BYTE],count:o})}return Ye(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){this.elements.destroy()}}]),e}(),TR=function(){function e(t,r){Fe(this,e),this.framebuffer=void 0;var n=r.width,i=r.height,a=r.color,o=r.colors;r.depth,r.stencil;var s={width:n,height:i};Array.isArray(o)&&(s.colors=o.map(function(u){return u.get()})),a&&typeof a!="boolean"&&(s.color=a.get()),this.framebuffer=t.framebuffer(s)}return Ye(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.framebuffer.resize(n,i)}}]),e}();function AR(e){var t=wi(e);return e!=null&&(t==="object"||t==="function")}function va(e){var t={};return Object.keys(e).forEach(function(r){bu(r,e[r],t,"")}),t}function bu(e,t,r,n){if(t===null||typeof t=="number"||typeof t=="boolean"||Array.isArray(t)&&typeof t[0]=="number"||Eu(t)||t===""||t.resize!==void 0){r["".concat(n&&n+".").concat(e)]=t;return}AR(t)&&Object.keys(t).forEach(function(i){bu(i,t[i],r,"".concat(n&&n+".").concat(e))}),Array.isArray(t)&&t.forEach(function(i,a){Object.keys(i).forEach(function(o){bu(o,i[o],r,"".concat(n&&n+".").concat(e,"[").concat(a,"]"))})})}function Ov(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function yi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ov(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ov(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var SR=function(){function e(t,r){Fe(this,e),this.reGl=void 0,this.drawCommand=void 0,this.uniforms={},this.reGl=t;var n=r.vs,i=r.fs,a=r.defines,o=r.attributes,s=r.uniforms,u=r.primitive,c=r.count,f=r.elements,d=r.depth,p=r.blend,g=r.stencil,T=r.cull,x=r.instances,O=r.scissor,z=r.viewport,ie={};s&&(this.uniforms=va(s),Object.keys(s).forEach(function(Re){ie[Re]=t.prop(Re)}));var X={};Object.keys(o).forEach(function(Re){X[Re]=o[Re].get()});var Te=a&&this.generateDefines(a)||"",ce={attributes:X,frag:`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
#else
  precision mediump float;
#endif
`.concat(Te,`
`).concat(i),uniforms:ie,vert:`
`.concat(Te,`
`).concat(n),primitive:Pw[u===void 0?M.TRIANGLES:u]};x&&(ce.instances=x),c&&(ce.count=c),f&&(ce.elements=f.get()),O&&(ce.scissor=O),z&&(ce.viewport=z),this.initDepthDrawParams({depth:d},ce),this.initBlendDrawParams({blend:p},ce),this.initStencilDrawParams({stencil:g},ce),this.initCullDrawParams({cull:T},ce),this.drawCommand=t(ce)}return Ye(e,[{key:"addUniforms",value:function(r){this.uniforms=yi(yi({},this.uniforms),va(r))}},{key:"draw",value:function(r){var n=yi(yi({},this.uniforms),va(r.uniforms||{})),i={};Object.keys(n).forEach(function(a){var o=wi(n[a]);o==="boolean"||o==="number"||Array.isArray(n[a])||n[a].BYTES_PER_ELEMENT?i[a]=n[a]:o==="string"||(i[a]=n[a].get())}),this.drawCommand(i)}},{key:"destroy",value:function(){}},{key:"initDepthDrawParams",value:function(r,n){var i=r.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:Dw[i.func||M.LESS],range:i.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var i=r.blend;if(i){var a=i.enable,o=i.func,s=i.equation,u=i.color,c=u===void 0?[0,0,0,0]:u;n.blend={enable:!!a,func:{srcRGB:lo[o&&o.srcRGB||M.SRC_ALPHA],srcAlpha:lo[o&&o.srcAlpha||M.SRC_ALPHA],dstRGB:lo[o&&o.dstRGB||M.ONE_MINUS_SRC_ALPHA],dstAlpha:lo[o&&o.dstAlpha||M.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Rv[s&&s.rgb||M.FUNC_ADD],alpha:Rv[s&&s.alpha||M.FUNC_ADD]},color:c}}}},{key:"initStencilDrawParams",value:function(r,n){var i=r.stencil;if(i){var a=i.enable,o=i.mask,s=o===void 0?-1:o,u=i.func,c=u===void 0?{cmp:M.ALWAYS,ref:0,mask:-1}:u,f=i.opFront,d=f===void 0?{fail:M.KEEP,zfail:M.KEEP,zpass:M.KEEP}:f,p=i.opBack,g=p===void 0?{fail:M.KEEP,zfail:M.KEEP,zpass:M.KEEP}:p;n.stencil={enable:!!a,mask:s,func:yi(yi({},c),{},{cmp:Fw[c.cmp]}),opFront:{fail:mi[d.fail],zfail:mi[d.zfail],zpass:mi[d.zpass]},opBack:{fail:mi[g.fail],zfail:mi[g.zfail],zpass:mi[g.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var i=r.cull;if(i){var a=i.enable,o=i.face,s=o===void 0?M.BACK:o;n.cull={enable:!!a,face:Gw[s]}}}},{key:"generateDefines",value:function(r){return Object.keys(r).map(function(n){return"#define ".concat(n," ").concat(Number(r[n]))}).join(`
`)}}]),e}(),wR=function(){function e(t,r){Fe(this,e),this.texture=void 0,this.width=void 0,this.height=void 0;var n=r.data,i=r.type,a=i===void 0?M.UNSIGNED_BYTE:i,o=r.width,s=r.height,u=r.flipY,c=u===void 0?!1:u,f=r.format,d=f===void 0?M.RGBA:f,p=r.mipmap,g=p===void 0?!1:p,T=r.wrapS,x=T===void 0?M.CLAMP_TO_EDGE:T,O=r.wrapT,z=O===void 0?M.CLAMP_TO_EDGE:O,ie=r.aniso,X=ie===void 0?0:ie,Te=r.alignment,ce=Te===void 0?1:Te,Re=r.premultiplyAlpha,Le=Re===void 0?!1:Re,Xe=r.mag,vt=Xe===void 0?M.NEAREST:Xe,ht=r.min,yt=ht===void 0?M.NEAREST:ht,Qe=r.colorSpace,pt=Qe===void 0?M.BROWSER_DEFAULT_WEBGL:Qe;this.width=o,this.height=s;var $e={width:o,height:s,type:Fu[a],format:Lw[d],wrapS:wv[x],wrapT:wv[z],mag:Sv[vt],min:Sv[yt],alignment:ce,flipY:c,colorSpace:kw[pt],premultiplyAlpha:Le,aniso:X};n&&($e.data=n),typeof g=="number"?$e.mipmap=Mw[g]:typeof g=="boolean"&&($e.mipmap=g),this.texture=t.texture($e)}return Ye(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,i=r.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"destroy",value:function(){this.texture.destroy()}}]),e}(),Iv,Pv,Lv,RR=(Iv=Rt(),Iv(Pv=(Lv=function(){function e(){var t=this;Fe(this,e),this.supportWebGPU=!1,this.useWGSL=!1,this.$canvas=void 0,this.gl=void 0,this.inited=void 0,this.createModel=function(){var r=At(Me.mark(function n(i){return Me.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!i.uniforms){o.next=3;break}return o.next=3,Promise.all(Object.keys(i.uniforms).map(function(){var s=At(Me.mark(function u(c){var f;return Me.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(!(i.uniforms[c]&&i.uniforms[c].load!==void 0)){p.next=5;break}return p.next=3,i.uniforms[c].load();case 3:f=p.sent,i.uniforms[c]=f;case 5:case"end":return p.stop()}},u)}));return function(u){return s.apply(this,arguments)}}()));case 3:return o.abrupt("return",new SR(t.gl,i));case 4:case"end":return o.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.createAttribute=function(r){return new Iw(t.gl,r)},this.createBuffer=function(r){return new Bw(t.gl,r)},this.createElements=function(r){return new gR(t.gl,r)},this.createTexture2D=function(r){return new wR(t.gl,r)},this.createFramebuffer=function(r){return new TR(t.gl,r)},this.useFramebuffer=function(r,n){t.gl({framebuffer:r?r.get():null})(n)},this.createComputeModel=function(){var r=At(Me.mark(function n(i){return Me.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new bR(t.gl,i));case 1:case"end":return o.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.clear=function(r){var n=r.color,i=r.depth,a=r.stencil,o=r.framebuffer,s=o===void 0?null:o,u={color:n,depth:i,stencil:a};u.framebuffer=s===null?s:s.get(),t.gl.clear(u)},this.setScissor=function(r){t.gl&&t.gl._gl&&(r.enable&&r.box?(t.gl._gl.enable(M.SCISSOR_TEST),t.gl._gl.scissor(r.box.x,r.box.y,r.box.width,r.box.height)):t.gl._gl.disable(M.SCISSOR_TEST),t.gl._refresh())},this.viewport=function(r){var n=r.x,i=r.y,a=r.width,o=r.height;t.gl&&t.gl._gl&&(t.gl._gl.viewport(n,i,a,o),t.gl._refresh())},this.readPixels=function(r){var n=r.framebuffer,i=r.x,a=r.y,o=r.width,s=r.height,u={x:i,y:a,width:o,height:s};return n&&(u.framebuffer=n.get()),t.gl.read(u)},this.getCanvas=function(){return t.$canvas},this.getGLContext=function(){return t.gl._gl},this.destroy=function(){t.gl&&(t.gl.destroy(),t.inited=!1)}}return Ye(e,[{key:"init",value:function(){var t=At(Me.mark(function n(i){return Me.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.inited){o.next=2;break}return o.abrupt("return");case 2:return this.$canvas=i.canvas,o.next=5,new Promise(function(s,u){Ow({canvas:i.canvas,attributes:{alpha:!0,antialias:i.antialias,premultipliedAlpha:!0},pixelRatio:1,extensions:["OES_element_index_uint","OES_texture_float","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(f,d){(f||!d)&&u(f),s(d)}})});case 5:this.gl=o.sent,this.inited=!0;case 7:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"isFloatSupported",value:function(){return this.gl.limits.readFloat}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}(),Lv))||Pv);function CR(){return typeof window<"u"}function xR(e,t,r,n){if(!!CR()){var i=document.getElementsByTagName("head")[0],a=document.createElement("script");a.setAttribute("type","text/javascript"),a.setAttribute("src",e),n&&(a.id=n),a.onload=function(){t&&t()},a.onerror=function(o){r&&r("Unable to load script '".concat(e,"'"),o)},i.appendChild(a)}}function NR(e,t){return new Promise(function(r,n){xR(e,function(){r()},function(i,a){n(a)})})}var ho;function OR(){return gu.apply(this,arguments)}function gu(){return gu=At(Me.mark(function e(){return Me.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!ho){r.next=2;break}return r.abrupt("return",ho);case 2:return r.next=4,NR("https://preview.babylonjs.com/glslang/glslang.js");case 4:return ho=window.glslang("https://preview.babylonjs.com/glslang/glslang.wasm"),r.abrupt("return",ho);case 6:case"end":return r.stop()}},e)})),gu.apply(this,arguments)}var IR=function(){function e(t,r){Fe(this,e),this.engine=t,this.options=r,this.attribute=void 0,this.buffer=void 0;var n=r,i=n.buffer,a=n.offset,o=n.stride,s=n.normalized,u=n.size,c=n.divisor,f=n.arrayStride,d=n.attributes,p=n.stepMode;this.buffer=i,this.attribute={buffer:i.get(),offset:a||0,stride:o||0,normalized:s||!1,divisor:c||0,arrayStride:f||0,attributes:d,stepMode:p||"vertex"},u&&(this.attribute.size=u)}return Ye(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Ai=function(){function e(t,r){Fe(this,e),this.engine=t,this.options=r,this.buffer=void 0;var n=r,i=n.data,a=n.usage;n.type,this.buffer=this.createBuffer(i instanceof Array?new Float32Array(i):i,a||ge.BufferUsage.Vertex|ge.BufferUsage.CopyDst)}return Ye(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,i=r.offset;this.setSubData(this.buffer,i,n instanceof Array?new Float32Array(n):n)}},{key:"createBuffer",value:function(r,n){var i=r.byteLength%4,a={size:r.byteLength+i,usage:n},o=this.engine.device.createBuffer(a);return this.setSubData(o,0,r),o}},{key:"setSubData",value:function(r,n,i){var a=gr?this.engine.device.getQueue():this.engine.device.defaultQueue;a.writeBuffer(r,n,i)}}]),e}();function PR(e){return typeof e=="number"}var LR=function(){function e(t,r){Fe(this,e),this.engine=t,this.context=r,this.entity=zr(),this.uniformGPUBufferLayout=[],this.uniformBuffer=void 0,this.vertexBuffers={},this.outputBuffer=void 0,this.bindGroupEntries=void 0,this.bindGroup=void 0,this.computePipeline=void 0}return Ye(e,[{key:"init",value:function(){var t=At(Me.mark(function n(){var i=this,a,o,s,u,c,f,d;return Me.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,this.compileComputePipelineStageDescriptor(this.context.shader);case 2:a=g.sent,o=a.computeStage,s=this.context.uniforms.filter(function(T){return T.storageClass===gn.StorageBuffer}),u=this.context.uniforms.filter(function(T){return T.storageClass===gn.Uniform}),c=u.length?1:0,this.bindGroupEntries=[],c&&(f=0,d=[],u.forEach(function(T){if(PR(T.data))i.uniformGPUBufferLayout.push({name:T.name,offset:f}),f+=4,d.push(T.data);else{var x,O=((x=T.data)===null||x===void 0?void 0:x.length)||1;O===3&&(O=4,T.data.push(0));var z=f/4%4;if(z>0){var ie=4-z;if(O>1&&O<=ie)O===2&&(ie===3&&(f+=4,d.push(0)),d.push.apply(d,Kt(T.data)),i.uniformGPUBufferLayout.push({name:T.name,offset:f}));else{for(var X=0;X<ie;X++)f+=4,d.push(0);d.push.apply(d,Kt(T.data)),i.uniformGPUBufferLayout.push({name:T.name,offset:f})}}f+=4*O}}),this.uniformBuffer=new Ai(this.engine,{data:d instanceof Array?new Float32Array(d):d,usage:ge.BufferUsage.Uniform|ge.BufferUsage.CopyDst}),this.bindGroupEntries.push({binding:0,resource:{buffer:this.uniformBuffer.get()}})),s.forEach(function(T){if(T.data!==null&&(T.type===jn.Vector4FloatArray||T.type===jn.FloatArray)){var x;T.name===i.context.output.name?(x=new Ai(i.engine,{data:isFinite(Number(T.data))?[T.data]:T.data,usage:ge.BufferUsage.Storage|ge.BufferUsage.CopyDst|ge.BufferUsage.CopySrc}),i.outputBuffer=x,i.context.output={name:T.name,length:isFinite(Number(T.data))?1:T.data.length,typedArrayConstructor:Float32Array,gpuBuffer:x.get()}):T.isReferer?T.data.model&&T.data.model.outputBuffer&&(x=T.data.model.outputBuffer):x=new Ai(i.engine,{data:isFinite(Number(T.data))?[T.data]:T.data,usage:ge.BufferUsage.Storage|ge.BufferUsage.CopyDst|ge.BufferUsage.CopySrc}),i.vertexBuffers[T.name]=x,i.bindGroupEntries.push({binding:c,resource:{name:T.name,refer:x?void 0:T.data,buffer:x?x.get():void 0}}),c++}}),this.computePipeline=this.engine.device.createComputePipeline({computeStage:o}),console.log(this.bindGroupEntries),this.bindGroup=this.engine.device.createBindGroup({layout:this.computePipeline.getBindGroupLayout(0),entries:this.bindGroupEntries});case 13:case"end":return g.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r=this;this.uniformBuffer&&this.uniformBuffer.destroy(),Object.keys(this.vertexBuffers).forEach(function(n){return r.vertexBuffers[n].destroy()})}},{key:"readData",value:function(){var t=At(Me.mark(function n(){var i,a,o,s,u,c,f,d,p,g;return Me.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(i=this.context.output,!i){x.next=16;break}if(a=i.length,o=i.typedArrayConstructor,s=i.gpuBuffer,!s){x.next=16;break}return u=a*o.BYTES_PER_ELEMENT,c=this.engine.device.createBuffer({size:u,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),f=this.engine.device.createCommandEncoder(),f.copyBufferToBuffer(s,0,c,0,u),d=gr?this.engine.device.getQueue():this.engine.device.defaultQueue,d.submit([f.finish()]),x.next=12,c.mapAsync(ge.MapMode.Read);case 12:return p=c.getMappedRange(),g=new o(p.slice(0)),c.unmap(),x.abrupt("return",g);case 16:return x.abrupt("return",new Float32Array);case 17:case"end":return x.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"run",value:function(){if(this.engine.currentComputePass){var r;this.engine.currentComputePass.setPipeline(this.computePipeline),this.engine.currentComputePass.setBindGroup(0,this.bindGroup),(r=this.engine.currentComputePass).dispatch.apply(r,Kt(this.context.dispatch))}}},{key:"updateBuffer",value:function(r,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=this.vertexBuffers[r];a&&a.subData({data:n,offset:i})}},{key:"updateUniform",value:function(r,n){var i=this.uniformGPUBufferLayout.find(function(a){return a.name===r});i&&this.uniformBuffer.subData({data:Number.isFinite(n)?new Float32Array([n]):new Float32Array(n),offset:i.offset})}},{key:"confirmInput",value:function(r,n){var i=this.vertexBuffers[n],a=r.outputBuffer;if(i&&a&&i!==a){var o=this.engine.device.createCommandEncoder(),s=r.context.output,u=s.length,c=s.typedArrayConstructor,f=u*c.BYTES_PER_ELEMENT;o.copyBufferToBuffer(a.get(),0,i.get(),0,f);var d=gr?this.engine.device.getQueue():this.engine.device.defaultQueue;d.submit([o.finish()])}}},{key:"compileShaderToSpirV",value:function(r,n,i){return this.compileRawShaderToSpirV(i+r,n)}},{key:"compileRawShaderToSpirV",value:function(r,n){return this.engine.glslang.compileGLSL(r,n)}},{key:"compileComputePipelineStageDescriptor",value:function(){var t=At(Me.mark(function n(i){var a,o;return Me.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(a=i,o=`#version 450
`,this.engine.options.useWGSL){u.next=6;break}return u.next=5,this.compileShaderToSpirV(i,"compute",o);case 5:a=u.sent;case 6:return u.abrupt("return",{computeStage:{module:this.engine.device.createShaderModule({code:a,isWHLSL:gr}),entryPoint:"main"}});case 7:case"end":return u.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()}]),e}(),MR=function(){function e(t,r){Fe(this,e),this.engine=t,this.options=r,this.indexCount=void 0,this.buffer=void 0;var n=r,i=n.data;n.usage,n.type;var a=n.count;this.indexCount=a||0,this.buffer=new Ai(t,{data:i instanceof Array?new Uint16Array(i):i,usage:ge.BufferUsage.Index|ge.BufferUsage.CopyDst})}return Ye(e,[{key:"get",value:function(){return this.buffer}},{key:"subData",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),kR=function(){function e(t,r){Fe(this,e),this.engine=t,this.options=r,this.colorTexture=void 0,this.depthTexture=void 0,this.width=0,this.height=0;var n=r;n.width,n.height;var i=n.color;n.colors;var a=n.depth;n.stencil,i&&(this.colorTexture=i),a&&(this.depthTexture=a)}return Ye(e,[{key:"get",value:function(){var r,n;return{color:(r=this.colorTexture)===null||r===void 0?void 0:r.get(),depth:(n=this.depthTexture)===null||n===void 0?void 0:n.get()}}},{key:"destroy",value:function(){var r,n;(r=this.colorTexture)===null||r===void 0||r.destroy(),(n=this.depthTexture)===null||n===void 0||n.destroy()}},{key:"resize",value:function(r){var n=r.width,i=r.height;if(n!==this.width||i!==this.height){var a,o;(a=this.colorTexture)===null||a===void 0||a.resize({width:n,height:i}),(o=this.depthTexture)===null||o===void 0||o.resize({width:n,height:i})}this.width=n,this.height=i}}]),e}(),Jr,jr,Fn,mr,_i,vo,ia,DR=(Jr={},Y(Jr,M.POINTS,ge.PrimitiveTopology.PointList),Y(Jr,M.LINES,ge.PrimitiveTopology.LineList),Y(Jr,M.LINE_LOOP,ge.PrimitiveTopology.LineList),Y(Jr,M.LINE_STRIP,ge.PrimitiveTopology.LineStrip),Y(Jr,M.TRIANGLES,ge.PrimitiveTopology.TriangleList),Y(Jr,M.TRIANGLE_FAN,ge.PrimitiveTopology.TriangleList),Y(Jr,M.TRIANGLE_STRIP,ge.PrimitiveTopology.TriangleStrip),Jr),FR=(jr={},Y(jr,M.NEVER,ge.CompareFunction.Never),Y(jr,M.ALWAYS,ge.CompareFunction.Always),Y(jr,M.LESS,ge.CompareFunction.Less),Y(jr,M.LEQUAL,ge.CompareFunction.LessEqual),Y(jr,M.GREATER,ge.CompareFunction.Greater),Y(jr,M.GEQUAL,ge.CompareFunction.GreaterEqual),Y(jr,M.EQUAL,ge.CompareFunction.Equal),Y(jr,M.NOTEQUAL,ge.CompareFunction.NotEqual),jr),Mv=(Fn={},Y(Fn,M.FUNC_ADD,ge.BlendOperation.Add),Y(Fn,M.MIN_EXT,ge.BlendOperation.Min),Y(Fn,M.MAX_EXT,ge.BlendOperation.Max),Y(Fn,M.FUNC_SUBTRACT,ge.BlendOperation.Subtract),Y(Fn,M.FUNC_REVERSE_SUBTRACT,ge.BlendOperation.ReverseSubtract),Fn),po=(mr={},Y(mr,M.ZERO,ge.BlendFactor.Zero),Y(mr,M.ONE,ge.BlendFactor.One),Y(mr,M.SRC_COLOR,ge.BlendFactor.SrcColor),Y(mr,M.ONE_MINUS_SRC_COLOR,ge.BlendFactor.OneMinusSrcColor),Y(mr,M.SRC_ALPHA,ge.BlendFactor.SrcAlpha),Y(mr,M.ONE_MINUS_SRC_ALPHA,ge.BlendFactor.OneMinusSrcAlpha),Y(mr,M.DST_COLOR,ge.BlendFactor.DstColor),Y(mr,M.ONE_MINUS_DST_COLOR,ge.BlendFactor.OneMinusDstColor),Y(mr,M.DST_ALPHA,ge.BlendFactor.DstAlpha),Y(mr,M.ONE_MINUS_DST_ALPHA,ge.BlendFactor.OneMinusDstAlpha),Y(mr,M.CONSTANT_COLOR,ge.BlendFactor.BlendColor),Y(mr,M.ONE_MINUS_CONSTANT_COLOR,ge.BlendFactor.OneMinusBlendColor),Y(mr,M.SRC_ALPHA_SATURATE,ge.BlendFactor.SrcAlphaSaturated),mr),GR=(_i={},Y(_i,M.ALPHA,"r8unorm"),Y(_i,M.RGBA,"rgba8unorm"),Y(_i,M.DEPTH_COMPONENT,"depth32float"),Y(_i,M.DEPTH_STENCIL,"depth24plus-stencil8"),_i),kv=(vo={},Y(vo,M.NEAREST,"nearest"),Y(vo,M.LINEAR,"linear"),vo),iu=(ia={},Y(ia,M.REPEAT,"repeat"),Y(ia,M.CLAMP_TO_EDGE,"clamp-to-edge"),Y(ia,M.MIRRORED_REPEAT,"mirror-repeat"),ia);function BR(e){var t=e.cull;if(!t||!t.enable)return ge.CullMode.None;if(t.face)return t.face===M.FRONT?ge.CullMode.Front:ge.CullMode.Back}function UR(e){var t=e.depth;e.stencil;var r={compare:ge.CompareFunction.Always,depthFailOp:ge.StencilOperation.Keep,failOp:ge.StencilOperation.Keep,passOp:ge.StencilOperation.Keep};return{depthWriteEnabled:t&&t.enable,depthCompare:FR[(t==null?void 0:t.func)||M.ALWAYS],format:ge.TextureFormat.Depth24PlusStencil8,stencilFront:r,stencilBack:r,stencilReadMask:4294967295,stencilWriteMask:4294967295}}function $R(e,t){var r=e.blend;return[{format:t,alphaBlend:{srcFactor:po[r&&r.func&&r.func.srcAlpha||M.ONE],dstFactor:po[r&&r.func&&r.func.dstAlpha||M.ZERO],operation:Mv[r&&r.equation&&r.equation.alpha||M.FUNC_ADD]},colorBlend:{srcFactor:po[r&&r.func&&r.func.srcRGB||M.ONE],dstFactor:po[r&&r.func&&r.func.dstRGB||M.ZERO],operation:Mv[r&&r.equation&&r.equation.rgb||M.FUNC_ADD]},writeMask:ge.ColorWrite.All}]}function Dv(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Ei(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Dv(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dv(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VR(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,o=n;a<o.length;a++){var s=o[a];t+=s.length}for(var u=new e(t),c=0,f=0,d=n;f<d.length;f++){var p=d[f];u.set(p,c),c+=p.length}return u}var jR=function(){function e(t,r){Fe(this,e),this.engine=t,this.options=r,this.pipelineLayout=void 0,this.renderPipeline=void 0,this.uniformsBindGroupLayout=void 0,this.uniformBindGroup=void 0,this.uniformBuffer=void 0,this.uniforms={},this.uniformGPUBufferLayout=[],this.attributeCache={},this.indexBuffer=void 0,this.indexCount=void 0}return Ye(e,[{key:"init",value:function(){var t=At(Me.mark(function n(){var i=this,a,o,s,u,c,f,d,p,g,T,x,O,z,ie,X,Te;return Me.wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return a=this.options,o=a.vs,s=a.fs,u=a.attributes,c=a.uniforms,f=a.primitive,a.count,d=a.elements,p=a.depth,g=a.blend,T=a.stencil,x=a.cull,a.instances,Re.next=3,this.compilePipelineStageDescriptor(o,s,null);case 3:O=Re.sent,z=O.vertexStage,ie=O.fragmentStage,c&&this.buildUniformBindGroup(c),d&&(this.indexBuffer=d.get(),this.indexCount=d.indexCount),X={vertexBuffers:Object.keys(u).map(function(Le,Xe){var vt=u[Le],ht=vt.get(),yt=ht.arrayStride,Qe=ht.stepMode,pt=ht.attributes;return i.attributeCache[Le]=vt,{arrayStride:yt,stepMode:Qe,attributes:pt}})},Te={sampleCount:this.engine.mainPassSampleCount,primitiveTopology:DR[f||M.TRIANGLES],rasterizationState:Ei(Ei({},this.getDefaultRasterizationStateDescriptor()),{},{cullMode:BR({cull:x})}),depthStencilState:UR({depth:p,stencil:T}),colorStates:$R({blend:g},this.engine.options.swapChainFormat),layout:this.pipelineLayout,vertexStage:z,fragmentStage:ie,vertexState:X},this.renderPipeline=this.engine.device.createRenderPipeline(Te);case 11:case"end":return Re.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"addUniforms",value:function(r){this.uniforms=Ei(Ei({},this.uniforms),va(r))}},{key:"draw",value:function(r){var n=this,i=this.engine.getCurrentRenderPass(),a=Ei(Ei({},this.uniforms),va(r.uniforms||{})),o=[];Object.keys(a).forEach(function(s){var u=wi(a[s]);if(u==="boolean"||u==="number"||Array.isArray(a[s])||a[s].BYTES_PER_ELEMENT){var c,f=(c=n.uniformGPUBufferLayout.find(function(z){var ie=z.name;return ie===s}))===null||c===void 0?void 0:c.offset;f!==null&&n.uniformBuffer.subData({data:a[s],offset:f})}else{var d,p=(d=n.uniformGPUBufferLayout.find(function(z){var ie=z.name;return ie===s}))===null||d===void 0?void 0:d.offset;if(p!==null){var g=a[s].get(),T=g.color||g,x=T.texture,O=T.sampler;O&&(o.push({binding:p,resource:O}),p++),o.push({binding:p,resource:x.createView()})}}}),this.uniformBuffer&&(o[0]={binding:0,resource:{buffer:this.uniformBuffer.get()}}),this.uniformBindGroup=this.engine.device.createBindGroup({layout:this.uniformsBindGroupLayout,entries:o}),this.renderPipeline&&i.setPipeline(this.renderPipeline),i.setBindGroup(0,this.uniformBindGroup),this.indexBuffer&&i.setIndexBuffer(this.indexBuffer.get(),ge.IndexFormat.Uint32,0),Object.keys(this.attributeCache).forEach(function(s,u){i.setVertexBuffer(0+u,n.attributeCache[s].get().buffer,0)}),this.indexBuffer?i.drawIndexed(this.indexCount,this.options.instances||1,0,0,0):i.draw(this.options.count||0,this.options.instances||0,0,0)}},{key:"destroy",value:function(){throw new Error("Method not implemented.")}},{key:"compilePipelineStageDescriptor",value:function(){var t=At(Me.mark(function n(i,a,o){var s,u,c;return Me.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(s=`#version 450
`,u=i,c=a,this.engine.options.useWGSL){d.next=10;break}return d.next=6,this.compileShaderToSpirV(i,"vertex",s);case 6:return u=d.sent,d.next=9,this.compileShaderToSpirV(a,"fragment",s);case 9:c=d.sent;case 10:return d.abrupt("return",this.createPipelineStageDescriptor(u,c));case 11:case"end":return d.stop()}},n,this)}));function r(n,i,a){return t.apply(this,arguments)}return r}()},{key:"compileShaderToSpirV",value:function(r,n,i){return this.compileRawShaderToSpirV(i+r,n)}},{key:"compileRawShaderToSpirV",value:function(r,n){return this.engine.glslang.compileGLSL(r,n)}},{key:"createPipelineStageDescriptor",value:function(r,n){return{vertexStage:{module:this.engine.device.createShaderModule({code:r,isWHLSL:gr}),entryPoint:"main"},fragmentStage:{module:this.engine.device.createShaderModule({code:n,isWHLSL:gr}),entryPoint:"main"}}}},{key:"getDefaultRasterizationStateDescriptor",value:function(){return{frontFace:ge.FrontFace.CCW,cullMode:ge.CullMode.None,depthBias:0,depthBiasSlopeScale:0,depthBiasClamp:0}}},{key:"buildUniformBindGroup",value:function(r){var n=this,i=0,a=VR.apply(void 0,[Float32Array].concat(Kt(Object.keys(r).map(function(u){return r[u]?(n.uniformGPUBufferLayout.push({name:u,offset:i}),i+=(r[u].length||1)*4,r[u]):[]})))),o=[],s=!1;a.length&&(s=!0,o.push({binding:0,visibility:ge.ShaderStage.Fragment|ge.ShaderStage.Vertex,type:ge.BindingType.UniformBuffer})),Object.keys(r).filter(function(u){return r[u]===null}).forEach(function(u,c){n.uniformGPUBufferLayout.push({name:u,offset:c*2+(s?1:0)}),o.push({binding:c*2+(s?1:0),visibility:ge.ShaderStage.Fragment,type:ge.BindingType.Sampler},{binding:c*2+(s?1:0)+1,visibility:ge.ShaderStage.Fragment,type:ge.BindingType.SampledTexture})}),this.uniformsBindGroupLayout=this.engine.device.createBindGroupLayout({entries:o}),this.pipelineLayout=this.engine.device.createPipelineLayout({bindGroupLayouts:[this.uniformsBindGroupLayout]}),s&&(this.uniformBuffer=new Ai(this.engine,{data:a instanceof Array?new Float32Array(a):a,usage:ge.BufferUsage.Uniform|ge.BufferUsage.CopyDst}))}}]),e}(),zR=function(){function e(t,r){Fe(this,e),this.engine=t,this.options=r,this.texture=void 0,this.sampler=void 0,this.width=void 0,this.height=void 0,this.createTexture()}return Ye(e,[{key:"get",value:function(){return{texture:this.texture,sampler:this.sampler}}},{key:"update",value:function(){}},{key:"resize",value:function(r){var n=r.width,i=r.height;(n!==this.width||i!==this.height)&&(this.destroy(),this.createTexture()),this.width=n,this.height=i}},{key:"destroy",value:function(){this.texture&&this.texture.destroy()}},{key:"createTexture",value:function(){var r=this.options;r.data;var n=r.type;n===void 0&&M.UNSIGNED_BYTE;var i=r.width,a=r.height;r.flipY;var o=r.format,s=o===void 0?M.RGBA:o;r.mipmap;var u=r.wrapS,c=u===void 0?M.CLAMP_TO_EDGE:u,f=r.wrapT,d=f===void 0?M.CLAMP_TO_EDGE:f,p=r.aniso,g=p===void 0?0:p;r.alignment,r.premultiplyAlpha;var T=r.mag,x=T===void 0?M.NEAREST:T,O=r.min,z=O===void 0?M.NEAREST:O,ie=r.colorSpace;ie===void 0&&M.BROWSER_DEFAULT_WEBGL;var X=r.usage;this.width=i,this.height=a,this.texture=this.engine.device.createTexture({size:[i,a,1],mipLevelCount:1,sampleCount:1,dimension:ge.TextureDimension.E2d,format:GR[s],usage:X||ge.TextureUsage.Sampled|ge.TextureUsage.CopyDst}),(!X||X&ge.TextureUsage.Sampled)&&(this.sampler=this.engine.device.createSampler({addressModeU:iu[c],addressModeV:iu[d],addressModeW:iu[c],magFilter:kv[x],minFilter:kv[z],maxAnisotropy:g}))}}]),e}(),Fv,Gv,Bv,HR=(Fv=Rt(),Fv(Gv=(Bv=function(){function e(){var t=this;Fe(this,e),this.supportWebGPU=!0,this.useWGSL=!1,this.options=void 0,this.canvas=void 0,this.context=void 0,this.glslang=void 0,this.adapter=void 0,this.device=void 0,this.swapChain=void 0,this.mainPassSampleCount=void 0,this.mainTexture=void 0,this.depthTexture=void 0,this.mainColorAttachments=void 0,this.mainTextureExtends=void 0,this.mainDepthAttachment=void 0,this.uploadEncoder=void 0,this.renderEncoder=void 0,this.computeEncoder=void 0,this.renderTargetEncoder=void 0,this.commandBuffers=new Array(4).fill(void 0),this.currentRenderPass=null,this.mainRenderPass=null,this.currentRenderTargetViewDescriptor=void 0,this.currentComputePass=null,this.bundleEncoder=void 0,this.tempBuffers=[],this.currentRenderTarget=null,this.uploadEncoderDescriptor={label:"upload"},this.renderEncoderDescriptor={label:"render"},this.renderTargetEncoderDescriptor={label:"renderTarget"},this.computeEncoderDescriptor={label:"compute"},this.pipelines={},this.computePipelines={},this.defaultSampleCount=4,this.clearDepthValue=1,this.clearStencilValue=0,this.transientViewport={x:1/0,y:0,width:0,height:0},this.cachedViewport={x:0,y:0,width:0,height:0},this.clear=function(r){r.framebuffer;var n=r.color,i=r.depth,a=r.stencil;t.options.supportCompute&&t.startComputePass(),t.currentRenderTarget?(t.currentRenderPass&&t.endRenderTargetRenderPass(),t.startRenderTargetRenderPass(t.currentRenderTarget,n||null,!!i,!!a)):(t.mainColorAttachments[0].loadValue=n||ge.LoadOp.Load,t.mainDepthAttachment.depthLoadValue=i||ge.LoadOp.Load,t.mainDepthAttachment.stencilLoadValue=a?t.clearStencilValue:ge.LoadOp.Load,t.mainRenderPass&&t.endMainRenderPass(),t.startMainRenderPass())},this.createModel=function(){var r=At(Me.mark(function n(i){var a;return Me.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=new jR(t,i),s.next=3,a.init();case 3:return s.abrupt("return",a);case 4:case"end":return s.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.createAttribute=function(r){return new IR(t,r)},this.createBuffer=function(r){return new Ai(t,r)},this.createElements=function(r){return new MR(t,r)},this.createTexture2D=function(r){return new zR(t,r)},this.createFramebuffer=function(r){return new kR(t,r)},this.useFramebuffer=function(r,n){t.currentRenderTarget&&t.unbindFramebuffer(t.currentRenderTarget),t.currentRenderTarget=r,t.currentRenderTargetViewDescriptor={dimension:ge.TextureViewDimension.E2d,arrayLayerCount:1,aspect:ge.TextureAspect.All},t.currentRenderPass=null,n()},this.createComputeModel=function(){var r=At(Me.mark(function n(i){var a;return Me.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=new LR(t,i),s.next=3,a.init();case 3:return s.abrupt("return",a);case 4:case"end":return s.stop()}},n)}));return function(n){return r.apply(this,arguments)}}(),this.getCanvas=function(){return t.canvas},this.getGLContext=function(){throw new Error("Method not implemented.")},this.viewport=function(r){var n=r.x,i=r.y,a=r.width,o=r.height;if(!t.currentRenderPass)t.transientViewport={x:n,y:i,width:a,height:o};else if(t.transientViewport.x!==1/0){var s=t.getCurrentRenderPass();s.setViewport(t.transientViewport.x,t.transientViewport.y,t.transientViewport.width,t.transientViewport.height,0,1)}else if(n!==t.cachedViewport.x||i!==t.cachedViewport.y||a!==t.cachedViewport.width||o!==t.cachedViewport.height){t.cachedViewport={x:n,y:i,width:a,height:o};var u=t.getCurrentRenderPass();u.setViewport(n,i,a,o,0,1)}},this.readPixels=function(r){throw new Error("Method not implemented.")}}return Ye(e,[{key:"isFloatSupported",value:function(){return!0}},{key:"init",value:function(){var t=At(Me.mark(function n(i){return Me.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.canvas=i.canvas,this.options=i,this.useWGSL=!!i.useWGSL,this.mainPassSampleCount=i.antialiasing?this.defaultSampleCount:1,o.next=6,this.initGlslang();case 6:this.initContextAndSwapChain(),this.initMainAttachments();case 8:case"end":return o.stop()}},n,this)}));function r(n){return t.apply(this,arguments)}return r}()},{key:"setScissor",value:function(r){throw new Error("Method not implemented.")}},{key:"destroy",value:function(){this.mainTexture&&this.mainTexture.destroy(),this.depthTexture&&this.depthTexture.destroy(),this.tempBuffers.forEach(function(r){return r.destroy()}),this.tempBuffers=[]}},{key:"beginFrame",value:function(){this.uploadEncoder=this.device.createCommandEncoder(this.uploadEncoderDescriptor),this.renderEncoder=this.device.createCommandEncoder(this.renderEncoderDescriptor),this.renderTargetEncoder=this.device.createCommandEncoder(this.renderTargetEncoderDescriptor),this.options.supportCompute&&(this.computeEncoder=this.device.createCommandEncoder(this.computeEncoderDescriptor))}},{key:"endFrame",value:function(){this.options.supportCompute&&this.endComputePass(),this.endMainRenderPass(),this.commandBuffers[0]=this.uploadEncoder.finish(),this.commandBuffers[1]=this.renderEncoder.finish(),this.options.supportCompute&&(this.commandBuffers[2]=this.computeEncoder.finish()),this.commandBuffers[3]=this.renderTargetEncoder.finish(),gr?this.device.getQueue().submit(this.commandBuffers.filter(function(r){return r})):this.device.defaultQueue.submit(this.commandBuffers.filter(function(r){return r}))}},{key:"getCurrentRenderPass",value:function(){return this.currentRenderTarget&&!this.currentRenderPass?this.startRenderTargetRenderPass(this.currentRenderTarget,null,!1,!1):this.currentRenderPass||this.startMainRenderPass(),this.currentRenderPass}},{key:"initGlslang",value:function(){var t=At(Me.mark(function n(){var i,a;return Me.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,OR();case 2:return this.glslang=s.sent,s.next=5,(i=navigator)===null||i===void 0||(a=i.gpu)===null||a===void 0?void 0:a.requestAdapter();case 5:return this.adapter=s.sent,s.next=8,this.adapter.requestDevice();case 8:this.device=s.sent;case 9:case"end":return s.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"initContextAndSwapChain",value:function(){this.context=this.canvas.getContext(gr?"gpu":"gpupresent"),this.swapChain=this.context.configureSwapChain({device:this.device,format:this.options.swapChainFormat,usage:ge.TextureUsage.OutputAttachment|ge.TextureUsage.CopySrc})}},{key:"initMainAttachments",value:function(){if(this.mainTextureExtends={width:this.canvas.width,height:this.canvas.height,depth:1},this.options.antialiasing){var r={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:ge.TextureDimension.E2d,format:ge.TextureFormat.BGRA8Unorm,usage:ge.TextureUsage.OutputAttachment};this.mainTexture&&this.mainTexture.destroy(),this.mainTexture=this.device.createTexture(r),this.mainColorAttachments=[{attachment:gr?this.mainTexture.createDefaultView():this.mainTexture.createView(),loadValue:[0,0,0,1],storeOp:ge.StoreOp.Store}]}else this.mainColorAttachments=[{attachment:gr?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),loadValue:[0,0,0,1],storeOp:ge.StoreOp.Store}];var n={size:this.mainTextureExtends,mipLevelCount:1,sampleCount:this.mainPassSampleCount,dimension:ge.TextureDimension.E2d,format:gr?"depth32float-stencil8":ge.TextureFormat.Depth24PlusStencil8,usage:ge.TextureUsage.OutputAttachment};this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture(n),this.mainDepthAttachment={attachment:gr?this.depthTexture.createDefaultView():this.depthTexture.createView(),depthLoadValue:this.clearDepthValue,depthStoreOp:ge.StoreOp.Store,stencilLoadValue:this.clearStencilValue,stencilStoreOp:ge.StoreOp.Store}}},{key:"startComputePass",value:function(){this.currentComputePass&&this.endComputePass(),this.currentComputePass=this.computeEncoder.beginComputePass()}},{key:"startMainRenderPass",value:function(){this.currentRenderPass&&!this.currentRenderTarget&&this.endMainRenderPass(),this.options.antialiasing?this.mainColorAttachments[0].resolveTarget=gr?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView():this.mainColorAttachments[0].attachment=gr?this.swapChain.getCurrentTexture().createDefaultView():this.swapChain.getCurrentTexture().createView(),this.currentRenderPass=this.renderEncoder.beginRenderPass({colorAttachments:this.mainColorAttachments,depthStencilAttachment:this.mainDepthAttachment}),this.mainRenderPass=this.currentRenderPass,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"startRenderTargetRenderPass",value:function(r,n,i){var a,o,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,u=(a=r.get().color)===null||a===void 0?void 0:a.texture,c;u&&(c=u.createView(this.currentRenderTargetViewDescriptor));var f=(o=r.get().depth)===null||o===void 0?void 0:o.texture,d;f&&(d=f.createView());var p=this.renderTargetEncoder.beginRenderPass({colorAttachments:[{attachment:c,loadValue:n!==null?n:ge.LoadOp.Load,storeOp:ge.StoreOp.Store}],depthStencilAttachment:f&&d?{attachment:d,depthLoadValue:i?this.clearDepthValue:ge.LoadOp.Load,depthStoreOp:ge.StoreOp.Store,stencilLoadValue:s?this.clearStencilValue:ge.LoadOp.Load,stencilStoreOp:ge.StoreOp.Store}:void 0});this.currentRenderPass=p,this.cachedViewport&&this.viewport(this.cachedViewport)}},{key:"endMainRenderPass",value:function(){this.currentRenderPass===this.mainRenderPass&&this.currentRenderPass!==null&&(this.currentRenderPass.endPass(),this.resetCachedViewport(),this.currentRenderPass=null,this.mainRenderPass=null)}},{key:"endComputePass",value:function(){this.currentComputePass&&(this.currentComputePass.endPass(),this.currentComputePass=null)}},{key:"endRenderTargetRenderPass",value:function(){this.currentRenderPass&&(this.currentRenderPass.endPass(),this.resetCachedViewport())}},{key:"resetCachedViewport",value:function(){this.cachedViewport={x:0,y:0,width:0,height:0}}},{key:"unbindFramebuffer",value:function(r){this.currentRenderPass&&this.currentRenderPass!==this.mainRenderPass&&this.endRenderTargetRenderPass(),this.transientViewport.x=1/0,this.currentRenderTarget=null,this.currentRenderPass=this.mainRenderPass}}]),e}(),Bv))||Gv),Uv,$v;function XR(e){var t=WR();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function WR(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Tu=4/64,Vv=1-Tu*2,YR=(Uv=Rt(),Uv($v=function(e){fr(r,e);var t=XR(r);function r(){return Fe(this,r),t.apply(this,arguments)}return Ye(r,[{key:"onEntityCreated",value:function(){var i=this.config,a=i.widthSegments,o=a===void 0?1:a,s=i.heightSegments,u=s===void 0?1:s,c=i.depthSegments,f=c===void 0?1:c,d=i.halfExtents,p=d===void 0?lt(.5,.5,.5):d,g=o,T=u,x=f,O=ko(p,3),z=O[0],ie=O[1],X=O[2],Te=[lt(-z,-ie,X),lt(z,-ie,X),lt(z,ie,X),lt(-z,ie,X),lt(z,-ie,-X),lt(-z,-ie,-X),lt(-z,ie,-X),lt(z,ie,-X)],ce=[[0,1,3],[4,5,7],[3,2,6],[1,0,4],[1,4,2],[5,0,6]],Re=[[0,0,1],[0,0,-1],[0,1,0],[0,-1,0],[1,0,0],[-1,0,0]],Le={FRONT:0,BACK:1,TOP:2,BOTTOM:3,RIGHT:4,LEFT:5},Xe=[],vt=[],ht=[],yt=[],Qe=0,pt=function(pe,Ie,qe){var Ve,tt,Nt,Lt;for(Nt=0;Nt<=Ie;Nt++)for(Lt=0;Lt<=qe;Lt++){var Ot=Ct(),dr=Ct(),_r=Ct(),on=Ct();Vn(Ot,Te[ce[pe][0]],Te[ce[pe][1]],Nt/Ie),Vn(dr,Te[ce[pe][0]],Te[ce[pe][2]],Lt/qe),mu(_r,dr,Te[ce[pe][0]]),nn(on,Ot,_r),Ve=Nt/Ie,tt=Lt/qe,Xe.push(on[0],on[1],on[2]),vt.push(Re[pe][0],Re[pe][1],Re[pe][2]),ht.push(Ve,tt),Ve/=3,tt/=3,Ve=Ve*Vv+Tu,tt=tt*Vv+Tu,Ve+=pe%3/3,tt+=Math.floor(pe/3)/3,Nt<Ie&&Lt<qe&&(yt.push(Qe+qe+1,Qe+1,Qe),yt.push(Qe+qe+1,Qe+qe+2,Qe+1)),Qe++}};pt(Le.FRONT,g,T),pt(Le.BACK,g,T),pt(Le.TOP,g,x),pt(Le.BOTTOM,g,x),pt(Le.RIGHT,x,T),pt(Le.LEFT,x,T);var $e=ku(Xe),we=this.getComponent();we.indices=Uint32Array.from(yt),we.aabb=$e,we.vertexCount=Qe,we.attributes=[{dirty:!0,name:"position",data:Float32Array.from(Xe),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(vt),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(ht),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(_n))||$v);function qR(e,t){if(!e&&!t)throw new Error("Please specify valid arguments for parameters a and b.");if(!t||t.length===0)return e;if(!e||e.length===0)return t;if(Object.prototype.toString.call(e)!==Object.prototype.toString.call(t))throw new Error("The types of the two arguments passed for parameters a and b do not match.");var r=new e.constructor(e.length+t.length);return r.set(e),r.set(t,e.length),r}var jv,zv;function KR(e){var t=QR();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function QR(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var ZR=(jv=Rt(),jv(zv=function(e){fr(r,e);var t=KR(r);function r(){return Fe(this,r),t.apply(this,arguments)}return Ye(r,[{key:"onEntityCreated",value:function(){var i=this.config.geometries,a=i===void 0?[]:i,o=this.getComponent();o.aabb=new Mu;var s=[],u=[],c=0;a.forEach(function(f){var d=f.aabb,p=f.indices,g=f.vertexCount,T=f.attributes;o.aabb.add(d),o.vertexCount+=g,p&&u.push.apply(u,Kt(p.map(function(x){return x+c}))),c+=g,T.forEach(function(x,O){s[O]?x.data&&(Du(x.data)?s[O].push(x.data):Sy(x.data)?s[O].data=qR(s[O].data,x.data):s[O].data=s[O].data.concat(x.data)):(s[O]=x,s[O].dirty=!0)})}),o.attributes=s,o.indices=Uint32Array.from(u),o.dirty=!0}}]),r}(_n))||zv),Hv,Xv;function JR(e){var t=eC();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function eC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var tC=(Hv=Rt(),Hv(Xv=function(e){fr(r,e);var t=JR(r);function r(){return Fe(this,r),t.apply(this,arguments)}return Ye(r,[{key:"onEntityCreated",value:function(){for(var i=this.config,a=i.halfExtents,o=a===void 0?[.5,.5]:a,s=i.widthSegments,u=s===void 0?5:s,c=i.lengthSegments,f=c===void 0?5:c,d=[],p=[],g=[],T=[],x=0,O=0;O<=u;O++)for(var z=0;z<=f;z++){var ie=-o[0]+2*o[0]*O/u,X=0,Te=-(-o[1]+2*o[1]*z/f),ce=O/u,Re=z/f;d.push(ie,X,Te),p.push(0,1,0),g.push(ce,Re),O<u&&z<f&&(T.push(x+f+1,x+1,x),T.push(x+f+1,x+f+2,x+1)),x++}var Le=ku(d),Xe=this.getComponent();Xe.indices=Uint32Array.from(T),Xe.aabb=Le,Xe.vertexCount=x,Xe.attributes=[{dirty:!0,name:"position",data:Float32Array.from(d),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(p),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(g),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(_n))||Xv),Wv,Yv;function rC(e){var t=nC();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function nC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var iC=(Wv=Rt(),Wv(Yv=function(e){fr(r,e);var t=rC(r);function r(){return Fe(this,r),t.apply(this,arguments)}return Ye(r,[{key:"onEntityCreated",value:function(){for(var i=this.config,a=i.radius,o=a===void 0?.5:a,s=i.latitudeBands,u=s===void 0?16:s,c=i.longitudeBands,f=c===void 0?16:c,d=[],p=[],g=[],T=[],x=0;x<=u;x++)for(var O=x*Math.PI/u,z=Math.sin(O),ie=Math.cos(O),X=0;X<=f;X++){var Te=X*2*Math.PI/f-Math.PI/2,ce=Math.sin(Te),Re=Math.cos(Te),Le=Re*z,Xe=ie,vt=ce*z,ht=1-X/f,yt=1-x/u;d.push(Le*o,Xe*o,vt*o),p.push(Le,Xe,vt),g.push(ht,yt)}for(var Qe=0;Qe<u;++Qe)for(var pt=0;pt<f;++pt){var $e=Qe*(f+1)+pt,we=$e+f+1;T.push($e+1,we,$e),T.push($e+1,we+1,we)}var me=ku(d),pe=this.getComponent();pe.indices=Uint32Array.from(T),pe.aabb=me,pe.vertexCount=d.length/3,pe.attributes=[{dirty:!0,name:"position",data:Float32Array.from(d),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"}]},{dirty:!0,name:"normal",data:Float32Array.from(p),arrayStride:4*3,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float3"}]},{dirty:!0,name:"uv",data:Float32Array.from(g),arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float2"}]}]}}]),r}(_n))||Yv),qv,Kv,Qv,Zv,mo,Jv,ep,tp;function aC(e){var t=oC();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function oC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var sC=`varying vec4 fragColor;

#pragma include "uv.frag.declaration"
#pragma include "map.frag.declaration"

void main() {
  vec4 diffuseColor = fragColor;

  #pragma include "map.frag.main"

  gl_FragColor = diffuseColor;
}`,uC=`attribute vec3 position;
attribute vec3 normal;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform vec4 color;

varying vec4 fragColor;

#pragma include "uv.vert.declaration"

void main() {
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  fragColor = color;

  #pragma include "uv.vert.main"
}`,cC=`// layout(set = 0, binding = 1) uniform WireframeUniforms {
//   float lineWidth;
//   vec4 lineColor;
// } wireframe;

layout(location = 0) in vec4 fragColor;
// layout(location = 1) in vec3 v_Barycentric;

layout(location = 0) out vec4 outColor;

// wireframe
// float edgeFactor() {
//   vec3 d = fwidth(v_Barycentric);
//   vec3 a3 = smoothstep(vec3(0.0), d * wireframe.lineWidth, v_Barycentric);
//   return min(min(a3.x, a3.y), a3.z);
// }

void main() {
  // outColor = mix(fragColor, wireframe.lineColor, (1.0 - edgeFactor()));
  outColor = fragColor;
}`,fC=`layout(set = 0, binding = 0) uniform Uniforms {
  vec4 color;
  mat4 projectionMatrix;
  mat4 modelViewMatrix;
} uniforms;

layout(location = 0) in vec3 position;
// layout(location = 1) in vec3 barycentric;

layout(location = 0) out vec4 fragColor;
// layout(location = 1) out vec3 v_Barycentric;

void main() {
  gl_Position = uniforms.projectionMatrix * uniforms.modelViewMatrix * vec4(position, 1.0);
  fragColor = uniforms.color;
  // v_Barycentric = barycentric;
}`,lC=(qv=Rt(),Kv=He(te.RenderEngine),Qv=He(te.ShaderModuleService),qv(Zv=(mo=(tp=function(e){fr(r,e);var t=aC(r);function r(){var n;Fe(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),je(n,"engine",Jv,Xt(n)),je(n,"shaderModuleService",ep,Xt(n)),n}return Ye(r,[{key:"onEntityCreated",value:function(){var i=this.getComponent(),a=this.engine.supportWebGPU?fC:uC,o=this.engine.supportWebGPU?cC:sC;this.shaderModuleService.registerModule("material-basic",{vs:a,fs:o});var s=this.shaderModuleService.getModule("material-basic"),u=s.vs,c=s.fs,f=s.uniforms;i.vertexShaderGLSL=u,i.fragmentShaderGLSL=c,i.setUniform(f),this.config.map&&(i.setDefines({USE_UV:1,USE_MAP:1}),i.setUniform({map:this.config.map,uvTransform:Ta()}))}}]),r}(wy),tp),Jv=ze(mo.prototype,"engine",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep=ze(mo.prototype,"shaderModuleService",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mo))||Zv),rp,np,ip,ap,op,sp,up,aa,cp,fp,lp,dp;function dC(e){var t=hC();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function hC(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var vC=`// generate grid, borrow from clay.gl viewer
// @see https://github.com/pissang/clay-viewer/blob/master/src/graphic/ground.glsl
#extension GL_OES_standard_derivatives : enable

varying vec3 v_Position;
// varying vec3 v_Normal;

uniform float u_GridSize : 5;
uniform float u_GridSize2 : .5;
uniform vec4 u_GridColor : [0, 0, 0, 1];
uniform vec4 u_GridColor2 : [0.3, 0.3, 0.3, 1];
uniform bool u_GridEnabled : true;

// uniform vec3 u_LightDirection;
// uniform vec3 u_LightColor;
// uniform vec3 u_Camera;

void main() {
  // vec3 n = v_Normal;
  // vec3 l = normalize(u_LightDirection);
  // float NdotL = clamp(dot(n, l), 0.001, 1.0);

  gl_FragColor = vec4(1.);

  if (u_GridEnabled) {
    float wx = v_Position.x;
    float wz = v_Position.z;
    // float x0 = abs(fract(wx / u_GridSize - 0.5) - 0.5) / fwidth(wx) * u_GridSize / 2.0;
    // float z0 = abs(fract(wz / u_GridSize - 0.5) - 0.5) / fwidth(wz) * u_GridSize / 2.0;

    float x1 = abs(fract(wx / u_GridSize2 - 0.5) - 0.5) / fwidth(wx) * u_GridSize2;
    float z1 = abs(fract(wz / u_GridSize2 - 0.5) - 0.5) / fwidth(wz) * u_GridSize2;

    // float v0 = 1.0 - clamp(min(x0, z0), 0.0, 1.0);
    float v1 = 1.0 - clamp(min(x1, z1), 0.0, 1.0);
    // if (v0 > 0.1) {
        // gl_FragColor = mix(gl_FragColor, u_GridColor, v0);
    // }
    // else {
        gl_FragColor = mix(gl_FragColor, u_GridColor2, v1);
    // }
  }

  // float shadowFactor = calcShadow(u_ShadowMap, v_PositionFromLight, l, n);
  // vec3 diffuseColor = u_LightColor * NdotL * shadowFactor;

  // gl_FragColor.rgb *= diffuseColor;
}`,pC=`attribute vec3 a_Position;

varying vec3 v_Position;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;

void main() {
  v_Position = a_Position;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_Position, 1.);
}`,mC=(rp=Rt(),np=He(te.Systems),ip=Xr(te.MaterialSystem),ap=He(te.Systems),op=Xr(te.GeometrySystem),sp=He(te.ShaderModuleService),rp(up=(aa=(dp=function(e){fr(r,e);var t=dC(r);function r(){var n;Fe(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),je(n,"materialSystem",cp,Xt(n)),je(n,"geometrySystem",fp,Xt(n)),je(n,"shaderModuleService",lp,Xt(n)),n}return Ye(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();s&&s.material&&(a==="gridColor"?(s.material.setUniform("u_GridColor",o),s.material.setUniform("u_GridColor2",o)):a==="gridSize"&&(s.material.setUniform("u_GridSize",o),s.material.setUniform("u_GridSize2",o)))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:pC,fs:vC});var i=this.shaderModuleService.getModule("grid"),a=i.vs,o=i.fs,s=i.uniforms,u=this.materialSystem.createShaderMaterial({vertexShader:a,fragmentShader:o});this.setMaterial(u);var c=this.geometrySystem.createBufferGeometry({vertexCount:4});this.setGeometry(c),u.setCull({enable:!1,face:M.BACK}).setDepth({enable:!0,func:M.LESS}),u.setUniform(s),this.setAttributes({gridColor:this.config.gridColor,gridSize:this.config.gridSize}),c.setIndex([0,3,2,2,1,0]),c.setAttribute("a_Position",Float32Array.from([-4,-1,-4,4,-1,-4,4,-1,4,-4,-1,4]),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]})}}]),r}(yn),dp),cp=ze(aa.prototype,"materialSystem",[np,ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp=ze(aa.prototype,"geometrySystem",[ap,op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lp=ze(aa.prototype,"shaderModuleService",[sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aa))||up),xy=1e-6,Ny=yC;function yC(){var e=new Float32Array(2);return e[0]=0,e[1]=0,e}var _C=EC;function EC(e){var t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}var bC=gC;function gC(e,t){var r=new Float32Array(2);return r[0]=e,r[1]=t,r}var TC=AC;function AC(e,t){return e[0]=t[0],e[1]=t[1],e}var Oy=SC;function SC(e,t,r){return e[0]=t,e[1]=r,e}var wC=RC,hp=xy;function RC(e,t){var r=e[0],n=e[1],i=t[0],a=t[1];return Math.abs(r-i)<=hp*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=hp*Math.max(1,Math.abs(n),Math.abs(a))}var CC=xC;function xC(e,t){return e[0]===t[0]&&e[1]===t[1]}var Iy=NC;function NC(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}var Gu=OC;function OC(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}var Py={exports:{}};(function(e){e.exports=Gu})(Py);var Ly=IC;function IC(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}var My={exports:{}};(function(e){e.exports=Ly})(My);var ky=PC;function PC(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}var Dy={exports:{}};(function(e){e.exports=ky})(Dy);var LC=MC;function MC(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}var kC=DC;function DC(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}var FC=GC;function GC(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}var BC=UC;function UC(e,t,r){var n=Math.cos(r),i=Math.sin(r),a=t[0],o=t[1];return e[0]=a*n-o*i,e[1]=a*i+o*n,e}var $C=VC;function VC(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}var jC=zC;function zC(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}var HC=XC;function XC(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}var WC=YC;function YC(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}var qC=KC;function KC(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}var Fy=QC;function QC(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}var Gy={exports:{}};(function(e){e.exports=Fy})(Gy);var By=ZC;function ZC(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}var Uy={exports:{}};(function(e){e.exports=By})(Uy);var $y=JC;function JC(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}var Vy={exports:{}};(function(e){e.exports=$y})(Vy);var jy=ex;function ex(e){var t=e[0],r=e[1];return t*t+r*r}var zy={exports:{}};(function(e){e.exports=jy})(zy);var tx=rx;function rx(e,t){return e[0]=-t[0],e[1]=-t[1],e}var Hy=nx;function nx(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}var Xy=ix;function ix(e,t){return e[0]*t[0]+e[1]*t[1]}var ax=ox;function ox(e,t,r){var n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}var sx=ux;function ux(e,t,r,n){var i=t[0],a=t[1];return e[0]=i+n*(r[0]-i),e[1]=a+n*(r[1]-a),e}var cx=fx;function fx(e,t){t=t||1;var r=Math.random()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}var lx=dx;function dx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i,e[1]=r[1]*n+r[3]*i,e}var hx=vx;function vx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[2]*i+r[4],e[1]=r[1]*n+r[3]*i+r[5],e}var px=mx;function mx(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[3]*i+r[6],e[1]=r[1]*n+r[4]*i+r[7],e}var yx=_x;function _x(e,t,r){var n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e}var Ex=bx,bi=Ny();function bx(e,t,r,n,i,a){var o,s;for(t||(t=2),r||(r=0),n?s=Math.min(n*t+r,e.length):s=e.length,o=r;o<s;o+=t)bi[0]=e[o],bi[1]=e[o+1],i(bi,bi,a),e[o]=bi[0],e[o+1]=bi[1];return e}var gx=Tx;function Tx(e,t,r){var n=t[0]*t[0]+t[1]*t[1];if(n>r*r){var i=Math.sqrt(n);e[0]=t[0]/i*r,e[1]=t[1]/i*r}else e[0]=t[0],e[1]=t[1];return e}var yo={EPSILON:xy,create:Ny,clone:_C,fromValues:bC,copy:TC,set:Oy,equals:wC,exactEquals:CC,add:Iy,subtract:Gu,sub:Py.exports,multiply:Ly,mul:My.exports,divide:ky,div:Dy.exports,inverse:LC,min:kC,max:FC,rotate:BC,floor:$C,ceil:jC,round:HC,scale:WC,scaleAndAdd:qC,distance:Fy,dist:Gy.exports,squaredDistance:By,sqrDist:Uy.exports,length:$y,len:Vy.exports,squaredLength:jy,sqrLen:zy.exports,negate:tx,normalize:Hy,dot:Xy,cross:ax,lerp:sx,random:cx,transformMat2:lx,transformMat2d:hx,transformMat3:px,transformMat4:yx,forEach:Ex,limit:gx},Ax=Iy,Au=Oy,Wy=Hy,Sx=Gu,wx=Xy,vp=[0,0],Rx=function(t,r,n,i,a){return Ax(t,n,i),Wy(t,t),Au(r,-t[1],t[0]),Au(vp,-n[1],n[0]),a/wx(r,vp)},_o=function(t,r){return Au(t,-r[1],r[0]),t},pp=function(t,r,n){return Sx(t,r,n),Wy(t,t),t};function Eo(e,t,r,n,i){pa(t,n,-i),pa(t,n,i),e.push(r),e.push(r)}function pa(e,t,r){e.push([[t[0],t[1]],r])}function Cx(e,t,r){var n=[0,0],i=[0,0],a=[0,0],o=[0,0],s=-1,u=!1,c=null,f=yo.create(),d=r||0,p=3,g=[],T=[],x=[],O=[0,0];t&&(e=e.slice(),e.push(e[0]));for(var z=e.length,ie=1;ie<z;ie++){var X=d,Te=e[ie-1],ce=e[ie],Re=ie<e.length-1?e[ie+1]:null;if(O.push(ie/z,ie/z),pp(n,ce,Te),c||(c=[0,0],_o(c,n)),u||(u=!0,Eo(T,g,Te,c,1)),x.push([X+0,X+1,X+2]),!Re)_o(c,n),Eo(T,g,ce,c,1),x.push(s===1?[X,X+2,X+3]:[X+2,X+1,X+3]),d+=2;else{pp(i,Re,ce);var Le=Rx(a,o,n,i,1),Xe=yo.dot(a,c)<0?-1:1,vt=Le>p;if(!isFinite(Le)){_o(c,n),Eo(T,g,ce,c,1),x.push(s===1?[X,X+2,X+3]:[X+2,X+1,X+3]),d+=2,s=Xe;continue}vt?(Le=p,O.push(ie/z),pa(g,c,-Xe),T.push(ce),pa(g,o,Le*Xe),T.push(ce),x.push(s!==-Xe?[X,X+2,X+3]:[X+2,X+1,X+3]),x.push([X+2,X+3,X+4]),_o(f,i),yo.copy(c,f),pa(g,c,-Xe),T.push(ce),d+=3):(Eo(T,g,ce,o,Le),x.push(s===1?[X,X+2,X+3]:[X+2,X+1,X+3]),Xe=-1,yo.copy(c,o),d+=2),s=Xe}}return{normals:g,attrIndex:x,attrPos:T,attrCounters:O}}var mp,yp,_p,Ep,bp,gp,Tp,oa,Ap,Sp,wp,Rp;function xx(e){var t=Nx();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function Nx(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Ox=`uniform float u_dash_array : 0.02;
uniform float u_dash_offset : 0;
uniform float u_dash_ratio : 0;
uniform float u_thickness : 0.02;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_counters;

void main() {
    float blur = 1. - smoothstep(0.98, 1., length(v_normal));

    gl_FragColor = v_color;
    gl_FragColor.a *= blur * ceil(mod(v_counters + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));
}`,Ix=`attribute vec2 a_pos;
attribute vec4 a_color;
attribute float a_line_miter;
attribute vec2 a_line_normal;
attribute float a_counters;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;
uniform float u_thickness : 0.02;
uniform vec2 u_viewport;

varying vec4 v_color;
varying vec2 v_normal;
varying float v_counters;

void main() {
  v_color = a_color;
  v_counters = a_counters;

  vec3 normal = normalize(vec3(a_line_normal, 0.0));

  vec4 offset = vec4(normal * u_thickness / 2.0 * a_line_miter, 0.0);

  v_normal = vec2(normal * sign(a_line_miter));

  gl_Position = projectionMatrix * modelViewMatrix * vec4(a_pos, 0.0, 1.0) + offset;
}
`,Px=(mp=Rt(),yp=He(te.Systems),_p=Xr(te.MaterialSystem),Ep=He(te.Systems),bp=Xr(te.GeometrySystem),gp=He(te.ShaderModuleService),mp(Tp=(oa=(Rp=function(e){fr(r,e);var t=xx(r);function r(){var n;Fe(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),je(n,"materialSystem",Ap,Xt(n)),je(n,"geometrySystem",Sp,Xt(n)),je(n,"shaderModuleService",wp,Xt(n)),n.vertexCount=void 0,n}return Ye(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();if(s&&s.material)switch(a){case"dashArray":s.material.setUniform("u_dash_array",o);break;case"dashOffset":s.material.setUniform("u_dash_offset",o);break;case"dashRatio":s.material.setUniform("u_dash_ratio",o);break;case"thickness":s.material.setUniform("u_thickness",o);break;case"color":var u=new Array(this.vertexCount).fill(void 0).map(function(){return o}).reduce(function(c,f){return[].concat(Kt(c),Kt(f))},[]);s.geometry.setAttribute("a_color",Float32Array.from(u),{arrayStride:4*4,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]});break}}},{key:"onEntityCreated",value:function(){var i=this;this.shaderModuleService.registerModule("line",{vs:Ix,fs:Ox});var a=this.shaderModuleService.getModule("line"),o=a.vs,s=a.fs,u=a.uniforms,c=this.materialSystem.createShaderMaterial({vertexShader:o,fragmentShader:s}),f=Cx(this.config.points,!1),d=f.normals,p=f.attrIndex,g=f.attrPos,T=f.attrCounters,x=g.length;this.vertexCount=x;var O=this.geometrySystem.createBufferGeometry({vertexCount:x});this.setMaterial(c),this.setGeometry(O),c.setCull({enable:!1,face:M.BACK}).setUniform(u),this.setAttributes({dashArray:this.config.dashArray,dashOffset:this.config.dashOffset,dashRatio:this.config.dashRatio,thickness:this.config.thickness});var z=[],ie=[];d.forEach(function(Te){var ce=Te[0],Re=Te[1];z.push([ce[0],ce[1]]),ie.push(Re)}),O.setIndex(p.reduce(function(Te,ce){return[].concat(Kt(Te),Kt(ce))},[])),O.setAttribute("a_pos",Float32Array.from(g.reduce(function(Te,ce){return[].concat(Kt(Te),Kt(ce))},[])),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]});var X=new Array(x).fill(void 0).map(function(){return Kt(i.config.color)}).reduce(function(Te,ce){return[].concat(Kt(Te),Kt(ce))},[]);O.setAttribute("a_color",Float32Array.from(X),{arrayStride:4*4,stepMode:"vertex",attributes:[{shaderLocation:1,offset:0,format:"float4"}]}),O.setAttribute("a_line_miter",Float32Array.from(ie),{arrayStride:4*1,stepMode:"vertex",attributes:[{shaderLocation:2,offset:0,format:"float"}]}),O.setAttribute("a_line_normal",Float32Array.from(z.reduce(function(Te,ce){return[].concat(Kt(Te),Kt(ce))},[])),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:3,offset:0,format:"float2"}]}),O.setAttribute("a_counters",Float32Array.from(T),{arrayStride:4*1,stepMode:"vertex",attributes:[{shaderLocation:4,offset:0,format:"float"}]})}}]),r}(yn),Rp),Ap=ze(oa.prototype,"materialSystem",[yp,_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sp=ze(oa.prototype,"geometrySystem",[Ep,bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wp=ze(oa.prototype,"shaderModuleService",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oa))||Tp);function Lx(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}var Cp,xp,Np,Op,Ip,Pp,Lp,sa,Mp,kp,Dp,Fp;function Gp(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Mx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Gp(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kx(e){var t=Dx();return function(){var n=xt(e),i;if(t){var a=xt(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return lr(this,i)}}function Dx(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch{return!1}}var Fx=`uniform float u_blur : 0.05;
uniform float u_opacity : 0.7;
uniform float u_stroke_width : 0.01;
uniform vec4 u_stroke_color : [0, 0, 0, 0];
uniform float u_stroke_opacity : 1;

varying vec4 v_color;
varying vec4 v_data;
varying float v_radius;

#pragma include "sdf2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  // if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  // } else if (shape == 1) {
  //   outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
  //   inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  // } else if (shape == 2) {
  //   outer_df = sdBox(v_data.xy, vec2(1.));
  //   inner_df = sdBox(v_data.xy, vec2(r));
  // } else if (shape == 3) {
  //   outer_df = sdPentagon(v_data.xy, 0.8);
  //   inner_df = sdPentagon(v_data.xy, r * 0.8);
  // } else if (shape == 4) {
  //   outer_df = sdHexagon(v_data.xy, 0.8);
  //   inner_df = sdHexagon(v_data.xy, r * 0.8);
  // } else if (shape == 5) {
  //   outer_df = sdOctogon(v_data.xy, 1.0);
  //   inner_df = sdOctogon(v_data.xy, r);
  // } else if (shape == 6) {
  //   outer_df = sdHexagram(v_data.xy, 0.52);
  //   inner_df = sdHexagram(v_data.xy, r * 0.52);
  // } else if (shape == 7) {
  //   outer_df = sdRhombus(v_data.xy, vec2(1.0));
  //   inner_df = sdRhombus(v_data.xy, vec2(r));
  // } else if (shape == 8) {
  //   outer_df = sdVesica(v_data.xy, 1.1, 0.8);
  //   inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  // }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  vec4 strokeColor = u_stroke_color == vec4(0) ? v_color : u_stroke_color;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  gl_FragColor.a = gl_FragColor.a * opacity_t;

  gl_FragColor = filterColor(gl_FragColor);
}`,Gx=`attribute vec2 position;
attribute vec4 color;
attribute float shape;
attribute vec2 offset;
attribute float size;

uniform mat4 projectionMatrix;
uniform mat4 modelViewMatrix;

uniform float u_stroke_width : 0.01;
uniform float u_device_pixel_ratio;
uniform vec2 u_viewport;

varying vec4 v_color;
varying vec4 v_data;
varying float v_radius;

#pragma include "picking"

void main() {
  v_color = color;
  v_radius = size;

  lowp float antialiasblur = 1.0 / u_device_pixel_ratio * (size + u_stroke_width);

  // construct point coords
  v_data = vec4(position, antialiasblur, shape);

  gl_Position = projectionMatrix * modelViewMatrix
    * vec4(position * size + offset, 0.0, 1.0);

  setPickingColor(a_PickingColor);
}`,Bx=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],Ux=(Cp=Rt(),xp=He(te.Systems),Np=Xr(te.MaterialSystem),Op=He(te.Systems),Ip=Xr(te.GeometrySystem),Pp=He(te.ShaderModuleService),Cp(Lp=(sa=(Fp=function(e){fr(r,e);var t=kx(r);function r(){var n;Fe(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return n=t.call.apply(t,[this].concat(a)),je(n,"materialSystem",Mp,Xt(n)),je(n,"geometrySystem",kp,Xt(n)),je(n,"shaderModuleService",Dp,Xt(n)),n}return Ye(r,[{key:"onAttributeChanged",value:function(i){var a=i.name,o=i.data,s=this.getMeshComponent();s&&s.material&&(a==="strokeWidth"?s.material.setUniform("u_stroke_width",o):a==="strokeColor"?s.material.setUniform("u_stroke_color",o):a==="strokeOpacity"?s.material.setUniform("u_stroke_opacity",o):a==="opacity"?s.material.setUniform("u_opacity",o):a==="blur"&&s.material.setUniform("u_blur",o))}},{key:"onEntityCreated",value:function(){this.shaderModuleService.registerModule("grid",{vs:Gx,fs:Fx});var i=this.shaderModuleService.getModule("grid"),a=i.vs,o=i.fs,s=i.uniforms,u=this.materialSystem.createShaderMaterial({vertexShader:a,fragmentShader:o,cull:{enable:!1},depth:{enable:!1},blend:{enable:!0,func:{srcRGB:M.SRC_ALPHA,dstRGB:M.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}});u.setUniform(Mx({u_device_pixel_ratio:window.devicePixelRatio},s));var c=this.buildAttributes(),f=this.geometrySystem.createInstancedBufferGeometry({maxInstancedCount:c.instancedOffsets.length/2,vertexCount:6});f.setIndex([0,2,1,0,3,2]),f.setAttribute("position",Float32Array.from(c.positions),{arrayStride:4*2,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float2"}]}),f.setAttribute("offset",Float32Array.from(c.instancedOffsets),{arrayStride:4*2,stepMode:"instance",attributes:[{shaderLocation:1,offset:0,format:"float2"}]}),f.setAttribute("color",Float32Array.from(c.instancedColors),{arrayStride:4*4,stepMode:"instance",attributes:[{shaderLocation:2,offset:0,format:"float4"}]}),f.setAttribute("size",Float32Array.from(c.instancedSizes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:3,offset:0,format:"float"}]}),f.setAttribute("shape",Float32Array.from(c.instancedShapes),{arrayStride:4,stepMode:"instance",attributes:[{shaderLocation:4,offset:0,format:"float"}]}),f.setAttribute("a_PickingColor",Float32Array.from(c.instancedPickingColors),{arrayStride:4*3,stepMode:"instance",attributes:[{shaderLocation:6,offset:0,format:"float3"}]}),this.setMaterial(u),this.setGeometry(f)}},{key:"buildAttribute",value:function(i,a,o){var s,u,c,f;(s=a.instancedPickingColors).push.apply(s,Kt(Lx(i.id||o))),a.instancedShapes.push(Bx.indexOf(i.shape||"circle")),(u=a.instancedColors).push.apply(u,Kt(i.color||[1,0,0,1])),(c=a.instancedOffsets).push.apply(c,Kt(i.position||[0,0])),(f=a.instancedSizes).push.apply(f,Kt(i.size||[.2,.2]))}},{key:"buildAttributes",value:function(){var i=this,a={positions:[1,1,1,-1,-1,-1,-1,1],instancedOffsets:[],instancedColors:[],instancedSizes:[],instancedShapes:[],instancedPickingColors:[]};return Array.isArray(this.config)?this.config.forEach(function(o,s){i.buildAttribute(o,a,s)}):this.buildAttribute(this.config,a,0),a}}]),r}(yn),Fp),Mp=ze(sa.prototype,"materialSystem",[xp,Np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kp=ze(sa.prototype,"geometrySystem",[Op,Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=ze(sa.prototype,"shaderModuleService",[Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sa))||Lp),Bp,Up,$p,Vp,jp,ua,zp,Hp,Xp,Wp;function Yp(e,t){var r;if(typeof Symbol>"u"||e[Symbol.iterator]==null){if(Array.isArray(e)||(r=$x(e))||t&&e&&typeof e.length=="number"){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(c){throw c},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,o=!1,s;return{s:function(){r=e[Symbol.iterator]()},n:function(){var c=r.next();return a=c.done,c},e:function(c){o=!0,s=c},f:function(){try{!a&&r.return!=null&&r.return()}finally{if(o)throw s}}}}function $x(e,t){if(!!e){if(typeof e=="string")return qp(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return qp(e,t)}}function qp(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Vx=`#ifdef USE_MAP
  uniform sampler2D map;
#endif`,jx=`#ifdef USE_MAP
  vec4 texelColor = texture2D(map, vUv);
  // texelColor = mapTexelToLinear(texelColor);
  diffuseColor *= texelColor;
#endif`,zx=`#if (defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ))
  varying vec2 vUv;
#endif`,Hx=`#ifdef USE_UV
  attribute vec2 uv;
	#ifdef UVS_VERTEX_ONLY
    vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,Xx=`#ifdef USE_UV
  vUv = (uvTransform * vec3(uv, 1)).xy;
#endif`,Kp=(Bp=Rt(),Up=He(te.RenderEngine),$p=He(te.ShaderModuleService),Vp=He(te.ConfigService),Bp(jp=(ua=(Wp=function(){function e(){Fe(this,e),this.container=void 0,je(this,"engine",zp,this),je(this,"shaderModule",Hp,this),je(this,"configService",Xp,this),this.inited=!1,this.rendering=!1,this.pendings=[],this.views=[],this.size=void 0}return Ye(e,[{key:"init",value:function(){var t=At(Me.mark(function n(){var i,a,o,s,u;return Me.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.shaderModule.registerBuiltinModules(),this.shaderModule.registerModule("uv.vert.declaration",{vs:Hx}),this.shaderModule.registerModule("uv.vert.main",{vs:Xx}),this.shaderModule.registerModule("uv.frag.declaration",{fs:zx}),this.shaderModule.registerModule("map.frag.declaration",{fs:Vx}),this.shaderModule.registerModule("map.frag.main",{fs:jx}),i=this.container.getAll(te.Systems),a=this.configService.get(),!a.canvas){f.next=30;break}return f.next=11,this.engine.init({canvas:a.canvas,swapChainFormat:ge.TextureFormat.BGRA8Unorm,antialiasing:!1});case 11:o=Yp(i),f.prev=12,o.s();case 14:if((s=o.n()).done){f.next=21;break}if(u=s.value,!u.initialize){f.next=19;break}return f.next=19,u.initialize();case 19:f.next=14;break;case 21:f.next=26;break;case 23:f.prev=23,f.t0=f.catch(12),o.e(f.t0);case 26:return f.prev=26,o.f(),f.finish(26);case 29:this.inited=!0;case 30:case"end":return f.stop()}},n,this,[[12,23,26,29]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"render",value:function(){var t=At(Me.mark(function n(){var i,a,o,s,u,c,f,d=arguments;return Me.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(!this.inited||this.rendering)){g.next=2;break}return g.abrupt("return");case 2:for(this.pendings.length&&this.pendings.forEach(function(T){T()}),this.rendering=!0,this.engine.beginFrame(),i=this.container.getAll(te.Systems),a=d.length,o=new Array(a),s=0;s<a;s++)o[s]=d[s];u=Yp(i),g.prev=8,u.s();case 10:if((c=u.n()).done){g.next=17;break}if(f=c.value,!f.execute){g.next=15;break}return g.next=15,f.execute(o);case 15:g.next=10;break;case 17:g.next=22;break;case 19:g.prev=19,g.t0=g.catch(8),u.e(g.t0);case 22:return g.prev=22,u.f(),g.finish(22);case 25:this.engine.endFrame(),this.rendering=!1;case 27:case"end":return g.stop()}},n,this,[[8,19,22,25]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"clear",value:function(r){var n=this;return this.inited?this.engine.clear(r):this.pendings.unshift(function(){n.engine.clear(r),n.pendings.shift()}),this}},{key:"setSize",value:function(r){var n=r.width,i=r.height,a=this.engine.getCanvas();return this.size={width:n,height:i},a.width=n,a.height=i,this}},{key:"getSize",value:function(){return this.size}}]),e}(),Wp),zp=ze(ua.prototype,"engine",[Up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hp=ze(ua.prototype,"shaderModule",[$p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=ze(ua.prototype,"configService",[Vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ua))||jp),Qp,Zp,Jp,em=(Qp=Rt(),Qp(Zp=(Jp=function(){function e(){Fe(this,e),this.entities=[]}return Ye(e,[{key:"getEntities",value:function(){return this.entities}},{key:"addRenderable",value:function(r){return this.addEntity(r.getEntity()),this}},{key:"removeRenderable",value:function(r){return this.removeEntity(r.getEntity()),this}},{key:"addLight",value:function(){}},{key:"addEntity",value:function(r){return this.entities.indexOf(r)===-1&&this.entities.push(r),this}},{key:"removeEntity",value:function(r){var n=this.entities.indexOf(r);return this.entities.splice(n,1),this}}]),e}(),Jp))||Zp),tm,rm,nm,Yy=(tm=Rt(),tm(rm=(nm=function(){function e(){Fe(this,e),this.cache={}}return Ye(e,[{key:"get",value:function(r){return this.cache[r]}},{key:"set",value:function(r,n){this.cache[r]=n}}]),e}(),nm))||rm),im,am,om,sm,bo,um,cm,fm;function lm(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function dm(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lm(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var hm=(im=Rt(),am=He(Yy),om=He(te.RenderEngine),im(sm=(bo=(fm=function(){function e(){Fe(this,e),je(this,"textureCache",um,this),je(this,"engine",cm,this),this.config=void 0,this.loaded=!1,this.texture=void 0}return Ye(e,[{key:"setConfig",value:function(r){this.config=r}},{key:"isLoaded",value:function(){return this.loaded}},{key:"load",value:function(){var t=At(Me.mark(function n(){var i=this;return Me.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.config.url){o.next=4;break}return o.abrupt("return",new Promise(function(s,u){var c=i.textureCache.get(i.config.url);if(c)s(c);else{var f=new Image;f.crossOrigin="Anonymous",f.src=i.config.url,f.onload=function(){var d=i.engine.createTexture2D(dm(dm({},i.config),{},{data:f,width:f.width,height:f.height,flipY:!0}));i.textureCache.set(i.config.url,d),i.texture=d,i.loaded=!0,s(d)},f.onerror=function(){u()}}}));case 4:return this.loaded=!0,this.texture=this.engine.createTexture2D(this.config),o.abrupt("return",this.texture);case 7:case"end":return o.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()}]),e}(),fm),um=ze(bo.prototype,"textureCache",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=ze(bo.prototype,"engine",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bo))||sm),vm,pm,mm,ym,au,_m,Em,bm=(vm=Rt(),pm=He(te.Systems),mm=Xr(te.RendererSystem),vm(ym=(au=(Em=function(){function e(){Fe(this,e),je(this,"rendererSystem",_m,this),this.camera=void 0,this.scene=void 0,this.viewport={x:0,y:0,width:0,height:0},this.clearColor=[1,1,1,1]}return Ye(e,[{key:"getCamera",value:function(){return this.camera}},{key:"getScene",value:function(){return this.scene}},{key:"getViewport",value:function(){return this.viewport}},{key:"getClearColor",value:function(){return this.clearColor}},{key:"setCamera",value:function(r){return this.camera=r,this}},{key:"setScene",value:function(r){return this.scene=r,this}},{key:"setViewport",value:function(r){return this.viewport=r,this}},{key:"setClearColor",value:function(r){return this.clearColor=r,this}},{key:"pick",value:function(r){return this.rendererSystem.pick(r,this)}}]),e}(),Em),_m=ze(au.prototype,"rendererSystem",[pm,mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),au))||ym),gm,Tm,Am,ou,Sm,wm;function Rm(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Wx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Rm(Object(r),!0).forEach(function(n){Y(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}gm=Rt(),Tm=He(te.ConfigService),gm(Am=(ou=(wm=function(){function e(){Fe(this,e),je(this,"configService",Sm,this),this.container=void 0}return Ye(e,[{key:"getEngine",value:function(){var t=At(Me.mark(function n(){var i,a,o,s;return Me.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return i=this.container.get(te.RenderEngine),a=this.configService.get(),o=a.canvas,s=a.engineOptions,c.next=4,i.init(Wx({canvas:o||Ay(),swapChainFormat:ge.TextureFormat.BGRA8Unorm,antialiasing:!1},s));case 4:return c.abrupt("return",i);case 5:case"end":return c.stop()}},n,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"getTransformComponent",value:function(r){var n=this.container.get(te.TransformComponentManager);return n.getComponentByEntity(r)}},{key:"getMeshComponent",value:function(r){var n=this.container.get(te.MeshComponentManager);return n.getComponentByEntity(r)}},{key:"setConfig",value:function(r){this.configService.set(r)}},{key:"setContainer",value:function(r){this.container=r}},{key:"getContainer",value:function(){return this.container}},{key:"createEntity",value:function(){return zr()}},{key:"createScene",value:function(){return this.container.get(em)}},{key:"createCamera",value:function(){return this.container.get(zh)}},{key:"createView",value:function(){return this.container.get(bm)}},{key:"createRenderable",value:function(r,n){var i=r?this.container.getNamed(te.Renderable,r):this.container.get(yn),a=zr();return i.setConfig(n||{}),i.setEntity(a),i}},{key:"createGeometry",value:function(r,n){var i=this.container.getNamed(te.Geometry,r),a=zr();return i.setConfig(n||{}),i.setEntity(a),i.getComponent()}},{key:"createMaterial",value:function(r,n){var i=this.container.getNamed(te.Material,r),a=zr();return i.setConfig(n||{}),i.setEntity(a,r),i.getComponent()}},{key:"createTexture2D",value:function(r){var n=this.container.get(hm);return n.setConfig(r),n}},{key:"createBufferGeometry",value:function(r){var n=this.container.getNamed(te.Systems,te.GeometrySystem);return n.createBufferGeometry(r)}},{key:"createInstancedBufferGeometry",value:function(r){var n=this.container.getNamed(te.Systems,te.GeometrySystem);return n.createInstancedBufferGeometry(r)}},{key:"createShaderMaterial",value:function(r){var n=this.container.getNamed(te.Systems,te.MaterialSystem);return n.createShaderMaterial(r)}},{key:"createKernel",value:function(r){var n=this.container.get(av);return typeof r=="string"?n.setBundle(JSON.parse(r)):n.setBundle(r),n.init(),n}},{key:"createRenderer",value:function(){var r=this.container.get(Kp);return r.container=this.container,r.init(),r}},{key:"destroy",value:function(){var r=this.container.getAll(te.Systems);r.forEach(function(a){a.tearDown&&a.tearDown()});var n=this.container.get(te.RenderEngine);n.destroy();var i=this.container.get(te.InteractorService);i.destroy()}}],[{key:"create",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=q1(),i=navigator.gpu?HR:RR;n.isBound(te.RenderEngine)||n.bind(te.RenderEngine).to(i).inSingletonScope(),n.bind(Kp).toSelf(),n.bind(av).toSelf(),n.bind(yn).toSelf(),n.bind(bm).toSelf(),n.bind(zh).toSelf(),n.bind(em).toSelf(),n.bind(e).toSelf(),n.bind(Yy).toSelf(),n.bind(hm).toSelf(),n.bind(te.Geometry).to(YR).whenTargetNamed(_n.BOX),n.bind(te.Geometry).to(iC).whenTargetNamed(_n.SPHERE),n.bind(te.Geometry).to(tC).whenTargetNamed(_n.PLANE),n.bind(te.Geometry).to(ZR).whenTargetNamed(_n.MERGED),n.bind(te.Material).to(lC).whenTargetNamed(wy.BASIC),n.bind(te.Renderable).to(Ux).whenTargetNamed(yn.POINT),n.bind(te.Renderable).to(Px).whenTargetNamed(yn.LINE),n.bind(te.Renderable).to(mC).whenTargetNamed(yn.GRID);var a=n.get(e);return a.setContainer(n),a.setConfig(r),a}}]),e}(),wm),Sm=ze(ou.prototype,"configService",[Tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ou));globalThis&&globalThis.__awaiter;globalThis&&globalThis.__awaiter;export{Qx as a,kf as b,Tn as g,Zx as i,Jx as l,_g as n,yg as t};
