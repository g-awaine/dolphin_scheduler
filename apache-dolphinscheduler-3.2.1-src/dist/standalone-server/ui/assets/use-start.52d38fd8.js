import{h as u}from"./index.18b4303b.js";import{_ as o}from"./lodash.68b7405b.js";import{u as p,bI as l,aL as c,a as f}from"./index.851b5188.js";import{a as g}from"./index.23da2c90.js";import{q as v}from"./index.2d754617.js";import{q as d}from"./index.57e264b5.js";import{q as L}from"./index.71fea87c.js";import{l as S}from"./index.b3847370.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";const I=n=>{const{t:i}=p(),m=l(),r=c({startFormRef:f(),startForm:{version:1,warningType:"NONE",warningGroupId:null,workerGroup:"default",tenantCode:"default",environmentCode:null,startParams:null,dryRun:0},startState:{projectCode:Number(m.params.projectCode),workerGroups:[],tenantList:[],alertGroups:[],environmentList:[],startParamsList:[]},saving:!1}),e={};return{variables:r,getWorkerGroups:()=>{v().then(a=>{r.startState.workerGroups=a.map(t=>({label:t,value:t}))})},getTenantList:()=>{d().then(a=>{r.startState.tenantList=a.map(t=>({label:t.tenantCode,value:t.tenantCode}))})},getEnvironmentList:()=>{L().then(a=>{r.startState.environmentList=a.map(t=>({label:t.name,value:t.code,workerGroups:t.workerGroups}))})},getAlertGroups:()=>{S().then(a=>{r.startState.alertGroups=a.map(t=>({label:t.groupName,value:t.id}))})},getStartParamsList:a=>{if(e[a]){r.startState.startParamsList=o.cloneDeep(e[a]);return}g(a,r.startState.projectCode).then(t=>{r.startState.startParamsList=t.processDefinition.globalParamList,e[a]=o.cloneDeep(r.startState.startParamsList)})},handleStartDefinition:async a=>{if(await r.startFormRef.validate(),!r.saving){r.saving=!0;try{const t={};for(const s of r.startState.startParamsList)s.value!==""&&(t[s.prop]=s.value);r.startForm.startParams=o.isEmpty(t)?"":JSON.stringify(t),await u(r.startState.projectCode,a,{...r.startForm}),window.$message.success(i("project.task.success")),r.saving=!1,n.emit("updateList"),n.emit("update:show")}catch{r.saving=!1}}}}};export{I as useStart};
