import{M as _}from"./index.e69e8738.js";import{u as h,aL as b,a as s,d as v,at as k,w as g,ba as M,c as r}from"./index.851b5188.js";import{v as C,c as R,u as w}from"./index.578616c5.js";import{N}from"./Form.9f7fa8c1.js";import{N as l}from"./FormItem.f5b3f80b.js";import{N as c}from"./Input.79ba0d48.js";import"./index.8acb741a.js";import"./Button.4e249408.js";import"./is-browser.45c3bd93.js";import"./use-form-item.bb4d7ada.js";import"./resolve-slot.9e6a0162.js";import"./keysOf.ab13e590.js";import"./Card.19bc42e2.js";import"./index.7a579f81.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./utils.f449ed5c.js";import"./index.3ef69258.js";import"./Space.f9ece73f.js";import"./get-slot.80096ab3.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./lodash.68b7405b.js";import"./format-length.d7d829b3.js";import"./get.aa32335f.js";import"./use-locale.f8ac8f2c.js";import"./use-merged-state.e40d3a9f.js";import"./Suffix.21a8a87f.js";function S(t,i){const{t:o}=h(),e=b({clusterFormRef:s(),model:{code:s(-1),name:s(""),k8s_config:s(""),yarn_config:s(""),description:s("")},saving:!1,rules:{name:{required:!0,trigger:["input","blur"],validator(){if(e.model.name==="")return new Error(o("security.cluster.cluster_name_tips"))}},description:{required:!0,trigger:["input","blur"],validator(){if(e.model.description==="")return new Error(o("security.cluster.cluster_description_tips"))}}}}),m=async n=>{if(await e.clusterFormRef.validate(),!e.saving){e.saving=!0;try{n===0?await d():await u()}finally{e.saving=!1}}},d=()=>{C({clusterName:e.model.name}).then(()=>{const n={name:e.model.name,config:JSON.stringify({k8s:e.model.k8s_config,yarn:e.model.yarn_config}),description:e.model.description};R(n).then(()=>{e.model.name="",e.model.k8s_config="",e.model.yarn_config="",e.model.description="",i.emit("confirmModal",t.showModalRef)})})},u=()=>{const n={code:e.model.code,name:e.model.name,config:JSON.stringify({k8s:e.model.k8s_config,yarn:e.model.yarn_config}),description:e.model.description};w(n).then(()=>{i.emit("confirmModal",t.showModalRef)})};return{variables:e,handleValidate:m}}const I=`apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CZJQ0FURS0tLS0tCg==
    server: https://127.0.0.1:6443
  name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: {}
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CZJQ0FURS0tLS0tCg= 
`,L="In development...",ce=v({name:"ClusterModal",props:{showModalRef:{type:Boolean,default:!1},statusRef:{type:Number,default:0},row:{type:Object,default:{}}},emits:["cancelModal","confirmModal"],setup(t,i){var f;const{variables:o,handleValidate:e}=S(t,i),{t:m}=h(),d=()=>{t.statusRef===0&&(o.model.name="",o.model.k8s_config="",o.model.yarn_config="",o.model.description=""),i.emit("cancelModal",t.showModalRef)},u=()=>{e(t.statusRef)},n=a=>{if(o.model.code=a.code,o.model.name=a.name,a.config){const p=JSON.parse(a.config);o.model.k8s_config=p.k8s||"",o.model.yarn_config=p.yarn||""}else o.model.k8s_config="",o.model.yarn_config="";o.model.description=a.description},y=(f=k())==null?void 0:f.appContext.config.globalProperties.trim;return g(()=>t.statusRef,()=>{t.statusRef===0?(o.model.name="",o.model.k8s_config="",o.model.yarn_config="",o.model.description=""):n(t.row)}),g(()=>t.row,()=>{n(t.row)}),{t:m,...M(o),cancelModal:d,confirmModal:u,trim:y}},render(){const{t}=this;return r("div",null,[r(_,{title:this.statusRef===0?t("security.cluster.create_cluster"):t("security.cluster.edit_cluster"),show:this.showModalRef,onCancel:this.cancelModal,onConfirm:this.confirmModal,confirmDisabled:!this.model.name||!this.model.description,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>r(N,{model:this.model,rules:this.rules,ref:"clusterFormRef"},{default:()=>[r(l,{label:t("security.cluster.cluster_name"),path:"name"},{default:()=>[r(c,{allowInput:this.trim,class:"input-cluster-name",placeholder:t("security.cluster.cluster_name_tips"),value:this.model.name,"onUpdate:value":i=>this.model.name=i},null)]}),r(l,{label:t("security.cluster.kubernetes_config"),path:"k8s_config"},{default:()=>[r(c,{allowInput:this.trim,class:"input-cluster-config",placeholder:I,type:"textarea",autosize:{minRows:16},value:this.model.k8s_config,"onUpdate:value":i=>this.model.k8s_config=i},null)]}),r(l,{label:t("security.cluster.yarn_config"),path:"yarn_config"},{default:()=>[r(c,{allowInput:this.trim,class:"input-yarn-config",placeholder:L,disabled:!0,value:this.model.yarn_config,"onUpdate:value":i=>this.model.yarn_config=i},null)]}),r(l,{label:t("security.cluster.cluster_desc"),path:"description"},{default:()=>[r(c,{class:"input-cluster-desc",placeholder:t("security.cluster.cluster_description_tips"),value:this.model.description,"onUpdate:value":i=>this.model.description=i},null)]})]})})])}});export{ce as default};
