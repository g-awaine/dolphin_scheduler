import{u as w,bt as N,aL as D,a as l,t as a,d as y,w as h,ba as C,c}from"./index.851b5188.js";import{u as b,a as z}from"./use-modal.a8c92e75.js";import{d as V,s as P,e as R}from"./index.23da2c90.js";import{E as S}from"./ExclamationCircleOutlined.f43290af.js";import{D as M}from"./DeleteOutlined.07e1d3fe.js";import{d as T}from"./Selection.28a32045.js";import{N as k}from"./Popconfirm.013915ef.js";import{N as j}from"./Tooltip.52cb9ce9.js";import{N as v}from"./Button.4e249408.js";import{N as g}from"./Space.f9ece73f.js";import{M as I}from"./index.e69e8738.js";import{N as $,a as L}from"./DataTable.0e9ec324.js";import"./lodash.68b7405b.js";import"./index.2d754617.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./index.71fea87c.js";import"./index.b3847370.js";import"./index.834fe2cc.js";import"./common.ee372ad3.js";import"./SettingOutlined.e20148d7.js";import"./PauseCircleOutlined.28d888d0.js";import"./CloseCircleOutlined.9e282d8c.js";import"./CheckCircleOutlined.67794958.js";import"./EditOutlined.e0b6da4a.js";import"./index.d671386a.js";import"./index.57e264b5.js";import"./VResizeObserver.6721b9ea.js";import"./Popover.30015336.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./use-false-until-truthy.5d7093c9.js";import"./_baseMap.9542141b.js";import"./get.aa32335f.js";import"./utils.f449ed5c.js";import"./format-length.d7d829b3.js";import"./resolve-slot.9e6a0162.js";import"./use-merged-state.e40d3a9f.js";import"./use-compitable.ae5454ac.js";import"./next-frame-once.e5ee25e8.js";import"./index.7a579f81.js";import"./use-locale.f8ac8f2c.js";import"./use-form-item.bb4d7ada.js";import"./Suffix.21a8a87f.js";import"./keysOf.ab13e590.js";import"./is-browser.45c3bd93.js";import"./get-slot.80096ab3.js";import"./index.8acb741a.js";import"./Card.19bc42e2.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./index.3ef69258.js";import"./ArrowDown.45f9e719.js";import"./Checkbox.98b84c16.js";import"./RadioGroup.c3ead4f3.js";import"./Radio.fc32ca3b.js";import"./Dropdown.4af83811.js";import"./Icon.afc45566.js";import"./ChevronRight.d6536995.js";import"./use-keyboard.f4d2f0c0.js";import"./Ellipsis.b13f7726.js";import"./Input.79ba0d48.js";import"./Select.3e0f2c28.js";import"./Forward.bddcd6d4.js";function q(i){const{t}=w(),s=N(),e=D({columns:[],row:{},tableData:[],page:l(1),totalPage:l(1),pageSize:l(10),projectCode:l(Number(s.currentRoute.value.params.projectCode)),loadingRef:l(!1)}),u=(o,m)=>{o.columns=[{title:"#",key:"id",width:50,render:(r,n)=>n+1},{title:t("project.workflow.version"),key:"version",render:r=>r.version===o.row.version?a(T,{type:"success",size:"small"},{default:()=>`V${r.version} ${t("project.workflow.current_version")}`}):`V${r.version}`},{title:t("project.workflow.description"),key:"description"},{title:t("project.workflow.create_time"),key:"operateTime"}],m||o.columns.push({title:t("project.workflow.operation"),key:"operation",render:r=>a(g,null,{default:()=>[a(k,{onPositiveClick:()=>{f(r.version)}},{trigger:()=>a(j,{},{trigger:()=>a(v,{circle:!0,type:"info",size:"small",disabled:r.version===o.row.version},{icon:()=>a(S)}),default:()=>t("project.workflow.switch_version")}),default:()=>t("project.workflow.confirm_switch_version")}),a(k,{onPositiveClick:()=>{d(r.version)}},{trigger:()=>a(j,{},{trigger:()=>a(v,{circle:!0,type:"error",size:"small",disabled:r.version===o.row.version},{icon:()=>a(M)}),default:()=>t("project.workflow.delete")}),default:()=>t("project.workflow.delete_confirm")})]})})},p=o=>{e.loadingRef||(e.loadingRef=!0,e.row=o,V({pageSize:e.pageSize,pageNo:e.page},e.projectCode,e.row.code).then(m=>{e.tableData=m.totalList.map(r=>({...r})),e.totalPage=m.totalPage,e.loadingRef=!1}))},f=o=>{P(e.projectCode,e.row.code,o).then(()=>{e.row.version=o,window.$message.success(t("project.workflow.success")),i.emit("updateList")})},d=o=>{R(e.projectCode,e.row.code,o).then(()=>{window.$message.success(t("project.workflow.success")),i.emit("updateList"),e.tableData.length===1&&e.page>1&&(e.page-=1),p(e.row)})};return{variables:e,createColumns:u,getTableData:p}}const B={isInstance:{type:Boolean,default:!1},show:{type:Boolean,default:!1},row:{type:Object,default:{}}},We=y({name:"workflowDefinitionVersion",props:B,emits:["update:show","update:row","updateList"],setup(i,t){const{variables:s,createColumns:e,getTableData:u}=q(t),{importState:p}=b(),{handleImportDefinition:f}=z(p,t),d=()=>{var n;i.show&&((n=i.row)==null?void 0:n.code)&&u(i.row)},o=()=>{t.emit("update:show")},m=()=>{f()},r=({file:n})=>{p.importForm.name=n.name,p.importForm.file=n.file};return h(()=>i.show,()=>{e(s,i.isInstance),d()}),h(w().locale,()=>{e(s,i.isInstance)}),{hideModal:o,handleImport:m,customRequest:r,requestData:d,...C(s)}},render(){const{t:i}=w(),{requestData:t,loadingRef:s}=this;return c(I,{show:this.$props.show,title:i("project.workflow.version_info"),onCancel:this.hideModal,onConfirm:this.hideModal},{default:()=>[c(g,{vertical:!0},{default:()=>[c($,{loading:s,columns:this.columns,data:this.tableData,striped:!0,size:"small"},null),c(g,{justify:"center"},{default:()=>[c(L,{page:this.page,"onUpdate:page":e=>this.page=e,"page-size":this.pageSize,"onUpdate:page-size":e=>this.pageSize=e,"page-count":this.totalPage,onUpdatePage:t},null)]})]})]})}});export{We as default};
