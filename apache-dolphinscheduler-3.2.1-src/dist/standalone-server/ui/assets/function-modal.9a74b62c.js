import{u as R,aL as b,a as _,d as k,at as q,e as V,w as j,ba as g,c as o,ai as M,al as $}from"./index.851b5188.js";import{M as x}from"./index.e69e8738.js";import{_ as B}from"./lodash.68b7405b.js";import{b as O,g as H,j as T,k as S}from"./index.59799c67.js";import{u as G}from"./index.73124cc7.js";import{C as P}from"./CloudUploadOutlined.ffad40df.js";import{N as C}from"./Form.9f7fa8c1.js";import{N as l}from"./FormItem.f5b3f80b.js";import{N as A}from"./RadioGroup.c3ead4f3.js";import{N as J}from"./Radio.fc32ca3b.js";import{N as f}from"./Input.79ba0d48.js";import{N as D}from"./InputGroup.205f411e.js";import{N as L}from"./TreeSelect.5a0f3466.js";import{N as v}from"./Button.4e249408.js";import{N as z}from"./Upload.62ae1afa.js";import{N as K}from"./Icon.afc45566.js";import"./index.8acb741a.js";import"./keysOf.ab13e590.js";import"./Card.19bc42e2.js";import"./resolve-slot.9e6a0162.js";import"./index.7a579f81.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./utils.f449ed5c.js";import"./is-browser.45c3bd93.js";import"./index.3ef69258.js";import"./Space.f9ece73f.js";import"./get-slot.80096ab3.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./use-form-item.bb4d7ada.js";import"./format-length.d7d829b3.js";import"./get.aa32335f.js";import"./use-merged-state.e40d3a9f.js";import"./use-locale.f8ac8f2c.js";import"./Suffix.21a8a87f.js";import"./Checkbox.98b84c16.js";import"./Selection.28a32045.js";import"./Popover.30015336.js";import"./_baseMap.9542141b.js";import"./use-compitable.ae5454ac.js";import"./next-frame-once.e5ee25e8.js";import"./Add.3164a73d.js";import"./Image.2f947741.js";import"./Tooltip.52cb9ce9.js";const Q=()=>{const{t}=R(),i=b({functionFormRef:_(),functionForm:{type:"HIVE",funcName:"",className:"",argTypes:"",database:"",description:"",resourceId:-1,fullName:""},saving:!1,rules:{type:{required:!0,trigger:["input","blur"],validator(){if(!i.functionForm.type)return new Error(t("resource.function.enter_name_tips"))}},funcName:{required:!0,trigger:["input","blur"],validator(){if(!i.functionForm.funcName)return new Error(t("resource.function.enter_name_tips"))}},className:{required:!0,trigger:["input","blur"],validator(){if(!i.functionForm.className)return new Error(t("resource.function.enter_name_tips"))}},resourceId:{required:!1,trigger:["input","blur"],validator(){if(i.functionForm.resourceId===-1)return new Error(t("resource.function.enter_name_tips"))}},fullName:{required:!0,trigger:["input","blur"],validator(){if(i.functionForm.fullName=="")return new Error(t("resource.function.enter_name_tips"))}}}}),n=b({uploadFormRef:_(),uploadForm:{name:"",file:"",description:"",pid:-1,currentDir:"/"},uploadRules:{pid:{required:!0,trigger:["input","blur"],validator(){if(n.uploadForm.pid===-1)return new Error(t("resource.function.enter_name_tips"))}}}});return{state:i,uploadState:n}};function W(t,i,n){const{t:r}=R(),c=async()=>{F(async()=>await T({...t.functionForm}))},h=async a=>{F(async()=>{await S({...t.functionForm,id:a},a)})},F=async a=>{if(await t.functionFormRef.validate(),!t.saving){t.saving=!0;try{await a(),window.$message.success(r("resource.function.success")),t.saving=!1,n.emit("updateList"),n.emit("update:show")}catch{t.saving=!1}}},d=b({uploadShow:_(!1),udfResourceList:[],udfResourceDirList:[]}),m=a=>{for(const e of a)e.children&&m(e.children);return a.filter(e=>/\.jar$/.test(e.name)&&e.children.length===0||!/\.jar$/.test(e.name)&&e.children.length>0)},N=a=>{for(const e of a)e.children&&(e.children=N(e.children));return a.filter(e=>!/\.jar$/.test(e.name))},p=a=>{a.forEach(e=>{e.children===""||e.children===void 0||e.children===null||e.children.length===0?delete e.children:p(e.children)})},w=()=>{const{state:a}=G(O({type:"UDF",fullName:""}).then(e=>{let u=e,s=B.cloneDeep(e);m(u),u=m(u),p(u),p(N(s)),s=s.filter(I=>{if(I.dirctory)return I}),d.udfResourceList=u,d.udfResourceDirList=s}),{});return a},y=()=>{i.uploadForm.name="",i.uploadForm.file="",i.uploadForm.pid=-1,i.uploadForm.currentDir="/",i.uploadForm.description=""};return{variables:d,getUdfList:w,handleCreateFunc:c,handleRenameFunc:h,handleUploadFile:()=>{i.uploadFormRef.validate(async a=>{if(!a){const e=new FormData;e.append("file",i.uploadForm.file),e.append("type","UDF"),e.append("name",i.uploadForm.name),e.append("pid",i.uploadForm.pid),e.append("currentDir",i.uploadForm.currentDir),e.append("description",i.uploadForm.description);const u=await H(e);window.$message.success(r("resource.function.success")),d.uploadShow=!1,y(),w(),t.functionForm.resourceId=u.id}})}}}function E(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!$(t)}const X={row:{type:Object,default:{}},show:{type:Boolean,default:!1}},Ke=k({name:"ResourceFileFolder",props:X,emits:["update:show","updateList"],setup(t,i){var u;const n=_(),{state:r,uploadState:c}=Q(),{variables:h,handleCreateFunc:F,handleRenameFunc:d,getUdfList:m,handleUploadFile:N}=W(r,c,i),p=()=>{i.emit("update:show")},w=()=>{F()},y=()=>{d(t.row.id)},U=()=>{var s;c.uploadForm.currentDir=`/${(s=n.value.selectedOption)==null?void 0:s.fullName}`,N()},a=({file:s})=>{c.uploadForm.name=s.name,c.uploadForm.file=s.file},e=(u=q())==null?void 0:u.appContext.config.globalProperties.trim;return V(()=>{m()}),j(()=>t.row,()=>{h.uploadShow=!1,r.functionForm.type=t.row.type||"HIVE",r.functionForm.funcName=t.row.funcName,r.functionForm.className=t.row.className,r.functionForm.resourceId=t.row.resourceId||-1,r.functionForm.fullName=t.row.resourceName||"",r.functionForm.description=t.row.description}),{treeRef:n,hideModal:p,handleCreate:w,handleRename:y,customRequest:a,handleUpload:U,...g(r),...g(c),...g(h),trim:e}},render(){let t,i;const{t:n}=R();return o(x,{show:this.$props.show,title:this.row.id?n("resource.function.edit_udf_function"):n("resource.function.create_udf_function"),onCancel:this.hideModal,onConfirm:this.row.id?this.handleRename:this.handleCreate,confirmClassName:"btn-submit",cancelClassName:"btn-cancel",confirmLoading:this.saving},{default:()=>[o(C,{rules:this.rules,ref:"functionFormRef"},{default:()=>[o(l,{label:n("resource.function.type"),path:"type"},{default:()=>[o(A,{value:this.functionForm.type,"onUpdate:value":r=>this.functionForm.type=r,name:"type",class:"radio-function-type"},{default:()=>[o(J,{value:"HIVE"},{default:()=>[M("HIVE UDF")]})]})]}),o(l,{label:n("resource.function.udf_function_name"),path:"funcName"},{default:()=>[o(f,{allowInput:this.trim,value:this.functionForm.funcName,"onUpdate:value":r=>this.functionForm.funcName=r,placeholder:n("resource.function.enter_udf_unction_name_tips"),class:"input-function-name"},null)]}),o(l,{label:n("resource.function.package_name"),path:"className"},{default:()=>[o(f,{allowInput:this.trim,value:this.functionForm.className,"onUpdate:value":r=>this.functionForm.className=r,placeholder:n("resource.function.enter_package_name_tips"),class:"input-class-name"},null)]}),o(l,{label:n("resource.function.udf_resources"),path:"fullName"},{default:()=>[o(D,null,{default:()=>[o(L,{options:this.udfResourceList,"label-field":"name","key-field":"fullName","check-strategy":"child",value:this.functionForm.fullName,"onUpdate:value":r=>this.functionForm.fullName=r,placeholder:n("resource.function.enter_select_udf_resources_tips"),defaultValue:this.functionForm.fullName,disabled:this.uploadShow,showPath:!1,class:"btn-udf-resource-dropdown"},null),o(v,{type:"primary",ghost:!0,onClick:()=>this.uploadShow=!this.uploadShow},E(t=n("resource.function.upload_resources"))?t:{default:()=>[t]})]})]}),this.uploadShow&&o(C,{rules:this.uploadRules,ref:"uploadFormRef"},{default:()=>[o(l,{label:n("resource.function.udf_resources_directory"),path:"pid","show-feedback":!1,style:{marginBottom:"5px"}},{default:()=>[o(L,{ref:"treeRef",options:this.udfResourceDirList,"label-field":"fullName","key-field":"id",value:this.uploadForm.pid,"onUpdate:value":r=>this.uploadForm.pid=r,placeholder:n("resource.function.enter_select_udf_resources_directory_tips"),defaultValue:this.uploadForm.pid},null)]}),o(l,{label:" ","show-feedback":!1,style:{marginBottom:"5px"}},{default:()=>[o(D,null,{default:()=>[o(f,{allowInput:this.trim,value:this.uploadForm.name,"onUpdate:value":r=>this.uploadForm.name=r,placeholder:n("resource.function.enter_name_tips")},null),o(z,{value:this.uploadForm.file,"onUpdate:value":r=>this.uploadForm.file=r,customRequest:this.customRequest,showFileList:!1,style:{width:"auto"}},{default:()=>[o(v,null,{default:()=>[n("resource.function.upload"),o(K,null,{default:()=>[o(P,null,null)]})]})]})]})]}),o(l,{label:" ",path:"description","show-feedback":!1,style:{marginBottom:"5px"}},{default:()=>[o(f,{type:"textarea",value:this.uploadForm.description,"onUpdate:value":r=>this.uploadForm.description=r,placeholder:n("resource.function.enter_description_tips"),class:"input-description"},null)]}),o(l,{label:" "},{default:()=>[o(v,{onClick:this.handleUpload},E(i=n("resource.function.upload_udf_resources"))?i:{default:()=>[i]})]})]}),o(l,{label:n("resource.function.instructions"),path:"description"},{default:()=>[o(f,{type:"textarea",value:this.functionForm.description,"onUpdate:value":r=>this.functionForm.description=r,placeholder:n("resource.function.enter_instructions_tips"),class:"input-description"},null)]})]})]})}});export{Ke as default};
