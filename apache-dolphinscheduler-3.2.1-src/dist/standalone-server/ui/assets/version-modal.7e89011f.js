import{d as w,b7 as N,b8 as b,b9 as V,u as C,bI as j,aL as T,a as p,t as s,w as g,ba as _,c}from"./index.851b5188.js";import{u as y}from"./index.73124cc7.js";import{c as z,e as P,f as S}from"./index.18b4303b.js";import{D as x}from"./DeleteOutlined.07e1d3fe.js";import{d as R}from"./Selection.28a32045.js";import{N as h}from"./Popconfirm.013915ef.js";import{N as k}from"./Tooltip.52cb9ce9.js";import{N as v}from"./Button.4e249408.js";import{N as f}from"./Space.f9ece73f.js";import{M as B}from"./index.e69e8738.js";import{N as M,a as L}from"./DataTable.0e9ec324.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./lodash.68b7405b.js";import"./VResizeObserver.6721b9ea.js";import"./Popover.30015336.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./use-false-until-truthy.5d7093c9.js";import"./_baseMap.9542141b.js";import"./get.aa32335f.js";import"./utils.f449ed5c.js";import"./format-length.d7d829b3.js";import"./resolve-slot.9e6a0162.js";import"./use-merged-state.e40d3a9f.js";import"./use-compitable.ae5454ac.js";import"./next-frame-once.e5ee25e8.js";import"./index.7a579f81.js";import"./use-locale.f8ac8f2c.js";import"./use-form-item.bb4d7ada.js";import"./Suffix.21a8a87f.js";import"./keysOf.ab13e590.js";import"./is-browser.45c3bd93.js";import"./get-slot.80096ab3.js";import"./index.8acb741a.js";import"./Card.19bc42e2.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./index.3ef69258.js";import"./ArrowDown.45f9e719.js";import"./Checkbox.98b84c16.js";import"./RadioGroup.c3ead4f3.js";import"./Radio.fc32ca3b.js";import"./Dropdown.4af83811.js";import"./Icon.afc45566.js";import"./ChevronRight.d6536995.js";import"./use-keyboard.f4d2f0c0.js";import"./Ellipsis.b13f7726.js";import"./Input.79ba0d48.js";import"./Select.3e0f2c28.js";import"./Forward.bddcd6d4.js";const O={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},q=V("path",{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5L207 474a32 32 0 0 0-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z",fill:"currentColor"},null,-1),U=[q],I=w({name:"CheckOutlined",render:function(n,a){return N(),b("svg",O,U)}});function $(){const{t:e}=C(),n=j(),a=Number(n.params.projectCode),r=i=>{i.columns=[{title:"#",key:"index",render:(t,d)=>d+1},{title:e("project.task.version"),key:"version",render:t=>s("span",null,t.version!==i.taskVersion?"v"+t.version:s(R,{type:"success",size:"small"},{default:()=>`v${t.version} ${e("project.task.current_version")}`}))},{title:e("project.task.description"),key:"description",render:t=>s("span",null,t.description?t.description:"-")},{title:e("project.task.create_time"),key:"createTime"},{title:e("project.task.operation"),key:"operation",render(t){return s(f,null,{default:()=>[s(h,{onPositiveClick:()=>{l(t)}},{trigger:()=>s(k,{},{trigger:()=>s(v,{circle:!0,type:"info",size:"small",disabled:t.version===i.taskVersion},{icon:()=>s(I)}),default:()=>e("project.task.switch_version")}),default:()=>e("project.task.confirm_switch_version")}),s(h,{onPositiveClick:()=>{m(t)}},{trigger:()=>s(k,{},{trigger:()=>s(v,{circle:!0,type:"error",size:"small",disabled:t.version===i.taskVersion},{icon:()=>s(x)}),default:()=>e("project.task.delete")}),default:()=>e("project.task.delete_confirm")})]})}}]},o=T({columns:[],tableData:[],page:p(1),pageSize:p(10),totalPage:p(1),taskVersion:p(null),taskCode:p(null),refreshTaskDefinition:p(!1),row:{},loadingRef:p(!1)}),l=i=>{z({version:i.version},{code:o.taskCode},{projectCode:a}).then(()=>{o.refreshTaskDefinition=!0})},m=i=>{P({version:i.version},{code:o.taskCode},{projectCode:a}).then(()=>{o.refreshTaskDefinition=!0})};return{variables:o,getTableData:i=>{if(o.loadingRef)return;o.loadingRef=!0;const{state:t}=y(S({...i},{code:o.taskCode},{projectCode:a}).then(d=>{o.tableData=d.totalList.map((D,E)=>({...D})),o.totalPage=d.totalPage,o.loadingRef=!1}),{});return t},createColumns:r}}const A={show:{type:Boolean,default:!1},row:{type:Object,default:{}}},Ae=w({name:"VersionModal",props:A,emits:["confirm","refresh"],setup(e,n){const{t:a}=C(),{variables:r,getTableData:o,createColumns:l}=$(),m=()=>{o({pageSize:r.pageSize,pageNo:r.page})};g(()=>e.show,()=>{var i,t;e.show&&(r.taskVersion=(i=e.row)==null?void 0:i.taskVersion,r.taskCode=(t=e.row)==null?void 0:t.taskCode,l(r),m())}),g(()=>r.refreshTaskDefinition,()=>{r.refreshTaskDefinition&&(n.emit("refresh"),r.refreshTaskDefinition=!1)});const u=()=>{n.emit("confirm")};return{t:a,..._(r),requestData:m,onConfirm:u}},render(){const{t:e,requestData:n,onConfirm:a,show:r,loadingRef:o}=this;return c(B,{show:r,title:e("project.task.version"),cancelShow:!1,onConfirm:a},{default:()=>[c(f,{vertical:!0},{default:()=>[c(M,{loading:o,columns:this.columns,data:this.tableData},null),c(f,{justify:"center"},{default:()=>[c(L,{page:this.page,"onUpdate:page":l=>this.page=l,"page-size":this.pageSize,"onUpdate:page-size":l=>this.pageSize=l,"page-count":this.totalPage,onUpdatePage:n},null)]})]})]})}});export{Ae as default};
