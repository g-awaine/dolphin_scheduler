import{d as j,b8 as V,b9 as d,b7 as x,a as N,u as Y,bF as Z,A as ee,bt as te,bI as oe,c as e,V as le,al as re}from"./index.851b5188.js";import{S as l}from"./dag.module.6dc78b46.js";import{D as ne}from"./index.6abc819d.js";import"./lodash.68b7405b.js";import{b as ie}from"./index.73124cc7.js";import"./dag-context-menu.e22e9ab5.js";import"./task-type.dfd9250b.js";import"./gForce.3509cc7a.js";import{u as ae}from"./use-text-copy.448fed4f.js";import"./service.4be3af67.js";import"./dag-node-status.8cc86097.js";import se from"./dag-startup-param.1d33a3fd.js";import ce from"./variables-view.b9866483.js";import{C as ue}from"./CopyOutlined.8195d297.js";import{S as de}from"./SearchOutlined.3b9a5586.js";import{D as me}from"./DownloadOutlined.2b4ed5b8.js";import{S as pe}from"./SyncOutlined.95d4ed16.js";import{D as fe}from"./DeleteOutlined.07e1d3fe.js";import{F as ge,a as he}from"./FullscreenOutlined.01f40161.js";import{I as ve}from"./InfoCircleOutlined.926adab8.js";import{N as a}from"./Tooltip.52cb9ce9.js";import{N as n}from"./Button.4e249408.js";import{N as s}from"./Icon.afc45566.js";import{N as q}from"./Popover.30015336.js";import{N as U}from"./text.f967c9a6.js";import{d as we}from"./Selection.28a32045.js";import{a as _e}from"./Select.3e0f2c28.js";import"./toNumber.c7e8ca68.js";import"./_baseMap.9542141b.js";import"./get.aa32335f.js";import"./debounce.948fb11c.js";import"./index.18b4303b.js";import"./common.ee372ad3.js";import"./SettingOutlined.e20148d7.js";import"./PauseCircleOutlined.28d888d0.js";import"./CloseCircleOutlined.9e282d8c.js";import"./CheckCircleOutlined.67794958.js";import"./EditOutlined.e0b6da4a.js";import"./index.d671386a.js";import"./ui-setting.39219f0f.js";import"./is-browser.45c3bd93.js";import"./use-form-item.bb4d7ada.js";import"./resolve-slot.9e6a0162.js";import"./typeof.b54b2da3.js";import"./use-message.e3f85643.js";import"./Spin.447cad15.js";import"./fade-in.cssr.55dfcced.js";import"./use-compitable.ae5454ac.js";import"./index.7a579f81.js";import"./format-length.d7d829b3.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./utils.f449ed5c.js";import"./use-merged-state.e40d3a9f.js";import"./next-frame-once.e5ee25e8.js";import"./index.b3847370.js";import"./index.2d754617.js";import"./index.4701b8ec.js";import"./index.23da2c90.js";import"./use-locale.f8ac8f2c.js";import"./Suffix.21a8a87f.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./index.3ef69258.js";const be={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ye=d("defs",null,null,-1),Ce=d("path",{d:"M840 192h-56v-72c0-13.3-10.7-24-24-24H168c-13.3 0-24 10.7-24 24v272c0 13.3 10.7 24 24 24h592c13.3 0 24-10.7 24-24V256h32v200H465c-22.1 0-40 17.9-40 40v136h-44c-4.4 0-8 3.6-8 8v228c0 .6.1 1.3.2 1.9c-.1 2-.2 4.1-.2 6.1c0 46.4 37.6 84 84 84s84-37.6 84-84c0-2.1-.1-4.1-.2-6.1c.1-.6.2-1.2.2-1.9V640c0-4.4-3.6-8-8-8h-44V520h351c22.1 0 40-17.9 40-40V232c0-22.1-17.9-40-40-40zM720 352H208V160h512v192zM477 876c0 11-9 20-20 20s-20-9-20-20V696h40v180z",fill:"currentColor"},null,-1),ke=[ye,Ce],Ne=j({name:"FormatPainterOutlined",render:function(r,t){return x(),V("svg",be,ke)}}),je={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Se=d("defs",null,null,-1),Ve=d("path",{d:"M956 686.5l-.1-.1l-.1-.1C911.7 593 843.4 545 752.5 545s-159.2 48.1-203.4 141.3v.1c-5.4 11.5-5.4 24.9 0 36.4C593.3 816 661.6 864 752.5 864s159.2-48.1 203.4-141.3c5.4-11.5 5.4-24.8.1-36.2zM752.5 800c-62.1 0-107.4-30-141.1-95.5C645 639 690.4 609 752.5 609c62.1 0 107.4 30 141.1 95.5C860 770 814.6 800 752.5 800z",fill:"currentColor"},null,-1),xe=d("path",{d:"M697 705a56 56 0 1 0 112 0a56 56 0 1 0-112 0z",fill:"currentColor"},null,-1),Oe=d("path",{d:"M136 232h704v253h72V192c0-17.7-14.3-32-32-32H96c-17.7 0-32 14.3-32 32v520c0 17.7 14.3 32 32 32h352v-72H136V232z",fill:"currentColor"},null,-1),Te=d("path",{d:"M724.9 338.1l-36.8-36.8c-3.1-3.1-8.2-3.1-11.3 0L493 485.3l-86.1-86.2c-3.1-3.1-8.2-3.1-11.3 0L251.3 543.4c-3.1 3.1-3.1 8.2 0 11.3l36.8 36.8c3.1 3.1 8.2 3.1 11.3 0l101.8-101.8l86.1 86.2c3.1 3.1 8.2 3.1 11.3 0l226.3-226.5c3.2-3.1 3.2-8.2 0-11.3z",fill:"currentColor"},null,-1),De=[Se,Ve,xe,Oe,Te],Fe=j({name:"FundViewOutlined",render:function(r,t){return x(),V("svg",je,De)}}),$e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ze=d("path",{d:"M666.7 505.5l-246-178A8 8 0 0 0 408 334v46.9c0 10.2 4.9 19.9 13.2 25.9L566.6 512L421.2 617.2c-8.3 6-13.2 15.6-13.2 25.9V690c0 6.5 7.4 10.3 12.7 6.5l246-178c4.4-3.2 4.4-9.8 0-13z",fill:"currentColor"},null,-1),Ie=d("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448s448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1),Me=[ze,Ie],Be=j({name:"RightCircleOutlined",render:function(r,t){return x(),V("svg",$e,Me)}});function Pe(o){const r=N(""),{graph:t}=o,_=N(!1),f=()=>{_.value=!_.value},g=N([]),m=()=>{var C;const v=((C=t.value)==null?void 0:C.getNodes())||[];g.value=v.map(w=>({label:w.getData().taskName,value:w.id})),g.value.findIndex(w=>w.value===r.value)===-1&&(r.value="")};function S(v){if(r.value=v,!t.value)return;const b=t.value.getCellById(v);t.value.scrollToCell(b,{animation:{duration:600}}),t.value.cleanSelection(),t.value.select(b)}return{searchSelectValue:r,navigateTo:S,toggleSearchInput:f,searchInputVisible:_,reQueryNodes:m,nodesDropdown:g}}function y(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!re(o)}const He={layoutToggle:{type:Function,default:()=>{}},instance:{type:Object,default:null},definition:{type:Object,default:null}},Yt=j({name:"workflow-dag-toolbar",props:He,emits:["versionToggle","saveModelToggle","removeTasks","refresh"],setup(o,r){const{t}=Y(),_=Z(),f=ee("graph",N()),g=te(),m=oe(),{searchSelectValue:S,navigateTo:v,toggleSearchInput:b,searchInputVisible:C,reQueryNodes:w,nodesDropdown:A}=Pe({graph:f}),G=(p={fileName:"dag",bgColor:"#f2f3f7"})=>{var c;const{fileName:i,bgColor:h}=p;(c=f.value)==null||c.toPNG(k=>{ne.downloadDataUri(k,`${i}.png`)},{padding:{top:50,right:50,bottom:50,left:50},backgroundColor:h})},{isFullscreen:O,toggle:Q}=ie(),W=()=>{r.emit("versionToggle",!0)},J=()=>{o.layoutToggle(!0)},K=()=>{if(history.state.back!=="/login"){g.go(-1);return}if(history.state.current.includes("workflow/definitions")){g.push({path:`/projects/${m.params.projectCode}/workflow-definition`});return}if(history.state.current.includes("workflow/instances")){g.push({path:`/projects/${m.params.projectCode}/workflow/instances`});return}},{copy:T}=ae(),X=()=>{var p;if(f.value){const i=f.value.getSelectedCells();if(i){const h=i.filter(c=>c.isNode()).map(c=>+c.id);r.emit("removeTasks",h,i),(p=f.value)==null||p.removeCells(i)}}};return()=>{var c,k,D,F,$,z,I,M,B,P,H;let p,i,h;return e("div",{class:[l.toolbar,l[_.darkTheme?"toolbar-dark":"toolbar-light"]]},[e("span",{class:l["workflow-name"]},[m.name==="workflow-instance-detail"?(c=o.instance)==null?void 0:c.name:((D=(k=o.definition)==null?void 0:k.processDefinition)==null?void 0:D.name)||t("project.dag.create")]),(($=(F=o.definition)==null?void 0:F.processDefinition)==null?void 0:$.name)&&e(a,null,{trigger:()=>e(n,{quaternary:!0,circle:!0,onClick:()=>{var L,E,R;const u=m.name==="workflow-instance-detail"?(L=o.instance)==null?void 0:L.name:(R=(E=o.definition)==null?void 0:E.processDefinition)==null?void 0:R.name;T(u)},class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e(ue,null,null)]})]}),default:()=>t("project.dag.copy_name")}),((I=(z=o.definition)==null?void 0:z.processDefinition)==null?void 0:I.name)&&e(a,null,{trigger:()=>e(q,{placement:"bottom",trigger:"click",scrollable:!0,style:{maxWidth:"50vw",maxHeight:"70vh"}},{trigger:()=>e(n,{quaternary:!0,circle:!0,class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e(Fe,null,null)]})]}),header:()=>{let u;return e(U,{strong:!0,depth:1},y(u=t("project.workflow.parameters_variables"))?u:{default:()=>[u]})},default:()=>e(ce,{onCopy:T},null)}),default:()=>t("project.dag.view_variables")}),e("div",{class:l["toolbar-left-part"]},[m.name!=="workflow-instance-detail"&&((B=(M=o.definition)==null?void 0:M.processDefinition)==null?void 0:B.releaseState)==="ONLINE"&&e(we,{round:!0,size:"small",type:"info"},y(p=t("project.dag.online"))?p:{default:()=>[p]}),m.name==="workflow-instance-detail"&&e(le,null,[e(a,null,{trigger:()=>e(q,{placement:"bottom",trigger:"click"},{trigger:()=>e(n,{quaternary:!0,circle:!0,class:l["toolbar-btn"]},{default:()=>[e(s,null,{default:()=>[e(Be,null,null)]})]}),header:()=>{let u;return e(U,{strong:!0,depth:1},y(u=t("project.workflow.startup_parameter"))?u:{default:()=>[u]})},default:()=>e(se,{startupParam:o.instance},null)}),default:()=>t("project.dag.startup_parameter")})])]),e("div",{class:l["toolbar-right-part"]},[e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:b},{icon:()=>e(s,null,{default:()=>[e(de,null,null)]})}),default:()=>t("project.dag.search")}),e("div",{class:`${l["toolbar-right-item"]} ${l["node-selector"]} ${C.value?l.visible:""}`},[e(_e,{size:"small",value:S.value,options:A.value,onFocus:w,onUpdateValue:v,filterable:!0},null)]),e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>G()},{icon:()=>e(s,null,{default:()=>[e(me,null,null)]})}),default:()=>t("project.dag.download_png")}),o.instance&&e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>{r.emit("refresh")}},{icon:()=>e(s,null,{default:()=>[e(pe,null,null)]})}),default:()=>t("project.dag.refresh_dag_status")}),e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:()=>X()},{icon:()=>e(s,null,{default:()=>[e(fe,null,null)]})}),default:()=>t("project.dag.delete_cell")}),e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:Q},{icon:()=>e(s,null,{default:()=>[O.value?e(ge,null,null):e(he,null,null)]})}),default:()=>O.value?t("project.dag.fullscreen_close"):t("project.dag.fullscreen_open")}),e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:J},{icon:()=>e(s,null,{default:()=>[e(Ne,null,null)]})}),default:()=>t("project.dag.format")}),!!o.definition&&e(a,null,{trigger:()=>e(n,{class:l["toolbar-right-item"],strong:!0,secondary:!0,circle:!0,type:"info",onClick:W},{icon:()=>e(s,null,{default:()=>[e(ve,null,null)]})}),default:()=>t("project.workflow.version_info")}),e(n,{class:[l["toolbar-right-item"],"btn-save"],type:"info",secondary:!0,round:!0,disabled:((H=(P=o.definition)==null?void 0:P.processDefinition)==null?void 0:H.releaseState)==="ONLINE"&&!o.instance,onClick:()=>{r.emit("saveModelToggle",!0)}},y(i=t("project.dag.save"))?i:{default:()=>[i]}),e(n,{secondary:!0,round:!0,onClick:K,class:"btn-close"},y(h=t("project.dag.close"))?h:{default:()=>[h]})])])}}});export{Yt as default};
