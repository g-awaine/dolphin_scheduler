import{M as le}from"./index.e69e8738.js";import{d as O,t as o,bB as re,aq as oe,au as ie,ad as ue,cg as se,y as ce,A as x,g as j,f as W,h as de,i as pe,m as me,a as M,z as B,l as Z,n as L,B as fe,U as ve,s as he,N as U,ch as _,ci as F,a5 as ge,bI as ye,u as be,cj as Ie,at as Pe,e as we,w as Ve,c as u,al as Re}from"./index.851b5188.js";import{v as ke}from"./index.23da2c90.js";/* empty css                 */import{f as je}from"./use-form-item.bb4d7ada.js";import{N}from"./Input.79ba0d48.js";import{u as Ne}from"./use-merged-state.e40d3a9f.js";import{u as Se}from"./use-locale.f8ac8f2c.js";import{N as D}from"./Button.4e249408.js";import{a as H,b as Ae,c as $}from"./resolve-slot.9e6a0162.js";import{A as Y}from"./Add.3164a73d.js";import{N as Ce}from"./ButtonGroup.90ec260c.js";import{R as Ue,N as De}from"./InputNumber.cc83334e.js";import{A as Oe}from"./ArrowDown.45f9e719.js";import{N as Be}from"./Form.9f7fa8c1.js";import{N as w}from"./FormItem.f5b3f80b.js";import{N as Le}from"./Switch.f95d65b1.js";import{a as J}from"./Select.3e0f2c28.js";import{N as Te,a as E}from"./Grid.3ae564e0.js";import{a as Q}from"./Checkbox.98b84c16.js";import"./index.8acb741a.js";import"./keysOf.ab13e590.js";import"./Card.19bc42e2.js";import"./index.7a579f81.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./utils.f449ed5c.js";import"./is-browser.45c3bd93.js";import"./index.3ef69258.js";import"./Space.f9ece73f.js";import"./get-slot.80096ab3.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./lodash.68b7405b.js";import"./Suffix.21a8a87f.js";import"./format-length.d7d829b3.js";import"./get.aa32335f.js";import"./use-compitable.ae5454ac.js";import"./Selection.28a32045.js";import"./Popover.30015336.js";import"./_baseMap.9542141b.js";import"./next-frame-once.e5ee25e8.js";const _e=O({name:"ArrowUp",render(){return o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},o("g",{fill:"none"},o("path",{d:"M3.13 9.163a.5.5 0 1 0 .74.674L9.5 3.67V17.5a.5.5 0 0 0 1 0V3.672l5.63 6.165a.5.5 0 0 0 .738-.674l-6.315-6.916a.746.746 0 0 0-.632-.24a.746.746 0 0 0-.476.24L3.131 9.163z",fill:"currentColor"})))}}),Fe=()=>se,$e=re({name:"DynamicInput",common:oe,peers:{Input:ie,Button:ue},self:Fe}),Ee=$e,z=ce("n-dynamic-input"),Me=O({name:"DynamicInputInputPreset",props:{clsPrefix:{type:String,required:!0},value:{type:String,default:""},parentPath:String,path:String,onUpdateValue:{type:Function,required:!0}},setup(){const{mergedThemeRef:e,placeholderRef:h}=x(z);return{mergedTheme:e,placeholder:h}},render(){const{mergedTheme:e,placeholder:h,value:s,clsPrefix:l,onUpdateValue:g}=this;return o("div",{class:`${l}-dynamic-input-preset-input`},o(N,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:s,placeholder:h,onUpdateValue:g}))}}),xe=O({name:"DynamicInputPairPreset",props:{clsPrefix:{type:String,required:!0},value:{type:Object,default:()=>({key:"",value:""})},parentPath:String,path:String,onUpdateValue:{type:Function,required:!0}},setup(e){const{mergedThemeRef:h,keyPlaceholderRef:s,valuePlaceholderRef:l}=x(z);return{mergedTheme:h,keyPlaceholder:s,valuePlaceholder:l,handleKeyInput(g){e.onUpdateValue({key:g,value:e.value.value})},handleValueInput(g){e.onUpdateValue({key:e.value.key,value:g})}}},render(){const{mergedTheme:e,keyPlaceholder:h,valuePlaceholder:s,value:l,clsPrefix:g}=this;return o("div",{class:`${g}-dynamic-input-preset-pair`},o(N,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:l.key,class:`${g}-dynamic-input-pair-input`,placeholder:h,onUpdateValue:this.handleKeyInput}),o(N,{theme:e.peers.Input,"theme-overrides":e.peerOverrides.Input,value:l.value,class:`${g}-dynamic-input-pair-input`,placeholder:s,onUpdateValue:this.handleValueInput}))}}),ze=j("dynamic-input",{width:"100%"},[j("dynamic-input-item",`
 margin-bottom: 10px;
 display: flex;
 flex-wrap: nowrap;
 `,[j("dynamic-input-preset-input",{flex:1,alignItems:"center"}),j("dynamic-input-preset-pair",`
 flex: 1;
 display: flex;
 align-items: center;
 `,[j("dynamic-input-pair-input",[W("&:first-child",{"margin-right":"12px"})])]),de("action",`
 align-self: flex-start;
 display: flex;
 justify-content: flex-end;
 flex-shrink: 0;
 flex-grow: 0;
 margin: var(--action-margin);
 `,[pe("icon",{cursor:"pointer"})]),W("&:last-child",{marginBottom:0})]),j("form-item",`
 padding-top: 0 !important;
 margin-right: 0 !important;
 `,[j("form-item-blank",{paddingTop:"0 !important"})])]),T=new WeakMap,Ke=Object.assign(Object.assign({},Z.props),{max:Number,min:{type:Number,default:0},value:Array,defaultValue:{type:Array,default:()=>[]},preset:{type:String,default:"input"},keyField:String,itemStyle:[String,Object],keyPlaceholder:{type:String,default:""},valuePlaceholder:{type:String,default:""},placeholder:{type:String,default:""},showSortButton:Boolean,createButtonProps:Object,onCreate:Function,onRemove:Function,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onClear:Function,onInput:[Function,Array]}),qe=O({name:"DynamicInput",props:Ke,setup(e,{slots:h}){const{mergedComponentPropsRef:s,mergedClsPrefixRef:l,mergedRtlRef:g,inlineThemeDisabled:t}=me(),b=x(je,null),V=M(e.defaultValue),S=B(e,"value"),y=Ne(S,V),f=Z("DynamicInput","-dynamic-input",ze,Ee,e,l),R=L(()=>{const{value:a}=y;if(Array.isArray(a)){const{max:n}=e;return n!==void 0&&a.length>=n}return!1}),k=L(()=>{const{value:a}=y;return Array.isArray(a)?a.length<=e.min:!0}),c=L(()=>{var a,n;return(n=(a=s==null?void 0:s.value)===null||a===void 0?void 0:a.DynamicInput)===null||n===void 0?void 0:n.buttonSize});function p(a){const{onInput:n,"onUpdate:value":d,onUpdateValue:i}=e;n&&$(n,a),d&&$(d,a),i&&$(i,a),V.value=a}function r(a,n){if(a==null||typeof a!="object")return n;const d=_(a)?F(a):a;let i=T.get(d);return i===void 0&&T.set(d,i=ge()),i}function v(a,n){const{value:d}=y,i=Array.from(d!=null?d:[]),P=i[a];if(i[a]=n,P&&n&&typeof P=="object"&&typeof n=="object"){const ae=_(P)?F(P):P,ne=_(n)?F(n):n,G=T.get(ae);G!==void 0&&T.set(ne,G)}p(i)}function I(){m(0)}function m(a){const{value:n}=y,{onCreate:d}=e,i=Array.from(n!=null?n:[]);if(d)i.splice(a+1,0,d(a+1)),p(i);else if(h.default)i.splice(a+1,0,null),p(i);else switch(e.preset){case"input":i.splice(a+1,0,""),p(i);break;case"pair":i.splice(a+1,0,{key:"",value:""}),p(i);break}}function C(a){const{value:n}=y;if(!Array.isArray(n))return;const{min:d}=e;if(n.length<=d)return;const i=Array.from(n);i.splice(a,1),p(i);const{onRemove:P}=e;P&&P(a)}function K(a,n,d){if(n<0||d<0||n>=a.length||d>=a.length||n===d)return;const i=a[n];a[n]=a[d],a[d]=i}function ee(a,n){const{value:d}=y;if(!Array.isArray(d))return;const i=Array.from(d);a==="up"&&K(i,n,n-1),a==="down"&&K(i,n,n+1),p(i)}fe(z,{mergedThemeRef:f,keyPlaceholderRef:B(e,"keyPlaceholder"),valuePlaceholderRef:B(e,"valuePlaceholder"),placeholderRef:B(e,"placeholder")});const te=ve("DynamicInput",g,l),q=L(()=>{const{self:{actionMargin:a,actionMarginRtl:n}}=f.value;return{"--action-margin":a,"--action-margin-rtl":n}}),A=t?he("dynamic-input",void 0,q,e):void 0;return{locale:Se("DynamicInput").localeRef,rtlEnabled:te,buttonSize:c,mergedClsPrefix:l,NFormItem:b,uncontrolledValue:V,mergedValue:y,insertionDisabled:R,removeDisabled:k,handleCreateClick:I,ensureKey:r,handleValueChange:v,remove:C,move:ee,createItem:m,mergedTheme:f,cssVars:t?void 0:q,themeClass:A==null?void 0:A.themeClass,onRender:A==null?void 0:A.onRender}},render(){const{$slots:e,buttonSize:h,mergedClsPrefix:s,mergedValue:l,locale:g,mergedTheme:t,keyField:b,itemStyle:V,preset:S,showSortButton:y,NFormItem:f,ensureKey:R,handleValueChange:k,remove:c,createItem:p,move:r,onRender:v}=this;return v==null||v(),o("div",{class:[`${s}-dynamic-input`,this.rtlEnabled&&`${s}-dynamic-input--rtl`,this.themeClass],style:this.cssVars},!Array.isArray(l)||l.length===0?o(D,Object.assign({block:!0,ghost:!0,dashed:!0,size:h},this.createButtonProps,{disabled:this.insertionDisabled,theme:t.peers.Button,themeOverrides:t.peerOverrides.Button,onClick:this.handleCreateClick}),{default:()=>H(e["create-button-default"],()=>[g.create]),icon:()=>H(e["create-button-icon"],()=>[o(U,{clsPrefix:s},{default:()=>o(Y,null)})])}):l.map((I,m)=>o("div",{key:b?I[b]:R(I,m),"data-key":b?I[b]:R(I,m),class:`${s}-dynamic-input-item`,style:V},Ae(e.default,{value:l[m],index:m},()=>[S==="input"?o(Me,{clsPrefix:s,value:l[m],parentPath:f?f.path.value:void 0,path:f!=null&&f.path.value?`${f.path.value}[${m}]`:void 0,onUpdateValue:C=>k(m,C)}):S==="pair"?o(xe,{clsPrefix:s,value:l[m],parentPath:f?f.path.value:void 0,path:f!=null&&f.path.value?`${f.path.value}[${m}]`:void 0,onUpdateValue:C=>k(m,C)}):null]),o("div",{class:`${s}-dynamic-input-item__action`},o(Ce,{size:h},{default:()=>[o(D,{disabled:this.removeDisabled,theme:t.peers.Button,themeOverrides:t.peerOverrides.Button,circle:!0,onClick:()=>c(m)},{icon:()=>o(U,{clsPrefix:s},{default:()=>o(Ue,null)})}),o(D,{disabled:this.insertionDisabled,circle:!0,theme:t.peers.Button,themeOverrides:t.peerOverrides.Button,onClick:()=>p(m)},{icon:()=>o(U,{clsPrefix:s},{default:()=>o(Y,null)})}),y?o(D,{disabled:m===0,circle:!0,theme:t.peers.Button,themeOverrides:t.peerOverrides.Button,onClick:()=>r("up",m)},{icon:()=>o(U,{clsPrefix:s},{default:()=>o(_e,null)})}):null,y?o(D,{disabled:m===l.length-1,circle:!0,theme:t.peers.Button,themeOverrides:t.peerOverrides.Button,onClick:()=>r("down",m)},{icon:()=>o(U,{clsPrefix:s},{default:()=>o(Oe,null)})}):null]})))))}});function X(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Re(e)}const Ge={visible:{type:Boolean,default:!1},definition:{type:Object,default:void 0},instance:{type:Object,default:void 0}},Et=O({name:"dag-save-modal",props:Ge,emits:["update:show","save"],setup(e,h){var k;const s=ye(),{t:l}=be(),g=Number(s.params.projectCode),t=M({name:"",description:"",executionType:"PARALLEL",timeoutFlag:!1,timeout:0,globalParams:[],release:!1,sync:!1}),b=M(),V={name:{required:!0,message:l("project.dag.dag_name_empty")},timeout:{validator(){if(t.value.timeoutFlag&&!Ie.test(String(t.value.timeout)))return new Error(l("project.dag.positive_integer"))}},globalParams:{validator(){const c=new Set,p=t.value.globalParams.map(v=>v.key);if(new Set(p).size!==p.length)return new Error(l("project.dag.prop_repeat"));for(const v of t.value.globalParams){const I=v.value;if(v.direct==="IN"&&!I)return new Error(l("project.dag.prop_empty"));c.add(I)}}}},S=()=>{b.value.validate(async c=>{var p,r;if(!c){const v={name:t.value.name,code:(p=e.definition)==null?void 0:p.processDefinition.code};((r=e.definition)==null?void 0:r.processDefinition.name)!==t.value.name?ke(v,g).then(()=>h.emit("save",t.value)):h.emit("save",t.value)}})},y=()=>{h.emit("update:show",!1)},f=()=>{var p;const c=(p=e.definition)==null?void 0:p.processDefinition;c&&(t.value.name=c.name,t.value.description=c.description,t.value.executionType=c.executionType||"PARALLEL",c.timeout&&c.timeout>0&&(t.value.timeoutFlag=!0,t.value.timeout=c.timeout),t.value.globalParams=c.globalParamList.map(r=>({key:r.prop,value:r.value,direct:r.direct})))},R=(k=Pe())==null?void 0:k.appContext.config.globalProperties.trim;return we(()=>f()),Ve(()=>{var c;return(c=e.definition)==null?void 0:c.processDefinition},()=>f()),()=>{let c,p;return u(le,{show:e.visible,title:l("project.dag.basic_info"),onConfirm:S,onCancel:y,autoFocus:!1},{default:()=>[u(Be,{model:t.value,rules:V,ref:b},{default:()=>[u(w,{label:l("project.dag.workflow_name"),path:"name"},{default:()=>[u(N,{allowInput:R,value:t.value.name,"onUpdate:value":r=>t.value.name=r,class:"input-name"},null)]}),u(w,{label:l("project.dag.description"),path:"description"},{default:()=>[u(N,{allowInput:R,type:"textarea",value:t.value.description,"onUpdate:value":r=>t.value.description=r,class:"input-description"},null)]}),u(w,{label:l("project.dag.timeout_alert"),path:"timeoutFlag"},{default:()=>[u(Le,{value:t.value.timeoutFlag,"onUpdate:value":r=>t.value.timeoutFlag=r},null)]}),t.value.timeoutFlag&&u(w,{showLabel:!1,path:"timeout"},{default:()=>[u(De,{value:t.value.timeout,"onUpdate:value":r=>t.value.timeout=r,"show-button":!1,min:0},{suffix:()=>l("project.dag.minute")})]}),!e.instance&&u(w,{label:l("project.dag.process_execute_type"),path:"executionType"},{default:()=>[u(J,{options:[{value:"PARALLEL",label:l("project.dag.parallel")},{value:"SERIAL_WAIT",label:l("project.dag.serial_wait")},{value:"SERIAL_DISCARD",label:l("project.dag.serial_discard")},{value:"SERIAL_PRIORITY",label:l("project.dag.serial_priority")}],value:t.value.executionType,"onUpdate:value":r=>t.value.executionType=r},null)]}),u(w,{label:l("project.dag.global_variables"),path:"globalParams"},{default:()=>[u(qe,{value:t.value.globalParams,"onUpdate:value":r=>t.value.globalParams=r,onCreate:()=>({key:"",direct:"IN",value:""}),class:"input-global-params"},{default:r=>u(Te,{xGap:12,cols:24},{default:()=>[u(E,{span:9},{default:()=>[u(N,{value:r.value.key,"onUpdate:value":v=>r.value.key=v,placeholder:l("project.dag.key")},null)]}),u(E,{span:6},{default:()=>[u(J,{options:[{value:"IN",label:"IN"},{value:"OUT",label:"OUT"}],value:r.value.direct,"onUpdate:value":v=>r.value.direct=v,defaultValue:"IN"},null)]}),u(E,{span:9},{default:()=>[u(N,{value:r.value.value,"onUpdate:value":v=>r.value.value=v,placeholder:l("project.dag.value")},null)]})]})})]}),e.definition&&!e.instance&&u(w,{path:"timeoutFlag",showLabel:!1},{default:()=>[u(Q,{checked:t.value.release,"onUpdate:checked":r=>t.value.release=r},X(c=l("project.dag.online_directly"))?c:{default:()=>[c]})]}),e.instance&&u(w,{path:"sync",showLabel:!1},{default:()=>[u(Q,{checked:t.value.sync,"onUpdate:checked":r=>t.value.sync=r},X(p=l("project.dag.update_directly"))?p:{default:()=>[p]})]})]})]})}}});export{Et as default};
