import{u as F,bq as a,aL as g,a as f,by as u,w as I,d as w,e as v,at as U,ba as N,c as t,al as b}from"./index.851b5188.js";import{g as C,u as _}from"./index.58f13220.js";import{C as y}from"./index.6c124806.js";import{M as R}from"./index.e69e8738.js";import M from"./info.101c3e24.js";import{N as S}from"./Button.4e249408.js";import{N as q}from"./Form.9f7fa8c1.js";import{N as l}from"./FormItem.f5b3f80b.js";import{N as n}from"./Input.79ba0d48.js";import"./service.4be3af67.js";import"./ui-setting.39219f0f.js";import"./lodash.68b7405b.js";import"./Card.19bc42e2.js";import"./resolve-slot.9e6a0162.js";import"./index.7a579f81.js";import"./keysOf.ab13e590.js";import"./index.8acb741a.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./utils.f449ed5c.js";import"./is-browser.45c3bd93.js";import"./index.3ef69258.js";import"./Space.f9ece73f.js";import"./get-slot.80096ab3.js";import"./use-form-item.bb4d7ada.js";import"./format-length.d7d829b3.js";import"./get.aa32335f.js";import"./use-locale.f8ac8f2c.js";import"./use-merged-state.e40d3a9f.js";import"./Suffix.21a8a87f.js";function x(){const{t:e,locale:i}=F(),r=a().userInfo,o=g({profileFormRef:f(),profileForm:{username:r.userName,email:r.email,phone:r.phone},saving:!1,rules:{username:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.username==="")return new Error(e("profile.username_tips"))}},email:{trigger:["input","blur"],required:!0,validator(){if(o.profileForm.email==="")return new Error(e("profile.email_tips"));if(!u.regex.email.test(o.profileForm.email||""))return new Error(e("profile.email_correct_tips"))}}}});return I(r,()=>{o.profileForm={username:r.userName,email:r.email,phone:r.phone}}),{state:o,t:e,locale:i}}function j(){const e=a();return{getUserInfo:async()=>{const r=await C();await e.setUserInfo(r)}}}function E(e){const r=a().userInfo;return{handleUpdate:async()=>{if(await e.profileFormRef.validate(),e.saving!==!0){e.saving=!0;try{await _({userPassword:"",id:r.id,userName:e.profileForm.username,tenantId:r.tenantId,email:e.profileForm.email,phone:e.profileForm.phone,state:r.state,queue:r.queue}),e.saving=!1}catch{e.saving=!1}}}}}function L(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!b(e)}const Fe=w({name:"profile",setup(){var p;const e=a().userInfo,i=f(!1),{state:r,t:o}=x(),{handleUpdate:s}=E(r),{getUserInfo:m}=j();v(async()=>{await m()});const c=()=>{i.value=!1,r.profileForm.email=e.email,r.profileForm.phone=e.phone,r.profileForm.username=e.userName},d=async()=>{i.value=!1,await s(),await m()},h=(p=U())==null?void 0:p.appContext.config.globalProperties.trim;return{...N(r),showModalRef:i,t:o,onCancel:c,onConfirm:d,trim:h}},render(){const{t:e,onCancel:i,onConfirm:r}=this;return t("div",null,[t(y,{title:e("profile.profile")},{default:()=>t(M,null,null),"header-extra":()=>{let o;return t(S,{type:"info",size:"small",onClick:()=>this.showModalRef=!this.showModalRef},L(o=e("profile.edit"))?o:{default:()=>[o]})}}),t(R,{title:e("profile.edit_profile"),show:this.showModalRef,onCancel:i,onConfirm:r,confirmDisabled:!this.profileForm.username||!this.profileForm.email||!u.regex.email.test(this.profileForm.email),confirmLoading:this.saving},{default:()=>t(q,{rules:this.rules,ref:"profileFormRef"},{default:()=>[t(l,{label:e("profile.username"),path:"username"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.username,"onUpdate:value":o=>this.profileForm.username=o,placeholder:e("profile.username_tips")},null)]}),t(l,{label:e("profile.email"),path:"email"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.email,"onUpdate:value":o=>this.profileForm.email=o,placeholder:e("profile.email_tips")},null)]}),t(l,{label:e("profile.phone"),path:"phone"},{default:()=>[t(n,{allowInput:this.trim,value:this.profileForm.phone,"onUpdate:value":o=>this.profileForm.phone=o,placeholder:e("profile.phone_tips")},null)]})]})})])}});export{Fe as default};
