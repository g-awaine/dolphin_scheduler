import{d as T,b7 as I,b8 as D,b9 as P,u as M,bI as E,aL as $,t as o,at as q,e as A,$ as F,w as j,ba as G,c as s}from"./index.851b5188.js";import{d as X,q as Y,s as J,b as K,L as Q,a as Z}from"./index.d95f3dc5.js";import{r as z,S as ee,p as b,t as te,a as ae}from"./common.ee372ad3.js";import{D as oe,C as n,c as re}from"./column-width-config.4c11a147.js";import{A as se}from"./AlignLeftOutlined.db1eb979.js";import{D as ie}from"./DownloadOutlined.2b4ed5b8.js";import{f as L}from"./index.d671386a.js";import{N as f}from"./Tooltip.52cb9ce9.js";import{N as g}from"./Button.4e249408.js";import{N as d}from"./Icon.afc45566.js";import{N}from"./Space.f9ece73f.js";import{N as le}from"./Spin.447cad15.js";import{u as ne}from"./index.73124cc7.js";import{u as ce}from"./ui-setting.39219f0f.js";import{C as x}from"./index.6c124806.js";import{S as pe}from"./SearchOutlined.3b9a5586.js";import{N as S}from"./Input.79ba0d48.js";import{a as me}from"./Select.3e0f2c28.js";import{N as ue}from"./DatePicker.b69ef36a.js";import{N as de,a as he}from"./DataTable.0e9ec324.js";import"./service.4be3af67.js";import"./lodash.68b7405b.js";import"./index.e69e8738.js";import"./index.8acb741a.js";import"./keysOf.ab13e590.js";import"./Card.19bc42e2.js";import"./resolve-slot.9e6a0162.js";import"./index.7a579f81.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./utils.f449ed5c.js";import"./is-browser.45c3bd93.js";import"./index.3ef69258.js";import"./SyncOutlined.95d4ed16.js";import"./FullscreenOutlined.01f40161.js";import"./use-locale.f8ac8f2c.js";import"./throttle.821ebb8d.js";import"./debounce.948fb11c.js";import"./toNumber.c7e8ca68.js";import"./SettingOutlined.e20148d7.js";import"./PauseCircleOutlined.28d888d0.js";import"./CloseCircleOutlined.9e282d8c.js";import"./CheckCircleOutlined.67794958.js";import"./EditOutlined.e0b6da4a.js";import"./Popover.30015336.js";import"./_baseMap.9542141b.js";import"./get.aa32335f.js";import"./format-length.d7d829b3.js";import"./use-merged-state.e40d3a9f.js";import"./use-compitable.ae5454ac.js";import"./next-frame-once.e5ee25e8.js";import"./use-form-item.bb4d7ada.js";import"./get-slot.80096ab3.js";import"./Suffix.21a8a87f.js";import"./Selection.28a32045.js";import"./typeof.b54b2da3.js";import"./use-keyboard.f4d2f0c0.js";import"./Forward.bddcd6d4.js";import"./ArrowDown.45f9e719.js";import"./Checkbox.98b84c16.js";import"./RadioGroup.c3ead4f3.js";import"./Radio.fc32ca3b.js";import"./Dropdown.4af83811.js";import"./ChevronRight.d6536995.js";import"./Ellipsis.b13f7726.js";const fe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},ge=P("path",{d:"M136 552h63.6c4.4 0 8-3.6 8-8V288.7h528.6v72.6c0 1.9.6 3.7 1.8 5.2a8.3 8.3 0 0 0 11.7 1.4L893 255.4c4.3-5 3.6-10.3 0-13.2L749.7 129.8a8.22 8.22 0 0 0-5.2-1.8c-4.6 0-8.4 3.8-8.4 8.4V209H199.7c-39.5 0-71.7 32.2-71.7 71.8V544c0 4.4 3.6 8 8 8zm752-80h-63.6c-4.4 0-8 3.6-8 8v255.3H287.8v-72.6c0-1.9-.6-3.7-1.8-5.2a8.3 8.3 0 0 0-11.7-1.4L131 768.6c-4.3 5-3.6 10.3 0 13.2l143.3 112.4c1.5 1.2 3.3 1.8 5.2 1.8c4.6 0 8.4-3.8 8.4-8.4V815h536.6c39.5 0 71.7-32.2 71.7-71.8V480c-.2-4.4-3.8-8-8.2-8z",fill:"currentColor"},null,-1),ke=[ge],Ne=T({name:"RetweetOutlined",render:function(c,i){return I(),D("svg",fe,ke)}}),ye={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},we=P("path",{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144s144-64.5 144-144s-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80s80 35.8 80 80s-35.8 80-80 80z",fill:"currentColor"},null,-1),Se=[we],Re=T({name:"SaveOutlined",render:function(c,i){return I(),D("svg",ye,Se)}});function Ce(){const{t}=M(),c=E(),i=Number(c.params.projectCode),p=Number(c.params.processInstanceId),e=$({columns:[],tableWidth:oe,tableData:[],page:1,pageSize:10,searchVal:null,processInstanceId:p||null,host:null,stateType:null,datePickerRange:null,executorName:null,processDefinitionName:null,totalPage:1,showModalRef:!1,row:{},loadingRef:!1,logRef:"",logLoadingRef:!0,skipLineNum:0,limit:1e3}),m=l=>{l.columns=[{title:"#",key:"index",render:(a,C)=>C+1,...n.index},{title:t("project.task.task_name"),key:"name",...n.name},{title:t("project.task.workflow_name"),key:"processDefinitionName",...n.name},{title:t("project.task.node_type"),key:"taskType",...n.type},{title:t("project.task.state"),key:"state",...n.state,render:a=>ve(a.state,t)},{title:t("project.task.executor"),key:"executorName",...n.name},{title:t("project.task.host"),key:"host",...n.name,render:a=>a.host||"-"},{title:t("project.task.app_id"),key:"applicationID",...n.name,render:a=>a.applicationID||"-"},{title:t("project.task.dry_run_flag"),key:"dryRun",...n.dryRun,render:a=>a.dryRun===1?"YES":"NO"},{title:t("project.task.start_time"),...n.time,key:"startTime",render:a=>z(a.startTime)},{title:t("project.task.end_time"),...n.time,key:"endTime",render:a=>z(a.endTime)},{title:t("project.task.duration"),key:"duration",...n.duration,render:a=>o("span",null,a.duration?a.duration:"-")},{title:t("project.task.operation"),key:"operation",...n.operation(5),render(a){return o(N,null,{default:()=>[o(f,{},{trigger:()=>o(g,{tag:"div",circle:!0,type:"info",size:"small",onClick:()=>R(a.id)},{icon:()=>o(d,null,{default:()=>o(Re)})}),default:()=>t("project.task.savepoint")}),o(f,{},{trigger:()=>o(g,{tag:"div",circle:!0,type:"info",size:"small",onClick:()=>u(a.id)},{icon:()=>o(d,null,{default:()=>o(ee)})}),default:()=>t("project.task.stop")}),o(f,{},{trigger:()=>o(g,{circle:!0,type:"info",size:"small",disabled:!a.host,onClick:()=>h(a)},{icon:()=>o(d,null,{default:()=>o(se)})}),default:()=>t("project.task.view_log")}),o(f,{},{trigger:()=>o(g,{circle:!0,type:"info",size:"small",onClick:()=>X(a.id)},{icon:()=>o(d,null,{default:()=>o(ie)})}),default:()=>t("project.task.download_log")}),o(f,{},{trigger:()=>o(g,{circle:!0,type:"warning",size:"small",disabled:!0,tag:"div"},{icon:()=>o(d,null,{default:()=>o(Ne)})}),default:()=>t("project.task.jump_tip")})]})}}],l.tableWidth&&(l.tableWidth=re(l.columns))},h=l=>{e.showModalRef=!0,e.row=l},r=()=>{if(e.loadingRef)return;e.loadingRef=!0;const l={pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal,processInstanceId:e.processInstanceId,host:e.host,stateType:e.stateType,startDate:e.datePickerRange?L(b(e.datePickerRange[0]),"yyyy-MM-dd HH:mm:ss"):"",endDate:e.datePickerRange?L(b(e.datePickerRange[1]),"yyyy-MM-dd HH:mm:ss"):"",executorName:e.executorName,processDefinitionName:e.processDefinitionName,taskExecuteType:"STREAM"};Y(l,{projectCode:i}).then(a=>{e.tableData=[...a.totalList],e.totalPage=a.totalPage}).finally(()=>e.loadingRef=!1)},u=l=>{J(i,l).then(()=>{window.$message.success(t("project.task.success")),r()})},R=l=>{K(i,l).then(()=>{window.$message.success(t("project.task.success")),r()})};return{t,variables:e,getTableData:r,createColumns:m}}function ve(t,c){if(!t)return"";const i=te(c)[t],p=o(d,{color:i.color,class:i.classNames,style:{display:"flex"},size:20},()=>o(i.icon));return o(f,null,{trigger:()=>i.isSpin?o(le,{size:20},{icon:()=>p}):p,default:()=>i.desc})}const Bt=T({name:"task-instance",setup(){var _;let t;const i=ce().getLogTimer,{t:p,variables:e,getTableData:m,createColumns:h}=Ce(),r=()=>{e.page=1,m()},u=()=>{e.page=1,m()},R=()=>{e.searchVal=null,u()},l=()=>{e.processDefinitionName=null,u()},a=()=>{e.executorName=null,u()},C=()=>{e.host=null,u()},V=()=>{e.stateType=null,u()},U=()=>{e.datePickerRange=null,u()},H=()=>{e.showModalRef=!1},y=(k,v)=>{const{state:B}=ne(Z({taskInstanceId:Number(k.id),limit:e.limit,skipLineNum:e.skipLineNum}).then(w=>{e.logRef+=w.message||"",w&&w.message!==""?(e.limit+=1e3,e.skipLineNum+=w.lineNum,y(k,v)):(e.logLoadingRef=!1,setTimeout(()=>{e.logRef="",e.limit=1e3,e.skipLineNum=0,e.logLoadingRef=!0,y(k,v)},v*1e3))}),{});return B},O=k=>{e.logRef="",e.limit=1e3,e.skipLineNum=0,y(k,i)},W=(_=q())==null?void 0:_.appContext.config.globalProperties.trim;return A(()=>{h(e),m(),t=setInterval(()=>{m()},3e3)}),F(()=>{clearInterval(t)}),j(M().locale,()=>{h(e)}),j(()=>e.showModalRef,()=>{e.showModalRef?y(e.row,i):(e.row={},e.logRef="",e.logLoadingRef=!0,e.skipLineNum=0,e.limit=1e3)}),{t:p,...G(e),getTableData:m,onUpdatePageSize:r,onSearch:u,onClearSearchTaskName:R,onClearSearchWorkFlowName:l,onClearSearchExecutorName:a,onClearSearchHost:C,onClearSearchStateType:V,onClearSearchTime:U,onConfirmModal:H,refreshLogs:O,trim:W}},render(){const{t,getTableData:c,onUpdatePageSize:i,onSearch:p,onConfirmModal:e,loadingRef:m,refreshLogs:h}=this;return s(N,{vertical:!0},{default:()=>[s(x,null,{default:()=>[s(N,{justify:"end",wrap:!1},{default:()=>[s(S,{allowInput:this.trim,value:this.searchVal,"onUpdate:value":r=>this.searchVal=r,size:"small",placeholder:t("project.task.task_name"),clearable:!0,onClear:this.onClearSearchTaskName},null),s(S,{allowInput:this.trim,value:this.processDefinitionName,"onUpdate:value":r=>this.processDefinitionName=r,size:"small",placeholder:t("project.task.workflow_name"),clearable:!0,onClear:this.onClearSearchWorkFlowName},null),s(S,{allowInput:this.trim,value:this.executorName,"onUpdate:value":r=>this.executorName=r,size:"small",placeholder:t("project.task.executor"),clearable:!0,onClear:this.onClearSearchExecutorName},null),s(S,{allowInput:this.trim,value:this.host,"onUpdate:value":r=>this.host=r,size:"small",placeholder:t("project.task.host"),clearable:!0,onClear:this.onClearSearchHost},null),s(me,{value:this.stateType,"onUpdate:value":r=>this.stateType=r,size:"small",options:ae(t).slice(1),placeholder:t("project.task.state"),style:{width:"180px"},clearable:!0,onClear:this.onClearSearchStateType},null),s(ue,{value:this.datePickerRange,"onUpdate:value":r=>this.datePickerRange=r,type:"datetimerange",size:"small","start-placeholder":t("project.task.start_time"),"end-placeholder":t("project.task.end_time"),clearable:!0,onClear:this.onClearSearchTime},null),s(g,{size:"small",type:"primary",onClick:p},{default:()=>[s(d,null,{default:()=>[s(pe,null,null)]})]})]})]}),s(x,{title:t("project.task.stream_task")},{default:()=>[s(N,{vertical:!0},{default:()=>[s(de,{loading:m,columns:this.columns,data:this.tableData,scrollX:this.tableWidth},null),s(N,{justify:"center"},{default:()=>[s(he,{page:this.page,"onUpdate:page":r=>this.page=r,"page-size":this.pageSize,"onUpdate:page-size":r=>this.pageSize=r,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:c,onUpdatePageSize:i},null)]})]})]}),s(Q,{showModalRef:this.showModalRef,logRef:this.logRef,row:this.row,logLoadingRef:this.logLoadingRef,onConfirmModal:e,onRefreshLogs:h},null)]})}});export{Bt as default};
