import{u as x,bt as P,aL as B,a as d,t as l,d as M,bI as q,at as $,w as F,e as A,ba as G,c as i,al as H}from"./index.851b5188.js";import{_ as I}from"./lodash.68b7405b.js";import{u as X}from"./index.73124cc7.js";import{u as J}from"./use-text-copy.448fed4f.js";import{j as Q,k as Y,l as O,r as Z,f as ee,m as te}from"./index.23da2c90.js";import oe from"./table-action.4b3500d3.js";import{s as re,S as ae}from"./start-modal.f3a76e73.js";import{B as ie}from"./index.8acb741a.js";import{D as se,C as c,c as le}from"./column-width-config.4c11a147.js";import{C as ne}from"./CopyOutlined.8195d297.js";import{U as ce}from"./UnorderedListOutlined.0c9d10b6.js";import{N as pe}from"./Ellipsis.b13f7726.js";import{N as h}from"./Space.f9ece73f.js";import{N as m}from"./Button.4e249408.js";import{N as V}from"./Icon.afc45566.js";import{N as S}from"./Tooltip.52cb9ce9.js";import{d as R}from"./Selection.28a32045.js";import{u as de}from"./ui-setting.39219f0f.js";import{C as K}from"./index.6c124806.js";import me from"./import-modal.7436fe42.js";import we from"./timing-modal.53376ee1.js";import fe from"./version-modal.4c6e3cbb.js";import he from"./copy-modal.133fc141.js";import{S as ue}from"./index.94a7e931.js";import{S as ge}from"./SearchOutlined.3b9a5586.js";import{N as ke,a as ye}from"./DataTable.0e9ec324.js";import{N as Se}from"./Popconfirm.013915ef.js";import{N as je}from"./index.e69e8738.js";import"./use-message.e3f85643.js";import"./service.4be3af67.js";import"./FormOutlined.42f04dba.js";import"./PlayCircleOutlined.28a7c420.js";import"./DownloadOutlined.2b4ed5b8.js";import"./UploadOutlined.8bf7c13f.js";import"./InfoCircleFilled.b53f03a6.js";import"./DeleteOutlined.07e1d3fe.js";import"./ApartmentOutlined.5a241ee1.js";import"./Popover.30015336.js";import"./index.e739cd60.js";import"./flatten.05a2e46f.js";import"./Scrollbar.7a99b971.js";import"./fade-in.cssr.55dfcced.js";import"./VResizeObserver.6721b9ea.js";import"./use-false-until-truthy.5d7093c9.js";import"./_baseMap.9542141b.js";import"./get.aa32335f.js";import"./utils.f449ed5c.js";import"./format-length.d7d829b3.js";import"./resolve-slot.9e6a0162.js";import"./use-merged-state.e40d3a9f.js";import"./use-compitable.ae5454ac.js";import"./next-frame-once.e5ee25e8.js";import"./is-browser.45c3bd93.js";import"./use-form-item.bb4d7ada.js";import"./use-locale.f8ac8f2c.js";import"./keysOf.ab13e590.js";import"./get-slot.80096ab3.js";import"./index.7a579f81.js";import"./use-modal.a8c92e75.js";import"./index.2d754617.js";import"./index.71fea87c.js";import"./index.b3847370.js";import"./index.834fe2cc.js";import"./common.ee372ad3.js";import"./SettingOutlined.e20148d7.js";import"./PauseCircleOutlined.28d888d0.js";import"./CloseCircleOutlined.9e282d8c.js";import"./CheckCircleOutlined.67794958.js";import"./EditOutlined.e0b6da4a.js";import"./index.d671386a.js";import"./index.57e264b5.js";import"./ArrowUpOutlined.284f08d8.js";import"./PlusCircleOutlined.b025a581.js";import"./Form.9f7fa8c1.js";import"./FormItem.f5b3f80b.js";import"./RadioGroup.c3ead4f3.js";import"./Radio.fc32ca3b.js";import"./Select.3e0f2c28.js";import"./fade-in-scale-up.cssr.5737b1c6.js";import"./index.3ef69258.js";import"./Checkbox.98b84c16.js";import"./Input.79ba0d48.js";import"./Suffix.21a8a87f.js";import"./RadioButton.cdb434b9.js";import"./DatePicker.b69ef36a.js";import"./typeof.b54b2da3.js";import"./use-keyboard.f4d2f0c0.js";import"./Forward.bddcd6d4.js";import"./Switch.f95d65b1.js";import"./Card.19bc42e2.js";import"./Upload.62ae1afa.js";import"./Add.3164a73d.js";import"./Image.2f947741.js";import"./CloudUploadOutlined.ffad40df.js";import"./timezone.01550da9.js";import"./InputNumber.cc83334e.js";import"./Tabs.f9e4f691.js";import"./throttle.821ebb8d.js";import"./debounce.948fb11c.js";import"./toNumber.c7e8ca68.js";import"./index.35726d3e.js";import"./InputGroup.205f411e.js";import"./ExclamationCircleOutlined.f43290af.js";import"./ArrowDown.45f9e719.js";import"./Dropdown.4af83811.js";import"./ChevronRight.d6536995.js";import"./index.605d19c5.js";function be(){const{t:a}=x(),p=P(),{copy:w}=J(),e=B({columns:[],tableWidth:se,checkedRowKeys:[],row:{},tableData:[],projectCode:d(Number(p.currentRoute.value.params.projectCode)),page:d(1),pageSize:d(10),searchVal:d(),totalPage:d(1),showRef:d(!1),startShowRef:d(!1),timingShowRef:d(!1),versionShowRef:d(!1),copyShowRef:d(!1),loadingRef:d(!1),setTimingDialogShowRef:d(!1)}),s=r=>{r.columns=[{type:"selection",className:"btn-selected",...c.selection},{title:"#",key:"id",...c.index,render:(o,n)=>n+1},{title:a("project.workflow.workflow_name"),key:"name",className:"workflow-name",...c.name,titleColSpan:3,resizable:!0,width:300,minWidth:300,maxWidth:600,render:o=>l(h,{justify:"space-between",wrap:!1,class:re["workflow-name"]},{default:()=>l(ie,{onClick:()=>{const n=p.resolve({name:"workflow-definition-detail",params:{code:o.code}});window.open(n.href,"_blank")}},{default:()=>l(pe,{style:"max-width: 580px;line-height: 1.5"},()=>o.name)})})},{title:"Copy",key:"copy",...c.copy,render:o=>l(S,null,{trigger:()=>l(m,{quaternary:!0,circle:!0,type:"info",size:"tiny",onClick:()=>void w(o.name)},{icon:()=>l(V,{size:16},()=>l(ne))}),default:()=>a("project.workflow.copy_workflow_name")})},{title:"Instances",key:"instances",...c.instances,render:o=>l(S,null,{trigger:()=>l(m,{quaternary:!0,circle:!0,type:"info",size:"tiny",onClick:()=>{p.push({name:"workflow-instance-list",query:{processDefineCode:o.code}})}},{icon:()=>l(V,{size:18},()=>l(ce))}),default:()=>a("project.workflow.visit_workflow_instances")})},{title:a("project.workflow.status"),key:"releaseState",...c.state,render:o=>o.releaseState==="ONLINE"?l(R,{type:"success",size:"small"},{default:()=>a("project.workflow.up_line")}):l(R,{type:"warning",size:"small"},{default:()=>a("project.workflow.down_line")})},{title:a("project.workflow.schedule_publish_status"),key:"scheduleReleaseState",...c.state,render:o=>o.scheduleReleaseState==="ONLINE"?l(R,{type:"success",size:"small"},{default:()=>a("project.workflow.up_line")}):o.scheduleReleaseState==="OFFLINE"?l(R,{type:"warning",size:"small"},{default:()=>a("project.workflow.down_line")}):"-"},{title:a("project.workflow.create_time"),key:"createTime",...c.time},{title:a("project.workflow.update_time"),key:"updateTime",...c.time},{title:a("project.workflow.description"),key:"description",...c.note},{title:a("project.workflow.create_user"),key:"userName",...c.userName},{title:a("project.workflow.modify_user"),key:"modifyBy",...c.userName},{title:a("project.workflow.operation"),key:"operation",...c.operation(10),render:o=>l(oe,{row:o,onEditWorkflow:()=>t(o),onStartWorkflow:()=>j(o),onTimingWorkflow:()=>N(o),onVersionWorkflow:()=>_(o),onDeleteWorkflow:()=>z(o),onReleaseWorkflow:()=>T(o),onCopyWorkflow:()=>D(o),onExportWorkflow:()=>L(o),onGotoTimingManage:()=>C(o),onGotoWorkflowTree:()=>v(o)})}],r.tableWidth&&(r.tableWidth=le(r.columns))},t=r=>{e.row=r,p.push({name:"workflow-definition-detail",params:{code:r.code}})},j=r=>{e.startShowRef=!0,e.row=r},N=r=>{e.timingShowRef=!0,e.row=r},_=r=>{e.versionShowRef=!0,e.row=r},z=r=>{Q(e.projectCode,r.code).then(()=>{window.$message.success(a("project.workflow.success")),u({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},W=()=>{const r={codes:I.join(e.checkedRowKeys,",")};Y(r,e.projectCode).then(()=>{window.$message.success(a("project.workflow.success")),e.tableData.length===e.checkedRowKeys.length&&e.page>1&&(e.page-=1),e.checkedRowKeys=[],u({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},f=()=>{const r="workflow_"+new Date().getTime(),o={codes:I.join(e.checkedRowKeys,",")};O(o,e.projectCode).then(n=>{b(n,r),window.$message.success(a("project.workflow.success")),e.checkedRowKeys=[]})},U=()=>{},T=r=>{const o={name:r.name,releaseState:r.releaseState==="ONLINE"?"OFFLINE":"ONLINE"};Z(o,e.projectCode,r.code).then(()=>{o.releaseState==="ONLINE"?(e.setTimingDialogShowRef=!0,e.row=r):window.$message.success(a("project.workflow.success")),u({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},D=r=>{const o={codes:String(r.code),targetProjectCode:e.projectCode};ee(o,e.projectCode).then(()=>{window.$message.success(a("project.workflow.success")),u({pageSize:e.pageSize,pageNo:e.page,searchVal:e.searchVal})})},b=(r,o="json")=>{if(!r)return;const n=new Blob([r]),g=`${o}.json`;if("download"in document.createElement("a")){const E=window.URL.createObjectURL(n),k=document.createElement("a");k.style.display="none",k.href=E,k.setAttribute("download",g),document.body.appendChild(k),k.click(),document.body.removeChild(k),window.URL.revokeObjectURL(E)}else window.navigator.msSaveBlob&&window.navigator.msSaveBlob(n,g)},L=r=>{const o="workflow_"+new Date().getTime(),n={codes:String(r.code)};O(n,e.projectCode).then(g=>{b(g,o)})},C=r=>{p.push({name:"workflow-definition-timing",params:{projectCode:e.projectCode,definitionCode:r.code}})},v=r=>{p.push({name:"workflow-definition-tree",params:{projectCode:e.projectCode,definitionCode:r.code}})},u=r=>{if(e.loadingRef)return;e.loadingRef=!0;const{state:o}=X(te({...r},e.projectCode).then(n=>{e.totalPage=n.totalPage,e.tableData=n.totalList.map(g=>({...g})),e.loadingRef=!1}),{total:0,table:[]});return o};return{variables:e,createColumns:s,getTableData:u,batchDeleteWorkflow:W,batchExportWorkflow:f,batchCopyWorkflow:U,gotoTimingManage:C}}function y(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!H(a)}const Co=M({name:"WorkflowDefinitionList",setup(){var o;const a=P(),p=q(),w=Number(p.params.projectCode),e=de(),{variables:s,createColumns:t,getTableData:j,batchDeleteWorkflow:N,batchExportWorkflow:_,batchCopyWorkflow:z,gotoTimingManage:W}=be(),f=()=>{j({pageSize:s.pageSize,pageNo:s.page,searchVal:s.searchVal})},U=()=>{f()},T=()=>{s.checkedRowKeys=[],f()},D=()=>{W(s.row)},b=()=>{s.page=1,f()},L=()=>{s.page=1,j({pageSize:s.pageSize,pageNo:s.page,searchVal:""})},C=()=>{s.page=1,f()},v=()=>{a.push({path:`/projects/${w}/workflow/definitions/create`})},u=()=>{a.push({path:`/projects/${w}/workflow/definitions/create`,query:{dynamic:"true"}})},r=(o=$())==null?void 0:o.appContext.config.globalProperties.trim;return F(x().locale,()=>{t(s)}),A(()=>{t(s),f()}),{requestData:f,handleSearch:b,onClearSearch:L,handleUpdateList:U,createDefinition:v,createDefinitionDynamic:u,handleChangePageSize:C,batchDeleteWorkflow:N,batchExportWorkflow:_,batchCopyWorkflow:z,handleCopyUpdateList:T,confirmToSetWorkflowTiming:D,...G(s),uiSettingStore:e,trim:r}},render(){let a,p,w;const{t:e}=x(),{loadingRef:s}=this;return i(h,{vertical:!0},{default:()=>[i(K,null,{default:()=>[i(h,{justify:"space-between"},{default:()=>[i(h,null,{default:()=>[i(m,{type:"primary",size:"small",onClick:this.createDefinition,class:"btn-create-process"},y(a=e("project.workflow.create_workflow"))?a:{default:()=>[a]}),this.uiSettingStore.getDynamicTask&&i(m,{type:"warning",size:"small",onClick:this.createDefinitionDynamic},y(p=e("project.workflow.create_workflow_dynamic"))?p:{default:()=>[p]}),i(m,{strong:!0,secondary:!0,size:"small",onClick:()=>this.showRef=!0},y(w=e("project.workflow.import_workflow"))?w:{default:()=>[w]})]}),i(h,null,{default:()=>[i(ue,{placeholder:e("resource.function.enter_keyword_tips"),value:this.searchVal,"onUpdate:value":t=>this.searchVal=t,onSearch:this.handleSearch,onClear:this.onClearSearch},null),i(m,{type:"primary",size:"small",onClick:this.handleSearch},{default:()=>[i(V,null,{default:()=>[i(ge,null,null)]})]})]})]})]}),i(K,{title:e("project.workflow.workflow_definition")},{default:()=>[i(h,{vertical:!0},{default:()=>[i(ke,{loading:s,rowKey:t=>t.code,columns:this.columns,data:this.tableData,striped:!0,"checked-row-keys":this.checkedRowKeys,"onUpdate:checked-row-keys":t=>this.checkedRowKeys=t,"row-class-name":"items",scrollX:this.tableWidth},null),i(h,{justify:"space-between"},{default:()=>[i(h,null,{default:()=>[i(S,null,{default:()=>e("project.workflow.batch_delete"),trigger:()=>i(Se,{onPositiveClick:this.batchDeleteWorkflow},{default:()=>e("project.workflow.delete_confirm"),trigger:()=>{let t;return i(m,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,class:"btn-delete-all"},y(t=e("project.workflow.batch_delete"))?t:{default:()=>[t]})}})}),i(S,null,{default:()=>e("project.workflow.batch_export"),trigger:()=>{let t;return i(m,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:this.batchExportWorkflow,class:"btn-delete-all"},y(t=e("project.workflow.batch_export"))?t:{default:()=>[t]})}}),i(S,null,{default:()=>e("project.workflow.batch_copy"),trigger:()=>{let t;return i(m,{tag:"div",size:"small",type:"primary",disabled:this.checkedRowKeys.length<=0,onClick:()=>this.copyShowRef=!0,class:"btn-delete-all"},y(t=e("project.workflow.batch_copy"))?t:{default:()=>[t]})}})]}),i(ye,{page:this.page,"onUpdate:page":t=>this.page=t,"page-size":this.pageSize,"onUpdate:page-size":t=>this.pageSize=t,"page-count":this.totalPage,"show-size-picker":!0,"page-sizes":[10,30,50],"show-quick-jumper":!0,onUpdatePage:this.requestData,onUpdatePageSize:this.handleChangePageSize},null)]})]})]}),i(me,{show:this.showRef,"onUpdate:show":t=>this.showRef=t,onUpdateList:this.handleUpdateList},null),i(ae,{row:this.row,"onUpdate:row":t=>this.row=t,show:this.startShowRef,"onUpdate:show":t=>this.startShowRef=t,onUpdateList:this.handleUpdateList},null),i(we,{row:this.row,"onUpdate:row":t=>this.row=t,show:this.timingShowRef,"onUpdate:show":t=>this.timingShowRef=t,onUpdateList:this.handleUpdateList},null),i(fe,{row:this.row,"onUpdate:row":t=>this.row=t,show:this.versionShowRef,"onUpdate:show":t=>this.versionShowRef=t,onUpdateList:this.handleUpdateList},null),i(he,{codes:this.checkedRowKeys,"onUpdate:codes":t=>this.checkedRowKeys=t,show:this.copyShowRef,"onUpdate:show":t=>this.copyShowRef=t,onUpdateList:this.handleCopyUpdateList},null),i(je,{show:this.setTimingDialogShowRef,"onUpdate:show":t=>this.setTimingDialogShowRef=t,preset:"dialog",title:e("project.workflow.success"),content:e("project.workflow.want_to_set_timing"),positiveText:e("project.workflow.confirm"),negativeText:e("project.workflow.cancel"),maskClosable:!1,onPositiveClick:this.confirmToSetWorkflowTiming},null)]})}});export{Co as default};
