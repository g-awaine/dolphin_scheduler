[INFO] 2024-04-24 11:01:12.861 +0800 - ***********************************************************************************************
[INFO] 2024-04-24 11:01:12.862 +0800 - *********************************  Initialize task context  ***********************************
[INFO] 2024-04-24 11:01:12.862 +0800 - ***********************************************************************************************
[INFO] 2024-04-24 11:01:12.862 +0800 - Begin to initialize task
[INFO] 2024-04-24 11:01:12.862 +0800 - Set task startTime: 1713927672862
[INFO] 2024-04-24 11:01:12.862 +0800 - Set task appId: 578_1446
[INFO] 2024-04-24 11:01:12.862 +0800 - End initialize task {
  "taskInstanceId" : 1446,
  "taskName" : "spark preprocessing",
  "firstSubmitTime" : 1713927672854,
  "startTime" : 1713927672862,
  "taskType" : "SHELL",
  "workflowInstanceHost" : "172.18.0.9:5678",
  "host" : "172.18.1.1:1234",
  "logPath" : "/opt/dolphinscheduler/logs/20240424/13201021801792/110/578/1446.log",
  "processId" : 0,
  "processDefineCode" : 13201021801792,
  "processDefineVersion" : 110,
  "processInstanceId" : 578,
  "scheduleTime" : 0,
  "globalParams" : "[{\"prop\":\"folder\",\"direct\":\"IN\",\"type\":\"VARCHAR\",\"value\":\"processing\"}]",
  "executorId" : 1,
  "cmdTypeIfComplement" : 0,
  "tenantCode" : "default",
  "processDefineId" : 0,
  "projectId" : 0,
  "projectCode" : 13010050770016,
  "taskParams" : "{\"localParams\":[],\"rawScript\":\"$SPARK_HOME/bin/spark-submit \\\\\\n    --master local \\\\\\n    --deploy-mode client \\\\\\n    --conf spark.driver.cores=1 \\\\\\n    --conf spark.driver.memory=1G \\\\\\n    --conf spark.executor.instances=1 \\\\\\n    --conf spark.executor.cores=1 \\\\\\n    --conf spark.executor.memory=1G \\\\\\n    --name reddit_preprocessing \\\\\\n    --files ${raw_file_dir} \\\\\\n    -packages org.apache.spark:spark-sql-kafka-0-10_2.13:3.5.1 \\\\\\n    --conf spark.driver.extraJavaOptions=\\\"-Divy.cache.dir=/tmp -Divy.home=/tmp\\\" \\\\\\n    spark_reddit_preprocessing.py\\n\\n#     --jars spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar \\\\\",\"resourceList\":[{\"id\":null,\"resourceName\":\"file:/dolphinscheduler/default/resources/spark_reddit_preprocessing.py\",\"res\":null},{\"id\":null,\"resourceName\":\"file:/dolphinscheduler/default/resources/spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar\",\"res\":null}]}",
  "environmentConfig" : "export SPARK_HOME=/opt/spark-3.5.1-bin-hadoop3-scala2.13\nexport JAVA_HOME=/opt/java/openjdk\nexport PYSPARK_DRIVER_PYTHON=/bin/python3.11\nexport PYTHON_LAUNCHER=/bin/python3.11\nexport PYSPARK_PYTHON=/bin/python3.11",
  "prepareParamsMap" : {
    "system.task.definition.name" : {
      "prop" : "system.task.definition.name",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "spark preprocessing"
    },
    "system.project.name" : {
      "prop" : "system.project.name",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : null
    },
    "REDDIT_HOME" : {
      "prop" : "REDDIT_HOME",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "/local_storage/reddit"
    },
    "system.biz.curdate" : {
      "prop" : "system.biz.curdate",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "20240424"
    },
    "system.task.instance.id" : {
      "prop" : "system.task.instance.id",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "1446"
    },
    "system.task.definition.code" : {
      "prop" : "system.task.definition.code",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "13210058002752"
    },
    "system.datetime" : {
      "prop" : "system.datetime",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "20240424110112"
    },
    "folder" : {
      "prop" : "folder",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "processing"
    },
    "system.project.code" : {
      "prop" : "system.project.code",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "13010050770016"
    },
    "system.workflow.instance.id" : {
      "prop" : "system.workflow.instance.id",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "578"
    },
    "raw_file_dir" : {
      "prop" : "raw_file_dir",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "/local_storage/reddit/processing/500-20240423.json"
    },
    "system.biz.date" : {
      "prop" : "system.biz.date",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "20240423"
    },
    "system.workflow.definition.name" : {
      "prop" : "system.workflow.definition.name",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "preprocess_post"
    },
    "system.workflow.definition.code" : {
      "prop" : "system.workflow.definition.code",
      "direct" : "IN",
      "type" : "VARCHAR",
      "value" : "13201021801792"
    }
  },
  "taskAppId" : "578_1446",
  "taskTimeout" : 2147483647,
  "workerGroup" : "default",
  "delayTime" : 0,
  "currentExecutionStatus" : "SUBMITTED_SUCCESS",
  "endTime" : 0,
  "varPool" : "[{\"prop\":\"raw_file_dir\",\"direct\":\"IN\",\"type\":\"VARCHAR\",\"value\":\"/local_storage/reddit/processing/500-20240423.json\"}]",
  "dryRun" : 0,
  "paramsMap" : { },
  "cpuQuota" : -1,
  "memoryMax" : -1,
  "testFlag" : 0,
  "logBufferEnable" : false,
  "dispatchFailTimes" : 0
}
[INFO] 2024-04-24 11:01:12.863 +0800 - ***********************************************************************************************
[INFO] 2024-04-24 11:01:12.864 +0800 - *********************************  Load task instance plugin  *********************************
[INFO] 2024-04-24 11:01:12.864 +0800 - ***********************************************************************************************
[INFO] 2024-04-24 11:01:12.866 +0800 - Send task status RUNNING_EXECUTION master: 172.18.1.1:1234
[INFO] 2024-04-24 11:01:12.866 +0800 - TenantCode: default check successfully
[INFO] 2024-04-24 11:01:12.867 +0800 - WorkflowInstanceExecDir: /tmp/dolphinscheduler/exec/process/default/13010050770016/13201021801792_110/578/1446 check successfully
[INFO] 2024-04-24 11:01:12.867 +0800 - Create TaskChannel: org.apache.dolphinscheduler.plugin.task.shell.ShellTaskChannel successfully
[INFO] 2024-04-24 11:01:12.871 +0800 - Download resources successfully: 
ResourceContext(resourceItemMap={file:/dolphinscheduler/default/resources/spark_reddit_preprocessing.py=ResourceContext.ResourceItem(resourceAbsolutePathInStorage=file:/dolphinscheduler/default/resources/spark_reddit_preprocessing.py, resourceRelativePath=spark_reddit_preprocessing.py, resourceAbsolutePathInLocal=/tmp/dolphinscheduler/exec/process/default/13010050770016/13201021801792_110/578/1446/spark_reddit_preprocessing.py), file:/dolphinscheduler/default/resources/spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar=ResourceContext.ResourceItem(resourceAbsolutePathInStorage=file:/dolphinscheduler/default/resources/spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar, resourceRelativePath=spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar, resourceAbsolutePathInLocal=/tmp/dolphinscheduler/exec/process/default/13010050770016/13201021801792_110/578/1446/spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar)})
[INFO] 2024-04-24 11:01:12.871 +0800 - Download upstream files: [] successfully
[INFO] 2024-04-24 11:01:12.871 +0800 - Task plugin instance: SHELL create successfully
[INFO] 2024-04-24 11:01:12.872 +0800 - Initialize shell task params {
  "localParams" : [ ],
  "varPool" : null,
  "rawScript" : "$SPARK_HOME/bin/spark-submit \\\n    --master local \\\n    --deploy-mode client \\\n    --conf spark.driver.cores=1 \\\n    --conf spark.driver.memory=1G \\\n    --conf spark.executor.instances=1 \\\n    --conf spark.executor.cores=1 \\\n    --conf spark.executor.memory=1G \\\n    --name reddit_preprocessing \\\n    --files ${raw_file_dir} \\\n    -packages org.apache.spark:spark-sql-kafka-0-10_2.13:3.5.1 \\\n    --conf spark.driver.extraJavaOptions=\"-Divy.cache.dir=/tmp -Divy.home=/tmp\" \\\n    spark_reddit_preprocessing.py\n\n#     --jars spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar \\",
  "resourceList" : [ {
    "id" : null,
    "resourceName" : "file:/dolphinscheduler/default/resources/spark_reddit_preprocessing.py",
    "res" : null
  }, {
    "id" : null,
    "resourceName" : "file:/dolphinscheduler/default/resources/spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar",
    "res" : null
  } ]
}
[INFO] 2024-04-24 11:01:12.872 +0800 - Success initialized task plugin instance successfully
[INFO] 2024-04-24 11:01:12.881 +0800 - Set taskVarPool: [{"prop":"raw_file_dir","direct":"IN","type":"VARCHAR","value":"/local_storage/reddit/processing/500-20240423.json"}] successfully
[INFO] 2024-04-24 11:01:12.881 +0800 - ***********************************************************************************************
[INFO] 2024-04-24 11:01:12.881 +0800 - *********************************  Execute task instance  *************************************
[INFO] 2024-04-24 11:01:12.881 +0800 - ***********************************************************************************************
[INFO] 2024-04-24 11:01:12.882 +0800 - Final Shell file is: 
[INFO] 2024-04-24 11:01:12.882 +0800 - ****************************** Script Content *****************************************************************
[INFO] 2024-04-24 11:01:12.882 +0800 - #!/bin/bash
BASEDIR=$(cd `dirname $0`; pwd)
cd $BASEDIR
export SPARK_HOME=/opt/spark-3.5.1-bin-hadoop3-scala2.13
export JAVA_HOME=/opt/java/openjdk
export PYSPARK_DRIVER_PYTHON=/bin/python3.11
export PYTHON_LAUNCHER=/bin/python3.11
export PYSPARK_PYTHON=/bin/python3.11
$SPARK_HOME/bin/spark-submit \
    --master local \
    --deploy-mode client \
    --conf spark.driver.cores=1 \
    --conf spark.driver.memory=1G \
    --conf spark.executor.instances=1 \
    --conf spark.executor.cores=1 \
    --conf spark.executor.memory=1G \
    --name reddit_preprocessing \
    --files /local_storage/reddit/processing/500-20240423.json \
    -packages org.apache.spark:spark-sql-kafka-0-10_2.13:3.5.1 \
    --conf spark.driver.extraJavaOptions="-Divy.cache.dir=/tmp -Divy.home=/tmp" \
    spark_reddit_preprocessing.py

#     --jars spark_packages/spark-sql-kafka-0-10_2.13-3.5.1.jar \
[INFO] 2024-04-24 11:01:12.883 +0800 - ****************************** Script Content *****************************************************************
[INFO] 2024-04-24 11:01:12.883 +0800 - Executing shell command : sudo -u default -i /tmp/dolphinscheduler/exec/process/default/13010050770016/13201021801792_110/578/1446/578_1446.sh
[INFO] 2024-04-24 11:01:12.888 +0800 - process start, process id is: 1526
[INFO] 2024-04-24 11:01:13.889 +0800 -  -> 
	sudo: unable to change directory to /home/default: No such file or directory
	Error: Unrecognized option: -packages
	
[INFO] 2024-04-24 11:01:14.900 +0800 -  -> 
	Usage: spark-submit [options] <app jar | python file | R file> [app arguments]
	Usage: spark-submit --kill [submission ID] --master [spark://...]
	Usage: spark-submit --status [submission ID] --master [spark://...]
	Usage: spark-submit run-example [options] example-class [example args]
	
	Options:
	  --master MASTER_URL         spark://host:port, mesos://host:port, yarn,
	                              k8s://https://host:port, or local (Default: local[*]).
	  --deploy-mode DEPLOY_MODE   Whether to launch the driver program locally ("client") or
	                              on one of the worker machines inside the cluster ("cluster")
	                              (Default: client).
	  --class CLASS_NAME          Your application's main class (for Java / Scala apps).
	  --name NAME                 A name of your application.
	  --jars JARS                 Comma-separated list of jars to include on the driver
	                              and executor classpaths.
	  --packages                  Comma-separated list of maven coordinates of jars to include
	                              on the driver and executor classpaths. Will search the local
	                              maven repo, then maven central and any additional remote
	                              repositories given by --repositories. The format for the
	                              coordinates should be groupId:artifactId:version.
	  --exclude-packages          Comma-separated list of groupId:artifactId, to exclude while
	                              resolving the dependencies provided in --packages to avoid
	                              dependency conflicts.
	  --repositories              Comma-separated list of additional remote repositories to
	                              search for the maven coordinates given with --packages.
	  --py-files PY_FILES         Comma-separated list of .zip, .egg, or .py files to place
	                              on the PYTHONPATH for Python apps.
	  --files FILES               Comma-separated list of files to be placed in the working
	                              directory of each executor. File paths of these files
	                              in executors can be accessed via SparkFiles.get(fileName).
	  --archives ARCHIVES         Comma-separated list of archives to be extracted into the
	                              working directory of each executor.
	
	  --conf, -c PROP=VALUE       Arbitrary Spark configuration property.
	  --properties-file FILE      Path to a file from which to load extra properties. If not
	                              specified, this will look for conf/spark-defaults.conf.
	
	  --driver-memory MEM         Memory for driver (e.g. 1000M, 2G) (Default: 1024M).
	  --driver-java-options       Extra Java options to pass to the driver.
	  --driver-library-path       Extra library path entries to pass to the driver.
	  --driver-class-path         Extra class path entries to pass to the driver. Note that
	                              jars added with --jars are automatically included in the
	                              classpath.
	
	  --executor-memory MEM       Memory per executor (e.g. 1000M, 2G) (Default: 1G).
	
	  --proxy-user NAME           User to impersonate when submitting the application.
	                              This argument does not work with --principal / --keytab.
	
	  --help, -h                  Show this help message and exit.
	  --verbose, -v               Print additional debug output.
	  --version,                  Print the version of current Spark.
	
	 Spark Connect only:
	   --remote CONNECT_URL       URL to connect to the server for Spark Connect, e.g.,
	                              sc://host:port. --master and --deploy-mode cannot be set
	                              together with this option. This option is experimental, and
	                              might change between minor releases.
	
	 Cluster deploy mode only:
	  --driver-cores NUM          Number of cores used by the driver, only in cluster mode
	                              (Default: 1).
	
	 Spark standalone or Mesos with cluster deploy mode only:
	  --supervise                 If given, restarts the driver on failure.
	
	 Spark standalone, Mesos or K8s with cluster deploy mode only:
	  --kill SUBMISSION_ID        If given, kills the driver specified.
	  --status SUBMISSION_ID      If given, requests the status of the driver specified.
	
	 Spark standalone and Mesos only:
	  --total-executor-cores NUM  Total cores for all executors.
	
	 Spark standalone, YARN and Kubernetes only:
	  --executor-cores NUM        Number of cores used by each executor. (Default: 1 in
	                              YARN and K8S modes, or all available cores on the worker
	                              in standalone mode).
	
	 Spark on YARN and Kubernetes only:
	  --num-executors NUM         Number of executors to launch (Default: 2).
	                              If dynamic allocation is enabled, the initial number of
	                              executors will be at least NUM.
	  --principal PRINCIPAL       Principal to be used to login to KDC.
	  --keytab KEYTAB             The full path to the file that contains the keytab for the
	                              principal specified above.
	
	 Spark on YARN only:
	  --queue QUEUE_NAME          The YARN queue to submit to (Default: "default").
	      
[INFO] 2024-04-24 11:01:14.904 +0800 - process has exited. execute path:/tmp/dolphinscheduler/exec/process/default/13010050770016/13201021801792_110/578/1446, processId:1526 ,exitStatusCode:1 ,processWaitForStatus:true ,processExitValue:1
[INFO] 2024-04-24 11:01:14.904 +0800 - ***********************************************************************************************
[INFO] 2024-04-24 11:01:14.905 +0800 - *********************************  Finalize task instance  ************************************
[INFO] 2024-04-24 11:01:14.905 +0800 - ***********************************************************************************************
[INFO] 2024-04-24 11:01:14.906 +0800 - Upload output files: [] successfully
[INFO] 2024-04-24 11:01:14.939 +0800 - Send task execute status: FAILURE to master : 172.18.1.1:1234
[INFO] 2024-04-24 11:01:14.940 +0800 - Remove the current task execute context from worker cache
[INFO] 2024-04-24 11:01:14.947 +0800 - The current execute mode isn't develop mode, will clear the task execute file: /tmp/dolphinscheduler/exec/process/default/13010050770016/13201021801792_110/578/1446
[INFO] 2024-04-24 11:01:14.970 +0800 - Success clear the task execute file: /tmp/dolphinscheduler/exec/process/default/13010050770016/13201021801792_110/578/1446
[INFO] 2024-04-24 11:01:14.977 +0800 - FINALIZE_SESSION
